
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Документация Flask (русский перевод) 0.10.1</title>
    <link rel="stylesheet" href="_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/badge_only.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="shortcut icon" href="_static/flask-favicon.ico"/>
    <link rel="index" title="Алфавитный указатель" href="genindex.html" />
    <link rel="search" title="Поиск" href="search.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "ru", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="https://flask-russian-docs.readthedocs.io/ru/0.10.1/" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'index'
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head><body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Навигация</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">Документация Flask (русский перевод) 0.10.1</a> &#187;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>Оригинал этой страницы находится по адресу
<a class="reference external" href="http://flask-russian-docs.readthedocs.io/">http://flask-russian-docs.readthedocs.io/</a></p>
<p><strong>Краткое содержание:</strong> Попытка «человеческого» (не машинного, не кальки
с английского) перевода документации к пакету Flask (язык программирования
Python 2 и 3), выполненного с учётом синтаксиса русского языка.  Приглашаю
поучаствовать в переводе и в устранении ошибок и недостатков.  Перевод
выполняется как хобби в свободное время, с целью внесения посильного вклада
в развитие и продвижение СПО. При распространении ссылка на первоисточник
и указание авторства обязательны.</p>
<p><strong>Состояние перевода: на 10.03.2018 выполнено 62%</strong>. В целях ликвидации
многочисленных «висячих» ссылок добавлен раздел API на начальной
стадии перевода. Исправлено большинство опечаток.
Бэкпортированы некоторые мелкие исправления из свежих правок оригинальной
документации. Подключены дополнительные модули для формирования
межсайтовых ссылок.</p>
<p>Замечания и предложения можно оставить здесь:
<a class="reference external" href="https://bitbucket.org/ferm32/flask-russian-docs/issues">https://bitbucket.org/ferm32/flask-russian-docs/issues</a></p>
<p>либо отправить на почту ferm32 животное гмыло дот ком</p>
<p>либо оставлять через сервис Disqus комментарии (внизу страницы).</p>
<p>Существенная часть перевода к версии <a class="reference external" href="http://flask-russian-docs.readthedocs.io/ru/0.9/">0.9</a> выполнена
<a class="reference external" href="http://vladimir-stupin.blogspot.ru/">Владимиром Ступиным</a></p>
<div class="section" id="flask">
<h1>Добро пожаловать во Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h1>
<img alt="Flask: веб-разработка капля за каплей" class="floatingflask" src="_images/logo-full-rus.png" />
<p>Добро пожаловать в документацию по Flask.  Она разбита на следующие части.
Рекомендуем начать с раздела <a class="reference internal" href="index.html#installation"><span class="std std-ref">Инсталляция</span></a>, затем заглянуть в
<a class="reference internal" href="index.html#quickstart"><span class="std std-ref">Быстрый старт</span></a>. Помимо раздела «Быстрый старт», есть и более детальное
руководство - <a class="reference internal" href="index.html#tutorial"><span class="std std-ref">Учебник</span></a>, по которому можно создать вместе с Flask
хоть и небольшое, но полноценное приложение.  Если вы хотите
погрузиться во «внутренности» Flask, посмотрите документацию по <a class="reference internal" href="index.html#api"><span class="std std-ref">API (перевод на начальной стадии)</span></a>.
Общие шаблоны описаны в разделе <a class="reference internal" href="index.html#patterns"><span class="std std-ref">Заготовки для Flask</span></a>.</p>
<p>Flask требует наличия двух внешних библиотек: шаблонизатора <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a> и
инструментария WSGI <a class="reference external" href="http://werkzeug.pocoo.org/">Werkzeug</a>.  Здесь данные библиотеки не рассматриваются.
Если захотите углубиться в их документацию, воспользуйтесь следующими
ссылками:</p>
<ul class="simple">
<li><a class="reference external" href="http://jinja.pocoo.org/docs">Документация по Jinja2</a></li>
<li><a class="reference external" href="http://werkzeug.pocoo.org/docs">Документация по Werkzeug</a></li>
</ul>
<div class="section" id="id5">
<h2>Руководство пользователя<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h2>
<p>Эта, в значительной мере скучная часть документации, начинается с некоторой
вводной информации о Flask, а затем фокусируется на инструкциях по
веб-разработке шаг-за-шагом с использованием Flask.</p>
<div class="toctree-wrapper compound">
<span id="document-foreword"></span><div class="section" id="foreword">
<span id="id1"></span><h3>Предисловие<a class="headerlink" href="#foreword" title="Ссылка на этот заголовок">¶</a></h3>
<p>Перед началом работы с Flask начните отсюда.  Надеемся, вы получите ответы
на некоторые вопросы о задачах и назначении проекта, а также узнаете о том,
когда вам следует, а когда не следует его использовать.</p>
<div class="section" id="id2">
<h4>Что означает «микро»?<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>“Микро” не означает, что ваше веб-приложение целиком помещается в один файл
с кодом на Python, хотя, конечно же это может быть и так. Также, это не
означает, что Flask испытывает недостаток функциональности. «Микро» в слове
«микрофреймворк» означает, что Flask стремится придерживаться простого, но
расширяемого ядра. Flask не будет решать за вас многие вещи, например,
какую базу данных использовать. А те решения, которые он может принять,
например, который из движков для работы с шаблонами использовать, легко
изменить. Всё остальное зависит от вас, таким образом, может оказаться, что
Flask - всё, что вам нужно, и ничего лишнего.</p>
<p>По умолчанию, Flask не включает уровень абстракции баз данных, валидации
форм или каких-то иных, для чего уже существуют различные занимающиеся этим
библиотеки. Вместо этого, Flask поддерживает расширения для добавления
подобной функциональности в ваше приложение, таким образом, как если бы
это было реализовано в самом Flask. Многочисленные расширения обеспечивают
интеграцию с базами данных, валидацию форм, обработку загрузок на сервер,
различные открытые технологии аутентификации и так далее. Flask может
быть «микро», но при этом он готов для использования в реальных задачах
для самых разнообразных нужд.</p>
</div>
<div class="section" id="id3">
<h4>Конфигурация и Соглашения<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Flask имеет много параметров конфигурации с разумными значениями по умолчанию,
и мало предварительных соглашений.  По соглашению, шаблоны и статические
файлы хранятся в поддиректориях внутри дерева исходных текстов на Python,
с названиями <cite>templates</cite> и <cite>static</cite> соответственно. Хотя это можно и поменять,
обычно этого делать не стоит, особенно в самом начале работы.</p>
</div>
<div class="section" id="flask">
<h4>Расти вместе с Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h4>
<p>Однажды, скачав и запустив Flask, вы найдёте в сообществе множество доступных
его расширений, для их интеграции в ваш реально работающий проект. Команда
разработки ядра Flask рассматривает расширения и гарантирует, что одобренные
расширения не перестанут работать с будущими релизами.</p>
<p>Пока ваша кодовая база растёт, вы вольны принимать уместные для вашего проекта
решения.  Flak обеспечит простейший слой для склейки, выполненный настолько
хорошо, насколько это позволяет сделать Python. Вы можете реализовать
расширенные шаблоны в SQLAlchemy или в ином средстве для работы с БД, в
необходимых случаях применить надёжные нереляционные базы данных и использовать
преимущества изначально не предназначенных для работы с фреймворками средств,
построенных для работы с WSGI - веб интерфейсом для языка Python.</p>
<p>Flask для настройки его поведения содержит множество крючков (хуков).  Если
вам нужны дополнительные настройки, класс Flask построен, чтобы быть готовым
к созданию подклассов. Если это вас заинтересовало, проверьте раздел
<span class="xref std std-ref">becomingbig</span>.  Если вам любопытны принципы, в соответствии с которым
спроектирован Flask, посмотрите раздел <a class="reference internal" href="index.html#design"><span class="std std-ref">Проектные решения во Flask</span></a>.</p>
<p>Продолжение: <a class="reference internal" href="index.html#installation"><span class="std std-ref">Инсталляция</span></a>, <a class="reference internal" href="index.html#quickstart"><span class="std std-ref">Быстрый старт</span></a>, или <a class="reference internal" href="index.html#advanced-foreword"><span class="std std-ref">Предисловие для опытных программистов</span></a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/foreword/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-advanced_foreword"></span><div class="section" id="advanced-foreword">
<span id="id1"></span><h3>Предисловие для опытных программистов<a class="headerlink" href="#advanced-foreword" title="Ссылка на этот заголовок">¶</a></h3>
<div class="section" id="thread-locals-flask">
<h4>Внутрипоточные объекты (Thread-Locals) во Flask<a class="headerlink" href="#thread-locals-flask" title="Ссылка на этот заголовок">¶</a></h4>
<p>Одним из проектных решений для Flask было то, что простые задачи должны быть
простыми; они не должны требовать большого объёма кода, а ещё они не должны
ограничивать вас. Поэтому, при создании Flask было выбрано несколько решений,
которые некоторым людям могут показаться неожиданными или оригинальными.
Например, внутри себя Flask использует внутрипоточные объекты, поэтому вам
в запросе, чтобы сохранять потокобезопасность (thread-safe), необязательно
передавать объекты от функции к функции. Такой подход удобен, но требует
дейстивительный контекст запроса для внедрения зависимостей или при попытке
повторного использования кода, который использует значение, привязанное к
запросу. Flask к внутрипоточным переменным относится честно, не скрывает их
и всегда явно указывает в коде и в документации, где бы они не использовались.</p>
</div>
<div class="section" id="id2">
<h4>Разработка для Веб с осторожностью<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>При создании веб-приложений всегда думайте о безопасности.</p>
<p>Если вы пишете веб-приложение, вы, вероятно, позволяете пользователям
регистрироваться и оставлять их данные на сервере. Пользователи доверяют
вам свои данные. И даже если вы являетесь единственным пользователем,
который может внести данные в приложение, всё равно вы хотите надёжно их
сохранить.</p>
<p>К сожалению, существует множество способов, чтобы скомпрометировать
защиту с точки зрения безопасности веб-приложения. Flask защищает вас от
одной и наиболее распространённых проблем безопасности современных
веб-приложений: от межсайтового скриптинга (cross-site scripting - XSS).
Если только вы не пометите небезопасный HTML-код как безопасный, вас
прикроет Flask и нижележащий шаблонизатор Jinja2. Но существует и множество
других способов вызвать проблемы с безопасностью.</p>
<p>Документация предупредит вас о тех аспектах веб-разработки, которые требуют
внимания к безопасности. Некоторые из этих соображений являются гораздо более
сложными, чем можно было бы подумать, и иногда все мы недооцениваем вероятность
того, что уязвимость будет использована - а в это время толковый злоумышленник
вычисляет способы для взлома наших приложений. Н надейтесь, что ваше приложение
не настолько важно, чтобы привлечь злоумышленника. При некоторых видах атаки
есть вероятность, что автоматизированные боты зондируют различные способы
заполнения вашей базы данных спамом, ссылками на вредоносные программы и т. п.</p>
<p>В том, что вы, как разработчик, в процессе разработки в соответствии с вашей
постановкой задачи, должны действовать с осторожностью, и при этом следить за
попытками взлома, Flask ничем не отличается от других фреймворков.</p>
</div>
<div class="section" id="python-3">
<h4>Статус Python 3<a class="headerlink" href="#python-3" title="Ссылка на этот заголовок">¶</a></h4>
<p>В настоящее время сообщество Python находится в процессе совершенствования
библиотек для поддержки новой итерации языка программирования Python. Хотя
ситуация и резко улучшается, есть ещё некоторые вопросы, из-за которых
пользователям трудно переключиться на Python 3 прямо сейчас. Эти проблемы
частично вызваны не прошедшими длительной опробации изменениями в языке,
частично тем, что мы ещё не работали с низкоуровневыми изменениями уровня
API, внесёнными Python 3 в работу с Unicode.</p>
<p>Мы настоятельно рекомендуем использовать Python 2.7 с
активированными предупреждениями о несовместимостях с Python 3.  Если в
ближайшем будущем вы планируете обновиться до Python 3, мы настоятельно
рекомендуем вам прочитать статью <a class="reference external" href="http://lucumr.pocoo.org/2011/1/22/forwards-compatible-python/">Как писать код, совместимый со следующими
версиями Python</a>.</p>
<p>Если вы уже созрели до работы с Python 3, посмотрите страницу
<span class="xref std std-ref">python3-support</span>.</p>
<p>Продолжение: <a class="reference internal" href="index.html#installation"><span class="std std-ref">Инсталляция</span></a> или the <a class="reference internal" href="index.html#quickstart"><span class="std std-ref">Быстрый старт</span></a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/advanced_foreword/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-installation"></span><div class="section" id="installation">
<span id="id1"></span><h3>Инсталляция<a class="headerlink" href="#installation" title="Ссылка на этот заголовок">¶</a></h3>
<p>Flask зависит от некоторых внешних библиотек - таких, как
<a class="reference external" href="http://werkzeug.pocoo.org/">Werkzeug</a>
и <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a>. Werkzeug - это инструментарий для
WSGI - стандартного интерфейса Python между веб-приложениями и различными
серверами, предназначен как для разработки, так и развёртывания. Jinja2
занимается отображением шаблонов.</p>
<p>Итак, как же быстро получить всё необходимое на ваш компьютер? Есть много
способов, которыми вы это можете проделать, но самый обалденный - это
virtualenv, так что давайте глянем в первую очередь на него.</p>
<p>Для начала вам понадобится Python 2.6 или новее, так что убедитесь, что
у вас инсталлирован свежий Python 2.x.  При использовании Flask с Python 3
загляните в раздел <span class="xref std std-ref">python3-support</span>.</p>
<div class="section" id="virtualenv">
<span id="id2"></span><h4>virtualenv<a class="headerlink" href="#virtualenv" title="Ссылка на этот заголовок">¶</a></h4>
<p>Возможно, Virtualenv - именно то, что вы захотите использовать при
разработке, а если у вас на рабочем сервере есть доступ к командной оболочке,
вероятно, вы захотите использовать Virtualenv и здесь.</p>
<p>Какую из проблем решает virtualenv? Если вам нравится Python так, как он
нравится мне, скорее всего, вы захотите использовать его и в других проектах -
вне приложений, созданных на базе Flask.</p>
<p>Но чем больше у вас проектов, тем больше вероятность, что вы будете работать
с разными версиями самого Python, или, по крайней мере, с различными версиями
библиотек Python. Посмотрим правде в глаза: довольно часто библиотеки нарушают
обратную совместимость, и маловероятно, что серьёзное приложение будет работать
вообще без каких-либо зависимостей. Так что же делать, если два или более из
ваших проектов имеют конфликтующие зависимости?</p>
<p>Наше спасение - Virtualenv!  Virtualenv предоставляет несколько соседствующих
друг с другом установленных версий Python, по одной для каждого проекта. На
самом деле он реально не устанавливает различные версии Python, но обеспечивает
хитрый способ создать для проектов несколько изолированных друг от друга
окружений. Давайте посмотрим, как работает virtualenv.</p>
<p>Если вы работаете с MacOS X или с Linux, есть вероятность, что заработает
одна из следующих двух команд:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo easy_install virtualenv
</pre></div>
</div>
<p>или даже лучше:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo pip install virtualenv
</pre></div>
</div>
<p>Возможно, одна из этих команд установит virtualenv на вашей системе. А может
быть, это позволит сделать ваш пакетный менеджер. Если вы используете Ubuntu,
попробуйте:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install python-virtualenv
</pre></div>
</div>
<p>Если у вас Windows и команда <cite>easy_install</cite> не работает, вам необходимо
сначала установить её. Чтобы получить дополнительную информацию о том, как это
можно сделать, проверьте раздел <a class="reference internal" href="#windows-easy-install"><span class="std std-ref">pip и setuptools в MS Windows</span></a>. Установив данную
команду, запустите её, как указано чуть выше, но без префикса <cite>sudo</cite>.</p>
<p>После того, как virtualenv была установлена, просто запустите командный
интерпретатор и создайте ваше собственное окружение. Обычно в таких случаях
я создаю папку проекта, а в ней - папку <cite>venv</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir myproject
$ cd myproject
$ virtualenv venv
New python executable in venv/bin/python
Installing setuptools, pip............done.
</pre></div>
</div>
<p>Теперь, когда вы захотите работать над проектом, вам необходимо лишь
активировать соответствующее окружение. Под MacOS X и Linux, выполните
следующее:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ . venv/bin/activate
</pre></div>
</div>
<p>Если вы используете Windows, для вас подойдёт следующая команда:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ venv\scripts\activate
</pre></div>
</div>
<p>В любом случае, теперь вы должны использовать ваш virtualenv (обратите
внимание, как изменилось приглашение вашей командной оболочки - для того,
чтобы показать активное окружение).</p>
<p>А если вы захотите вернуться обратно в «реальный мир», используйте команду:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ deactivate
</pre></div>
</div>
<p>Полсе этого подсказка вашей командной оболочки вернёт свой прежний привычный
вид.</p>
<p>Теперь, двинемся дальше.  Для того, чтобы Flask появился в вашем виртуальном
окружении, введите команду:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install Flask
</pre></div>
</div>
<p>Через несколько секунд вы сможете двинуться в дальнейший путь.</p>
</div>
<div class="section" id="id3">
<h4>Установка непосредственно в систему<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Возможен и такой вариант установки, но я бы вам его не рекомендовал. Просто
запустите <cite>pip</cite> с привилегиями суперпользователя:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo pip install Flask
</pre></div>
</div>
<p>(Под Windows, запустите ту же команду, но только без <cite>sudo</cite>, внутри окна с
командной строкой, запущенного с привилегиями администратора системы)</p>
</div>
<div class="section" id="id4">
<h4>Жизнь на переднем краю<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если вы хотите работать с самой последней версией Flask, существует два пути:
можно указать <cite>pip</cite>, чтобы он загрузил версию для разработки, или можно
работать со срезом с текущего состояния репозитория git. В обоих случаях,
рекомендуется пользоваться virtualenv.</p>
<p>Получите срез с последнего состояния git в новом окружении virtualenv и
запустите в режиме разработки:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone http://github.com/mitsuhiko/flask.git
Initialized empty Git repository in ~/dev/flask/.git/
$ cd flask
$ virtualenv venv
New python executable in venv/bin/python
Installing setuptools, pip............done.
$ . venv/bin/activate
$ python setup.py develop
...
Finished processing dependencies for Flask
</pre></div>
</div>
<p>Будет скачана и активирована в virtualenv текущая версия, соответствующая
последнему (головному) срезу из git. В дальнейшем, чтобы обновиться до
последней версии, всё, что вам будет необходимо сделать - это выполнить
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">pull</span> <span class="pre">origin</span></code>.</p>
</div>
<div class="section" id="pip-setuptools-ms-windows">
<span id="windows-easy-install"></span><h4><cite>pip</cite> и <cite>setuptools</cite> в MS Windows<a class="headerlink" href="#pip-setuptools-ms-windows" title="Ссылка на этот заголовок">¶</a></h4>
<p>Иногда получение стандартных инструментов по работе с пакетами в Python -
таких, как <em>pip</em>, <em>setuptools</em> и <em>virtualenv</em> может быть несколько мудрёным,
но на самом деле в этом нет ничего сложного.  Вам нужны два ключевых пакета -
setuptools и pip - которые позволят вам инсталлировать всё остальное
(в том числе virtualenv). К счастью, есть два готовых скрипта, запустив которые
вы можете развернуть оба пакета «с нуля».</p>
<p>Если у вас их нет, скрипт <cite>get-pip.py</cite> осуществит инсталляцию обоих (вам не
нужно будет запускать ez_setup.py).</p>
<p><a class="reference external" href="https://raw.githubusercontent.com/pypa/pip/master/contrib/get-pip.py">get-pip.py</a></p>
<p>Для инсталляции последней версии setuptools, вы можете использовать следующий
скрипт, предназначенный для разворачивания «с нуля»:</p>
<p><a class="reference external" href="https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py">ez_setup.py</a></p>
<p>Оба этих скрипта необходимо скачать и запустить двойным щелчком мыши.  Если
у вас уже есть pip, вы можете обновить его, запустив команду:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">pip</span> <span class="n">setuptools</span>
</pre></div>
</div>
<p>Чаще всего, получив приглашение командной строки, вы захотите иметь возможность
набрать <code class="docutils literal notranslate"><span class="pre">pip</span></code> и <code class="docutils literal notranslate"><span class="pre">python</span></code>, что должно привести к запуску этих команд, однако
в Windows этого автоматически не происходит, потому что операционная система не
знает, где располагаются их исполнимые файлы (вы можете попробовать!).</p>
<p>Чтобы исправить это, вам необходимо перейти в папку, куда вы установили Python
(например, <code class="docutils literal notranslate"><span class="pre">C:\Python27</span></code>), а затем в подпапки <code class="docutils literal notranslate"><span class="pre">Tools</span></code>, <code class="docutils literal notranslate"><span class="pre">Scripts</span></code>; затем
найти файл <code class="docutils literal notranslate"><span class="pre">win_add2path.py</span></code> и запустить его.  Далее открыть <strong>новую</strong>
Командную строку и проверить, что при вводе <code class="docutils literal notranslate"><span class="pre">python</span></code> запускается командный
интерпретатор.</p>
<p>Наконец, для того, чтобы инсталлировать <a class="reference internal" href="#virtualenv">virtualenv</a>, вы можете просто ввести:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">virtualenv</span>
</pre></div>
</div>
<p>Теперь, когда вы установили всё, что нужно, выполнив вышеизложенные инструкции,
можно откинуться на спинку кресла.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/installation/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-quickstart"></span><div class="section" id="quickstart">
<span id="id1"></span><h3>Быстрый старт<a class="headerlink" href="#quickstart" title="Ссылка на этот заголовок">¶</a></h3>
<p>Рвётесь в бой? Эта страница даёт хорошее введение в Flask. Предполагается, что
вы уже имеете установленный Flask. Если это не так, обратитесь к секции
<a class="reference internal" href="index.html#installation"><span class="std std-ref">Инсталляция</span></a>.</p>
<div class="section" id="id2">
<h4>Минимальное приложение<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Минимальное приложение Flask выглядит примерно так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Просто сохраните его под именем наподобие <cite>hello.py</cite> и запустите с помощью
вашего интерпретатора Python. Только, пожалуйста, не давайте приложению
имя <cite>flask.py</cite>, так как это вызовет конфликт с самим Flask.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python hello.py
 * Running on http://127.0.0.1:5000/
</pre></div>
</div>
<p>Проследовав по ссылке <a class="reference external" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a>
вы увидите ваше приветствие миру.</p>
<p>Итак, что же делает этот код?</p>
<ol class="arabic simple">
<li>Сначала мы импортировали класс <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a>. Экземпляр этого
класса и будет вашим WSGI-приложением.</li>
<li>Далее мы создаём экземпляр этого класса. Первый аргумент - это имя модуля
или пакета приложения.  Если вы используете единственный модуль (как в
этом примере), вам следует использовать <cite>__name__</cite>, потому что в
зависимости от того, запущен ли код как приложение, или был импортирован
как модуль, это имя будет разным (<code class="docutils literal notranslate"><span class="pre">'__main__'</span></code> или актуальное имя
импортированного модуля соответственно).  Это нужно, чтобы Flask знал,
где искать шаблоны, статические файлы и прочее.  Для дополнительной
информации, смотрите документацию <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a>.</li>
<li>Далее, мы используем декоратор <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a>, чтобы сказать
Flask, какой из URL должен запускать нашу функцию.</li>
<li>Функция, которой дано имя, используемое также для генерации URL-адресов
для этой конкретной функции, возвращает сообщение, которое мы хотим
отобразить в браузере пользователя.</li>
<li>Наконец, для запуска локального сервера с нашим приложением, мы используем
функцию <a class="reference internal" href="index.html#flask.Flask.run" title="flask.Flask.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a>. Благодаря конструкции
<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code> можно быть уверенным, что сервер запустится
только при непосредственном вызове скрипта из интерпретатора Python, а не
при его импортировании в качестве модуля.</li>
</ol>
<p>Для остановки сервера, нажмите Ctrl+C.</p>
<div class="admonition- admonition" id="public-server">
<p class="first admonition-title">Публично доступный сервер</p>
<p>Если вы запустите сервер, вы заметите, что он доступен только с вашего
собственного компьютера, а не с какого-либо другого в сети. Так сделано
по умолчанию, потому что в режиме отладки пользователь приложения может
выполнить код на Python на вашем компьютере.</p>
<p>Если у вас отключена опция <cite>debug</cite> или вы доверяете пользователям в сети,
вы можете сделать сервер публично доступным, просто изменив вызов метода
<a class="reference internal" href="index.html#flask.Flask.run" title="flask.Flask.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> таким вот образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">Это укажет вашей операционной системе, чтобы она слушала сеть со всех
публичных IP-адресов.</p>
</div>
</div>
<div class="section" id="debug-mode">
<span id="id3"></span><h4>Режим отладки<a class="headerlink" href="#debug-mode" title="Ссылка на этот заголовок">¶</a></h4>
<p>Метод <a class="reference internal" href="index.html#flask.Flask.run" title="flask.Flask.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> чудесно подходит для запуска локального
сервера для разработки, но вы будете должны перезапускать его всякий раз
при изменении вашего кода. Это не очень здорово, и Flask здесь может
облегчить жизнь. Если вы включаете поддержку отладки, сервер перезагрузит
сам себя при изменении кода, кроме того, если что-то пойдёт не так, это
обеспечит вас полезным отладчиком.</p>
<p>Существует два способа включить отладку. Или установите флаг в объекте
приложения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Или передайте его как параметр при запуске:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Оба метода вызовут одинаковый эффект.</p>
<div class="admonition- admonition">
<p class="first admonition-title">Внимание.</p>
<p class="last">Несмотря на то, что интерактивный отладчик не работает в многопоточных
окружениях (что делает его практически неспособным к использованию на
реальных рабочих серверах), тем не менее, он позволяет выполнение
произвольного кода. Это делает его главной угрозой безопасности, и поэтому
<strong>он никогда не должен использоваться на реальных «боевых» серверах</strong>.</p>
</div>
<p>Снимок экрана с отладчиком в действии:</p>
<img alt="screenshot of debugger in action" class="screenshot align-center" src="_images/debugger.png" />
<p>Предполагаете использовать другой отладчик? Тогда смотрите <a class="reference internal" href="index.html#working-with-debuggers"><span class="std std-ref">Работа с отладчиками</span></a>.</p>
</div>
<div class="section" id="id4">
<h4>Маршрутизация<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Современные веб-приложения используют «красивые» URL.  Это помогает людям
запомнить эти URL, это особенно удобно для приложений, используемых с
мобильных устройств с более медленным сетевым соединением.  Если
пользователь может перейти сразу на желаемую страницу, без предварительного
посещения начальной страницы, он с большей вероятностью вернётся на эту
страницу и в следующий раз.</p>
<p>Как вы увидели ранее, декоратор <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> используется для
привязки функции к URL. Вот простейшие примеры:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Index Page&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span>
</pre></div>
</div>
<p>Но это еще не все!  Вы можете сделать определенные части URL динамически
меняющимися и задействовать в функции несколько правил.</p>
<div class="section" id="id5">
<h5>Правила для переменной части<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Чтобы добавлять к адресу URL переменные части, можно эти особые части
выделить как <code class="docutils literal notranslate"><span class="pre">&lt;variable_name&gt;</span></code>.  Затем подобные части передаются в вашу
функцию в качестве аргумента - в виде ключевого слова.  Также может быть
использован конвертер - с помощью задания правила следующего вида
<code class="docutils literal notranslate"><span class="pre">&lt;converter:variable_name&gt;</span></code>.  Вот несколько интересных примеров</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/user/&lt;username&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_user_profile</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="c1"># показать профиль данного пользователя</span>
    <span class="k">return</span> <span class="s1">&#39;User </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">username</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/post/&lt;int:post_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_post</span><span class="p">(</span><span class="n">post_id</span><span class="p">):</span>
    <span class="c1"># вывести сообщение с данным id, id - целое число</span>
    <span class="k">return</span> <span class="s1">&#39;Post </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">post_id</span>
</pre></div>
</div>
<p>Существуют следующие конвертеры:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><cite>int</cite></td>
<td>принимаются целочисленные значения</td>
</tr>
<tr class="row-even"><td><cite>float</cite></td>
<td>как и <cite>int</cite>, только значения с плавающей точкой</td>
</tr>
<tr class="row-odd"><td><cite>path</cite></td>
<td>подобно поведению по умолчанию, но допускаются слэши</td>
</tr>
</tbody>
</table>
<div class="admonition-url admonition">
<p class="first admonition-title">Уникальные URL / Перенаправления</p>
<p>Правила для URL, работающие в Flask, основаны на модуле маршрутизации
Werkzeug.  Этот модуль реализован в соответствие с идеей обеспечения
красивых и уникальных URL-адресов на основе исторически попавшего в
обиход - из поведения Apache и более ранних HTTP серверов.</p>
<p>Возьмём два правила:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/projects/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">projects</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;The project page&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/about&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">about</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;The about page&#39;</span>
</pre></div>
</div>
<p>Хоть они и выглядят довольно похожими, есть разница в использовании слэша
в <em>определении</em> URL.  В первом случае, канонический URL имеет завершающую
часть <cite>projects</cite> со слэшем в конце.  В этом смысле он похож на папку в
файловой системе.  В данном случае, при доступе к URL без слэша, Flask
перенаправит к каноническому URL с завершающим слэшем.</p>
<p>Однако, во втором случае, URL определен без косой черты - как путь к файлу
на UNIX-подобных системах.  Доступ к URL с завершающей косой чертой будет
приводить к появлению ошибки 404 «Not Found».</p>
<p class="last">Такое поведение позволяет продолжить работать с относительными URL, даже
если в конце строки URL пропущен слэш - в соответствии с тем, как работают
Apache и другие сервера.  Кроме того, URL-адреса останутся уникальными, что
поможет поисковым системам избежать повторной переиндексации страницы.</p>
</div>
</div>
<div class="section" id="url">
<span id="url-building"></span><h5>Построение (генерация) URL<a class="headerlink" href="#url" title="Ссылка на этот заголовок">¶</a></h5>
<p>Раз Flask может искать соответствия в URL, может ли он их генерировать?
Конечно, да. Для построения URL для специфической функции, вы можете
использовать функцию <a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a>.  В качестве первого аргумента
она принимает имя функции, кроме того она принимает ряд именованных
аргументов, каждый из которых соответствует переменной части правила для
URL.  Неизвестные переменные части добавляются к URL в качестве параметров
запроса.  Вот некоторые примеры:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">url_for</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span> <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">login</span><span class="p">():</span> <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/user/&lt;username&gt;&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">username</span><span class="p">):</span> <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">():</span>
<span class="gp">... </span> <span class="nb">print</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="gp">... </span> <span class="nb">print</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
<span class="gp">... </span> <span class="nb">print</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="gp">... </span> <span class="nb">print</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;John Doe&#39;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">/</span>
<span class="go">/login</span>
<span class="go">/login?next=/</span>
<span class="go">/user/John%20Doe</span>
</pre></div>
</div>
<p>(Здесь также использован метод <a class="reference internal" href="index.html#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_request_context()</span></code></a>,
который будет объяснён ниже.  Он просит Flask вести себя так, как будто
он обрабатывает запрос, даже если мы взаимодействуем с ним через оболочку
Python.  Взгляните на нижеследующее объяснение. <a class="reference internal" href="#context-locals"><span class="std std-ref">Локальные объекты контекста (context locals)</span></a>.</p>
<p>Зачем Вам может потребоваться формировать URL-ы с помощью функции их обращения
<a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a> вместо того, чтобы жёстко задать их в ваших шаблонах?
Для этого есть три веские причины:</p>
<p>1. По сравнению с жёстким заданием URL внутри кода обратный порядок часто
является более наглядным.  Более того, он позволяет менять URL за один
шаг, и забыть про необходимость изменять URL повсюду.
2. Построение URL будет прозрачно для вас осуществлять экранирование
специальных символов и данных Unicode, так что вам не придётся отдельно
иметь с ними дела.
3. Если ваше приложение размещено не в корневой папке URL root (а, скажем,
в <code class="docutils literal notranslate"><span class="pre">/myapplication</span></code> вместо <code class="docutils literal notranslate"><span class="pre">/</span></code>), данную ситуацию нужным для вас образом
обработает функция <a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a>.</p>
</div>
<div class="section" id="http">
<h5>Методы HTTP<a class="headerlink" href="#http" title="Ссылка на этот заголовок">¶</a></h5>
<p>HTTP (протокол, на котором общаются веб-приложения) может использовать
различные методы для доступа к URL-адресам.  По умолчанию, route
отвечает лишь на запросы типа <cite>GET</cite>, но это можно изменить, снабдив
декоратор  <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> аргументом <cite>methods</cite>. Вот
некоторые примеры:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">do_the_login</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">show_the_login_form</span><span class="p">()</span>
</pre></div>
</div>
<p>Если присутствует метод <cite>GET</cite>, то автоматически будет добавлен и <cite>HEAD</cite>.
Вам не придётся иметь с ним дело. Также, при этом можно быть уверенным,
что запросы <cite>HEAD</cite> будут обработаны в соответствии с требованиями
<a class="reference external" href="http://www.ietf.org/rfc/rfc2068.txt">HTTP RFC</a> (документ с описанием протокола HTTP), так что вам не
требуется ничего знать об этой части спецификации HTTP. Кроме того,
начиная с Flask версии 0.6, для вас будет автоматически реализован
метод <cite>OPTIONS</cite> автоматически.</p>
<p>Не имеете понятия, что такое метод HTTP?  Не беспокойтесь, здесь
приводится быстрое введение в методы HTTP, и почему они важны:</p>
<p>HTTP-метод (также часто называемый командой) сообщает серверу, что
хочет сделать клиент с запрашиваемой страницей. Очень распространены
Следующие методы:</p>
<dl class="docutils">
<dt><cite>GET</cite></dt>
<dd>Браузер говорит серверу, чтобы он просто получил информацию,
хранимую на этой странице, и отослал её.  Возможно, это самый
распространённый метод.</dd>
<dt><cite>HEAD</cite></dt>
<dd>Браузер просит сервер получить информацию, но его интересует только
<em>заголовки</em>, а не содержимое страницы.  Приложение предполагает
обработать их так же, как если бы был получен запрос <cite>GET</cite>, но без
доставки фактического содержимого.  В Flask, вам вовсе не требуется
иметь дело с этим методом, так как нижележащая библиотека Werkzeug
сделает всё за вас.</dd>
<dt><cite>POST</cite></dt>
<dd>Браузер говорит серверу, что он хочет сообщить этому URL некоторую
новую информацию, и что сервер должен убедиться, что данные сохранены
и сохранены в единожды.   Обычно, аналогичным образом происходит
передача из HTML форм на сервер данных.</dd>
<dt><cite>PUT</cite></dt>
<dd>Похоже на <cite>POST</cite>, только сервер может вызвать процедуру сохранения
несколько раз, перезаписывая старые значения более одного раза.
Здесь вы можете спросить, зачем это нужно, и есть несколько веских
причин, чтобы делать это подобным образом.  Предположим, во время
передачи произошла потеря соединения: в этой ситуации система между
браузером и сервером, ничего не нарушая, может совершенно спокойно
получить запрос во второй раз.  С <cite>POST</cite> такое было бы невозможно,
потому что он может быть вызван только один раз.</dd>
<dt><cite>DELETE</cite></dt>
<dd>Удалить информацию, расположенную в указанном месте.</dd>
<dt><cite>OPTIONS</cite></dt>
<dd>Обеспечивает быстрый способ выяснения клиентом поддерживаемых для
данного URL методов.  Начиная с Flask 0.6, это работает для вас
автоматически.</dd>
</dl>
<p>Теперь самое интересное: в HTML 4 и XHTML1, единственными методами,
которыми форма может отправить серверу данные, являются <cite>GET</cite> и <cite>POST</cite>.
Но для JavaScript и будущих стандартов HTML вы также можете использовать
и другие методы.  Кроме того, в последнее время HTTP стал довольно
популярным, и теперь браузеры уже не единственные клиенты, использующие
HTTP.  Например, его используют многие системы контроля версий.</p>
</div>
</div>
<div class="section" id="id6">
<h4>Статические файлы<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h4>
<p>Динамические веб-приложения также нуждаются и в статических файлах.
Обычно, именно из них берутся файлы CSS и JavaScript.  В идеале ваш
веб-сервер уже сконфигурирован так, чтобы обслуживать их для вас,
однако в ходе разработке это также может делать и сам Flask.  Просто
создайте внутри вашего пакета или модуля папку с названием <cite>static</cite>,
и она будет доступна из приложения как <cite>/static</cite>.</p>
<p>Чтобы сформировать для статических файлов URL, используйте специальное
окончание <code class="docutils literal notranslate"><span class="pre">'static'</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;style.css&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Этот файл должен храниться в файловой системе как <code class="docutils literal notranslate"><span class="pre">static/style.css</span></code>.</p>
</div>
<div class="section" id="id7">
<h4>Визуализация шаблонов<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h4>
<p>Генерация HTML из Python - невесёлое и на самом деле довольно сложное
занятие, так как вам необходимо самостоятельно заботиться о
безопасности приложения, производя для HTML обработку специальных
последовательностей (escaping).  Поэтому внутри Flask уже автоматически
преднастроен шаблонизатор <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a>.</p>
<p>Для визуализации шаблона вы можете использовать метод
<a class="reference internal" href="index.html#flask.render_template" title="flask.render_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">render_template()</span></code></a>. Всё, что вам необходимо - это указать
имя шаблона, а также переменные в виде именованных аргументов, которые
вы хотите передать движку обработки шаблонов:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">render_template</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hello/&#39;</span><span class="p">)</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hello/&lt;name&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;hello.html&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>Flask будет искать шаблоны в папке <cite>templates</cite>.  Поэтому, если ваше
приложение выполнено в виде модуля, эта папка будет рядом с модулем, а
если в виде пакета, она будет внутри вашего пакета:</p>
<p><strong>Первый случай</strong> - модуль:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">application</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">templates</span>
    <span class="o">/</span><span class="n">hello</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p><strong>Второй случай</strong> - пакет:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">application</span>
    <span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="o">/</span><span class="n">templates</span>
        <span class="o">/</span><span class="n">hello</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>При работе с шаблонами вы можете использовать всю мощь Jinja2. За
дополнительной информацией обратитесь к официальной <a class="reference external" href="http://jinja.pocoo.org/docs/templates">Документации по
шаблонам Jinja2</a></p>
<p>Вот пример шаблона:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Hello from Flask<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">name</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello <span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span>!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello World!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Также, внутри шаблонов вы имеете доступ к объектам
<a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>, <a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a> и
<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">g</span></code></a> <a class="footnote-reference" href="#id10" id="id9">[1]</a>, а также к функции
<a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_flashed_messages()</span></code></a>.</p>
<p>Шаблоны особенно полезны при использовании наследования.  Если вам
интересно, как это работает, обратитесь к документации по заготовкам
<a class="reference external" href="http://jinja.pocoo.org/docs/templates/#template-inheritance" title="(в Jinja2 v2.11)"><span>Template Inheritance</span></a>.  Проще говоря, наследование шаблонов позволяет
разместить определённые элементы (такие, как заголовки, элементы навигации
и «подвал» страницы) на каждой странице.</p>
<p>Автоматическая обработка специальных (escape-) последовательностей
(escaping) включена по умолчанию, поэтому если <cite>name</cite> содержит HTML, он
будет экранирован автоматически.  Если вы можете доверять переменной и
знаете, что в ней будет безопасный HTML (например, потому что он пришёл
из модуля конвертирования разметки wiki в HTML), вы можете пометить её
в шаблоне, как безопасную - с использованием класса
<a class="reference external" href="http://jinja.pocoo.org/docs/api/#jinja2.Markup" title="(в Jinja2 v2.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code></a> или фильтра <code class="docutils literal notranslate"><span class="pre">|safe</span></code>.  За дополнительными
примерами обратитесь к документации по Jinja2.</p>
<p>Вот основные возможности по работе с классом <a class="reference external" href="http://jinja.pocoo.org/docs/api/#jinja2.Markup" title="(в Jinja2 v2.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Markup</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;&lt;strong&gt;Hello </span><span class="si">%s</span><span class="s1">!&lt;/strong&gt;&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="s1">&#39;&lt;blink&gt;hacker&lt;/blink&gt;&#39;</span>
<span class="go">Markup(u&#39;&lt;strong&gt;Hello &amp;lt;blink&amp;gt;hacker&amp;lt;/blink&amp;gt;!&lt;/strong&gt;&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s1">&#39;&lt;blink&gt;hacker&lt;/blink&gt;&#39;</span><span class="p">)</span>
<span class="go">Markup(u&#39;&amp;lt;blink&amp;gt;hacker&amp;lt;/blink&amp;gt;&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;&lt;em&gt;Marked up&lt;/em&gt; &amp;raquo; HTML&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">striptags</span><span class="p">()</span>
<span class="go">u&#39;Marked up \xbb HTML&#39;</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.5: </span>Автоматическая обработка escape-последовательностей больше не
активирована для всех шаблонов.  Вот расширения шаблонов, которые
активизируют автообработку: <code class="docutils literal notranslate"><span class="pre">.html</span></code>, <code class="docutils literal notranslate"><span class="pre">.htm</span></code>, <code class="docutils literal notranslate"><span class="pre">.xml</span></code>, <code class="docutils literal notranslate"><span class="pre">.xhtml</span></code>.
Шаблоны, загруженные из строк, не будут обрабатывать специальные
последовательности.</p>
</div>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[1]</a></td><td>Затрудняетесь понять, что это за объект - <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">g</span></code></a>?  Это то,
в чём вы можете хранить информацию для ваших собственных нужд, для
дополнительной информации смотрите документацию на этот объект
(<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">g</span></code></a>) и <span class="xref std std-ref">sqlite3</span>.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="id11">
<h4>Доступ к данным запроса<a class="headerlink" href="#id11" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для веб-приложений важно, чтобы они реагировали на данные, которые
клиент отправляет серверу.  В Flask эта информация предоставляется
глобальным объектом <a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>.  Если у вас есть некоторый
опыт по работе с Python, вас может удивить, как этот объект может быть
глобальным, и как Flask при этом умудрился остаться ориентированным
на многопоточное выполнение.</p>
<div class="section" id="context-locals">
<span id="id12"></span><h5>Локальные объекты контекста (context locals)<a class="headerlink" href="#context-locals" title="Ссылка на этот заголовок">¶</a></h5>
<div class="admonition- admonition">
<p class="first admonition-title">Информация от инсайдера</p>
<p class="last">Прочтите этот раздел, если вы хотите понять, как это работает, и как
вы можете реализовать тесты с локальными переменными контекста.  Если
вам это неважно, просто пропустите его.</p>
</div>
<p>Некоторые объекты в Flask являются глобальными, но необычного типа.  Эти
объекты фактически являются прокси (посредниками) к объектам, локальным
для конкретного контекста.  Труднопроизносимо.  Но на самом деле довольно
легко понять.</p>
<p>Представьте себе контекст, обрабатывающий поток.  Приходит запрос, и
веб-сервер решает породить новый поток (или нечто иное - базовый объект
может иметь дело с системой параллельного выполнения не на базе потоков).
Когда Flask начинает осуществлять свою внутреннюю обработку запроса, он
выясняет, что текущий поток является активным контекстом и связывает
текущее приложение и окружение WSGI с этим контекстом (потоком).  Он
делает это с умом - так, что одно приложение может, не ломаясь,
вызывать другое приложение.</p>
<p>Итак, что это означает для вас?  В принципе, вы можете полностью
игнорировать, что это так, если вы не делаете чего-либо вроде тестирования
модулей.  Вы заметите, что код, зависящий от объекта запроса, неожиданно
будет работать неправильно, так как отсутствует объект запроса.  Решением
является самостоятельное создание объекта запроса и его привязка к
контексту.  Простейшим решением для тестирования модулей является
использование менеджера контекстов
<a class="reference internal" href="index.html#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_request_context()</span></code></a>.  В сочетании с оператором <cite>with</cite>
этот менеджер свяжет тестовый запрос так, что вы сможете с ним
взаимодействовать.  Вот пример:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">):</span>
    <span class="c1"># теперь, и до конца блока with, вы можете что-либо делать</span>
    <span class="c1"># с контекстом, например, вызывать простые assert-ы:</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/hello&#39;</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span>
</pre></div>
</div>
<p>Другая возможность - это передача целого окружения WSGI методу
<a class="reference internal" href="index.html#flask.Flask.request_context" title="flask.Flask.request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request_context()</span></code></a> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">environ</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h5>Объект запроса<a class="headerlink" href="#id13" title="Ссылка на этот заголовок">¶</a></h5>
<p>Объект запроса документирован в секции API, мы не будем рассматривать его
здесь подробно (смотри <a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>).  Вот широкий взгляд
на некоторые наиболее распространённые операции.  Прежде всего, вам
необходимо импортировать его из модуля <cite>flask</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>
</pre></div>
</div>
<p>В настоящее время метод запроса доступен через использование атрибута
<code class="xref py py-attr docutils literal notranslate"><span class="pre">method</span></code>.  Для доступа к данным формы (данным, которые
передаются в запросах типа <cite>POST</cite> или <cite>PUT</cite>), вы можете использовать
атрибут <code class="xref py py-attr docutils literal notranslate"><span class="pre">form</span></code>.  Вот полноценный пример работы с
двумя упомянутыми выше атрибутами:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">valid_login</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
                       <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">log_the_user_in</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;Invalid username/password&#39;</span>
    <span class="c1"># следущий код выполняется при методе запроса GET</span>
    <span class="c1"># или при признании полномочий недействительными</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>Что произойдёт, если ключ, указанный в атрибуте <cite>form</cite>, не существует?
В этом случае будет возбуждена специальная ошибка <a class="reference external" href="https://docs.python.org/dev/library/exceptions.html#KeyError" title="(в Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a>.  Вы
можете перехватить её подобно стандартной <a class="reference external" href="https://docs.python.org/dev/library/exceptions.html#KeyError" title="(в Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a>, но если вы этого
не сделаете, вместо этого будет показана страница с ошибкой <cite>HTTP 400 Bad
Request</cite>.  Так что во многих ситуациях вам не придётся иметь дело с этой
проблемой.</p>
<p>Для доступа к параметрам, представленным в URL (<code class="docutils literal notranslate"><span class="pre">?ключ=значение</span></code>), вы
можете использовать атрибут <code class="xref py py-attr docutils literal notranslate"><span class="pre">args</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">searchword</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Мы рекомендуем доступ к параметрам внутри URL через <cite>get</cite> или через
перехват <cite>KeyError</cite>, так как пользователь может изменить URL, а
предъявление ему страницы с ошибкой 400 <cite>bad request</cite> не является
дружественным.</p>
<p>За полным списком методов и атрибутов объекта запроса, обратитесь к
следующей документации: <a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>.</p>
</div>
<div class="section" id="id14">
<h5>Загрузка файлов на сервер<a class="headerlink" href="#id14" title="Ссылка на этот заголовок">¶</a></h5>
<p>В Flask обработка загружаемых на сервер файлов является несложным занятием.
Просто убедитесь, что вы в вашей HTML-форме не забыли установить атрибут
<code class="docutils literal notranslate"><span class="pre">enctype=&quot;multipart/form-data&quot;</span></code>, в противном случае браузер вообще
не передаст файл.</p>
<p>Загруженные на сервер файлы сохраняются в памяти или во временной папке
внутри файловой системы.  Вы можете получить к ним доступ, через атрибут
объекта запроса <code class="xref py py-attr docutils literal notranslate"><span class="pre">files</span></code>.  Каждый загруженный файл
сохраняется в этом словаре.  Он ведёт себя так же, как стандартный
объект Python <code class="xref py py-class docutils literal notranslate"><span class="pre">file</span></code>, однако он также имеет метод
<a class="reference external" href="http://werkzeug.pocoo.org/docs/datastructures/#werkzeug.datastructures.FileStorage.save" title="(в Werkzeug v0.14-dev)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a>, который вам позволяет
сохранить данный файл внутрь файловой системы сервера.  Вот простой пример,
показывающий, как это работает:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/upload&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;the_file&#39;</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;/var/www/uploads/uploaded_file.txt&#39;</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Если вы хотите до загрузки файла в приложение узнать, как он назван
на стороне клиента, вы можете просмотреть атрибут
<a class="reference external" href="http://werkzeug.pocoo.org/docs/datastructures/#werkzeug.datastructures.FileStorage.filename" title="(в Werkzeug v0.14-dev)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">filename</span></code></a>.  Однако, имейте в
виду, что данному значению никогда не стоит доверять, потому что оно может
быть подделано.  Если вы хотите использовать имя файла на клиентской стороне
для сохранения файла на сервере, пропустите его через функцию
<a class="reference external" href="http://werkzeug.pocoo.org/docs/utils/#werkzeug.utils.secure_filename" title="(в Werkzeug v0.14-dev)"><code class="xref py py-func docutils literal notranslate"><span class="pre">secure_filename()</span></code></a>, которой вас снабдил Werkzeug:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">werkzeug</span> <span class="k">import</span> <span class="n">secure_filename</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/upload&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;the_file&#39;</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;/var/www/uploads/&#39;</span> <span class="o">+</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Некоторые более удачные примеры можно найти в разделе заготовок:
<a class="reference internal" href="index.html#uploading-files"><span class="std std-ref">Загрузка файлов</span></a>.</p>
</div>
<div class="section" id="cookies">
<h5>Cookies<a class="headerlink" href="#cookies" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для доступа к cookies можно использовать атрибут
<a class="reference internal" href="index.html#flask.Request.cookies" title="flask.Request.cookies"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cookies</span></code></a>.  Для установки cookies можно использовать
метод объектов ответа <a class="reference internal" href="index.html#flask.Response.set_cookie" title="flask.Response.set_cookie"><code class="xref py py-attr docutils literal notranslate"><span class="pre">set_cookie</span></code></a>.  Атрибут
объектов запроса <a class="reference internal" href="index.html#flask.Request.cookies" title="flask.Request.cookies"><code class="xref py py-attr docutils literal notranslate"><span class="pre">cookies</span></code></a> - это словарь со всеми
cookies, которые передаёт клиент.  Если вы хотите использовать сессии,
то не используйте cookies напрямую, вместо этого используйте во Flask
<a class="reference internal" href="#sessions"><span class="std std-ref">Сессии</span></a>, который при работе с cookies даст вам некоторую
дополнительную безопасность.</p>
<p>Чтение cookies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
    <span class="c1"># Чтобы не получить в случае отсутствия cookie ошибку KeyError</span>
    <span class="c1"># используйте cookies.get(key) вместо cookies[key]</span>
</pre></div>
</div>
<p>Сохранение cookies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">make_response</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;the username&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>
</pre></div>
</div>
<p>Заметьте, что cookies устанавливаются в объектах ответа.  Так как
вы обычно просто возвращаете строки из функций представления, Flask
конвертирует их для вас в объекты ответа.  Если вы это хотите
сделать явно, то можете использовать функцию,
<a class="reference internal" href="index.html#flask.make_response" title="flask.make_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_response()</span></code></a>, затем изменив её.</p>
<p>Иногда вы можете захотеть установить cookie в точке, где объект ответа
ещё не существует.  Это можно сделать, используя заготовку
<span class="xref std std-ref">deferred-callbacks</span>.</p>
<p>Также об этом можно почитать здесь: <a class="reference internal" href="#about-responses"><span class="std std-ref">Об ответах</span></a>.</p>
</div>
</div>
<div class="section" id="id15">
<h4>Ошибки и перенаправления<a class="headerlink" href="#id15" title="Ссылка на этот заголовок">¶</a></h4>
<p>Чтобы перенаправить пользователя в иную конечную точку, используйте
функцию <a class="reference internal" href="index.html#flask.redirect" title="flask.redirect"><code class="xref py py-func docutils literal notranslate"><span class="pre">redirect()</span></code></a>; для того, чтобы преждевременно прервать
запрос с кодом ошибки, используйте функцию <a class="reference internal" href="index.html#flask.abort" title="flask.abort"><code class="xref py py-func docutils literal notranslate"><span class="pre">abort()</span></code></a> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">abort</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">))</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
    <span class="n">this_is_never_executed</span><span class="p">()</span>
</pre></div>
</div>
<p>Это довольно бессмысленный пример, потому что пользователь будет
перенаправлен с индексной страницы на страницу, на которую у него нет
доступа (<code class="docutils literal notranslate"><span class="pre">401</span></code> означает отказ в доступе), однако он показывает, как это
работает.</p>
<p>По умолчанию, для каждого кода ошибки отображается чёрно-белая страница
с ошибкой.  Если вы хотите видоизменить страницу с ошибкой, то можете
использовать декоратор <a class="reference internal" href="index.html#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">render_template</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;page_not_found.html&#39;</span><span class="p">),</span> <span class="mi">404</span>
</pre></div>
</div>
<p>Обратите внимание на <code class="docutils literal notranslate"><span class="pre">404</span></code> после вызова <a class="reference internal" href="index.html#flask.render_template" title="flask.render_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">render_template()</span></code></a>.
Это сообщит Flask, что код статуса для этой страницы должен быть 404,
что означает «не найдено».  По умолчанию предполагается код «200»,
который означает «всё прошло хорошо».</p>
</div>
<div class="section" id="about-responses">
<span id="id16"></span><h4>Об ответах<a class="headerlink" href="#about-responses" title="Ссылка на этот заголовок">¶</a></h4>
<p>Возвращаемое из функции представления значение автоматически
для вас конвертируется вас в объект ответа.  Если возвращаемое
значение является строкой, оно конвертируется в объект ответа
в строку в виде тела ответа, код статуса <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">OK</span></code> и в mimetype
со значением <code class="docutils literal notranslate"><span class="pre">text/html</span></code>.  Логика, которую применяет Flask
для конвертации возвращаемых значений в объекты ответа следующая:</p>
<ol class="arabic simple">
<li>Если возвращается объект ответа корректного типа, он прямо
возвращается из представления.</li>
<li>Если это строка, создаётся объект ответа с этими же данными и
параметрами по умолчанию.</li>
<li>Если возвращается кортеж, его элементы могут предоставлять
дополнительную информацию.  Такие кортежи должны соответствовать
форме <code class="docutils literal notranslate"><span class="pre">(ответ,</span> <span class="pre">статус,</span> <span class="pre">заголовки)</span></code>,
кортеж должен содержать хотя бы один из перечисленных элементов.
Значение <cite>статус</cite> заменит код статуса, а элемент <cite>заголовки</cite> может
быть или списком или словарём с дополнительными значениями заголовка.</li>
<li>Если ничего из перечисленного не совпало, Flask предполагает,
что возвращаемое значение - это допустимая WSGI-заявка, и
конвертирует его в объект ответа.</li>
</ol>
<p>Если вы хотите в результате ответа заполучить объект внутри
представления, то можете использовать функцию <a class="reference internal" href="index.html#flask.make_response" title="flask.make_response"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_response()</span></code></a>.</p>
<p>Представим, что вы имеете подобное представление:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;error.html&#39;</span><span class="p">),</span> <span class="mi">404</span>
</pre></div>
</div>
<p>Вам надо всего лишь обернуть возвращаемое выражение функцией
<a class="reference internal" href="index.html#flask.make_response" title="flask.make_response"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_response()</span></code></a> и получить объект ответа для
его модификации, а затем вернуть его:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;error.html&#39;</span><span class="p">),</span> <span class="mi">404</span><span class="p">)</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Something&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;A value&#39;</span>
    <span class="k">return</span> <span class="n">resp</span>
</pre></div>
</div>
</div>
<div class="section" id="sessions">
<span id="id17"></span><h4>Сессии<a class="headerlink" href="#sessions" title="Ссылка на этот заголовок">¶</a></h4>
<p>В дополнение к объекту ответа есть ещё один объект, называемый
<a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a>, который позволяет вам сохранять от одного запроса
к другому информацию, специфичную для пользователя.  Это реализовано для
вас поверх cookies, при этом используется криптографическая подпись этих
cookie.  Это означает, что пользователь может посмотреть на содержимое
cookie, но не может ничего в ней изменить, если он конечно не знает
значение секретного ключа, использованного для создания подписи.</p>
<p>В случае использования сессий вам необходимо установить значение этого
секретного ключа.  Вот как работают сессии:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">escape</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Logged in as </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">escape</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="s1">&#39;You are not logged in&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span>
<span class="s1">            &lt;p&gt;&lt;input type=text name=username&gt;</span>
<span class="s1">            &lt;p&gt;&lt;input type=submit value=Login&gt;</span>
<span class="s1">        &lt;/form&gt;</span>
<span class="s1">    &#39;&#39;&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="c1"># удалить из сессии имя пользователя, если оно там есть</span>
    <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>

<span class="c1"># set the secret key.  keep this really secret:</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">&#39;A0Zr98j/3yX R~XHH!jmN]LWX/,?RT&#39;</span>
</pre></div>
</div>
<p>Упомянутая  <a class="reference internal" href="index.html#flask.escape" title="flask.escape"><code class="xref py py-func docutils literal notranslate"><span class="pre">escape()</span></code></a> осуществляет для вас обработку
специальных последовательностей (escaping), что необходимо, если
вы не используете движок шаблонов (как в этом примере).</p>
<div class="admonition- admonition">
<p class="first admonition-title">Как генерировать хорошие секретные ключи</p>
<p>Проблемой случайных значений является то, что трудно сказать, что
действительно является является случайным.  А секретный ключ
должен быть настолько случайным, насколько это возможно.
У вашей операционной системы есть способы для генерации достаточно
случайных значений на базе криптографического случайного генератора,
который может быть использован для получения таких ключей:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="go">&#39;\xfd{H\xe5&lt;\x95\xf9\xe3\x96.5\xd1\x01O&lt;!\xd5\xa2\xa0\x9fR&quot;\xa1\xa8&#39;</span>
</pre></div>
</div>
<p class="last">Просто возьмите, скопируйте/вставьте это в ваш код, вот и готово.</p>
</div>
<p>Замечание о сессиях на базе cookie: Flask возьмёт значения, которые вы
помещаете в объект сессии, и сериализует их в cookie.  Если вы обнаружили
какие-либо значения, которые не сохраняются между запросами, а cookies
реально включены, а никаких ясных сообщений об ошибках не было, проверьте
размер cookie в ответах вашей страницы и сравните с размером,
поддерживаемым веб-браузером.</p>
</div>
<div class="section" id="message-flashing">
<h4>Message Flashing<a class="headerlink" href="#message-flashing" title="Ссылка на этот заголовок">¶</a></h4>
<p>Хорошие приложения и интерфейсы пользователя дают обратную связь.  Если
пользователь не получает достаточной обратной связи, вскоре он может начать
ненавидеть приложение.  При помощи системы всплывающих сообщений Flask
предоставляет пользователю по-настоящему простой способ обратной связи.
Система всплывающих сообщений обычно делает возможным записать сообщение в
конце запроса и получить к нему доступ во время обработки следующего и
только следующего запроса.  Обычно эти сообщения используются в шаблонах
макетов страниц, которые его и отображают.</p>
<p>Чтобы вызвать всплывающие сообщения, используйте метод <a class="reference internal" href="index.html#flask.flash" title="flask.flash"><code class="xref py py-func docutils literal notranslate"><span class="pre">flash()</span></code></a>,
чтобы заполучить сообщения, можно использовать метод, также доступный для
шаблонов - <a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_flashed_messages()</span></code></a>.  Полный
пример приведён в разделе <a class="reference internal" href="index.html#message-flashing-pattern"><span class="std std-ref">Всплывающие сообщения</span></a>.</p>
</div>
<div class="section" id="id18">
<h4>Ведение журналов<a class="headerlink" href="#id18" title="Ссылка на этот заголовок">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.3.</span></p>
</div>
<p>Иногда может возникнуть ситуация, в которой вы имеете дело с данными,
которые должны быть корректными, но в действительности это не так.
К примеру, у вас может быть некий код клиентской стороны, который
посылает HTTP-запрос к серверу, однако он очевидным образом неверен.
Это может произойти из-за манипуляции пользователя с данными, или
из-за неудачной работы клиентского кода.  В большинстве случаев
ответом, адекватным ситуации будет <code class="docutils literal notranslate"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code>, но иногда,
когда надо, чтобы код продолжал работать, это не годится.</p>
<p>Вы по-прежнему хотите иметь журнал того, что пошло не так.  Вот где
могут пригодиться объекты создания журнала <cite>logger</cite>.  Начиная с Flask
0.3, инструмент для журналирования уже настроен для использования.</p>
<p>Вот некоторые примеры вызовов функции журналирования:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Значение для отладки&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Предупреждение: (</span><span class="si">%d</span><span class="s1"> яблок)&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Ошибка&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Прилагаемый <a class="reference internal" href="index.html#flask.Flask.logger" title="flask.Flask.logger"><code class="xref py py-attr docutils literal notranslate"><span class="pre">logger</span></code></a> это стандартный класс
журналирования <a class="reference external" href="https://docs.python.org/dev/library/logging.html#logging.Logger" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Logger</span></code></a>, так что за подробностями
вы можете обратиться к официальной <a class="reference external" href="https://docs.python.org/library/logging.html">документации по журналированию</a>.</p>
</div>
<div class="section" id="hooking-wsgi">
<h4>Как зацепиться (hooking) к промежуточному слою WSGI<a class="headerlink" href="#hooking-wsgi" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если вы хотите добавить в ваше приложение слой промежуточного, или
связующего для WSGI программного обеспечения (middleware), вы можете
обернуть внутреннее WSGI-приложение.  К примеру, если вы хотите
использовать одно из middleware из пакета Werkzeug для обхода известных
багов в lighttpd, вы можете сделать это подобным образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.contrib.fixers</span> <span class="k">import</span> <span class="n">LighttpdCGIRootFix</span>
<span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">LighttpdCGIRootFix</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="quickstart-deployment">
<span id="id20"></span><h4>Развёртывание приложения на веб-сервере<a class="headerlink" href="#quickstart-deployment" title="Ссылка на этот заголовок">¶</a></h4>
<p>Готовы к развёртыванию на сервере вашего нового приложения Flask?
В завершение краткого руководства, вы можете немедленно развернуть
приложение на одной из платформ хостинга, предоставляющих бесплатное
размещение для малых проектов:</p>
<ul class="simple">
<li><a class="reference external" href="http://devcenter.heroku.com/articles/python">Развёртывание приложения Flask на Heroku</a></li>
<li><a class="reference external" href="http://docs.dotcloud.com/services/python/">Развёртывание WSGI в dotCloud</a>
с <a class="reference external" href="http://flask.pocoo.org/snippets/48/">специфическими для Flask замечаниями</a></li>
</ul>
<p>Другие места, где можно разместить ваше приложение:</p>
<ul class="simple">
<li><a class="reference external" href="http://flask.pocoo.org/snippets/65/">Развёртывание приложения Flask на Webfaction</a></li>
<li><a class="reference external" href="https://github.com/kamalgill/flask-appengine-template">Развёртывание приложения Flask в Google App Engine</a></li>
<li><a class="reference external" href="http://flask.pocoo.org/snippets/89/">Общий доступ к локальному хосту с помощью Localtunnel</a></li>
</ul>
<p>Если вы управляете собственными хостами и желаете разместиться у себя,
смотрите раздел <a class="reference internal" href="index.html#deployment"><span class="std std-ref">Варианты развёртывания</span></a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/quickstart/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-tutorial/index"></span><div class="section" id="tutorial">
<span id="id1"></span><h3>Учебник<a class="headerlink" href="#tutorial" title="Ссылка на этот заголовок">¶</a></h3>
<p>Хотите разработать приложение на Python под Flask?  Здесь вам даётся
такой шанс - изучить как это делается на примере.  В этом учебнике мы
создадим простое приложение микроблога.  Оно будет поддерживать одного
пользователя, который сможет создавать чисто текстовые записи, без
возможности подписки или комментирования, однако в ней будет всё, что
необходимо для того, чтобы начать работу.  Мы будем использовать Flask
и SQLite в качестве базы данных, которая идёт в комплекте с Python,
поэтому вам больше ничего не понадобится.</p>
<p>Если вам нужны все исходные тексты, чтобы не вводить их вручную либо
для сравнения, посмотрите их здесь <a class="reference external" href="http://github.com/mitsuhiko/flask/tree/master/examples/flaskr/">исходные тексты примеров</a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/">Оригинал этой страницы</a></p>
<div class="toctree-wrapper compound">
<span id="document-tutorial/introduction"></span><div class="section" id="flaskr">
<span id="tutorial-introduction"></span><h4>Введение в Flaskr<a class="headerlink" href="#flaskr" title="Ссылка на этот заголовок">¶</a></h4>
<p>Здесь мы будем называть наше приложение для блога flaskr, а вы можете
свободно выбрать менее оригинальное имя (прим. переводчика: очевидно,
имеется ввиду шутливая аллюзия на название известного web-2.0 ресурса
Flickr.com). ;)  Вот те основные возможности, которые хотелось бы
получить от данного приложения:</p>
<ol class="arabic simple">
<li>вход и выход пользователя с учётными данными, заданными в
конфигурации.  Требуется поддержка одного пользователя.</li>
<li>если пользователь вошёл, он может добавлять на страницу новые
записи, состоящие из чисто текстовых заголовков и некоторого
HTML кода для самого текста.  Мы полностью доверяем пользователю,
поэтому этот HTML проверять не требуется.</li>
<li>на странице отображаются все записи до самой последней, в обратном
порядке (свежие наверху), и пользователь после входа может
добавлять новые прямо с этой же страницы.</li>
</ol>
<p>Мы будем использовать для этого приложения прямые обращения к SQLite3,
так как это хорошо подходит для приложения подобного размера.  Однако,
для более крупных приложений, имеет большой смысл использовать
<a class="reference external" href="http://www.sqlalchemy.org/">SQLAlchemy</a>, которая более разумным способом обрабатывает соединения
с базой данных, что позволяет вам использовать одновременно различные
целевые реляционные базы данных, а также многое другое.  Также вы
можете подумать над использованием одной из популярных не-SQL баз
данных, если она лучше подходит для ваших данных.</p>
<p>Вот снимок экрана конечного варианта приложения:</p>
<img alt="screenshot of the final application" class="screenshot align-center" src="_images/flaskr.png" />
<p>Продолжение: <a class="reference internal" href="index.html#tutorial-folders"><span class="std std-ref">Шаг 0: Создание папок</span></a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/introduction/">Оригинал этой страницы</a></p>
</div>
<span id="document-tutorial/folders"></span><div class="section" id="tutorial-folders">
<span id="id1"></span><h4>Шаг 0: Создание папок<a class="headerlink" href="#tutorial-folders" title="Ссылка на этот заголовок">¶</a></h4>
<p>Перед тем, как мы начнём, давайте создадим папки, необходимые
для нашего приложения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">flaskr</span>
    <span class="o">/</span><span class="n">static</span>
    <span class="o">/</span><span class="n">templates</span>
</pre></div>
</div>
<p>Папка <cite>flaskr</cite> не является пакетом Python, это просто некое место, куда мы
будем класть наши файлы.  Далее, в эту папку, в добавок к главному модулю, мы
поместим схему нашей базы данных.  Это будет сделано следующим образом.  Файлы
внутри папки <cite>static</cite> доступны пользователям приложения по протоколу HTTP.
Это место, куда попадут файлы css и javascript.  В папке <cite>templates</cite> Flask
будет искать шаблоны <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a>.  В эту папку будут помещены шаблоны,
которые вы будете создавать в ходе работы с этим руководством.</p>
<p>Продолжение: <a class="reference internal" href="index.html#tutorial-schema"><span class="std std-ref">Шаг 1: Схема базы данных</span></a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/folders/">Оригинал этой страницы</a></p>
</div>
<span id="document-tutorial/schema"></span><div class="section" id="tutorial-schema">
<span id="id1"></span><h4>Шаг 1: Схема базы данных<a class="headerlink" href="#tutorial-schema" title="Ссылка на этот заголовок">¶</a></h4>
<p>Сперва мы хотим создать схему базы данных.  Это действие выполняется очень
просто, так как этому приложению нужна одна единственная таблица, и мы желаем
поддерживать только SQLite.  Просто поместите следующий текст в файл
с именем <cite>schema.sql</cite> в только что созданной папке <cite>flaskr</cite>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">drop</span> <span class="k">table</span> <span class="k">if</span> <span class="k">exists</span> <span class="n">entries</span><span class="p">;</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">entries</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">primary</span> <span class="k">key</span> <span class="n">autoincrement</span><span class="p">,</span>
  <span class="n">title</span> <span class="nb">text</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="nb">text</span> <span class="nb">text</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Эта схема состоит из единственной таблице с названием <cite>entries</cite>, и
каждая запись в ней содержит поля <cite>id</cite>, <cite>title</cite> и <cite>text</cite>. <cite>id</cite> это
автоинкрементируемое целое, которое одновременно является первичным
ключом, а два других поля - это строки, которые не могут быть пустыми.</p>
<p>Продолжение: <a class="reference internal" href="index.html#tutorial-setup"><span class="std std-ref">Шаг 2: Код для настройки приложения</span></a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/schema/">Оригинал этой страницы</a></p>
</div>
<span id="document-tutorial/setup"></span><div class="section" id="tutorial-setup">
<span id="id1"></span><h4>Шаг 2: Код для настройки приложения<a class="headerlink" href="#tutorial-setup" title="Ссылка на этот заголовок">¶</a></h4>
<p>Сейчас, когда наша схема уже на месте, мы можем создать модуль приложения.
Давайте назовём его flaskr.py. Мы разместим его в папке flaskr. Начнём с
добавления импортирования необходимых нам модулей, а также с добавления
раздела конфигурации.  Для небольших приложений допустимо размещать
конфигурацию прямо внутри модуля, что мы сейчас и сделаем.  Однако, более
прозрачным решением было бы создание отдельного файла <cite>.ini</cite> или <cite>.py</cite> и
загрузка или импорт значений оттуда.</p>
<p>Сперва мы добавим в <cite>flaskr.py</cite> импортирование модулей:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># все импорты</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">abort</span><span class="p">,</span> \
     <span class="n">render_template</span><span class="p">,</span> <span class="n">flash</span>

<span class="c1"># конфигурация</span>
<span class="n">DATABASE</span> <span class="o">=</span> <span class="s1">&#39;/tmp/flaskr.db&#39;</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;development key&#39;</span>
<span class="n">USERNAME</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>
</pre></div>
</div>
<p>Далее, мы должны создать наше текущее приложение и инициализировать
его в помощью конфигурации из того же файла, т. е. flaskr.py:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># создаём наше маленькое приложение :)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Загружаем конфиг по умолчанию и переопределяем в конфигурации часть</span>
<span class="c1"># значений через переменную окружения</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">DATABASE</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="s1">&#39;flaskr.db&#39;</span><span class="p">),</span>
    <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">SECRET_KEY</span><span class="o">=</span><span class="s1">&#39;development key&#39;</span><span class="p">,</span>
    <span class="n">USERNAME</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span>
    <span class="n">PASSWORD</span><span class="o">=</span><span class="s1">&#39;default&#39;</span>
<span class="p">))</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_envvar</span><span class="p">(</span><span class="s1">&#39;FLASKR_SETTINGS&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Объект <a class="reference internal" href="index.html#flask.Config" title="flask.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">Config</span></code></a> работает подобно словарю, поэтому мы можем
обновлять его с помощью новых значений.</p>
<div class="admonition- admonition">
<p class="first admonition-title">Путь к базе данных</p>
<p>Операционные системы знают концепцию текущего рабочего каталога для
каждого из процессов.  К несчастью, в случае веб-приложений, вы не
можете отталкиваться от этого, так как у вас может быть более одного
приложения в одном и том же процессе.</p>
<p>По этой причине, для получения пути к приложения может быть использован
атрибут <code class="docutils literal notranslate"><span class="pre">app.root_path</span></code>.  Если одновременно использовать модуль
<code class="docutils literal notranslate"><span class="pre">os.path</span></code>, можно легко найти все файлы.  В этом примере мы поместили
базу данных прямо рядом с приложением.</p>
<p class="last">Для реальных рабочих приложений вместо этого рекомендуется использовать
<a class="reference internal" href="index.html#instance-folders"><span class="std std-ref">Каталоги экземпляров</span></a>.</p>
</div>
<p>Обычно, загрузка отдельного, определяемого через переменную окружения,
конфигурационного файла является хорошей идеей.  Flask позволяет вам
импортировать множество конфигураций, используя при этом те установки,
которые были определены в последнем из импортов.  Это позволяет использовать
при настройках конфигурации мощные возможности.  Для достижения этого
используется <a class="reference internal" href="index.html#flask.Config.from_envvar" title="flask.Config.from_envvar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_envvar()</span></code></a>.</p>
<blockquote>
<div>app.config.from_envvar(„FLASKR_SETTINGS“, silent=True)</div></blockquote>
<p>Просто определите переменную окружения <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">FLASKR_SETTINGS</span></code>, которая
укажет, какой файл конфигурации необходимо загрузить.  Опция silent просит
Flask не ругаться, если вышеуказанная переменная окружения не установлена.</p>
<p>В добавление к сказанному, вы можете использовать метод
<a class="reference internal" href="index.html#flask.Config.from_object" title="flask.Config.from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_object()</span></code></a> объекта конфигурации, указавему имя
импортируемого модуля.  Flask проинициализирует переменную из этого модуля.
Заметим, что в любом случае будут учтены только имена переменных, заданные в
верхнем регистре.</p>
<p><code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code> нужен для обеспечения безопасности сессий на стороне клиента.
Выбирайте этот ключ с умом, и настолько трудный для разгадывания
и сложный, насколько это возможно. Флаг DEBUG включает или отключает
интерактивный отладчик.  <em>Никогда не оставляйте режим отладки активированным
при реальном использовании системы</em>, потому что
это позволит пользователям исполнять код на сервере!</p>
<p>Добавим также метод, который позволяет простым способом соединиться с
указанной базой данных.  Он может быть использован для открытия соединения
по запросу, а также из интерактивной командной оболочки Python или из скрипта.
Это пригодится в дальнейшем.  Мы создаём простое соединение с базой данных
SQLite и далее просим его использовать для представления строк объект
<a class="reference external" href="https://docs.python.org/dev/library/sqlite3.html#sqlite3.Row" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlite3.Row</span></code></a>.  Это позволит нам рассматривать строки, как если бы
они были словарями, а не кортежами.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">connect_db</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Соединяет с указанной базой данных.&quot;&quot;&quot;</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">])</span>
    <span class="n">rv</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
    <span class="k">return</span> <span class="n">rv</span>
</pre></div>
</div>
<p>Наконец, мы просто добавляем строчку в конце файла, которая запускает
сервер, если мы хотим запустить этот файл как отдельное приложение:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Отвлекаясь на минутку, приведём способ, которым достигается запуск
приложения без каких-либо проблем - это делается с помощью следующих
команд:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Вы увидите сообщение, которое сообщает вам о том, что сервер запущен,
и адрес, по которому вы можете к нему получить доступ.</p>
<p>Когда вы зайдёте с помощью своего браузера на сервер, вы получите ошибку
404 (страница не найдена), так как у нас пока нет ни одного представления
(view).  Однако, мы сфокусируемся на этом чуть позже.  Для начала мы
должны добиться, чтобы заработала база данных.</p>
<div class="admonition- admonition">
<p class="first admonition-title">Сервер, доступный из внешнего мира</p>
<p class="last">Хотите, чтобы ваш сервер был публично доступным?  Для получения
дополнительной информации обратитесь к разделу
<a class="reference internal" href="index.html#public-server"><span class="std std-ref">externally visible server</span></a>.</p>
</div>
<p>Продолжение: <a class="reference internal" href="index.html#tutorial-dbcon"><span class="std std-ref">Шаг 3: Соединения с базой данных</span></a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/setup/">Оригинал этой страницы</a></p>
</div>
<span id="document-tutorial/dbcon"></span><div class="section" id="tutorial-dbcon">
<span id="id1"></span><h4>Шаг 3: Соединения с базой данных<a class="headerlink" href="#tutorial-dbcon" title="Ссылка на этот заголовок">¶</a></h4>
<p>Мы создали функцию для установления соединения с базой данных с помощью
<cite>connect_db</cite>, но сама по себе она не совсем пригодна.  Создание и закрытие
соединения с базой данных каждый раз - очень неэффективно, поэтому мы
хотели бы держать его подольше.  Поскольку соединения с базой данных
инкапсулирует транзакцию, нам также надо убедиться, что в один момент
времени соединением пользуется только один запрос.  В этом месте в игру
вступает контекст приложения.  С этого места и начнём.</p>
<p>Flask обеспечивает нас двумя контекстами: контекстом приложения и контекстом
запроса.  На данный момент всё, что вы должны знать - это то, что есть
специальные переменные, которые используют их.  Например, переменная
<a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-data docutils literal notranslate"><span class="pre">request</span></code></a> - это объект запроса, ассоциированный с текущим
запросом, в то время как <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> - это переменная общего назначения,
которая ассоциирована с текущим контекстом приложения.  Чуть позже мы
коснёмся этого более детально.</p>
<p>Всё, что вам надо знать на этот момент - это то, что вы можете безопасно
сохранять информацию в объекте <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a>.</p>
<p>Итак, когда же вы начнёте её туда сохранять?  Чтобы сделать это, вы
можете сделать функцию-помощник (helper).  Когда она будет запущена в
первый раз, она создаст для текущего контекста соединение с базой данных,
и её успешные вызовы будут возвращать уже установленное соединение:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Если ещё нет соединения с базой данных, открыть новое - для</span>
<span class="sd">    текущего контекста приложения</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;sqlite_db&#39;</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">sqlite_db</span> <span class="o">=</span> <span class="n">connect_db</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">sqlite_db</span>
</pre></div>
</div>
<p>Итак, теперь мы знаем, как соединиться, но вот как мы можем соответственно
разорвать соединение?  Для этого Flask обеспечил нас декоратором
<a class="reference internal" href="index.html#flask.Flask.teardown_appcontext" title="flask.Flask.teardown_appcontext"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_appcontext()</span></code></a>. Он выполняется каждый раз,
когда происходит разрыв контекста приложения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span> <span class="nf">close_db</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Closes the database again at the end of the request.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;sqlite_db&#39;</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">sqlite_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Функция, обозначенная как <a class="reference internal" href="index.html#flask.Flask.teardown_appcontext" title="flask.Flask.teardown_appcontext"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_appcontext()</span></code></a>
вызывается каждый раз при разрыве контекста приложения.  Что это значит?
В сущности, контекст приложения уже создан до того, как пришёл запрос,
и он уничтожается (разрывается) когда запрос заканчивается.  Разрыв
может произойти по двум причинам: или всё прошло хорошо (параметр
ошибки в этом случае будет <cite>None</cite>), или произошло исключение, и в этом
случае функции разрыва будет передана ошибка.</p>
<p>Непонятно, что означают эти контексты?  Для дальнейшего изучения
загляните в раздел документации <a class="reference internal" href="index.html#app-context"><span class="std std-ref">Контекст приложения Flask</span></a>.</p>
<p>Продолжение: <a class="reference internal" href="index.html#tutorial-dbinit"><span class="std std-ref">Шаг 4: Создание базы данных</span></a>.</p>
<div class="admonition hint">
<p class="first admonition-title">Подсказка</p>
<p>Куда мне поместить этот код?</p>
<p>Если вы следовали указаниям этого учебника, вас может немного озадачить,
куда поместить код из этого и следующего шага.  Было бы логичным
сгруппировать эти функции уровня модуля вместе, и разместить ваши новые
функции <code class="docutils literal notranslate"><span class="pre">get_db</span></code> и <code class="docutils literal notranslate"><span class="pre">close_db</span></code> под функцией
<code class="docutils literal notranslate"><span class="pre">connect_db</span></code> (аккуратно следуя учебнику).</p>
<p class="last">Если вам нужно время, чтобы сориентироваться, взгляните как организованы
<a class="reference external" href="http://github.com/mitsuhiko/flask/tree/master/examples/flaskr/">исходные тексты примера</a>.  В Flask, вы можете поместить весь код вашего
приложения в единственный модуль Python.  Однако это вовсе необязательно,
и если ваше приложение <a class="reference internal" href="index.html#larger-applications"><span class="std std-ref">растёт larger</span></a>, будет
разумным этого не делать.</p>
</div>
<p><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/dbcon/">Оригинал этой страницы</a></p>
</div>
<span id="document-tutorial/dbinit"></span><div class="section" id="tutorial-dbinit">
<span id="id1"></span><h4>Шаг 4: Создание базы данных<a class="headerlink" href="#tutorial-dbinit" title="Ссылка на этот заголовок">¶</a></h4>
<p>Как было указано ранее, Flaskr это приложение с базой данных «под капотом»,
а если более точно, то приложение с системой на базе реляционной базы
данных «под капотом». Такие системы нуждаются в схеме, которая сообщает
им, как хранить информацию.  Поэтому важно создать схему перед тем, как
запустить в первый раз сервер.</p>
<p>Такая схема может быть создана с помощью перенаправления через канал (pipe)
содержимого файла <cite>schema.sql</cite> команде <cite>sqlite3</cite> следующим образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqlite3</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">flaskr</span><span class="o">.</span><span class="n">db</span> <span class="o">&lt;</span> <span class="n">schema</span><span class="o">.</span><span class="n">sql</span>
</pre></div>
</div>
<p>Недостатком такого способа является необходимость наличия в системе команды
sqlite3, которая в некоторых системах может отсутствовать.  Также, здесь
потребуется, чтобы мы указали путь к базе данных, что может привести к
ошибкам.  Хорошей идеей было бы добавить функцию, которая иициализировала
бы для вашего приложения базу данных.</p>
<p>Чтобы это сделать, мы можем создать функцию с именем <cite>init_db</cite>, которая
инициализирует базу данных.  Позвольте, я сперва покажу вам код.  Просто
добавьте в <cite>flaskr.py</cite> эту функцию после функции <cite>connect_db</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">init_db</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;schema.sql&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>Итак, что же здесь происходит?  Помните, как мы усваивали в предыдущем
разделе, что контекст приложения создаётся всякий раз при появлении запроса?
Здесь у нас пока ещё нет запроса, поэтому нам необходимо создать контекст
приложения вручную.  Без контекста приложения объект <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> не
узнает, какому приложению он соответствует, ведь их может быть несколько!</p>
<p>Контекст приложения для нас устанавливает оператор <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">app.app_context()</span></code>.
В теле оператора with объект <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> будет проассоциирован с <code class="docutils literal notranslate"><span class="pre">app</span></code>.
В конце оператора with ассоциация перестанет действовать, и будут запущены
все функции разрыва контекста.  Это значит, что после совершения действия
соединение с базой данных будет разорвано.</p>
<p>Метод <a class="reference internal" href="index.html#flask.Flask.open_resource" title="flask.Flask.open_resource"><code class="xref py py-func docutils literal notranslate"><span class="pre">open_resource()</span></code></a> объекта приложения является удобной
функцией-помощником, которая откроет ресурс, обеспечиваемый приложением.  Эта
функция открывает файл из места расположения ресурсов
(в нашем случае папка <cite>flaskr</cite>), и позволяет вам из него читать.  Мы
используем её здесь для того, чтобы выполнить скрипт при установлении
соединения с базой данных.</p>
<p>Объект соединения, который предоставляет SQLite может дать нам объект курсора.
Для этого курсора существует метод для выполнения целого скрипта.  В самом
конце нам нужно лишь совершить (фиксировать) изменения.  SQLite 3 и другие
транзакционные базы данных не зафиксируют изменения, если вы явно об этом их
не попросите.</p>
<p>Теперь мы можем из командной оболочки Python импортировать и вызвать
эту функцию, тем самым создав базу данных:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">flaskr</span> <span class="k">import</span> <span class="n">init_db</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">init_db</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition- admonition">
<p class="first admonition-title">Поиск и устранение возможных проблем</p>
<p class="last">Если появилось исключение, что таблица не может быть найдена, проверьте,
что вы назвали функцию <cite>init_db</cite>, и что имена ваших таблиц заданы
корректным образом (проверьте, например, на отсутствие в именах ошибок,
связанных с использованием единственного и множественного числа).</p>
</div>
<p>Продолжение: <a class="reference internal" href="index.html#tutorial-views"><span class="std std-ref">Шаг 5: Функции представления</span></a></p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/dbinit/">Оригинал этой страницы</a></p>
</div>
<span id="document-tutorial/views"></span><div class="section" id="tutorial-views">
<span id="id1"></span><h4>Шаг 5: Функции представления<a class="headerlink" href="#tutorial-views" title="Ссылка на этот заголовок">¶</a></h4>
<p>Теперь, когда соединения с базой данных уже работают, мы можем заняться
написанием функций представления.  Нам нужны четыре из них:</p>
<div class="section" id="id2">
<h5>Показать записи<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Это представление показывает все записи, хранящиеся в базе данных.  Оно
соответствует главной странице вашего приложения, и выбирает все заголовки
и тексты из базы данных.  Запись с наибольшим id (последняя по времени)
будет наверху.  Строки, возвращаемые курсором немного похожи на кортежи,
так как мы используем фабрику строк <a class="reference external" href="https://docs.python.org/dev/library/sqlite3.html#sqlite3.Row" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlite3.Row</span></code></a></p>
<p>Функция представления передаёт записи в виде словаря шаблону
<cite>show_entries.html</cite> и возвращает сформированное отображение:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_entries</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select title, text from entries order by id desc&#39;</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;show_entries.html&#39;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="n">entries</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Добавление новой записи<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Это представление позволяет пользователю, если он осуществил вход,
добавлять новые записи.  Оно реагирует только на запросы типа <cite>POST</cite>,
а фактическая форма отображается на странице <cite>show_entries</cite>.  Если всё
работает хорошо, наше сообщение будет передано (<a class="reference internal" href="index.html#flask.flash" title="flask.flash"><code class="xref py py-func docutils literal notranslate"><span class="pre">flash()</span></code></a>)
следующему запросу  и произойдёт возврат через перенаправление на
страницу <cite>show_entries</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/add&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">add_entry</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logged_in&#39;</span><span class="p">):</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;insert into entries (title, text) values (?, ?)&#39;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]])</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;New entry was successfully posted&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;show_entries&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Заметьте, что здесь есть проверка на то, что пользователь вошёл (ключ
внутри сессии <cite>logged_in</cite> присутствует и установлен в <cite>True</cite>).</p>
<div class="admonition- admonition">
<p class="first admonition-title">Замечание, касающееся безопасности</p>
<p class="last">Убедитесь пожалуйста, что при формировании оператора SQL, как и в примере
выше, были использованы вопросительные знаки.  В обратном случае, при
форматировании строк для построения оператора SQL, ваше приложение станет
уязвимым для SQL-инъекций.  За подробностями обратитесь к разделу
<span class="xref std std-ref">sqlite3</span>.</p>
</div>
</div>
<div class="section" id="id4">
<h5>Вход и выход<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Эти функции используются для того, чтобы пользователь мог войти под собой
и выйти.  При входе производится проверка имя пользователя и пароля с
значениями, хранимыми в конфигурации, и в сессии устанавливается ключ
<cite>logged_in</cite>.  Если пользователь зашёл успешно, этот ключ устанавливается
в <cite>True</cite>, и пользователь возвращается обратно к странице <cite>show_entries</cite>.
К тому же, появляется всплывающее сообщение, что он или она зашли успешно.
При возникновении ошибки, шаблон об этом получает уведомление, и происходит
повторный запрос у пользователя имени пользователя и пароля:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;USERNAME&#39;</span><span class="p">]:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;Invalid username&#39;</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PASSWORD&#39;</span><span class="p">]:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;Invalid password&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;logged_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;You were logged in&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;show_entries&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>Функция выхода, с другой стороны, удаляет обратно этот ключ из сессии.
Здесь мы используем ловкий трюк: если вы используете метод словаря
<a class="reference external" href="https://docs.python.org/dev/library/stdtypes.html#dict.pop" title="(в Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code></a> и передаёте ему второй параметр (по умолчанию),
метод удаляет ключ из словаря при его наличии или ничего не делает
если такого ключа нет.  Это полезно, потому что теперь нам не надо
делать проверку, вошёл ли пользователь или нет.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;logged_in&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;You were logged out&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;show_entries&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Продолжение: <a class="reference internal" href="index.html#tutorial-templates"><span class="std std-ref">Шаг 6: Шаблоны</span></a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/views/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-tutorial/templates"></span><div class="section" id="tutorial-templates">
<span id="id1"></span><h4>Шаг 6: Шаблоны<a class="headerlink" href="#tutorial-templates" title="Ссылка на этот заголовок">¶</a></h4>
<p>Теперь нам следует поработать над шаблонами.  Если мы будем сейчас
запрашивать URL, мы получим лишь исключения, означающие, что Flask не
может найти шаблоны.  Шаблоны используют синтаксис <a class="reference external" href="http://jinja.pocoo.org/2/documentation/templates">Jinja2</a> и по
умолчанию имеют автоматическую обработку специальных последовательностей
(autoescaping).  Это означает, что если вы в шаблоне вы не пометили
значение с помощью <a class="reference internal" href="index.html#flask.Markup" title="flask.Markup"><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code></a> или с помощью фильтра
<code class="docutils literal notranslate"><span class="pre">|safe</span></code>, Jinja2 гарантирует, что особые символы, например <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> или
<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, будут заменены спецпоследовательностями их XML-эквивалентов.</p>
<p>Также мы используем наследование шаблонов, что делает возможным повторно
использовать макет веб-сайта на всех страницах.</p>
<p>Поместите в папку <cite>templates</cite> следующие шаблоны:</p>
<div class="section" id="layout-html">
<h5>layout.html<a class="headerlink" href="#layout-html" title="Ссылка на этот заголовок">¶</a></h5>
<p>Этот шаблон содержит скелет HTML, заголовок и ссылку для входа на сайт
(или выхода, если пользователь уже вошёл).  Он также отображает всплывающие
сообщения, если они есть.  Блок <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">body</span> <span class="pre">%}</span></code> может быть заменён в
дочернем шаблоне на блок с тем же именем (<code class="docutils literal notranslate"><span class="pre">body</span></code>).</p>
<p>Также из шаблона доступен словарь <a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a>, и вы можете
его использовать для проверки - вошёл ли пользователь или нет.  Заметим,
что в Jinja вы можете иметь доступ к отсутствующим атрибутам и элементам
объектов / словарей, что делает следующий код работоспособным, даже при
отсутствии в сессии ключа <code class="docutils literal notranslate"><span class="pre">'logged_in'</span></code>:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Flaskr<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">stylesheet</span> <span class="na">type</span><span class="o">=</span><span class="s">text/css</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;static&#39;</span><span class="o">,</span> <span class="nv">filename</span><span class="o">=</span><span class="s1">&#39;style.css&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">page</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Flaskr<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">metanav</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="k">not</span> <span class="nv">session.logged_in</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;login&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>log in<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;logout&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>log out<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">get_flashed_messages</span><span class="o">()</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">flash</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="show-entries-html">
<h5>show_entries.html<a class="headerlink" href="#show-entries-html" title="Ссылка на этот заголовок">¶</a></h5>
<p>Этот шаблон расширяет вышеприведённый шаблон <cite>layout.html</cite> для отображения
сообщений.  Заметим, что цикл <cite>for</cite> итерирует сообщения которые мы передаём
внутрь шаблона с помощью функции <a class="reference internal" href="index.html#flask.render_template" title="flask.render_template"><code class="xref py py-func docutils literal notranslate"><span class="pre">render_template()</span></code></a>.  Также мы
сообщаем форме, чтобы она предала данные вашей функции <cite>add_entry</cite>,
используя при этом <cite>POST</cite> в качестве метода <cite>HTTP</cite>:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">session.logged_in</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;add_entry&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">post</span> <span class="na">class</span><span class="o">=</span><span class="s">add-entry</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Title:
        <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">text</span> <span class="na">size</span><span class="o">=</span><span class="s">30</span> <span class="na">name</span><span class="o">=</span><span class="s">title</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Text:
        <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">text</span> <span class="na">rows</span><span class="o">=</span><span class="s">5</span> <span class="na">cols</span><span class="o">=</span><span class="s">40</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">submit</span> <span class="na">value</span><span class="o">=</span><span class="s">Share</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">entries</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">for</span> <span class="nv">entry</span> <span class="k">in</span> <span class="nv">entries</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">entry.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">entry.text</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span>
  <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">em</span><span class="p">&gt;</span>Unbelievable.  No entries here so far<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="login-html">
<h5>login.html<a class="headerlink" href="#login-html" title="Ссылка на этот заголовок">¶</a></h5>
<p>Наконец, шаблон для осуществления входа, который просто-напросто отображает
форму, позволяющую пользователю войти под своим логином:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">error</span> <span class="cp">%}</span><span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">error</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Error:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> <span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;login&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">post</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Username:
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">text</span> <span class="na">name</span><span class="o">=</span><span class="s">username</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Password:
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">password</span> <span class="na">name</span><span class="o">=</span><span class="s">password</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">submit</span> <span class="na">value</span><span class="o">=</span><span class="s">Login</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Продолжение: <a class="reference internal" href="index.html#tutorial-css"><span class="std std-ref">Шаг 7: Добавление стиля</span></a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/templates/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-tutorial/css"></span><div class="section" id="tutorial-css">
<span id="id1"></span><h4>Шаг 7: Добавление стиля<a class="headerlink" href="#tutorial-css" title="Ссылка на этот заголовок">¶</a></h4>
<p>Теперь, когда всё остальное работает, пришло время, чтобы придать
приложению немного стиля.  Просто создайте в папке <cite>static</cite>, которую
мы создавали до этого, таблицу стилей, в файле с именем <cite>style.css</cite>:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">body</span>            <span class="p">{</span> <span class="k">font-family</span><span class="p">:</span> <span class="kc">sans-serif</span><span class="p">;</span> <span class="k">background</span><span class="p">:</span> <span class="mh">#eee</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">a</span><span class="o">,</span> <span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span>       <span class="p">{</span> <span class="k">color</span><span class="p">:</span> <span class="mh">#377ba8</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span>          <span class="p">{</span> <span class="k">font-family</span><span class="p">:</span> <span class="s1">&#39;Georgia&#39;</span><span class="p">,</span> <span class="kc">serif</span><span class="p">;</span> <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">h1</span>              <span class="p">{</span> <span class="k">border-bottom</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#eee</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">h2</span>              <span class="p">{</span> <span class="k">font-size</span><span class="p">:</span> <span class="mf">1.2</span><span class="kt">em</span><span class="p">;</span> <span class="p">}</span>

<span class="p">.</span><span class="nc">page</span>           <span class="p">{</span> <span class="k">margin</span><span class="p">:</span> <span class="mi">2</span><span class="kt">em</span> <span class="kc">auto</span><span class="p">;</span> <span class="k">width</span><span class="p">:</span> <span class="mi">35</span><span class="kt">em</span><span class="p">;</span> <span class="k">border</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#ccc</span><span class="p">;</span>
                  <span class="k">padding</span><span class="p">:</span> <span class="mf">0.8</span><span class="kt">em</span><span class="p">;</span> <span class="k">background</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">entries</span>        <span class="p">{</span> <span class="k">list-style</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span> <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">entries</span> <span class="nt">li</span>     <span class="p">{</span> <span class="k">margin</span><span class="p">:</span> <span class="mf">0.8</span><span class="kt">em</span> <span class="mf">1.2</span><span class="kt">em</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">entries</span> <span class="nt">li</span> <span class="nt">h2</span>  <span class="p">{</span> <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-1</span><span class="kt">em</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">add-entry</span>      <span class="p">{</span> <span class="k">font-size</span><span class="p">:</span> <span class="mf">0.9</span><span class="kt">em</span><span class="p">;</span> <span class="k">border-bottom</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#ccc</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">add-entry</span> <span class="nt">dl</span>   <span class="p">{</span> <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">metanav</span>        <span class="p">{</span> <span class="k">text-align</span><span class="p">:</span> <span class="kc">right</span><span class="p">;</span> <span class="k">font-size</span><span class="p">:</span> <span class="mf">0.8</span><span class="kt">em</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mf">0.3</span><span class="kt">em</span><span class="p">;</span>
                  <span class="k">margin-bottom</span><span class="p">:</span> <span class="mi">1</span><span class="kt">em</span><span class="p">;</span> <span class="k">background</span><span class="p">:</span> <span class="mh">#fafafa</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">flash</span>          <span class="p">{</span> <span class="k">background</span><span class="p">:</span> <span class="mh">#cee5F5</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mf">0.5</span><span class="kt">em</span><span class="p">;</span>
                  <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#aacbe2</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span><span class="nc">error</span>          <span class="p">{</span> <span class="k">background</span><span class="p">:</span> <span class="mh">#f0d6d6</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mf">0.5</span><span class="kt">em</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Продолжение: <a class="reference internal" href="index.html#tutorial-testing"><span class="std std-ref">Бонус: Тестирование приложения</span></a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/css/">Оригинал этой страницы</a></p>
</div>
<span id="document-tutorial/testing"></span><div class="section" id="tutorial-testing">
<span id="id1"></span><h4>Бонус: Тестирование приложения<a class="headerlink" href="#tutorial-testing" title="Ссылка на этот заголовок">¶</a></h4>
<p>Теперь, когда вы завершили работу над приложением и всё работает, как и
ожидалось, нам - чтобы упростить его дальнейшую модификацию - вероятно,
было бы неплохо добавить автоматизированные тесты.  Вышеприведённое
приложение используется в разделе документации <a class="reference internal" href="index.html#testing"><span class="std std-ref">Тестирование приложений Flask</span></a> в качестве
простейшего примера того, как следует выполнять тестирование модулей.
Перейдите туда, чтобы увидеть, насколько просто тестировать приложения
Flask.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/testing/">Оригинал этой страницы</a></p>
</div>
</div>
</div>
<span id="document-templating"></span><div class="section" id="templating">
<span id="id1"></span><h3>Шаблоны<a class="headerlink" href="#templating" title="Ссылка на этот заголовок">¶</a></h3>
<p>Flask использует в качестве системы шаблонизации Jinja2.  Можно
использовать другие системы шаблонизации, но для запуска Flask всё
равно необходимо установить Jinja2.  Это необходимо для использования
дополнительных возможностей.  Расширения могут зависеть от наличия Jinja2.</p>
<p>Этот раздел предоставляет лишь краткое описание интеграции Jinja2 во Flask.
Если вам нужна информация о синтаксисе самой системы шаблонизации, за более
подробной информацией обратитесь к <a class="reference external" href="http://jinja.pocoo.org/2/documentation/templates">официальной документации по шаблонам
Jinja2</a>.</p>
<div class="section" id="jinja">
<h4>Установка Jinja<a class="headerlink" href="#jinja" title="Ссылка на этот заголовок">¶</a></h4>
<p>По умолчанию Flask настраивает Jinja2 следующим образом:</p>
<ul class="simple">
<li>включено автоматическое экранирование для всех шаблонов, с
расширениями <code class="docutils literal notranslate"><span class="pre">.html</span></code>, <code class="docutils literal notranslate"><span class="pre">.htm</span></code>, <code class="docutils literal notranslate"><span class="pre">.xml</span></code>, <code class="docutils literal notranslate"><span class="pre">.xhtml</span></code></li>
<li>шаблон может включать или отключать автоматическое экранирование при
помощи тега <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">autoescape</span> <span class="pre">%}</span></code>.</li>
<li>Flask добавляет пару функций и хелперов в контекст Jinja2,
дополнительно к значениям, имеющимся по умолчанию.</li>
</ul>
</div>
<div class="section" id="id2">
<h4>Стандартный контекст<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>По умолчанию из шаблонов Jinja2 доступны следующие глобальные переменные:</p>
<dl class="data">
<dt>
<code class="descname">config</code></dt>
<dd><p>Объект текущей конфигурации (<code class="xref py py-data docutils literal notranslate"><span class="pre">flask.config</span></code>)</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.6.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.10: </span>Теперь он доступен всегда, даже в импортированных шаблонах.</p>
</div>
</dd></dl>

<dl class="data">
<dt>
<code class="descname">request</code></dt>
<dd><p>Объект текущего запроса (<a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.request</span></code></a>).  Эта переменная
недоступна, если шаблон отрисован без контекста активного запроса.</p>
</dd></dl>

<dl class="data">
<dt>
<code class="descname">session</code></dt>
<dd><p>Объект текущего сеанса (<a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.session</span></code></a>).  Эта переменная
недоступна, если шаблон отрисован без контекста активного запроса.</p>
</dd></dl>

<dl class="data">
<dt>
<code class="descname">g</code></dt>
<dd><p>Связанный с запросом объект с глобальными переменными (<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.g</span></code></a>).
Эта переменная недоступна, если шаблон отрисован без контекста активного
запроса.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">url_for</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Функция <a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.url_for()</span></code></a>.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">get_flashed_messages</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Функция <a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">flask.get_flashed_messages()</span></code></a>.</p>
</dd></dl>

<div class="admonition-jinja admonition">
<p class="first admonition-title">Контекстное поведение Jinja</p>
<p>Эти переменные добавляются к переменным контекста, но это не глобальные
переменные.  Отличие заключается в том, что по умолчанию эти переменные
отсутствуют в контексте импортируемых шаблонов.  Отчасти это сделано для
повышения производительности, отчасти - из-за предпочтения явного
поведения неявному.</p>
<p>Какое это имеет значение?  Если вам нужно получить доступ из макроса к
объекту запроса, есть две возможности:</p>
<ol class="arabic simple">
<li>явным образом передать объект запроса или его атрибут в макрос в
качестве параметра.</li>
<li>импортировать макрос с контекстом, указав ключевые слова «with
context».</li>
</ol>
<p>Импорт с контекстом выглядит следующим образом:</p>
<div class="last highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">from</span> <span class="s1">&#39;_helpers.html&#39;</span> <span class="k">import</span> <span class="nv">my_macro</span> <span class="k">with context</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h4>Стандартные фильтры<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>В дополнение к собственным фильтрам Jinja2, доступны следующие фильтры:</p>
<dl class="function">
<dt>
<code class="descname">tojson</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Эта функция конвертирует переданный объект в JSON-представление.  Это
может быть полезно, когда нужно на лету сгенерировать JavaScript.</p>
<p>Отметим, что внутри тегов <cite>script</cite> не должно производиться
экранирование, поэтому убедитесь в том, что отключили экранирование при
помощи фильтра <code class="docutils literal notranslate"><span class="pre">|safe</span></code> (ранее версии Flask 0.10), если собираетесь
использовать фильтр <cite>tojson</cite> внутри тегов <cite>script</cite>:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">text/javascript</span><span class="p">&gt;</span>
    <span class="nx">doSomethingWith</span><span class="p">(</span><span class="cp">{{</span> <span class="nv">user.username</span><span class="o">|</span><span class="nf">tojson</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="id4">
<h4>Управление автоэкранированием<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Автоэкранирование - это автоматическое экранирование специальных символов.
Специальными символами в HTML (а также в XML и в XHTML) являются <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> и <code class="docutils literal notranslate"><span class="pre">'</span></code>.  Поскольку эти символы имеют особое значение
в документах, для использования в тексте их нужно заменить на так
называемые «сущности».  Если этого не сделать, это не только может повлиять
на невозможность использования этих символов пользователем, но и привести к
проблемам с безопасностью (см. <span class="xref std std-ref">xss</span>).</p>
<p>Однако, иногда в шаблонах может потребоваться отключить автоэкранирование.
Это может понадобиться, если нужно явным образом вставить в страниц
фрагмент HTML, если фрагмент поступил из системы генерации безопасного
HTML, например, из преобразователя markdown в HTML.</p>
<p>Для достижения этого есть три способа:</p>
<ul class="simple">
<li>В коде Python обернуть строку HTML в объект <a class="reference internal" href="index.html#flask.Markup" title="flask.Markup"><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code></a>
перед передачей в шаблон.  Это рекомендуемый способ.</li>
<li>Внутри шаблона, воспользовавшись фильтром <code class="docutils literal notranslate"><span class="pre">|safe</span></code> для явной отметки
строки, как безопасного HTML (<code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">myvariable|safe</span> <span class="pre">}}</span></code>)</li>
<li>Временно отключить систему автоэкранирования.</li>
</ul>
<p>Для отключения системы автоэкранирования в шаблонах можно воспользоваться
блоком <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">autoescape</span> <span class="pre">%}</span></code>:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">autoescape</span> <span class="kp">false</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>autoescaping is disabled here
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">will_not_be_escaped</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Соблюдайте осторожность и всегда следите за переменными, которые помещаете
в этот блок.</p>
</div>
<div class="section" id="registering-filters">
<span id="id5"></span><h4>Регистрация фильтров<a class="headerlink" href="#registering-filters" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если нужно зарегистрировать собственные фильтры в Jinja2, у есть два
способа.  Можно просто поместить их вручную в атрибут
<a class="reference internal" href="index.html#flask.Flask.jinja_env" title="flask.Flask.jinja_env"><code class="xref py py-attr docutils literal notranslate"><span class="pre">jinja_env</span></code></a> приложения или использовать декоратор
<a class="reference internal" href="index.html#flask.Flask.template_filter" title="flask.Flask.template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">template_filter()</span></code></a>.</p>
<p>Следующие примеры делают одно и то же, переставляя элементы объекта в
обратном порядке:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">template_filter</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">reverse_filter</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">reverse_filter</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">app</span><span class="o">.</span><span class="n">jinja_env</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s1">&#39;reverse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reverse_filter</span>
</pre></div>
</div>
<p>При использовании декоратора указывать аргумент не обязательно, если вы
хотите чтобы имя фильтра совпадало с именем функции.  Однажды
зарегистрировав фильтр, вы можете использовать его в шаблонах точно так же,
как и встроенные фильтры Jinja2, например, если имеется список Python,
имеющий в контексте имя <cite>mylist</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mylist</span> <span class="o">|</span> <span class="n">reverse</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>Процессоры контекста<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для автоматической вставки в контекст шаблона новых переменных существуют
процессоры контекста Flask.  Процессоры контекста запускаются перед
отрисовкой шаблона и позволяют добавить новые переменные в контекст.
Процессор контекста - это функция, возвращающая словарь, который будет
объединён с контекстом шаблона, для всех шаблонов в приложении.  Например,
для app:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">context_processor</span>
<span class="k">def</span> <span class="nf">inject_user</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
<p>Процессор контекста, приведённый выше, сделает переменную <cite>g.user</cite>
доступной из шаблона под именем <cite>user</cite>.  Этот пример не очень интересен,
поскольку <cite>g</cite> и так доступна в шаблонах, но даёт представление о том, как
это работает.</p>
<p>Переменные не ограничены только своими значениями; процессор контекста
может передавать в шаблон не только переменные, но и функции (поскольку
Python позволяет передавать функции):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">context_processor</span>
<span class="k">def</span> <span class="nf">utility_processor</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">format_price</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;€&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="si">{0:.2f}{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">format_price</span><span class="o">=</span><span class="n">format_price</span><span class="p">)</span>
</pre></div>
</div>
<p>Вышеприведённый процессор контекста сделает функцию <cite>format_price</cite> доступной
для всех шаблонов:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">format_price</span><span class="p">(</span><span class="mf">0.33</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
<p>Вы также можете встроить <cite>format_price</cite> как фильтр шаблона (см. выше раздел
<a class="reference internal" href="#registering-filters"><span class="std std-ref">Регистрация фильтров</span></a>), но этот пример демонстрирует, как передавать
функции в контекст шаблона.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/templating/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-testing"></span><div class="section" id="flask">
<span id="testing"></span><h3>Тестирование приложений Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h3>
<blockquote>
<div><strong>То, что не протестировано, не работает.</strong></div></blockquote>
<p>Оригинал цитаты неизвестен, и хотя она не совсем правильная, всё же она недалека от
истины.  Не подвергнутые тестированию приложения затрудняют развитие существующего
кода, а разработчики не протестированных приложений, как правило, подвергаются
влиянию паранойи.  Если у приложения есть автоматизированные тесты, можно
безопасно вносить в него изменения и узнавать сразу, если что-то пошло не так.</p>
<p>Flask предоставляет вам способ тестирования вашего приложения с помощью теста из
состава Werkzeug <a class="reference external" href="http://werkzeug.pocoo.org/docs/test/#werkzeug.test.Client" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a> и через обработку локальных
переменных контекста.  В дальнейшем вы можете это использовать с вашим любимым
средством тестирования.  В данной документации мы будем использовать идущий в
комплекте с Python пакет <a class="reference external" href="https://docs.python.org/dev/library/unittest.html#module-unittest" title="(в Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a>.</p>
<div class="section" id="id1">
<h4>Приложение<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для начала, нам нужно иметь приложение для тестирования; мы будем использовать
приложение из <a class="reference internal" href="index.html#tutorial"><span class="std std-ref">Учебник</span></a>.  Если у вас пока нет этого приложения, возьмите
его исходные тексты из <a class="reference external" href="http://github.com/mitsuhiko/flask/tree/master/examples/flaskr/">примеров</a>.</p>
</div>
<div class="section" id="id3">
<h4>Скелет для тестирования<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для того, чтобы протестировать приложение, мы добавим второй модуль
(<cite>flaskr_tests.py</cite>) и создадим здесь скелет для использования модуля unittest:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">flaskr</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="k">class</span> <span class="nc">FlaskrTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_fd</span><span class="p">,</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
        <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;TESTING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
        <span class="n">flaskr</span><span class="o">.</span><span class="n">init_db</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_fd</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Код метода <a class="reference external" href="https://docs.python.org/dev/library/unittest.html#unittest.TestCase.setUp" title="(в Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setUp()</span></code></a> создаёт нового клиента тестирования
и инициализирует новую базу данных.  Эта функция вызывается перед запуском
каждой индивидуальной функции тестирования.  Для удаления базы данных после
окончания теста, мы закрываем файл и удаляем его из файловой системы в методе
<a class="reference external" href="https://docs.python.org/dev/library/unittest.html#unittest.TestCase.tearDown" title="(в Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tearDown()</span></code></a>.  Дополнительно, в процессе настройки
активируется флаг конфигурации <code class="docutils literal notranslate"><span class="pre">TESTING</span></code>.  Это приводит к отключению
отлова ошибок во время обработки запроса, и вы получаете более качественные
отчёты об ошибках при выполнении по отношению к приложению тестовых запросов.</p>
<p>Этот тестовый клиент даст нам простой интерфейс к приложению.  Мы можем
запускать тестовые запросы к приложению, а клиент будет также отслеживать
для нас cookies.</p>
<p>Так как SQLite3 использует файловую систему, для создания временной базы
данных и её инициализации мы можем по-простому использовать модуль tempfile.
Функция <a class="reference external" href="https://docs.python.org/dev/library/tempfile.html#tempfile.mkstemp" title="(в Python v3.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mkstemp()</span></code></a> делает для нас две вещи: она возвращает
низкоуровневый обработчик файла и случайное имя файла, последний из которых
мы будем использовать как имя базы данных.  Нам всего лишь надо сохранить
значение <cite>db_fd</cite>, чтобы в дальнейшем мы могли использовать функцию
<a class="reference external" href="https://docs.python.org/dev/library/os.html#os.close" title="(в Python v3.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.close()</span></code></a> для закрытия файла.</p>
<p>Если мы запустим сейчас наш набор тестов, мы должны получить следующий
результат:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python flaskr_tests.py

----------------------------------------------------------------------
Ran 0 tests in 0.000s

OK
</pre></div>
</div>
<p>Даже без запуска реальных тестов мы уже будем знать, является ли наше
приложение flaskr допустимым синтаксически, в случае, если это не так,
операция импорта завершится с возникновением исключения.</p>
</div>
<div class="section" id="id4">
<h4>Первый тест<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Сейчас самое время начать тестирование функциональности приложения.
Давайте проверим, что при попытке доступа к корню приложения (<code class="docutils literal notranslate"><span class="pre">/</span></code>)
оно отображает «Здесь пока нет ни одной записи».  Чтобы это сделать,
добавим новый метод тестирования в наш класс, следующим образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FlaskrTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_fd</span><span class="p">,</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
        <span class="n">flaskr</span><span class="o">.</span><span class="n">init_db</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_fd</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">flaskr</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_empty_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s1">&#39;Unbelievable.  No entries here so far&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<p>Заметим, что наша тестовая функция начинается со слова <cite>test</cite>; это позволяет
модулю <a class="reference external" href="https://docs.python.org/dev/library/unittest.html#module-unittest" title="(в Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> определить метод как тест для запуска.</p>
<p>С помощью использования <cite>self.app.get</cite> мы можем послать приложению HTTP-запрос
<cite>GET</cite> с заданным путём.  Возвращаемым значением будет объект
<a class="reference internal" href="index.html#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-class docutils literal notranslate"><span class="pre">response_class</span></code></a>.  Теперь мы можем для проверки возвращаемого
значения (как строки) использовать атрибут
<a class="reference external" href="http://werkzeug.pocoo.org/docs/wrappers/#werkzeug.wrappers.BaseResponse.data" title="(в Werkzeug v0.14-dev)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">data</span></code></a>.  В данном случае, мы хотим
убедиться в том, что в выводе присутствует <code class="docutils literal notranslate"><span class="pre">'Unbelievable.</span>&#160; <span class="pre">No</span> <span class="pre">entries</span> <span class="pre">here</span> <span class="pre">so</span> <span class="pre">far'</span></code>.</p>
<p>Запустим всё заново, при похождении теста должно появиться:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python flaskr_tests.py
.
----------------------------------------------------------------------
Ran 1 test in 0.034s

OK
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>Вход и выход<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<p>Большинство функций нашего приложения доступны только для администратора,
поэтому нам необходим способ для осуществления нашим клиентом тестирования
входа и выхода из приложения.  Чтобы реализовать это. мы запустим несколько
запросов к страницам входа и выхода с необходимыми данными форм (именем
пользователя и паролем).  Так как страницы входа и выхода приводят к
редиректу, мы попросим это позволить нашему клиенту: <cite>follow_redirects</cite>.</p>
<p>Добавьте два следующих метода к вашему классу <cite>FlaskrTestCase</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="n">password</span>
    <span class="p">),</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">,</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь мы с лёгкостью можем проверить, что вход и выход работают и что
они оканчиваются неудачей при неверных учётных данных.  Добавьте к нашему
классу новый тест:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_login_logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s1">&#39;You were logged in&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s1">&#39;You were logged out&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;adminx&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s1">&#39;Invalid username&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;defaultx&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s1">&#39;Invalid password&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>Тестирование добавления сообщений<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h4>
<p>Нам необходимо также проверить как работает добавление сообщений.
Добавьте новый метод тестирования следующего вида:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/add&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&lt;Hello&gt;&#39;</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;strong&gt;HTML&lt;/strong&gt; allowed here&#39;</span>
    <span class="p">),</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s1">&#39;No entries here so far&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
    <span class="k">assert</span> <span class="s1">&#39;&amp;lt;Hello&amp;gt;&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
    <span class="k">assert</span> <span class="s1">&#39;&lt;strong&gt;HTML&lt;/strong&gt; allowed here&#39;</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<p>Здесь мы проверяем, что запись соответсвует установленным правилам -
HTML может присутствовать в тексте, но не заголовке.</p>
<p>Теперь при запуске мы должны увидеть, что пройдено 3 теста:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python flaskr_tests.py
...
----------------------------------------------------------------------
Ran 3 tests in 0.332s

OK
</pre></div>
</div>
<p>Чтобы посмотреть более сложные тесты заголовков и статусных кодов,
обратитесь к исходникам Flask <a class="reference external" href="http://github.com/mitsuhiko/flask/tree/master/examples/minitwit/">MiniTwit Example</a>, в которых есть
более развёрнутый набор тестов.</p>
</div>
<div class="section" id="id7">
<h4>Другие трюки с тестами<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h4>
<p>Кроме вышеуказанного использования клиента тестирования, есть ещё
метод <a class="reference internal" href="index.html#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_request_context()</span></code></a>, который может быть
использован в комбинации с оператором <cite>with</cite> для временной активации
контекста запроса.  С помощью него вы можете получить доступ к
объектам <a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>, <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">g</span></code></a> и
<a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a>, подобно функции представления.  Вот
полный пример, который демонстрирует подобный подход:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">(</span><span class="s1">&#39;/?name=Peter&#39;</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span>
    <span class="k">assert</span> <span class="n">flask</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Peter&#39;</span>
</pre></div>
</div>
<p>Подобным способом могут использоваться и все другие объекты, связанные
с контекстом.</p>
<p>Если вы хотите протестировать ваше приложение в другой конфигурации,
а хорошего способа, чтобы это сделать, нет, подумайте над переходом
на фабрики приложений (см. <span class="xref std std-ref">app-factories</span>).</p>
<p>Заметим, однако, что если вы используете контекст тестового запроса,
функции <a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> автоматически не выполняются
для подобных функций <a class="reference internal" href="index.html#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a>.  Однако, функции
<a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> действительно выполняются, когда
контекст тестового запроса покидает блок <cite>with</cite>.  Если вы хотите, чтобы
функции <a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> также вызывались, вам
необходимо вручную использовать вызов
<a class="reference internal" href="index.html#flask.Flask.preprocess_request" title="flask.Flask.preprocess_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">preprocess_request()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">(</span><span class="s1">&#39;/?name=Peter&#39;</span><span class="p">):</span>
    <span class="n">app</span><span class="o">.</span><span class="n">preprocess_request</span><span class="p">()</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Это может понадобиться для открытия соединений с базой данных или для
чего-то подобного, в зависимости от того, как построено ваше приложение.</p>
<p>Если вы хотите вызвать функции <a class="reference internal" href="index.html#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a>, вам
необходимо воспользоваться вызовом <a class="reference internal" href="index.html#flask.Flask.process_response" title="flask.Flask.process_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">process_response()</span></code></a>,
однако он требует, чтобы вы передали ему объект ответа:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">(</span><span class="s1">&#39;/?name=Peter&#39;</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">process_response</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Обычно, это не так полезно, так как в данный момент вы можете прямо
стартовать с помощью тестового клиента.</p>
</div>
<div class="section" id="faking-resources">
<span id="id8"></span><h4>Подделка ресурсов и контекста<a class="headerlink" href="#faking-resources" title="Ссылка на этот заголовок">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
<p>Часто используемая ситуация, когда информация о пользовательской
авторизации и соединениях с базой данных сохраняется в контексте
приложения или в объекте <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.g</span></code></a>.  Общий шаблон для этого -
поместить объект туда при первом использовании, а далее удалить его
при разрыве контекста.  Представьте, к примеру, такой код, который
служит для получения текущего пользователя:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_user</span><span class="p">():</span>
    <span class="n">user</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">fetch_current_user_from_database</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="k">return</span> <span class="n">user</span>
</pre></div>
</div>
<p>Для его тестирования будет неплохо переопределить пользователя извне, без
изменений в коде.  Это можно сделать тривиально, если зацепить (hooking)
сигнал <a class="reference internal" href="index.html#flask.appcontext_pushed" title="flask.appcontext_pushed"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.appcontext_pushed</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">appcontext_pushed</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">user_set</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="k">with</span> <span class="n">appcontext_pushed</span><span class="o">.</span><span class="n">connected_to</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="k">yield</span>
</pre></div>
</div>
<p>Теперь используем это:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">json</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users/me&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">users_me</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>

<span class="k">with</span> <span class="n">user_set</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">my_user</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/users/me&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_equal</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">my_user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4>Сохранение окружения контекста<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.4.</span></p>
</div>
<p>Иногда бывает полезно вызвать регулярный запрос, сохранив при этом
немного дольше окружение контекста, так чтобы могла произойти
дополнительная интроспекция.  Это стало возможным начиная с Flask
версии 0.4 с использованием <a class="reference internal" href="index.html#flask.Flask.test_client" title="flask.Flask.test_client"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_client()</span></code></a> совместно
с блоком <cite>with</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/?tequila=42&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;tequila&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;42&#39;</span>
</pre></div>
</div>
<p>Если вы использовали просто <a class="reference internal" href="index.html#flask.Flask.test_client" title="flask.Flask.test_client"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_client()</span></code></a> без блока
<cite>with</cite>, <cite>assert</cite> завершится аварийно с ошибкой, так как <cite>request</cite> более
недоступен (потому что вы попытались использовать его вне актуального
запроса).</p>
</div>
<div class="section" id="id10">
<h4>Доступ к сессиям и их изменение<a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
<p>Иногда бывает очень полезно получить доступ к сессиям или изменить их
из клиента тестирования.  Обычно, чтобы сделать это, существует два
способа.  Если вы просто хотите убедиться, что в сессии есть определённый
набор ключей, которым присвоены определённые значения, вам надо просто
сохранить окружение контекста и получить доступ к <a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.session</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">flask</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">42</span>
</pre></div>
</div>
<p>Однако, это не даёт возможности изменять сессию или иметь доступ к сессии
до запуска запроса.  Начиная с Flask 0.8, мы предоставили вам так называемую
“транзакцию сессии”, которая имитирует соответствующие вызовы для открытия
сессии в контексте клиента тестирования, в том числе для её изменения.
В конце транзакции сессия сохраняется.  Это работает вне зависимости от
того, какой из бэкэндов сессии был использован:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">c</span><span class="o">.</span><span class="n">session_transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
        <span class="n">sess</span><span class="p">[</span><span class="s1">&#39;a_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;a value&#39;</span>

    <span class="c1"># здесь сессия будет сохранена</span>
</pre></div>
</div>
<p>Заметим, что в данном случае вам необходимо использовать вместо прокси
<a class="reference internal" href="index.html#flask.session" title="flask.session"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.session</span></code></a> объект <code class="docutils literal notranslate"><span class="pre">sess</span></code>.  Однако, объект сам по себе
обеспечит вас тем же интерфейсом.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/testing/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-errorhandling"></span><div class="section" id="application-errors">
<span id="id1"></span><h3>Журналирование ошибок приложения<a class="headerlink" href="#application-errors" title="Ссылка на этот заголовок">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.3.</span></p>
</div>
<p>В приложениях и серверах иногда происходят ошибки.  Рано или поздно вы
увидите исключение на сервере в эксплуатации.  Даже если ваш код на 100%
правильный, вы всё равно будете время от времени видеть исключения.
Почему?  Потому что может сломаться что-то другое.  Вот некоторые ситуации,
в которых совершенный код может приводить к ошибкам на сервере:</p>
<ul class="simple">
<li>клиент завершил запрос раньше, а приложение по-прежнему ожидает
поступления данных.</li>
<li>сервер базы данных был перегружен и не смог обработать запрос.</li>
<li>в файловой системе закончилось место.</li>
<li>сломался жёсткий диск.</li>
<li>перегружен сервер-бэкэнд.</li>
<li>ошибка в используемой библиотеке.</li>
<li>ошибка сетевого соединения сервера с другой системой.</li>
</ul>
<p>И это только небольшой список причин, который можно продолжить.  Как же
справляться с проблемами такого рода?  По умолчанию, если приложение запущено
в рабочем режиме, Flask покажет очень простую страницу и занесёт исключение в
журнал <a class="reference internal" href="index.html#flask.Flask.logger" title="flask.Flask.logger"><code class="xref py py-attr docutils literal notranslate"><span class="pre">logger</span></code></a>.</p>
<p>Но для обработки ошибок можно сделать и больше, если задать соответствующие
настройки.</p>
<div class="section" id="id2">
<h4>Письма об ошибках<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если приложение запущено на сервере в эксплуатации, по умолчанию
нежелательно показывать сообщения об ошибках.  Почему?  Flask пытается быть
фреймворком, не требующим настройки.  Куда он должен складывать сообщения
об ошибках, если это не указано в настройках?  Автоматически выбранное
место может не подойти, потому что у пользователя может не быть прав на
создание там журналов.  К тому же, в большинстве никто не станет читать
журналы небольших приложений.</p>
<p>На деле я предполагаю, что вы не станете заглядывать в журнал ошибок, даже
если настроите его, до тех пор пока вам не понадобится увидеть исключение
для отладки проблемы, о которой сообщил пользователь.  Более полезной может
оказаться отправка письма в случае возникновения исключения.  Тогда вы
получите оповещение и сможете что-нибудь с ним сделать.</p>
<p>Flask использует встроенную систему журналирования Python, и действительно
может отправлять письма об ошибках, чем вы можете воспользоваться.  Вот как
можно настроить систему журналирования Flask для отправки писем об
исключениях:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ADMINS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;yourname@example.com&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="kn">from</span> <span class="nn">logging.handlers</span> <span class="k">import</span> <span class="n">SMTPHandler</span>
    <span class="n">mail_handler</span> <span class="o">=</span> <span class="n">SMTPHandler</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;server-error@example.com&#39;</span><span class="p">,</span>
                               <span class="n">ADMINS</span><span class="p">,</span> <span class="s1">&#39;YourApplication Failed&#39;</span><span class="p">)</span>
    <span class="n">mail_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">mail_handler</span><span class="p">)</span>
</pre></div>
</div>
<p>Что это даст? Мы создали новый обработчик
<a class="reference external" href="https://docs.python.org/dev/library/logging.handlers.html#logging.handlers.SMTPHandler" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTPHandler</span></code></a>, который отправит письма через
почтовый сервер с IP-адресом <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> на все адреса из <cite>ADMINS</cite> с
адреса <em>server-error&#64;example.com</em> и с темой «YourApplication Failed»
(«Сбой в ВашемПриложении»).  Если почтовый сервер требует авторизации,
можно указать необходимые для неё данные.  За информацией о том, как это
сделать, обратитесь к документации на
<a class="reference external" href="https://docs.python.org/dev/library/logging.handlers.html#logging.handlers.SMTPHandler" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTPHandler</span></code></a>.</p>
<p>Мы также сообщили обработчику, что он должен отправлять письма только об
ошибках или более важных сообщениях, потому что нам явно не нужны письма
о предупреждениях или других бесполезных записях в журнале, которые могут
появиться в процессе обработки запроса.</p>
<p>Перед тем, как применить эти настройки на сервере в эксплуатации,
обратитесь к разделу <a class="reference internal" href="#id4"><span class="std std-ref">Управление форматом журнала</span></a> ниже,
чтобы в письма помещалась необходимая информация и вы не растерялись,
получив письмо.</p>
</div>
<div class="section" id="id3">
<h4>Журналирование в файл<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Даже если вы получили письмо, вам скорее всего захочется посмотреть и на
предупреждения в журнале.  Хорошо бы сохранить как можно больше информации,
полезной для отладки проблемы.  Отметим, что ядро Flask само по себе не
выдаёт предупреждений, поэтому вам самим нужно позаботиться о том, чтобы
генерировать предупреждения в вашем коде, в случае если что-то пошло не так.</p>
<p>Эта пара обработчиков поставляется в комплекте с системой журналирования,
но не каждый из них подходит для начального журналирования ошибок.
Наиболее интересными могут показаться следующие:</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/dev/library/logging.handlers.html#logging.FileHandler" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileHandler</span></code></a> - ведёт журнал ошибок в файле.</li>
<li><a class="reference external" href="https://docs.python.org/dev/library/logging.handlers.html#logging.handlers.RotatingFileHandler" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RotatingFileHandler</span></code></a> - ведёт журнал ошибок в
файле и создаёт новый файл после определённого количества сообщений.</li>
<li><a class="reference external" href="https://docs.python.org/dev/library/logging.handlers.html#logging.handlers.NTEventLogHandler" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NTEventLogHandler</span></code></a> - использует системный
журнал событий Windows.  Может пригодиться при развёртывании приложения
на Windows-компьютере.</li>
<li><a class="reference external" href="https://docs.python.org/dev/library/logging.handlers.html#logging.handlers.SysLogHandler" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SysLogHandler</span></code></a> - отправляет сообщения в syslog,
системный журнал UNIX.</li>
</ul>
<p>Как только вы подберёте подходящий обработчик журнала, можете настроить
обработчик SMTP из примера выше.  Просто убедитесь в том, что снизили порог
критичности сообщений (я рекомендую <cite>WARNING</cite>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="kn">from</span> <span class="nn">themodule</span> <span class="k">import</span> <span class="n">TheHandlerYouWant</span>
    <span class="n">file_handler</span> <span class="o">=</span> <span class="n">TheHandlerYouWant</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<span id="id5"></span><h4>Управление форматом журнала<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>По умолчанию обработчик будет лишь записывать строку с сообщением в файл
или отправлять эту строку по почте.  Записи журнала содержат больше
информации и стоит настроить обработчик так, чтобы он содержал больше
полезной информации, по которой можно понять, что случилось и, что более
важно, где это произошло.</p>
<p>Средство форматирования можно настроить при помощи строки формата.
Отметим, что отчёт о трассировке добавляется к записи в журнале
автоматически, для этого не требуется каких-то специальных настроек в
строке формата.</p>
<p>Вот примеры настройки:</p>
<div class="section" id="id6">
<h5>Журналирование на почту<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logging</span> <span class="k">import</span> <span class="n">Formatter</span>
<span class="n">mail_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Message type:       </span><span class="si">%(levelname)s</span><span class="s1"></span>
<span class="s1">Location:           </span><span class="si">%(pathname)s</span><span class="s1">:</span><span class="si">%(lineno)d</span><span class="s1"></span>
<span class="s1">Module:             </span><span class="si">%(module)s</span><span class="s1"></span>
<span class="s1">Function:           </span><span class="si">%(funcName)s</span><span class="s1"></span>
<span class="s1">Time:               </span><span class="si">%(asctime)s</span><span class="s1"></span>

<span class="s1">Message:</span>

<span class="si">%(message)s</span><span class="s1"></span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h5>Журналирование в файл<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logging</span> <span class="k">import</span> <span class="n">Formatter</span>
<span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">Formatter</span><span class="p">(</span>
    <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1"> &#39;</span>
    <span class="s1">&#39;[in </span><span class="si">%(pathname)s</span><span class="s1">:</span><span class="si">%(lineno)d</span><span class="s1">]&#39;</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h5>Сложное форматирование журналов<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h5>
<p>Вот список полезных переменных форматирования для подстановки в строку
формата.  Отметим, что этот список не полный, полный список можно найти в
официальной документации пакета журналирования <a class="reference external" href="https://docs.python.org/dev/library/logging.html#module-logging" title="(в Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Format</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">%(levelname)s</span></code></td>
<td>Уровень серьёзности сообщения (<code class="docutils literal notranslate"><span class="pre">'DEBUG'</span></code> -
отладочное, <code class="docutils literal notranslate"><span class="pre">'INFO'</span></code> - информационное,
<code class="docutils literal notranslate"><span class="pre">'WARNING'</span></code> - предупреждение, <code class="docutils literal notranslate"><span class="pre">'ERROR'</span></code> -
ошибка, <code class="docutils literal notranslate"><span class="pre">'CRITICAL'</span></code> - критичное).</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">%(pathname)s</span></code></td>
<td>Полный путь к файлу с исходным текстом, из
которого была вызвана функция журналирования (если
доступен).</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">%(filename)s</span></code></td>
<td>Имя файла с исходным текстом.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">%(module)s</span></code></td>
<td>Модуль (часть имени файла).</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">%(funcName)s</span></code></td>
<td>Имя функции, из который была вызвана функция
журналирования.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">%(lineno)d</span></code></td>
<td>Номер строки в файле исходного текста, в которой
произошёл вызов функции журналирования (если
доступна).</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">%(asctime)s</span></code></td>
<td>Время создания записи в журнале в
человеко-читаемом виде.  По умолчанию используется
формат <code class="docutils literal notranslate"><span class="pre">&quot;2003-07-08</span> <span class="pre">16:49:45,896&quot;</span></code> (числа после
запятой - это миллисекунды).  Можно изменить путём
создания класса-наследника от formatter и заменой
метода <a class="reference external" href="https://docs.python.org/dev/library/logging.html#logging.Formatter.formatTime" title="(в Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">formatTime()</span></code></a>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">%(message)s</span></code></td>
<td>Журнальное сообщение, полученное из выражения
<code class="docutils literal notranslate"><span class="pre">msg</span> <span class="pre">%</span> <span class="pre">args</span></code></td>
</tr>
</tbody>
</table>
<p>Если вы хотите выполнить тонкую настройку форматирования, нужно создать
класс-наследник от formatter.  formatter имеет три полезных метода:</p>
<dl class="docutils">
<dt><a class="reference external" href="https://docs.python.org/dev/library/logging.html#logging.Formatter.format" title="(в Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">format()</span></code></a>:</dt>
<dd>Занимается собственно форматированием.  Принимает объект
<a class="reference external" href="https://docs.python.org/dev/library/logging.html#logging.LogRecord" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogRecord</span></code></a> и возвращает отформатированную строку.</dd>
<dt><a class="reference external" href="https://docs.python.org/dev/library/logging.html#logging.Formatter.formatTime" title="(в Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">formatTime()</span></code></a>:</dt>
<dd>Вызывается для форматирования <cite>asctime</cite>.  Если нужно задать другой
формат времени, можно заменить этот метод.</dd>
<dt><a class="reference external" href="https://docs.python.org/dev/library/logging.html#logging.Formatter.formatException" title="(в Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">formatException()</span></code></a></dt>
<dd>Вызывается для форматирования исключений.  Принимает кортеж
<code class="xref py py-attr docutils literal notranslate"><span class="pre">exc_info</span></code> и возвращает строку.  В большинстве случаев
подойдёт метод по умолчанию, поэтому скорее всего вам не потребуется
его заменять.</dd>
</dl>
<p>За более подробной информацией обратитесь к официальной документации.</p>
</div>
</div>
<div class="section" id="id9">
<h4>Другие библиотеки<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h4>
<p>Таким образом мы настроили журналирование событий, порождаемых самим
приложением.  Другие библиотеки могут вести собственный журнал.  Например,
SQLAlchemy широко использует журналирование в собственном ядре.  Хотя этот
способ пригоден для настройки сразу всех средств журналирования в пакете
<a class="reference external" href="https://docs.python.org/dev/library/logging.html#module-logging" title="(в Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a>, пользоваться им не рекомендуется.  Может возникнуть
ситуация, когда нужно различать приложения, работающие в пределах одного
интерпретатора Python, но будет невозможно сделать для них отдельные
настройки журналирования.</p>
<p>Вместо этого рекомендуется выяснить, какие средства журналирования нужны,
получить их с помощью функции <a class="reference external" href="https://docs.python.org/dev/library/logging.html#logging.getLogger" title="(в Python v3.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">getLogger()</span></code></a> и перебрать все
присоединённые к ним обработчики:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logging</span> <span class="k">import</span> <span class="n">getLogger</span>
<span class="n">loggers</span> <span class="o">=</span> <span class="p">[</span><span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span> <span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;sqlalchemy&#39;</span><span class="p">),</span>
           <span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;otherlibrary&#39;</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">logger</span> <span class="ow">in</span> <span class="n">loggers</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">mail_handler</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id10">
<h3>Отладка ошибок приложения<a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h3>
<p>Для приложений в эксплуатации настройте журналирование и уведомления так, как
описано в разделе <a class="reference internal" href="#application-errors"><span class="std std-ref">Журналирование ошибок приложения</span></a>.  Этот раздел предоставит указания
для отладки конфигурации развёртывания и более глубокого исследования с
использованием полнофункционального отладчика Python.</p>
<div class="section" id="id11">
<h4>В случае сомнений запускайте вручную<a class="headerlink" href="#id11" title="Ссылка на этот заголовок">¶</a></h4>
<p>Возникли проблемы с настройкой приложения в эксплуатации?  Если имеется
доступ к командной строке на сервере, проверьте, можете ли вы запустить
приложение вручную из командной строки в режиме разработки.  Убедитесь, что
запустили его под той же учётной записью, под которой оно установлено, чтобы
отследить ошибки, связанные с неправильной настройкой прав доступа.  Можете
воспользоваться встроенным во Flask сервером разработки, передав ему
аргумент <cite>debug=True</cite> на сервере эксплуатации, что может помочь в отлове
проблем с настройками, но <strong>убедитесь, что делаете это временно в
управляемом окружении</strong>.  Не запускайте приложение в эксплуатацию с
аргументом debug=True.</p>
</div>
<div class="section" id="working-with-debuggers">
<span id="id12"></span><h4>Работа с отладчиками<a class="headerlink" href="#working-with-debuggers" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для более глубокого исследования можно выполнить трассировку кода.  Flask
содержит отладчик в стандартной поставке (смотрите <a class="reference internal" href="index.html#debug-mode"><span class="std std-ref">Режим отладки</span></a>). Если
вам нравится пользоваться другим отладчиком Python, учтите, что они могут
мешать друг другу.  Можно указать несколько опций, чтобы использовать ваш
любимый отладчик:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">debug</span></code>        - указывает, нужно ли включить режим отладки и захват
исключений.</li>
<li><code class="docutils literal notranslate"><span class="pre">use_debugger</span></code> - указывает, нужно ли использовать отладчик, встроенный
во Flask.</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">use_reloader</span></code> - указывает, нужно ли перезагружать и перезапускать процесс,</dt>
<dd>если произошло исключение.</dd>
</dl>
</li>
</ul>
<p>Опция <code class="docutils literal notranslate"><span class="pre">debug</span></code> должна иметь значение True (то есть, исключения должны
захватываться), для того чтобы учитывались две следующие опции.</p>
<p>Если вы используете Aptana/Eclipse для отладки, вам нужно установить обе опции
<code class="docutils literal notranslate"><span class="pre">use_debugger</span></code> и <code class="docutils literal notranslate"><span class="pre">use_reloader</span></code> в False.</p>
<p>Возможно, лучшие всего настроить эти опции в файле config.yaml (измените блок,
так как вам нужно):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FLASK</span><span class="p">:</span>
    <span class="n">DEBUG</span><span class="p">:</span> <span class="kc">True</span>
    <span class="n">DEBUG_WITH_APTANA</span><span class="p">:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>В точке входа в ваше приложение (main.py), нужно написать что-то вроде этого:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># To allow aptana to receive errors, set use_debugger=False</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="n">use_debugger</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Disable Flask&#39;s debugger if external debugger is requested</span>
        <span class="n">use_debugger</span> <span class="o">=</span> <span class="ow">not</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DEBUG_WITH_APTANA&#39;</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">use_debugger</span><span class="o">=</span><span class="n">use_debugger</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
            <span class="n">use_reloader</span><span class="o">=</span><span class="n">use_debugger</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="http://flask.pocoo.org/docs/errorhandling/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-config"></span><div class="section" id="flask">
<span id="config"></span><h3>Обработка конфигурации Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.3.</span></p>
</div>
<p>Приложения требуют настройки.  Здесь описаны различные настройки, которые
можно менять в зависимости от окружения, в котором работает приложение:
переключение режима отладки, настройки секретного ключа и т.п.</p>
<p>Flask спроектирован так, что обычно требует настройки при запуске
приложения.  Вы можете вшить настройки в код, что не так уж плохо для
многих небольших приложений, но имеются способы лучше.</p>
<p>Вне зависимости от того, каким образом загружена конфигурация, существует
объект конфигурации, содержащий загруженные параметры: атрибут
<a class="reference internal" href="index.html#flask.Flask.config" title="flask.Flask.config"><code class="xref py py-attr docutils literal notranslate"><span class="pre">config</span></code></a> объекта <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a>.  Это место,
где Flask содержит свои настройки, а также то место, куда расширения могут
поместить собственные настройки.  Но здесь можно размещать и конфигурацию
вашего приложения.</p>
<div class="section" id="id1">
<h4>Основы конфигурации<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p><a class="reference internal" href="index.html#flask.Flask.config" title="flask.Flask.config"><code class="xref py py-attr docutils literal notranslate"><span class="pre">config</span></code></a> на самом деле является подклассом словаря и
может изменяться точно так же, как и любой словарь:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Некоторые параметры конфигурации передаются в объект <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask</span></code></a>,
которые тоже можно читать и писать:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Для обновления нескольких ключей за раз можно воспользоваться методом
словаря <a class="reference external" href="https://docs.python.org/dev/library/stdtypes.html#dict.update" title="(в Python v3.8)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dict.update()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">SECRET_KEY</span><span class="o">=</span><span class="s1">&#39;...&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Встроенные параметры конфигурации<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Сам Flask использует следующие параметры конфигурации:</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">DEBUG</span></code></td>
<td>Включить/выключить режим отладки.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">TESTING</span></code></td>
<td>Включить/выключить режим тестирования.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PROPAGATE_EXCEPTIONS</span></code></td>
<td>Явное включение или отключение
исключений.  Если не задано или явным
образом задано значение <cite>None</cite>, то
подразумевается истина, если истиной
является <cite>TESTING</cite> или <cite>DEBUG</cite>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">PRESERVE_CONTEXT_ON_EXCEPTION</span></code></td>
<td>По умолчанию в режиме отладки при
возникновении исключения контекст запроса
не извлекается из стека, позволяя
отладчику анализировать данные.  Такое
поведение можно отключить с помощью этого
параметра.  Также можно воспользоваться
этим параметром для его принудительного
включения, если это может помочь в
отладке приложений в эксплуатации
(однако, это не рекомендуется).</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code></td>
<td>Секретный ключ.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_NAME</span></code></td>
<td>Имя переменной (cookie) браузера для
хранения сеанса.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_DOMAIN</span></code></td>
<td>Домен переменной браузера, используемой
для хранения сеанса.  Если не задан,
переменная браузера будет действительной
для всех поддоменов <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_PATH</span></code></td>
<td>Путь к переменной браузера, используемой
для хранения сеанса.  Если не задан,
переменная браузера будет действительной
для всех <code class="docutils literal notranslate"><span class="pre">APPLICATION_ROOT</span></code>, если не
задано значение <code class="docutils literal notranslate"><span class="pre">'/'</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_HTTPONLY</span></code></td>
<td>Указывает, должен ли у переменной
браузера устанавливаться флаг httponly
(что защищает переменную от доступа со
стороны скриптов, работающих внутри
браузера - <code class="docutils literal notranslate"><span class="pre">прим.</span> <span class="pre">перев.</span></code>).  По
умолчанию - <cite>True</cite>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_SECURE</span></code></td>
<td>Указывает, должен ли у переменной
браузера устанавливаться флаг secure (что
позволяет передавать переменную только по
защищённому протоколу HTTPS - <code class="docutils literal notranslate"><span class="pre">прим.</span>
<span class="pre">перев.</span></code>). По умолчанию - <cite>False</cite>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PERMANENT_SESSION_LIFETIME</span></code></td>
<td>Непрерывное время жизни сеанса, как
объект <a class="reference external" href="https://docs.python.org/dev/library/datetime.html#datetime.timedelta" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.timedelta</span></code></a>.
Начиная с Flask 0.8 этот параметр может
быть задан в виде целого числа с
количеством секунд.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SESSION_REFRESH_EACH_REQUEST</span></code></td>
<td>Этот флаг контролирует, как будут
обновляться постоянные сессии.  Если
установлен в <cite>True</cite> (по умолчанию),
cookies будут обновляться при каждом
запросе, что автоматически подтолкнёт
вперёд окончание их срока жизни.
Если установлен в <cite>False</cite>, заголовок
<cite>set-cookie</cite> посылается только в случае
внесения изменений в сессию.  Не влияет
на не постоянные сессии.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">USE_X_SENDFILE</span></code></td>
<td>Включить/отключить x-sendfile.  (При
использовании этой возможности
представление может вернуть специально
сформированный ответ со ссылкой на
статический файл.  Получив такой ответ от
представления, веб-сервер отдаёт клиенту
вместо ответа представления сам
статический файл, найдя его по ссылке в
локальной файловой системе.  Это
позволяет перенести нагрузку по отдаче
больших файлов на веб-сервер, если перед
отдачей файла представление должно
решить, можно ли отдавать этот файл
клиенту и какой именно файл нужно отдать
по этой ссылке - <code class="docutils literal notranslate"><span class="pre">прим.</span> <span class="pre">перев.</span></code>)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">LOGGER_NAME</span></code></td>
<td>Имя средства журналирования.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code></td>
<td>Имя и номер порта сервера.  Необходимо
для поддержки поддоменов (например:
<code class="docutils literal notranslate"><span class="pre">'myapp.dev:5000'</span></code>).  Отметим, что
localhost не поддерживает поддомены,
поэтому установка параметра в значение
“localhost” не поможет.  Настройка
<code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> также по умолчанию
включает генерацию URL’ов без контекста
запроса, но с контекстом приложения.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">APPLICATION_ROOT</span></code></td>
<td>Если приложение не занимает целый домен
или поддомен, с помощью этого параметра
можно задать путь к настроенному
приложению.  Значение этого параметра
используется в качестве пути к переменной
браузера для хранения сеанса.  Если
используются домены, значением этого
параметра должно быть <code class="docutils literal notranslate"><span class="pre">None</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">MAX_CONTENT_LENGTH</span></code></td>
<td>Если задать значение в байтах, Flask
будет отклонять входящие запросы, объём
содержимого которых больше этого
значения, возвращая код статуса 413.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SEND_FILE_MAX_AGE_DEFAULT</span></code>:</td>
<td>По умолчанию задаёт время кэширования
файла для использования совместно с
<a class="reference internal" href="index.html#flask.Flask.send_static_file" title="flask.Flask.send_static_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_static_file()</span></code></a>
(обработчик статических файлов по
умолчанию) и <a class="reference internal" href="index.html#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>,
в секундах.  Заменить это значение для
каждого файла индивидуально можно с
помощью обработчика
<a class="reference internal" href="index.html#flask.Flask.get_send_file_max_age" title="flask.Flask.get_send_file_max_age"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_send_file_max_age()</span></code></a>
<a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> или
<a class="reference internal" href="index.html#flask.Blueprint" title="flask.Blueprint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code></a>.  По умолчанию -
43200 (12 часов).</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">TRAP_HTTP_EXCEPTIONS</span></code></td>
<td>Если <code class="docutils literal notranslate"><span class="pre">True</span></code>, Flask не выполняет
обработчиков ошибок исключений HTTP, но
вместо этого трактует исключение как любое
другое и передаёт исключение выше.  Этот
параметр полезен для отладки сложных
случаев, когда нужно найти, где именно
произошло исключение HTTP.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">TRAP_BAD_REQUEST_ERRORS</span></code></td>
<td>Внутренние структуры данных Werkzeug,
работающие с данными запроса порождают
ошибки с особым ключом, также являющимся
исключением запроса.  Также, многие
операции могут неявно приводить к
исключениям BadRequest в случае ошибок
целостности.  Поскольку для отладки важно
знать, где именно произошла ошибка, этот
флаг может использоваться для отладки в
подобных случаях. Если этот параметр
истинен (<code class="docutils literal notranslate"><span class="pre">True</span></code>), произойдёт обычная
выдача результата трассировки.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">PREFERRED_URL_SCHEME</span></code></td>
<td>Схема, которую нужно использовать для
генерации URL’ов, если она не указана
явно.  По умолчанию - <code class="docutils literal notranslate"><span class="pre">http</span></code>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">JSON_AS_ASCII</span></code></td>
<td>По умолчанию Flask сериализует объекты
к JSON, представленному в виде ASCII.
Если <code class="docutils literal notranslate"><span class="pre">False</span></code>, Flask не будет кодировать
в ASCII, а выводимые строки будут как есть,
то есть в виде строк в формате unicode.
Затем, <code class="docutils literal notranslate"><span class="pre">json-ификация</span></code> автоматически
переведёт их к кодировке <code class="docutils literal notranslate"><span class="pre">utf-8</span></code> для
дальнейшей доставки для экземпляра.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">JSON_SORT_KEYS</span></code></td>
<td>По умолчанию Flask сериализует объекты
JSON таким способом, что ключи становятся
упорядоченными.  Это делается, чтобы
гарантировать, что независимо от значения
хэша словаря, возвращаемое значение будет
таким, чтобы не замусоривать внешние HTTP-
кэши.  Вы можете переопределить поведение
по умолчанию через изменение этой переменной.
Это не рекомендовано, но может дать вам
выигрыш в производительности ценой
худшей кэшируемости данных.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">JSONIFY_PRETTYPRINT_REGULAR</span></code></td>
<td>Если <code class="docutils literal notranslate"><span class="pre">True</span></code> (по умолчанию), ответы
json-ификации будут распечатаны, если они не
запрашивались объектом XMLHttpRequest
(который контролируется заголовком
<code class="docutils literal notranslate"><span class="pre">X-Requested-With</span></code>)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">TEMPLATES_AUTO_RELOAD</span></code></td>
<td>Flask проверяет, был ли изменён шаблон каждый
раз, когда он запрашивается, и перезагружает
его в случае такой необходимости.  Однако это
происходит ценой увеличения дискового
ввода-вывода, и может появиться жизненная
необходимость отключить данную особенность
путём установки этого ключа в <code class="docutils literal notranslate"><span class="pre">False</span></code>.
Данная опция не оказывает влияния при работе
в режиме отладки.</td>
</tr>
</tbody>
</table>
<div class="admonition-server-name admonition">
<p class="first admonition-title">Подробнее о <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> - это параметр, который используется для поддержки
поддоменов.  Flask не может догадаться о том, какая часть доменного
имени является поддоменом, не зная имя сервера.  Этот же параметр
используется для настройки переменной браузера, в которой хранится сеанс.</p>
<p class="last">Помните, что не только Flask не может узнать поддомен, ваш веб-браузер
тоже не может.  Большинство соверменных браузеров не разрешают
междоменные переменные браузера, если в имени сервера нет точек.
Поэтому если имя сервера <code class="docutils literal notranslate"><span class="pre">'localhost'</span></code>, вы не сможете задать переменную
браузера для <code class="docutils literal notranslate"><span class="pre">'localhost'</span></code> и каждого из его поддоменов.  В этом случае
выберите другое имя сервера, например <code class="docutils literal notranslate"><span class="pre">'myapplication.local'</span></code> и
добавьте это имя и поддомены, которые вы хотите использовать, в файл
hosts или настройте локальный <a class="reference external" href="https://www.isc.org/software/bind">bind</a>.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.4: </span><code class="docutils literal notranslate"><span class="pre">LOGGER_NAME</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5: </span><code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.6: </span><code class="docutils literal notranslate"><span class="pre">MAX_CONTENT_LENGTH</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7: </span><code class="docutils literal notranslate"><span class="pre">PROPAGATE_EXCEPTIONS</span></code>, <code class="docutils literal notranslate"><span class="pre">PRESERVE_CONTEXT_ON_EXCEPTION</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8: </span><code class="docutils literal notranslate"><span class="pre">TRAP_BAD_REQUEST_ERRORS</span></code>, <code class="docutils literal notranslate"><span class="pre">TRAP_HTTP_EXCEPTIONS</span></code>,
<code class="docutils literal notranslate"><span class="pre">APPLICATION_ROOT</span></code>, <code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_DOMAIN</span></code>,
<code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_PATH</span></code>, <code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_HTTPONLY</span></code>,
<code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_SECURE</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9: </span><code class="docutils literal notranslate"><span class="pre">PREFERRED_URL_SCHEME</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10: </span><code class="docutils literal notranslate"><span class="pre">JSON_AS_ASCII</span></code>, <code class="docutils literal notranslate"><span class="pre">JSON_SORT_KEYS</span></code>, <code class="docutils literal notranslate"><span class="pre">JSONIFY_PRETTYPRINT_REGULAR</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 1.0: </span><code class="docutils literal notranslate"><span class="pre">SESSION_REFRESH_EACH_REQUEST</span></code></p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 1.0: </span><code class="docutils literal notranslate"><span class="pre">TEMPLATES_AUTO_RELOAD</span></code></p>
</div>
</div>
<div class="section" id="id3">
<h4>Задание конфигурации с помощью файлов<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Конфигурация становится более удобной, если разместить её в отдельном
файле.  Лучше, если он находится за пределами пакета с приложением.  Это
позволяет создавать пакеты и распространять приложения с помощью различных
инструментов обработки пакетов (<span class="xref std std-ref">distribute-deployment</span>) и
впоследствии - изменять конфигурацию.</p>
<p>Далее показан обычный пример::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;yourapplication.default_settings&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_envvar</span><span class="p">(</span><span class="s1">&#39;YOURAPPLICATION_SETTINGS&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Сначала грузится конфигурация из модуля
<cite>yourapplication.default_settings</cite>, а затем её значения заменяет
содержимое файла, указанного в переменной окружения
<span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">YOURAPPLICATION_SETTINGS</span></code>.  Эта переменная окружения может быть
задана в Linux или OS X при помощи команды export оболочки перед запуском
сервера:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export YOURAPPLICATION_SETTINGS=/path/to/settings.cfg
$ python run-app.py
 * Running on http://127.0.0.1:5000/
 * Restarting with reloader...
</pre></div>
</div>
<p>В системах Windows воспользуйтесь встроенной командой <cite>set</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="nb">set</span> <span class="n">YOURAPPLICATION_SETTINGS</span><span class="o">=</span>\<span class="n">path</span>\<span class="n">to</span>\<span class="n">settings</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
<p>Файлы конфигурации являются обычными файлами Python.  В объект конфигурации
сохраняются только переменные с именами в верхнем регистре, так что
убедитесь в том, что имена ваших параметров заданы в верхнем регистре.</p>
<p>Вот пример файла конфигурации:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Пример конфигурации</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;?</span><span class="se">\xbf</span><span class="s1">,</span><span class="se">\xb4\x8d\xa3</span><span class="s1">&quot;&lt;</span><span class="se">\x9c\xb0</span><span class="s1">@</span><span class="se">\x0f</span><span class="s1">5</span><span class="se">\xab</span><span class="s1">,w</span><span class="se">\xee\x8d</span><span class="s1">$0</span><span class="se">\x13\x8b</span><span class="s1">83&#39;</span>
</pre></div>
</div>
<p>Убедитесь в том, что файл загружается как можно раньше, чтобы расширения
могли получить доступ к собственным настройкам при запуске.  Существуют
другие методы загрузки объекта конфигурации из отдельных файлов.  За более
полной информацией обратитесь к документации объекта <a class="reference internal" href="index.html#flask.Config" title="flask.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">Config</span></code></a>.</p>
</div>
<div class="section" id="id4">
<h4>Лучшие способы задания конфигурации<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Недостаток описанного выше подхода заключается в усложнении тестирования.
Нет стопроцентного способа решения этой проблемы, но вот несколько
рекомендаций опытных пользователей:</p>
<ol class="arabic simple">
<li>Создайте ваше приложение внутри функции и зарегистрируйте в ней
blueprint’ы.  Таким образом вы можете создать несколько экземпляров
вашего приложения с разными конфигурациями, что значительно упростит
модульное тестирование.  Вы можете воспользоваться функцией,
чтобы передать в неё необходимую конфигурацию.</li>
<li>Не пишите код, которому требуется конфигурация при импорте. Если
ограничиться чтением конфигурации по запросу, возможно будет
переконфигурировать объект позже.</li>
</ol>
</div>
<div class="section" id="id5">
<h4>Режим разработки и режим эксплуатации<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<p>Большинству приложений нужно более одной конфигурации.  По меньшей мере
нужна отдельная конфигурация для рабочего сервера и ещё одна для разработки.
Простейший способ управления ими - это создать конфигурацию по умолчанию,
которая загружается всегда и которую можно поместить в систему управления
версиями, и частичные конфигурации, которые заменяют необходимые значения
следующим образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;yourapplication.default_settings&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_envvar</span><span class="p">(</span><span class="s1">&#39;YOURAPPLICATION_SETTINGS&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь просто создайте отдельный файл <cite>config.py</cite>, выполните команду
export <code class="docutils literal notranslate"><span class="pre">YOURAPPLICATION_SETTINGS=/path/to/config.py</span></code> и готово.  Однако,
существуют альтернативные способы.  Например, можно воспользоваться импортом
и подклассами.</p>
<p>В мире Django распространён следующий способ: сделать явный импорт
конфигурации, добавив строку <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">yourapplication.default_settings</span>
<span class="pre">import</span> <span class="pre">*</span></code> в начале файла, а затем заменить значения вручную.  Можно сделать
также, затем взять из переменной окружения вида <code class="docutils literal notranslate"><span class="pre">YOURAPPLICATION_MODE</span></code>
необходимый режим - <cite>production</cite>, <cite>development</cite> и т.п., а затем импортировать
заранее определённые файлы, основываясь на этом значении.</p>
<p>Другой любопытный способ - воспользоваться классами и наследованием
конфигурации:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">TESTING</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">DATABASE_URI</span> <span class="o">=</span> <span class="s1">&#39;sqlite://:memory:&#39;</span>

<span class="k">class</span> <span class="nc">ProductionConfig</span><span class="p">(</span><span class="n">Config</span><span class="p">):</span>
    <span class="n">DATABASE_URI</span> <span class="o">=</span> <span class="s1">&#39;mysql://user@localhost/foo&#39;</span>

<span class="k">class</span> <span class="nc">DevelopmentConfig</span><span class="p">(</span><span class="n">Config</span><span class="p">):</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">TestingConfig</span><span class="p">(</span><span class="n">Config</span><span class="p">):</span>
    <span class="n">TESTING</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Для включения такой конфигурации, вам просто нужно вызвать
<a class="reference internal" href="index.html#flask.Config.from_object" title="flask.Config.from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_object()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;configmodule.ProductionConfig&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Есть много разных способов, которые можно выбрать для управления файлами
конфигурации. Вот список хороших советов:</p>
<ul class="simple">
<li>Храните файл конфигурации по умолчанию в системе управления версиями.
Заполните объект конфигурации значениями по умолчанию или импортируйте
его в ваших собственных файлах конфигурации перед тем, как заменить
значения.</li>
<li>Воспользуйтесь переменной окружения для переключения между
конфигурациями.  Это можно сделать вне интерпретатора Python и это
позволит упростить разработку и развёртывание, потому что вы можете
быстро и легко переключаться между разными конфигурациями, совсем не
прикасаясь к коду.  Если вы часто работаете над разными проектами,
можно создать собственный скрипт, который будет определять текущий
каталог проекта, активировать virtualenv и экспортировать конфигурацию
режима разработки.</li>
<li>Используйте инструмент <a class="reference external" href="http://fabfile.org/">fabric</a> для внесения изменений на сервер
эксплуатации и раздельных конфигураций на серверы эксплуатации.  За
более подробным описанием того, как это сделать, обратитесь к главе
<span class="xref std std-ref">fabric-deployment</span>.</li>
</ul>
</div>
<div class="section" id="instance-folders">
<span id="id6"></span><h4>Каталоги экземпляров<a class="headerlink" href="#instance-folders" title="Ссылка на этот заголовок">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
<p>Во Flask 0.8 появились каталоги экземпляров.  Flask долгое время позволял
ссылаться на пути относительно каталога приложения (с помощью
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.root_path</span></code>).  Поэтому многие разработчики хранили конфигурацию
рядом с приложением.  К несчастью, это возможно только если приложение не
находится внутри пакета, так как в таком случае root_path указывает внутрь
пакета.</p>
<p>Во Flask 0.8 был введён новый атрибут: <code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.instance_path</span></code>.  Он
вводит новое понятие, которое называется “каталогом экземпляра”. Каталог
экземпляра задуман как каталог, не управляемый системой контроля версий
и относящийся к развёрнутому приложению.  Это подходящее место для того,
чтобы поместить в него файлы, изменяемые в процессе работы или файлы
конфигурации.</p>
<p>Можно явным образом указать путь к каталогу экземпляра при создании
приложения Flask или можно разрешить Flask’у самому выбрать каталог
экземпляра.  Чтобы задать его явным образом, воспользуйтесь параметром
<cite>instance_path</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">instance_path</span><span class="o">=</span><span class="s1">&#39;/path/to/instance/folder&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Помните, что если этот путь указан, он <em>должен</em> быть абсолютным.</p>
<p>Если параметр <cite>instance_path</cite> не указан, по умолчанию используются
следующие места:</p>
<ul>
<li><p class="first">Не установленный модуль:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">myapp</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">instance</span>
</pre></div>
</div>
</li>
<li><p class="first">Не установленный пакет:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">myapp</span>
    <span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">instance</span>
</pre></div>
</div>
</li>
<li><p class="first">Установленный модуль или пакет:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$PREFIX/lib/python2.X/site-packages/myapp
$PREFIX/var/myapp-instance
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">$PREFIX</span></code> - это префикс, с которым установлен Python. Это может быть
каталог <code class="docutils literal notranslate"><span class="pre">/usr</span></code> или путь в каталоге с виртуальным окружением,
созданном virtualenv.  Можно вывести на экран значение <code class="docutils literal notranslate"><span class="pre">sys.prefix</span></code>,
чтобы увидеть его действительное значение.</p>
</li>
</ul>
<p>Как только стало возможным загружать объект конфигурации из файлов с
относительными именами, мы добавили возможность загружать файлы с именами
относительно каталога экземпляра.  При помощи переключателя
<cite>instance_relative_config</cite> в конструкторе приложения можно указать, должны
ли интерпретироваться относительные пути файлов “относительно корня
приложения” (по умолчанию) или “относительно каталога экземпляра”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">instance_relative_config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Ниже представлен полный пример настройки Flask для предварительной загрузки
конфигурации из модуля и последующей замены параметров значениями из файла
в каталоге конфигурации, если он существует:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">instance_relative_config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;yourapplication.default_settings&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="s1">&#39;application.cfg&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Путь к каталогу экземпляра может быть найден при помощи
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.instance_path</span></code>. Flask также предоставляет более короткий
способ открытия файлов из каталога экземпляра при помощи
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.open_instance_resource()</span></code>.</p>
<p>Вот пример для обоих способов:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">instance_path</span><span class="p">,</span> <span class="s1">&#39;application.cfg&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># или при помощи open_instance_resource:</span>
<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">open_instance_resource</span><span class="p">(</span><span class="s1">&#39;application.cfg&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h4>Примечания переводчика<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h4>
<p>В качестве перевода для термина <code class="docutils literal notranslate"><span class="pre">cookie</span></code> было использовано понятие
«переменных бразуера».</p>
<p>Информация о флагах <cite>httponly</cite> и <cite>secure</cite> взята из статьи <a class="reference external" href="http://ru.wikipedia.org/wiki/HTTP_cookie">HTTP cookie</a>.</p>
<p>Информация о <cite>x-sendfile</cite> взята из статьи <a class="reference external" href="http://codepress.ru/статьи/php/nginx-xsendfile.html">Передача файлов с помощью XSendfile с помощью NGINX</a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/config/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-signals"></span><div class="section" id="signals">
<span id="id1"></span><h3>Сигналы<a class="headerlink" href="#signals" title="Ссылка на этот заголовок">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.6.</span></p>
</div>
<p>В Flask, начиная с версии 0.6, есть интегрированная поддержка для
передачи сигналов.  Эта поддержка обеспечивается великолепной библиотекой
<a class="reference external" href="http://pypi.python.org/pypi/blinker">blinker</a>, при отсутствии которой она элегантно отключается.</p>
<p>Что такое сигналы? Он помогают вам разделить приложения с помощью
посылки уведомлений при возникновении где-либо действий - в ядре фреймворка
или в других расширениях Flask.  Вкратце - сигналы позволяют определённым
отправителям уведомлять их подписчиков о том, что что-то произошло.</p>
<p>Внутри Flask уже есть пара сигналов, а другие расширения могут давать
дополнительные.  Также имейте ввиду, что сигналы предназначены для
уведомления подписчиков и не должны им содействовать в изменении данных.
Вы заметите, что есть такие сигналы, которые появляются для того, чтобы
сделать то же самое, что делают некоторые из встроенных декораторов
(например: <a class="reference internal" href="index.html#flask.request_started" title="flask.request_started"><code class="xref py py-data docutils literal notranslate"><span class="pre">request_started</span></code></a> очень похож на
<a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a>).  Однако, есть разница в том, как
они работают.  Например, обработчик <a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a>,
который находится в ядре, выполняется в соответствии с определённым
порядком и способен с помощью возврата ответа прервать запрос на ранней
стадии.  Напротив, порядок выполнения для всех обработчиков сигналов,
которые в процессе работы не изменяют какие-либо данные, не определён.</p>
<p>Большим преимуществом сигналов перед обработчиками является то, что
вы можете в один миг спокойно на них подписаться.  Такие временные
подписки могут оказаться полезными, например, при тестировании модулей.
Например, сигналы прекрасно подходят для того, чтобы узнать, что было
отрисовано шаблоном в рамках запроса.</p>
<div class="section" id="id2">
<h4>Подписка на сигналы<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Чтобы подписаться на сигнал, вы можете использовать его метод
<a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Signal.connect" title="(в Blinker v1.4)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connect()</span></code></a>.  Первый аргумент - это функция,
которая должна быть вызвана в момент подачи сигнала, второй необязательный
аргумент определяет отправителя.  Для того, чтобы отписаться от сигнала,
вы можете использовать метод <a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Signal.disconnect" title="(в Blinker v1.4)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">disconnect()</span></code></a>.</p>
<p>Для всех сигналов ядра Flask, отправителем является приложение, которое
выдало этот сигнал.  Когда вы подписываетесь на сигнал и не хотите
слушать сигналы от всех приложений, убедитесь, что указали отправителя.
Особенно это верно, если вы взялись за разработку расширения Flask.</p>
<p>Вот, например, менеджер контекстов для помощника, который можно использовать
при тестировании модуля для того, чтобы выяснить, какие из шаблонов были
отрисованы и какие переменные были переданы шаблону:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">template_rendered</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">captured_templates</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">recorded</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
        <span class="n">recorded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
    <span class="n">template_rendered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">recorded</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">template_rendered</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>Этот фрагмент хорошо подходит для совместного использования с клиентом
тестирования:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">captured_templates</span><span class="p">(</span><span class="n">app</span><span class="p">)</span> <span class="k">as</span> <span class="n">templates</span><span class="p">:</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">rv</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">templates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">template</span><span class="p">,</span> <span class="n">context</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">template</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;index.html&#39;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">10</span>
</pre></div>
</div>
<p>Чтобы ваши вызовы не порушились в ситуации, если Flask вставит для сигнала
новые аргументы, убедитесь, что подписываетесь с дополнительным аргументом
<code class="docutils literal notranslate"><span class="pre">**extra</span></code></p>
<p>Вся отрисовка шаблона внутри кода, вызванного изнутри тела блока <cite>with</cite>
приложения <cite>app</cite>, теперь будет записана в переменную <cite>templates</cite>.  Всякий
раз при отрисовке шаблона, к ней будут добавлены объект шаблона и контекст.</p>
<p>Кроме того, есть удобный метод помощника
(<a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Signal.connected_to" title="(в Blinker v1.4)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connected_to()</span></code></a>), что позволяет вам временно
самоподписать функцию на сигнал с менеджером контекстов.  Так как возвращаемое
менеджером контекстов значение не может быть указано, оно должно быть
передано в списке в качестве аргумента:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">template_rendered</span>

<span class="k">def</span> <span class="nf">captured_templates</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">recorded</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">recorded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">template_rendered</span><span class="o">.</span><span class="n">connected_to</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>Вышеуприведённый пример в этом случае будет выглядить так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">templates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="n">captured_templates</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">templates</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">template</span><span class="p">,</span> <span class="n">context</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition-blinker-api admonition">
<p class="first admonition-title">Изменения в Blinker API</p>
<p class="last">Метод <a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Signal.connected_to" title="(в Blinker v1.4)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connected_to()</span></code></a> появился в Blinker,
начиная с версии 1.1.</p>
</div>
</div>
<div class="section" id="id3">
<h4>Создание сигналов<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если вы хотите использовать сигналы в ваших собственных приложениях, вы можете
напрямую использовать библиотеку blinker.  Самый общий случай - это
именованные сигналы в пользовательском <a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Namespace" title="(в Blinker v1.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Namespace</span></code></a>..
Это то, что можно порекомендовать чаще всего:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">blinker</span> <span class="k">import</span> <span class="n">Namespace</span>
<span class="n">my_signals</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">()</span>
</pre></div>
</div>
<p>Теперь вы можете создать такой вот сигнал:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_saved</span> <span class="o">=</span> <span class="n">my_signals</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="s1">&#39;model-saved&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Имя сигнала здесь делает его уникальным, а также упрощает отладку.  Вы можете
получить доступ к имени сигнала через атрибут
<a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.NamedSignal.name" title="(в Blinker v1.4)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">name</span></code></a>.</p>
<div class="admonition- admonition">
<p class="first admonition-title">Для продвинутых разработчиков</p>
<p class="last">Если вы пишете расширения для Flask и хотите изящно обойти ситуацию
отсутствия blinker, вы можете сделать это с использованием класса
<a class="reference internal" href="index.html#flask.signals.Namespace" title="flask.signals.Namespace"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.signals.Namespace</span></code></a>.</p>
</div>
</div>
<div class="section" id="signals-sending">
<span id="id4"></span><h4>Отправка сигналов<a class="headerlink" href="#signals-sending" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если вы хотите послать сигнал, вы можете это сделать, вызвав метод
<a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Signal.send" title="(в Blinker v1.4)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send()</span></code></a>.  Он принимает отправителя в качестве
первого аргумента и опционально - некоторые именованные аргументы, которые
будут перенаправлены подписчикам сигнала:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">model_saved</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Всегда пытайтесь выбирать верного отправителя.  Если у вас есть класс,
который посылает сигнал, в качестве отправителя передайте <cite>self</cite>.
Если вы посылаете сигнал из случайной функции, в качестве отправителя
можно указать <code class="docutils literal notranslate"><span class="pre">current_app._get_current_object()</span></code>.</p>
<div class="admonition-proxies admonition">
<p class="first admonition-title">Передача в качестве отправителей посредников (Proxies)</p>
<p class="last">Никогда не передавайте сигналу в качестве отправителя
<a class="reference internal" href="index.html#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a>. Вместо этого используйте
<code class="docutils literal notranslate"><span class="pre">current_app._get_current_object()</span></code>.  Это объясняется тем, что
<a class="reference internal" href="index.html#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> - это посредник, а не объект реального
приложения.</p>
</div>
</div>
<div class="section" id="flask">
<h4>Сигналы и контекст запроса Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h4>
<p>Сигналы (при их получении) полностью поддерживают <a class="reference internal" href="index.html#request-context"><span class="std std-ref">Контекст запроса Flask</span></a>.
Контекстно-локальные переменные постоянно доступны между
<a class="reference internal" href="index.html#flask.request_started" title="flask.request_started"><code class="xref py py-data docutils literal notranslate"><span class="pre">request_started</span></code></a> и <a class="reference internal" href="index.html#flask.request_finished" title="flask.request_finished"><code class="xref py py-data docutils literal notranslate"><span class="pre">request_finished</span></code></a>, так
что вы можете при необходимости рассчитывать на <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.g</span></code></a> или
другие.  Заметим, что есть ограничения, описанные в <a class="reference internal" href="#signals-sending"><span class="std std-ref">Отправка сигналов</span></a>
и описании сигнала <a class="reference internal" href="index.html#flask.request_tearing_down" title="flask.request_tearing_down"><code class="xref py py-data docutils literal notranslate"><span class="pre">request_tearing_down</span></code></a>.</p>
</div>
<div class="section" id="id5">
<h4>Подписки на сигналы с использованием декоратора<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<p>С Blinker 1.1 вы также можете легко подписаться на сигналы с помощью нового
декоратора <code class="xref py py-meth docutils literal notranslate"><span class="pre">connect_via()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">template_rendered</span>

<span class="nd">@template_rendered</span><span class="o">.</span><span class="n">connect_via</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">when_template_rendered</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s1">&#39;Template </span><span class="si">%s</span><span class="s1"> is rendered with </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>Сигналы ядра<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Flask присутствуют следующие сигналы:</p>
<dl class="data">
<dt>
<code class="descclassname">flask.</code><code class="descname">template_rendered</code></dt>
<dd><p>Этот сигнал посылается при успешном отображении шаблона.  Этот сигнал
вызывается с экземпляром шаблона (<cite>template</cite>) и контекста (словарь
с именем <cite>context</cite>).</p>
<p>Пример подписчика:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_template_renders</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Rendering template &quot;</span><span class="si">%s</span><span class="s1">&quot; with context </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">template</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;string template&#39;</span><span class="p">,</span>
                        <span class="n">context</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">template_rendered</span>
<span class="n">template_rendered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">log_template_renders</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt>
<code class="descclassname">flask.</code><code class="descname">request_started</code></dt>
<dd><p>Сигнал посылается перед запуском обработки любого запроса, но после того,
как контекст запроса уже установлен.  Поскольку контекст запроса уже
привязан, подписчик может получить доступ к запросу через стандартные
глобальные прокси-посредники, такие как <a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>.</p>
<p>Пример подписчика:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_request</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Request context is set up&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request_started</span>
<span class="n">request_started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">log_request</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt>
<code class="descclassname">flask.</code><code class="descname">request_finished</code></dt>
<dd><p>Этот сигнал посылается прямо перед отправкой ответа клиенту.  Он передаётся
для отправки ответу с именем <cite>response</cite>.</p>
<p>Пример подписчика:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_response</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Request context is about to close down.  &#39;</span>
                        <span class="s1">&#39;Response: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request_finished</span>
<span class="n">request_finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">log_response</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt>
<code class="descclassname">flask.</code><code class="descname">got_request_exception</code></dt>
<dd><p>Этот сигнал посылается при возникновении исключения во время обработки
запроса.  Он посылается <em>до того</em>, как умрёт стандартная обработка
исключения, и даже в режиме отладки, когда обработки исключений не
происходит.  Само по себе исключение передаётся подписчику как
<cite>exception</cite>.</p>
<p>Пример подписчика:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_exception</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">sender</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Got exception during processing: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">exception</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">got_request_exception</span>
<span class="n">got_request_exception</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">log_exception</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt>
<code class="descclassname">flask.</code><code class="descname">request_tearing_down</code></dt>
<dd><p>Этот сигнал посылается при демонтаже запроса.  Он вызывается всегда,
даже при появлении исключения.  В настоящий момент функции, слушающие
этот сигнал, вызываются после обычных обработчиков демонтажа, но на
это не стоит особенно полагаться.</p>
<p>Пример подписчика:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">close_db_connection</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request_tearing_down</span>
<span class="n">request_tearing_down</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">close_db_connection</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>В Flask 0.9 здесь также будет передан аргумент с именем <cite>exc</cite>, который
ссылается на исключение, которое вызвало демонтаж, если таковое было.</p>
</dd></dl>

<dl class="data">
<dt>
<code class="descclassname">flask.</code><code class="descname">appcontext_tearing_down</code></dt>
<dd><p>Этот сигнал посылается при демонтаже контекста приложения.  Он вызывается
всегда, даже при появлении исключения.  В настоящий момент функции,
слушающие этот сигнал, вызываются после обычных обработчиков демонтажа,
но на это не стоит особенно полагаться.</p>
<p>Пример подписчика:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">close_db_connection</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">appcontext_tearing_down</span>
<span class="n">appcontext_tearing_down</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">close_db_connection</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>Здесь также будет передан аргумент с именем <cite>exc</cite>, который
ссылается на исключение, которое вызвало демонтаж, если таковое было.</p>
</dd></dl>

<dl class="data">
<dt>
<code class="descclassname">flask.</code><code class="descname">appcontext_pushed</code></dt>
<dd><p>Этот сигнал посылается, при запуске контекста приложения.  Отправитель -
приложение.  Обычно он может быть полезен для юнит-тестов, когда нужно
временно выцепить информацию.  Например, он может быть использован, чтобы
на ранней стадии установить значение ресурса для объекта <cite>g</cite>.</p>
<p>Пример использования:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">appcontext_pushed</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">user_set</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="k">with</span> <span class="n">appcontext_pushed</span><span class="o">.</span><span class="n">connected_to</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="k">yield</span>
</pre></div>
</div>
<p>И в коде тестирования:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_user_me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">user_set</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s1">&#39;john&#39;</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/users/me&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;username=john&#39;</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
</dd></dl>

<dl class="data">
<dt>
<code class="descclassname">flask.</code><code class="descname">appcontext_popped</code></dt>
<dd><p>Этот сигнал посылается при сбросе контекста приложения.  Отправитель -
приложение.  Обычно это происходит вместе с появлением сигнала
<a class="reference internal" href="index.html#flask.appcontext_tearing_down" title="flask.appcontext_tearing_down"><code class="xref py py-data docutils literal notranslate"><span class="pre">appcontext_tearing_down</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
</dd></dl>

<dl class="data">
<dt>
<code class="descclassname">flask.</code><code class="descname">message_flashed</code></dt>
<dd><p>Этот сигнал посылается, когда приложение генерирует сообщение.  Сообщение
посылается, как аргумент с именем <cite>message</cite> и категорией <cite>category</cite>.</p>
<p>Пример подписчика:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recorded</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="o">**</span><span class="n">extra</span><span class="p">):</span>
    <span class="n">recorded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">message</span><span class="p">,</span> <span class="n">category</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">message_flashed</span>
<span class="n">message_flashed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
</dd></dl>

<p><a class="reference external" href="http://flask.pocoo.org/docs/signals/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-views"></span><div class="section" id="pluggable-views">
<span id="views"></span><h3>Сменные представления (Pluggable Views)<a class="headerlink" href="#pluggable-views" title="Ссылка на этот заголовок">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
<p>В Flask 0.7 появились сменные представления, идея которых взята из обычных
представлений (generic views) Django, основанных не на функциях, а на классах.
Их основное назначение - чтобы вы путём замены части реализации могли бы
получить настраиваемые сменные представления.</p>
<div class="section" id="id1">
<h4>Основной принцип<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>К примеру, у вас есть функция, загружающая список объектов из базы данных
и отображающая их в шаблон:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_users</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;users.html&#39;</span><span class="p">,</span> <span class="n">users</span><span class="o">=</span><span class="n">users</span><span class="p">)</span>
</pre></div>
</div>
<p>Это и гибко, и просто, однако если вы хотите обеспечить это представление
в общем виде, которое может быть адаптировано также и к другим моделям и
шаблонам, вам может потребоваться дополнительная гибкость.  Этот тот случай,
когда хорошо подходят сменные представления на базе классов.  Первым делом для
преобразования к представлению на основе классов, выполним следующее:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask.views</span> <span class="k">import</span> <span class="n">View</span>

<span class="k">class</span> <span class="nc">ShowUsers</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;users.html&#39;</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="n">users</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">ShowUsers</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;show_users&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Как видите, вам необходимо создать подкласс класса <a class="reference internal" href="index.html#flask.views.View" title="flask.views.View"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.views.View</span></code></a>
и реализовать <a class="reference internal" href="index.html#flask.views.View.dispatch_request" title="flask.views.View.dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch_request()</span></code></a>.  Далее нам надо
преобразовать этот класс в функцию актуального представления с использованием
метода класса <a class="reference internal" href="index.html#flask.views.View.as_view" title="flask.views.View.as_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_view()</span></code></a>.  Строка, которую вы передаёте
в эту функцию - это имя конечной точки, к которой придёт представление.  Однако
само по себе это бесполезно, так что давайте немного переработаем код:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask.views</span> <span class="k">import</span> <span class="n">View</span>

<span class="k">class</span> <span class="nc">ListView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_template_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">render_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_name</span><span class="p">(),</span> <span class="o">**</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;objects&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_objects</span><span class="p">()}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">UserView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_template_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;users.html&#39;</span>

    <span class="k">def</span> <span class="nf">get_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p>Конечно, это не так полезно для такого вот небольшого примера, однако этого
достаточно, чтобы раскрыть простейшие принципы.  Когда у вас есть основанное
на классе представление, встаёт вопрос, на что указывает <cite>self</cite>.  Это работает
следующим образом.  Всякий раз при диспетчеризации запроса, создаётся новый
экземпляр класс и вызывается метод <a class="reference internal" href="index.html#flask.views.View.dispatch_request" title="flask.views.View.dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch_request()</span></code></a>
с параметрами из URL-правила.  Сам класс создаётся с параметрами, переданными
функции <a class="reference internal" href="index.html#flask.views.View.as_view" title="flask.views.View.as_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_view()</span></code></a>.  Например, вы можете создать
класс, похожий на вот этот:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RenderTemplateView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template_name</span> <span class="o">=</span> <span class="n">template_name</span>
    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь вы можете зарегестрировать его подобным образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/about&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">RenderTemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span>
    <span class="s1">&#39;about_page&#39;</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="s1">&#39;about.html&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Подсказки метода<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Сменные представления присоединяются к приложению подобно обычной функции
с помощью использования <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-func docutils literal notranslate"><span class="pre">route()</span></code></a> или лучше
<a class="reference internal" href="index.html#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a>.  Однако это будет также означать, что
при их присоединении вам придётся предоставить имена HTTP-методов,
поддерживаемых представлением.  Чтобы переместить эту информацию в класс,
вам надо предоставить атрибут <a class="reference internal" href="index.html#flask.views.View.methods" title="flask.views.View.methods"><code class="xref py py-attr docutils literal notranslate"><span class="pre">methods</span></code></a>, который
содержит следующую информацию:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
            <span class="o">...</span>
        <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/myview&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">MyView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;myview&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>Диспетчеризация на базе метода<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для различных RESTful API, особенно полезно выполнять различные функции
для каждого из методов HTTP.  Вы можете легко это осуществить с помощью
<a class="reference internal" href="index.html#flask.views.MethodView" title="flask.views.MethodView"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.views.MethodView</span></code></a>.  Каждый HTTP-метод сопоставляется с
функцией, носящей такое же имя (но в нижнем регистре):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask.views</span> <span class="k">import</span> <span class="n">MethodView</span>

<span class="k">class</span> <span class="nc">UserAPI</span><span class="p">(</span><span class="n">MethodView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">from_form_data</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
        <span class="o">...</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">UserAPI</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>При этом вам нет нужды предоставлять атрибут <a class="reference internal" href="index.html#flask.views.View.methods" title="flask.views.View.methods"><code class="xref py py-attr docutils literal notranslate"><span class="pre">methods</span></code></a>.
Он будет автоматически установлен исходя из определённых в классе методов.</p>
</div>
<div class="section" id="id4">
<h4>Декорирующие представления<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Так как сам по себе класс предcтавления не является функцией представления,
которая добавляется в подсистему маршрутизации, не имеет особого смысла
декорировать сам класс.  Вместо этого вы должны вручную декорировать
возвращаемое <a class="reference internal" href="index.html#flask.views.View.as_view" title="flask.views.View.as_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_view()</span></code></a> значение:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">user_required</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks whether user is logged in or raises error 401.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorator</span>

<span class="n">view</span> <span class="o">=</span> <span class="n">user_required</span><span class="p">(</span><span class="n">UserAPI</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">))</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">)</span>
</pre></div>
</div>
<p>Начиная с Flask 0.8 есть альтернативный способ, при котором вы можете
указать список декораторов, которые необходимо применить при декорировании
класса:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserAPI</span><span class="p">(</span><span class="n">MethodView</span><span class="p">):</span>
    <span class="n">decorators</span> <span class="o">=</span> <span class="p">[</span><span class="n">user_required</span><span class="p">]</span>
</pre></div>
</div>
<p>В связи с неявным self с точки зрения вызывающего объекта, вы не можете
использовать для индивидуальных методов обычные декораторы представления,
однако, имейте это ввиду.</p>
</div>
<div class="section" id="api">
<h4>Представления метода для различных API<a class="headerlink" href="#api" title="Ссылка на этот заголовок">¶</a></h4>
<p>Веб-API часто работают очень близко с методами HTTP, так что есть большой
смысл реализовывать такие API на базе <a class="reference internal" href="index.html#flask.views.MethodView" title="flask.views.MethodView"><code class="xref py py-class docutils literal notranslate"><span class="pre">MethodView</span></code></a>.
Тем не менее вы заметите, что API требуют различные URL-правила, которые
чаще всего передавались тому же методу представления.  Рассмотрим для
примера, что вы делаете доступным через web объект пользователя (user):</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="22%" />
<col width="56%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>URL</td>
<td>Method</td>
<td>Description</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/users/</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">GET</span></code></td>
<td>Вывести список всех пользователей</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">/users/</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">POST</span></code></td>
<td>Создать нового пользователя</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/users/&lt;id&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">GET</span></code></td>
<td>Показать одного пользователя</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">/users/&lt;id&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">PUT</span></code></td>
<td>Обновить одного пользователя</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/users/&lt;id&gt;</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">DELETE</span></code></td>
<td>Удалить одного пользователя</td>
</tr>
</tbody>
</table>
<p>Итак, как вам это сделать с помощью <a class="reference internal" href="index.html#flask.views.MethodView" title="flask.views.MethodView"><code class="xref py py-class docutils literal notranslate"><span class="pre">MethodView</span></code></a>?
Хитрость в том, что можно воспользоваться предоставлением нескольких правил
для одного и того же представления.</p>
<p>Предположим, что на данный момент представление будет выглядеть следующим
образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserAPI</span><span class="p">(</span><span class="n">MethodView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># возвратить список пользователей</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># показать одного пользователя</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># создать нового пользователя</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="c1"># удалить одного пользователя</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="c1"># обновить одного пользователя</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>Итак, как же нам подцепить это к подсистеме маршрутизации?  Путём добавления
двух правил и оговаривая для каждого из них методы:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user_view</span> <span class="o">=</span> <span class="n">UserAPI</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;user_api&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
                 <span class="n">view_func</span><span class="o">=</span><span class="n">user_view</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,])</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">user_view</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,])</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/users/&lt;int:user_id&gt;&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">user_view</span><span class="p">,</span>
                 <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Если у вас много похожих API, вы можете реорганизовать такой вот код
регистрации:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">register_api</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">pk_type</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">):</span>
    <span class="n">view_func</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="n">pk</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
                     <span class="n">view_func</span><span class="o">=</span><span class="n">view_func</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,])</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view_func</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,])</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">pk_type</span><span class="p">,</span> <span class="n">pk</span><span class="p">),</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view_func</span><span class="p">,</span>
                     <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>

<span class="n">register_api</span><span class="p">(</span><span class="n">UserAPI</span><span class="p">,</span> <span class="s1">&#39;user_api&#39;</span><span class="p">,</span> <span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="http://flask.pocoo.org/docs/views/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-appcontext"></span><div class="section" id="flask">
<span id="app-context"></span><h3>Контекст приложения Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
<p>Одно из проектных решений Flask заключается в том, что есть два разных
“состояния”, в которых выполняется код.  Состояние настройки приложения,
которое подразумевается на уровне модуля.  Оно наступает в момент, когда
создаётся экземпляр объекта <code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code>, и заканчивается, когда поступает
первый запрос. Пока приложение находится в этом состоянии, верно следующее:</p>
<ul class="simple">
<li>программист может безопасно менять объект приложения.</li>
<li>запросы ещё не обрабатывались.</li>
<li>у вас имеется ссылка на объект приложения, чтобы изменить его, нет
необходимости пользоваться каким-либо посредником для того, чтобы
получить ссылку на созданный или изменяемый объект приложения.</li>
</ul>
<p>Напротив, во время обработки запроса верны следующие правила:</p>
<ul class="simple">
<li>пока активен запрос, объекты локального контекста (<a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.request</span></code></a>
и другие) указывают на текущий запрос.</li>
<li>любой код может в любое время может заполучить эти объекты.</li>
</ul>
<p>Есть и третье состояние, которое располагается между ними.  Иногда можно
работать с приложением так же, как и во время обработки запроса, просто
в этот момент нет активного запроса.  Например, вы можете работать с
интерактивной оболочкой Python и взаимодействовать с приложением или
запустить приложение из командной строки.</p>
<p>Контекст приложения - это то, чем управляет локальный контекст
<a class="reference internal" href="index.html#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a>.</p>
<div class="section" id="id1">
<h4>Назначение контекста приложения<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Основная причина существования контекста приложений состоит в том, что в
прошлом большая доля функциональности была привязана к контексту запроса за
неимением лучшего решения.  Тогда одной из целей, учитываемых при
проектировании Flask, было обеспечение возможности иметь несколько
приложений в рамках одного процесса Python.</p>
<p>Каким образом код находит “правильное” приложение?  В прошлом мы
рекомендовали явную передачу приложений, но появились проблемы с
библиотеками, которые не были спроектированы с учётом этого.</p>
<p>Обходной путь решения этой проблемы заключался в том, чтобы использовать
посредника <a class="reference internal" href="index.html#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a>, привязанного ссылкой к текущему
запросу приложения.  Но поскольку создание такого контекста запроса
является не оправданно дорогостоящим в случае отсутствия запроса, был
введён контекст приложения.</p>
</div>
<div class="section" id="id2">
<h4>Создание контекста приложения<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для создания контекста приложения есть два способа.  Первый из них -
неявный: когда поступает контекст запроса, при необходимости также
создаётся и контекст приложения.  В результате вы можете игнорировать
существование контекста приложения до тех пор, пока он вам не понадобится.</p>
<p>Второй способ - это явное создание контекста при помощи метода
<a class="reference internal" href="index.html#flask.Flask.app_context" title="flask.Flask.app_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app_context()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">current_app</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
    <span class="c1"># within this block, current_app points to app.</span>
    <span class="nb">print</span> <span class="n">current_app</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>Контекст приложения также используется функцией <a class="reference internal" href="index.html#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a>
в случае, если было настроено значение параметра конфигурации
<code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code>.  Это позволяет вам генерировать URL’ы даже при отсутствии
запроса.</p>
</div>
<div class="section" id="id3">
<h4>Локальность контекста<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Контекст приложения создаётся и уничтожается при необходимости.  Он никогда
не перемещается между потоками и не является общим для разных запросов.
Поэтому - это идеальное место для хранения информации о подключении к базе
данных и т.п.  Внутренний объект стека называется
<a class="reference internal" href="index.html#flask._app_ctx_stack" title="flask._app_ctx_stack"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask._app_ctx_stack</span></code></a>.  Расширения могут хранить дополнительную
информацию на самом верхнем уровне, если предполагается, что они выбрали
достаточно уникальное имя и если они помещают свою информацию сюда, а не
в объект <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.g</span></code></a>, который зарезервирован для пользовательского кода.</p>
<p>За дополнительной информацией по теме обратитесь к разделу
<span class="xref std std-ref">extension-dev</span>.</p>
</div>
<div class="section" id="id4">
<h4>Использование контекста<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Обычно контекст используют для кэширования в нём ресурсов, которые
необходимо создавать в случае отдельных запросов или для постоянного
использования.  Например, соединения к базе данных предназначены для
хранения именно там. Для сохранения чего-либо в контексте приложения
необходимо выбирать уникальные имена, так как это то место, которое
является общим для приложений и расширений Flask.</p>
<p>Наиболее распространённым использованием является разделение
управления ресурсами на две части:</p>
<ol class="arabic simple">
<li>неявное кэширование ресурсов в контексте.</li>
<li>освобождение ресурса, основанное на демонтировании контекста.</li>
</ol>
<p>В обычном случае, должна присутствовать функция <code class="docutils literal notranslate"><span class="pre">get_X()</span></code>, которая
создаёт ресурс  <code class="docutils literal notranslate"><span class="pre">X</span></code>, если он ещё не существует, и, если это не так,
возвращает тот же самый ресурс, а также функция <code class="docutils literal notranslate"><span class="pre">teardown_X()</span></code>,
которая регистрирует обработчик демонтирования.</p>
<p>Вот пример соединения с базой данных:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">g</span>

<span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;_database&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">_database</span> <span class="o">=</span> <span class="n">connect_to_database</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">db</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span> <span class="nf">teardown_db</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;_database&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Соединение будет установлено, когда <code class="docutils literal notranslate"><span class="pre">get_db()</span></code> вызывается в первый раз.
Для того, чтобы сделать это неявно, можно использовать класс
<a class="reference external" href="http://werkzeug.pocoo.org/docs/local/#werkzeug.local.LocalProxy" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocalProxy</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.local</span> <span class="k">import</span> <span class="n">LocalProxy</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">LocalProxy</span><span class="p">(</span><span class="n">get_db</span><span class="p">)</span>
</pre></div>
</div>
<p>С использованием этого способа пользователь может иметь прямой доступ к
<code class="docutils literal notranslate"><span class="pre">db</span></code>, которая сама внутри себя вызовет <code class="docutils literal notranslate"><span class="pre">get_db()</span></code>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/appcontext/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-reqcontext"></span><div class="section" id="flask">
<span id="request-context"></span><h3>Контекст запроса Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h3>
<p>Этот документ описывает поведение Flask 0.7, которое в основном совпадает
со старым, но имеет некоторые небольшие отличия.</p>
<p>Рекомендуем сначала прочитать главу <a class="reference internal" href="index.html#app-context"><span class="std std-ref">Контекст приложения Flask</span></a>.</p>
<div class="section" id="id1">
<h4>Подробнее о локальных объектах контекста<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Представим, что имеется служебная функция, которая возвращает URL, на
который нужно перенаправить пользователя.  Представим, что всегда нужно
перенаправлять на URL из параметра <code class="docutils literal notranslate"><span class="pre">next</span></code> или на страницу, с которой
перешли на текущую страницу, или на страницу-индекс:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span>

<span class="k">def</span> <span class="nf">redirect_url</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="n">request</span><span class="o">.</span><span class="n">referrer</span> <span class="ow">or</span> \
           <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Можно заметить, что функция обращается к объекту запроса. Если попытаться
запустить её из оболочки Python, будет выброшено исключение:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">redirect_url</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">AttributeError</span>: <span class="n">&#39;NoneType&#39; object has no attribute &#39;request&#39;</span>
</pre></div>
</div>
<p>В этом есть определённый смысл, потому что в данный момент нет запроса, к
которому мы пытаемся получить доступ.  Итак, нам нужно создать запрос и
связать его с текущим контекстом.  Создадим
<a class="reference internal" href="index.html#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> с помощью метода
<a class="reference internal" href="index.html#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-attr docutils literal notranslate"><span class="pre">test_request_context</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">(</span><span class="s1">&#39;/?next=http://example.com/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Этот контекст можно использовать одним из двух способов - используя
выражение <cite>with</cite> или вызвав методы <a class="reference internal" href="index.html#flask.ctx.RequestContext.push" title="flask.ctx.RequestContext.push"><code class="xref py py-meth docutils literal notranslate"><span class="pre">push()</span></code></a>
и <a class="reference internal" href="index.html#flask.ctx.RequestContext.pop" title="flask.ctx.RequestContext.pop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
</pre></div>
</div>
<p>После чего можно работать с объектом запроса:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">redirect_url</span><span class="p">()</span>
<span class="go">u&#39;http://example.com/&#39;</span>
</pre></div>
</div>
<p>И так до тех пор, пока вы не вызовете <cite>pop</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
<p>Поскольку контекст запроса изнутри представляет собой элемент стека, можно
добавлять и вынимать его из стека множество раз.  Это очень полезно для
реализации таких функций, как внутреннее перенаправление.</p>
<p>За более подробной информацией об использовании контекста запроса из
интерактивной оболочки Python, обратитесь к главе <a class="reference internal" href="index.html#shell"><span class="std std-ref">Работа с командной оболочкой</span></a>.</p>
</div>
<div class="section" id="id2">
<h4>Как работает контекст<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если посмотреть изнутри на то, как работает приложение Flask WSGI, можно
обнаружить фрагмент кода, который выглядит очень похожим на следующий:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">wsgi_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">):</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">environ</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dispatch_request</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_exception</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</pre></div>
</div>
<p>Метод <code class="xref py py-meth docutils literal notranslate"><span class="pre">request_context()</span></code> возвращает новый объект
<a class="reference internal" href="index.html#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> и использует его в выражении <cite>with</cite> для
связывания контекста.  Всё, что будет вызвано из этого потока, начиная с
этой точки и до конца выражения <cite>with</cite>, будет иметь доступ к глобальному
объекту запроса (<a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.request</span></code></a> и т.п.).</p>
<p>Контекст запроса изнутри работает как стек: на самом верху стека находится
текущий активный запрос.  <a class="reference internal" href="index.html#flask.ctx.RequestContext.push" title="flask.ctx.RequestContext.push"><code class="xref py py-meth docutils literal notranslate"><span class="pre">push()</span></code></a> добавляет
контекст на верхушку стека, а <a class="reference internal" href="index.html#flask.ctx.RequestContext.pop" title="flask.ctx.RequestContext.pop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code></a>
вынимает его из стека.  При изъятии также вызываются функции
<a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-func docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> приложения.</p>
<p>Стоит также отметить, что при добавлении контекста запроса в стек также
создаётся контекст приложения, если его ещё не было.
(Not completed: Another thing of note is that the request context will
automatically also create an <a class="reference internal" href="index.html#app-context"><span class="std std-ref">application context</span></a> when
it’s pushed and there is no application context for that application so
far.)</p>
</div>
<div class="section" id="callbacks-and-errors">
<span id="id3"></span><h4>Функции обратного вызова и ошибки<a class="headerlink" href="#callbacks-and-errors" title="Ссылка на этот заголовок">¶</a></h4>
<p>Что случится, если произойдёт ошибка во время обработки запроса во Flask?
Частично это поведение изменилось в версии 0.7, потому что желательно знать,
что на самом деле произошло.  Новое поведение очень простое:</p>
<ol class="arabic simple">
<li>Перед каждым запросом выполняются функции
<a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a>.  Если одна из этих функций вернула
ответ, другие функции не выполняются.  Однако, в любом случае, это
значение трактуется как значение, возвращённое представлением.</li>
<li>Если функции <a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> не вернули ответ,
обработка запроса прекращается и он передаётся в подходящую функцию
представления, которая может вернуть ответ.</li>
<li>Значение, возвращённое из функции представления, преобразуется в
настоящий объект ответа и обрабатывается функциями
<a class="reference internal" href="index.html#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a>, которые могут заменить его целиком
или отредактировать.</li>
<li>В конце запроса выполняются функции
<a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a>.  Это происходит независимо от
того, было ли выброшено необработанное исключение, были ли вызваны
функции <a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a>, или произошло всё сразу
(например, в тестовом окружении обработка функций обратного вызова
<a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> иногда может быть отключена).</li>
</ol>
<p>Итак, что же происходит в случае ошибки?  В рабочем режиме неотловленные
исключения приводят к тому, что обработчик выводит сообщение об ошибке 500
на сервере.  В режиме разработки, однако, приложение не обрабатывает
исключение и передаёт его наверх, серверу WSGI.  Таким образом, средства
интерактивной отладки могут предоставить информацию для отладки.</p>
<p>Важное изменение в версии 0.7 заключается в том, что внутреннее сообщение
сервера об ошибке теперь больше не подвергается пост-обработке с помощью
функций обратного вызова <a class="reference internal" href="index.html#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a> и больше нет
гарантии того, что они будут выполнены. Таким образом,  внутренняя
обработка кода выглядит понятнее и удобнее в настройке.</p>
<p>Предполагается, что вместо них должны использоваться новые функции
<a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a>, специально предназначенные для
действий, которые нужно выполнять по окончании запроса при любом его
исходе.</p>
</div>
<div class="section" id="teardown-request">
<h4>Функции обратного вызова teardown_request<a class="headerlink" href="#teardown-request" title="Ссылка на этот заголовок">¶</a></h4>
<p>Функции обратного вызова <a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> - это
особые функции обратного вызова, которые выполняются отдельно. Строго
говоря, они не зависят от действительной обработки запроса и связаны с
жизненным циклом объекта <a class="reference internal" href="index.html#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a>.  Когда
контекст запроса вынимается из стека, вызываются функции
<a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a>.</p>
<p>Это важно знать, если жизнь контекста запроса будет удлинена при
использовании клиента для тестировании с помощью выражения <cite>with</cite> или при
использовании контекста запроса из командной строки:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/foo&#39;</span><span class="p">)</span>
    <span class="c1"># the teardown functions are still not called at that point</span>
    <span class="c1"># even though the response ended and you have the response</span>
    <span class="c1"># object in your hand</span>

<span class="c1"># only when the code reaches this point the teardown functions</span>
<span class="c1"># are called.  Alternatively the same thing happens if another</span>
<span class="c1"># request was triggered from the test client</span>
</pre></div>
</div>
<p>В этом можно убедиться, воспользовавшись командной строкой:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@app</span><span class="o">.</span><span class="n">teardown_request</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">teardown_request</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span> <span class="s1">&#39;this runs after request&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="go">this runs after request</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Учтите, что функции обратного вызова выполняются всегда, независимо от
того, были ли выполнены функции обратного вызова
<a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> и произошло ли исключение.  Некоторые
части системы тестирования могут также создавать временный контекст без
вызова обработчиков <a class="reference internal" href="index.html#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a>.  Убедитесь, что
ваши обработчики <a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> в таких случаях
никогда не приводят к ошибкам.</p>
</div>
<div class="section" id="notes-on-proxies">
<span id="id4"></span><h4>Замечания о посредниках<a class="headerlink" href="#notes-on-proxies" title="Ссылка на этот заголовок">¶</a></h4>
<p>Некоторые из объектов, предоставляемых Flask, являются посредниками к
другим объектам.  Причина в том, что эти посредники являются общими для
потоков и они скрыто передают объект для обработки соответствующему потоку.</p>
<p>В большинстве случаев об этом не стоит беспокоиться, но существует
несколько исключительных случаев, когда хорошо знать, что объект на самом
деле является посредником:</p>
<ul class="simple">
<li>Объекты-посредники не подделывают наследуемые типы, поэтому если
понадобится провести проверки над реальным экземпляром объекта, это
можно сделать это над экземпляром, который доступен через посредника
(см. ниже <cite>_get_current_object</cite>).</li>
<li>Если ссылка на объект имеет значение (например, для отправки
<a class="reference internal" href="index.html#signals"><span class="std std-ref">Сигналы</span></a>).</li>
</ul>
<p>Если нужно получить доступ к объекту, доступному через посредника, можно
воспользоваться методом
<a class="reference external" href="http://werkzeug.pocoo.org/docs/local/#werkzeug.local.LocalProxy._get_current_object" title="(в Werkzeug v0.14-dev)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_get_current_object()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">_get_current_object</span><span class="p">()</span>
<span class="n">my_signal</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>Защита контекста при ошибках<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<p>Случилась ли ошибка или нет, в конце обработки запроса контекст запроса
извлекается из стека и все связанные с ним данные удаляются.  Однако, во
время разработки это может стать проблемой, потому что может потребоваться
извлечь информацию из запроса, если произошло исключение.  Во Flask 0.6 и
более ранних версиях в режиме отладки, если произошло исключение, контекст
запроса не извлекается, так что средство интерактивной отладки всё ещё
может предоставить вам необходимую информацию.</p>
<p>Начиная со Flask 0.7 имеется возможность управлять этим поведением при
помощи настройки параметра конфигурации <code class="docutils literal notranslate"><span class="pre">PRESERVE_CONTEXT_ON_EXCEPTION</span></code>.
По умолчанию он связан с настройкой <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>.  Если приложение находится в
отладочном режиме, то контекст защищается, а если в рабочем, то - нет.</p>
<p>Не следует принудительно включать <code class="docutils literal notranslate"><span class="pre">PRESERVE_CONTEXT_ON_EXCEPTION</span></code> в
рабочем режиме, потому что это может привести к утечке памяти приложения
при каждом исключении.  Однако, эта настройка может оказаться полезной в
режиме разработки, чтобы воспроизвести ошибку, которая происходит только
с настройками рабочего режима.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/reqcontext/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-blueprints"></span><div class="section" id="flask-blueprint">
<span id="blueprints"></span><h3>Модульные приложения Flask с использованием blueprint’ов<a class="headerlink" href="#flask-blueprint" title="Ссылка на этот заголовок">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
<p>Flask использует концепцию <em>blueprint’ов</em> («blueprint» - «эскиз») для
создания компонентов приложений и поддержки общих шаблонов внутри
приложения или между приложениями.  Blueprint’ы могут как значительно
упростить большие приложения, так и предоставить общий механизм регистрации
в приложении операций из расширений Flask.  Объект <code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code>
работает аналогично объекту приложения <code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code>, но в
действительности он не является приложением.  Обычно это лишь <em>эскиз</em> для
сборки или расширения приложения.</p>
<div class="section" id="blueprint">
<h4>Для чего нужны blueprint’ы?<a class="headerlink" href="#blueprint" title="Ссылка на этот заголовок">¶</a></h4>
<p>Blueprint’ы во Flask могут пригодиться в случае, если нужно:</p>
<ul class="simple">
<li>Разделить приложения на набор blueprint’ов.  Они идеальны для больших
приложений; проект должен создать объект приложения, инициализировав
несколько расширений, и зарегистрировав набор blueprint’ов.</li>
<li>Зарегистрировать blueprint в приложении по определённом префиксу URL
и/или в поддомене.  Параметры в префиксе URL или поддомене становятся
обычными аргументами представлений (со значениями по умолчанию) для всех
функций представлений в blueprint’е.</li>
<li>Зарегистрировать blueprint несколько раз в приложении с разными правилами
URL.</li>
<li>Предоставить фильтры шаблонов, статический файлы, шаблоны и другие
вспомогательные средства с помощью blueprint’ов.  Blueprint не является
реализацией приложения или функций представлений.</li>
<li>Зарегистрировать blueprint в приложении в любом из этих случаев при
инициализации расширения Flask.</li>
</ul>
<p>Blueprint во Flask не является подключаемым приложением, потому что это на
самом деле не приложение – это набор операций, которые могут быть
зарегистрированы в приложении, возможно даже не один раз.  Почему бы не
воспользоваться несколькими объектами приложений?  Вы можете это сделать
(обратитесь к разделу <span class="xref std std-ref">app-dispatch</span>), но ваши приложения будут иметь
раздельные файлы конфигурации и будут управляться слоем WSGI.</p>
<p>Вместо этого, blueprint’ы предоставляют разделение на уровне Flask,
позволяя использовать общий файл конфигурации приложения и могут менять
объект приложения необходимым образом при регистрации.  Побочным эффектом
будет невозможность отменить регистрацию blueprint’а, если приложение уже
было создано, если только не уничтожить целиком весь объект приложения.</p>
</div>
<div class="section" id="id1">
<h4>Концепция blueprint’ов<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Основная концепция blueprint’ов заключается в том, что они записывают
операции для выполнения при регистрации в приложении.  Flask связывает
функции представлений с blueprint’ами при обработке запросов и
генерировании URL’ов от одной конечной точки к другой.</p>
</div>
<div class="section" id="id2">
<h4>Мой первый blueprint<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Приведём пример того, как выглядит основа простейшего blueprint’а.  В
данном случае мы хотим реализовать blueprint, который выполняет простую
отрисовку статических шаблонов:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">abort</span>
<span class="kn">from</span> <span class="nn">jinja2</span> <span class="k">import</span> <span class="n">TemplateNotFound</span>

<span class="n">simple_page</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;simple_page&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span>
                        <span class="n">template_folder</span><span class="o">=</span><span class="s1">&#39;templates&#39;</span><span class="p">)</span>

<span class="nd">@simple_page</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="s1">&#39;index&#39;</span><span class="p">})</span>
<span class="nd">@simple_page</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;page&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;pages/</span><span class="si">%s</span><span class="s1">.html&#39;</span> <span class="o">%</span> <span class="n">page</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">TemplateNotFound</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</pre></div>
</div>
<p>При связывании функции при помощи декоратора <code class="docutils literal notranslate"><span class="pre">&#64;simple_page.route</span></code>,
blueprint записывает намерение зарегистрировать в приложении функцию
<cite>show</cite>, когда blueprint будет зарегистрирован.  Кроме того, декоратор
предварит название конечной точки префиксом - именем blueprint’а,
который был указан конструктору <code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code> (в данном случае это
тоже <code class="docutils literal notranslate"><span class="pre">simple_page</span></code>).</p>
</div>
<div class="section" id="id3">
<h4>Регистрация blueprint’ов<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Как теперь зарегистрировать этот blueprint? Например, так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">yourapplication.simple_page</span> <span class="k">import</span> <span class="n">simple_page</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">simple_page</span><span class="p">)</span>
</pre></div>
</div>
<p>Если теперь посмотреть на правила, зарегистрированные в приложении, то
можно обнаружить следующее:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/static/&lt;filename&gt;&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">static</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/&lt;page&gt;&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">simple_page</span><span class="o">.</span><span class="n">show</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">simple_page</span><span class="o">.</span><span class="n">show</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>Первым обычно является правило для статических файлов самого приложения.
Следующие два правила - правила для функции <cite>show</cite> из blueprint’а
<code class="docutils literal notranslate"><span class="pre">simple_page</span></code>.  Как можно заметить, они тоже предварены именем
blueprint’а и отделены от него точкой (<code class="docutils literal notranslate"><span class="pre">.</span></code>).</p>
<p>Однако, blueprint’ы можно связывать с другими местами:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">simple_page</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s1">&#39;/pages&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>И, чтобы убедиться в этом, посмотрим на правила, сгенерированные на этот
раз:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/static/&lt;filename&gt;&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">static</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/pages/&lt;page&gt;&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">simple_page</span><span class="o">.</span><span class="n">show</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">Rule</span> <span class="s1">&#39;/pages/&#39;</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">,</span> <span class="n">OPTIONS</span><span class="p">,</span> <span class="n">GET</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">simple_page</span><span class="o">.</span><span class="n">show</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>Плюс ко всему, можно зарегистрировать blueprint’ы несколько раз, хотя не
каждый blueprint будет работать правильно.  Это зависит от того, был ли
реализован blueprint’е с учётом возможности многократного монтирования.</p>
</div>
<div class="section" id="id4">
<h4>Ресурсы blueprint’а<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Blueprint’ы могут, кроме всего прочего, предоставлять ресурсы.  Иногда
может потребоваться ввести дополнительный blueprint только ради
предоставления ресурсов.</p>
<div class="section" id="id5">
<h5>Каталог ресурсов blueprint’а<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Как и обычные приложения, blueprint’ы задуманы для размещения в отдельном
каталоге.  Хотя несколько blueprint’ов можно разместить в одном и том же
каталоге, так делать не рекомендуется.</p>
<p>Имя каталога берётся из второго аргумента <code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code>’а, которым
обычно является <cite>__name__</cite>.  Этот аргумент указывает, какой логический
модуль или пакет Python соответствует blueprint’у.  Если он указывает на
существующий пакет Python (который является каталогом файловой системы),
то он и будет каталогом ресурсов.  Если это модуль, то каталогом ресурсов
будет тот каталог, в котором содержится модуль.  Можно обратиться к
свойству <code class="xref py py-attr docutils literal notranslate"><span class="pre">Blueprint.root_path</span></code>, чтобы увидеть, что это за каталог:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">simple_page</span><span class="o">.</span><span class="n">root_path</span>
<span class="go">&#39;/Users/username/TestProject/yourapplication&#39;</span>
</pre></div>
</div>
<p>Для быстрого открытия ресурсов из этого каталога можно воспользоваться
функцией <code class="xref py py-meth docutils literal notranslate"><span class="pre">open_resource()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">simple_page</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;static/style.css&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>Статические файлы<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Blueprint может выставлять наружу каталог со статическими файлами, если в
его конструкторе указан каталог файловой системы с помощью аргумента с
ключевым словом <cite>static_folder</cite>.  Аргумент может быть абсолютным путём или
каталогом относительно каталога blueprint’а:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">admin</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>По умолчанию самая правая часть пути выставляется наружу в веб. Поскольку
в данном случае указан каталог с именем <code class="docutils literal notranslate"><span class="pre">static</span></code>, он будет располагаться
внутри каталога blueprint’а и будет называться <code class="docutils literal notranslate"><span class="pre">static</span></code>.  В данном случае
при регистрации blueprint’а в каталоге <code class="docutils literal notranslate"><span class="pre">/admin</span></code>, каталог <code class="docutils literal notranslate"><span class="pre">static</span></code> будет
находиться в <code class="docutils literal notranslate"><span class="pre">/admin/static</span></code>.</p>
<p>Конечная точка будет иметь имя <cite>blueprint_name.static</cite>, так что можно
генерировать URL’ы точно так же, как это делается для статического каталога
приложения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;admin.static&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;style.css&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h5>Шаблоны<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если нужно выставить наружу каталог с шаблонами, это можно сделать указав
параметр <cite>template_folder</cite> конструктору <code class="xref py py-class docutils literal notranslate"><span class="pre">Blueprint</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">admin</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="s1">&#39;templates&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Как и в случае статических файлов, путь может быть абсолютным или
располагаться в каталоге ресурсов blueprint’а.  Каталог шаблона добавляется
к пути поиска шаблонов, но с меньшим приоритетом, чем каталог шаблонов
самого приложения.  Таким образом, можно легко заменить шаблоны blueprint’а
в самом приложении.</p>
<p>Например, если есть blueprint в каталоге <code class="docutils literal notranslate"><span class="pre">yourapplication/admin</span></code> и нужно
отрисовать шаблон <code class="docutils literal notranslate"><span class="pre">'admin/index.html'</span></code>, а в параметре <cite>template_folder</cite>
указан каталог <cite>templates</cite>, тогда нужно создать файл
<code class="docutils literal notranslate"><span class="pre">yourapplication/admin/templates/admin/index.html</span></code>.</p>
</div>
</div>
<div class="section" id="url">
<h4>Генерирование URL’ов<a class="headerlink" href="#url" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если нужно вставить ссылку с одной страницы на другую, можно
воспользоваться функцией <code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code>, как обычно: нужно просто добавить
к конечной точке URL’а префикс с именем blueprint’а и точкой (<code class="docutils literal notranslate"><span class="pre">.</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;admin.index&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Наконец, если в функции представления blueprint’а или в отрисованном
шаблоне нужно добавить ссылку на другую конечную точку того же blueprint’а,
можно воспользоваться относительным перенаправлением, добавив префикс,
состоящий только из точки:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;.index&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Получится ссылка на <code class="docutils literal notranslate"><span class="pre">admin.index</span></code> в случае обработки текущего запроса в
любой другой конечной точке blueprint’а.</p>
</div>
<div class="section" id="id8">
<h4>Обработчики ошибок<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h4>
<p>Точно так же, как и объект приложения <code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code>, Blueprint’ы поддерживают
декоратор обработчика ошибок , так что создать blueprint-специфичные заданные
программистом страницы ошибок просто.</p>
<p>Вот пример для обработки исключения  «404 Page Not Found»:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@simple_page</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;pages/404.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>За дополнительной информацией по обработке ошибок обратитесь к разделу <span class="xref std std-ref">errorpages</span>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/blueprints/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-extensions"></span><div class="section" id="flask">
<span id="extensions"></span><h3>Расширения Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h3>
<p>Расширения Flask различным образом расширяют функциональность Flask.
Например, добавляют поддержку баз данных и т.п.</p>
<div class="section" id="id1">
<h4>Поиск расширений<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Расширения Flask перечислены по ссылке <a class="reference external" href="http://flask.pocoo.org/extensions/">Реестр расширений Flask</a> и могут
быть скачаны при помощи <code class="docutils literal notranslate"><span class="pre">easy_install</span></code> или <code class="docutils literal notranslate"><span class="pre">pip</span></code>.  Если добавить
расширение Flask в качестве зависимости в файл <code class="docutils literal notranslate"><span class="pre">requirements.rst</span></code> или
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code>, то обычно их можно установить с помощью простой команды или
при установке приложения.</p>
</div>
<div class="section" id="id2">
<h4>Использование расширений<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Обычно расширения снабжены документацией, которая объясняет как их
использовать.  Нет общих правил обращения с расширениями, но их можно
импортировать из обычных мест.  Если у вас имеется расширение под названием
<code class="docutils literal notranslate"><span class="pre">Flask-Foo</span></code> или <code class="docutils literal notranslate"><span class="pre">Foo-Flask</span></code>, в любом случае его можно импортировать из
<code class="docutils literal notranslate"><span class="pre">flask.ext.foo</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask.ext</span> <span class="k">import</span> <span class="n">foo</span>
</pre></div>
</div>
</div>
<div class="section" id="flask-0-8">
<h4>Flask до версии 0.8<a class="headerlink" href="#flask-0-8" title="Ссылка на этот заголовок">¶</a></h4>
<p>Во Flask версии 0.7 и более ранних пакет <code class="xref py py-data docutils literal notranslate"><span class="pre">flask.ext</span></code> отсутствует, а
вместо него можно импортировать расширение из <code class="docutils literal notranslate"><span class="pre">flaskext.foo</span></code> или
<code class="docutils literal notranslate"><span class="pre">flask_foo</span></code>, в зависимости от способа поставки расширения.  Если вы
хотите разрабатывать приложения, поддерживающие Flask 0.7 и более ранние,
импортировать всё равно нужно из пакета <code class="xref py py-data docutils literal notranslate"><span class="pre">flask.ext</span></code>.  Есть модуль,
предоставляющий этот пакет и позволяющий достичь совместимости со старыми
версиями Flask. Его можно скачать с github: <a class="reference external" href="https://github.com/mitsuhiko/flask/raw/master/scripts/flaskext_compat.py">flaskext_compat.py</a></p>
<p>Вот пример его использования:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flaskext_compat</span>
<span class="n">flaskext_compat</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">flask.ext</span> <span class="k">import</span> <span class="n">foo</span>
</pre></div>
</div>
<p>После активации модуля <code class="docutils literal notranslate"><span class="pre">flaskext_compat</span></code> появится <code class="xref py py-data docutils literal notranslate"><span class="pre">flask.ext</span></code>, из
которого можно импортировать расширения.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/extensions/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-shell"></span><div class="section" id="shell">
<span id="id1"></span><h3>Работа с командной оболочкой<a class="headerlink" href="#shell" title="Ссылка на этот заголовок">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.3.</span></p>
</div>
<p>Одна из причин, по которой все любят Python - это его командная оболочка.
Она позволяет очень просто в реальном времени исполнять команды Python и
получать немедленный результат.  Сам по себе Flask не обладает интерактивной
командной оболочкой, так как он не требует каких-либо особых предварительных
настроек, а лишь импортирования вашего приложения и его старта с дальнейшими
попытками «поиграться» с ним.</p>
<p>Однако, есть несколько удобных помощников для того, чтобы подобные действия
в командной строке были бы более приятным занятием.  Главная проблема при
работе с сессией интерактивной консолью - это то, что вы не можете вызвать
запрос, подобный тому, который делает браузер, а это означает, что
<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a>, <a class="reference internal" href="index.html#flask.request" title="flask.request"><code class="xref py py-data docutils literal notranslate"><span class="pre">request</span></code></a> и другие недоступны.  Однако
код, который вы хотите проверить, может от них зависеть. Что же далать?</p>
<p>Здесь нам пригодятся несколько функций помощников.  Однако, имейте в виду,
что эти функции предназначены не только для использования с интерактивной
командной оболочкой, но также и для тестирования модулей и для других
ситуаций, требующих использования «поддельного» контекста запроса.</p>
<p>А вообще-то, вам рекомендуется сначала прочесть раздел документации
<a class="reference internal" href="index.html#request-context"><span class="std std-ref">Контекст запроса Flask</span></a>.</p>
<div class="section" id="id2">
<h4>Создание контекста запроса<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Самый простой способ создать правильный контекст запроса из командной
оболочки - это использование метода <a class="reference internal" href="index.html#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-attr docutils literal notranslate"><span class="pre">test_request_context</span></code></a>,
который создаст нам <a class="reference internal" href="index.html#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">()</span>
</pre></div>
</div>
<p>Обычно, чтобы активировать этот объект запроса, вам следует использовать
оператор <cite>with</cite>, но в командной оболочке проще вручную использовать методы
<a class="reference internal" href="index.html#flask.ctx.RequestContext.push" title="flask.ctx.RequestContext.push"><code class="xref py py-meth docutils literal notranslate"><span class="pre">push()</span></code></a> и <a class="reference internal" href="index.html#flask.ctx.RequestContext.pop" title="flask.ctx.RequestContext.pop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
</pre></div>
</div>
<p>С этого места и далее, вплоть до вызова <cite>pop</cite>, вы можете работать с объектом
запроса.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>Формирование запроса до/после<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Создавая лишь контекст запроса, нам не удаётся запустить код, который
в реальной ситуации выполнится перед запросом.  Из-за этого, к примеру,
ваша база данных окажется недоступной, если соединение с ней шло через
обратный вызов перед запросом, или к примеру текущий пользователь не
будет сохранён в объекте <a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> и т. п.</p>
<p>Это, Однако, можно сделать самостоятельно.  Просто вызовите
<a class="reference internal" href="index.html#flask.Flask.preprocess_request" title="flask.Flask.preprocess_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">preprocess_request()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">preprocess_request</span><span class="p">()</span>
</pre></div>
</div>
<p>Помните, что функция <a class="reference internal" href="index.html#flask.Flask.preprocess_request" title="flask.Flask.preprocess_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">preprocess_request()</span></code></a> может вернуть
объект ответа, в этом случае просто не обращайте на него внимания.</p>
<p>Чтобы завершить («выключить») запрос, вам необходимо немного поколдовать
перед выполнением «после»-функций для запроса (вызываются с помощью
<a class="reference internal" href="index.html#flask.Flask.process_response" title="flask.Flask.process_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">process_response()</span></code></a>), которые воздействуют на объект
ответа:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">app</span><span class="o">.</span><span class="n">process_response</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">response_class</span><span class="p">())</span>
<span class="go">&lt;Response 0 bytes [200 OK]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
<p>Функции, зарегистрированные как <a class="reference internal" href="index.html#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a>
автоматически вызываются при извлечении контекста.  Поэтому, это отличное
место для автоматического освобождения ресурсов, которые были нужны
контексту запроса (например, соединения с базой данных).</p>
</div>
<div class="section" id="id4">
<h4>Дальнейшее развитие опыта работы с командной оболочкой<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если вам понравилась идея экспериментировать в командной оболочке, создайте
самостоятельно модуль с тем, что вам необходимо, чтобы он выполнил при своём
импорте в вашу интерактивную сессию необходимую роль.  Вам также следует
определить ещё несколько методов-помощников для таких обычных задач, как
инициализация базы данных, удаление таблиц и т. п.</p>
<p>Просто поместите их в модуль (например, <cite>shelltools</cite>), и импортируйте их
оттуда:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">shelltools</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>
</div>
<p><a class="reference external" href="http://flask.pocoo.org/docs/shell/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-patterns/index"></span><div class="section" id="flask">
<span id="patterns"></span><h3>Заготовки для Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h3>
<p>Некоторые вещи являются настолько общими, что существует большой шанс найти
их в большинстве веб-приложений.  К примеру, довольно много приложений
используют реляционные базы данных и аутентификацию пользователей.  В этом
случае, скорее всего, ими в начале запроса будут открываться подключения к
базе данных и получаться информация о пользователе, вошедшем в систему.
В конце запроса, соединение с базой данных вновь закрывается.</p>
<p>В <a class="reference external" href="http://flask.pocoo.org/snippets/">Архиве фрагментов для Flask</a> можно
найти много поддерживаемых энтузиастами фрагментов и заготовок.</p>
<div class="toctree-wrapper compound">
<span id="document-patterns/packages"></span><div class="section" id="flask">
<span id="larger-applications"></span><h4>Большие приложения во Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h4>
<p>В больших приложениях лучше использовать пакеты вместо модулей.  Это
очень просто.  Представьте, что небольшое приложение выглядит так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">yourapplication</span>
    <span class="o">/</span><span class="n">yourapplication</span><span class="o">.</span><span class="n">py</span>
    <span class="o">/</span><span class="n">static</span>
        <span class="o">/</span><span class="n">style</span><span class="o">.</span><span class="n">css</span>
    <span class="o">/</span><span class="n">templates</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">html</span>
        <span class="n">index</span><span class="o">.</span><span class="n">html</span>
        <span class="n">login</span><span class="o">.</span><span class="n">html</span>
        <span class="o">...</span>
</pre></div>
</div>
<div class="section" id="id1">
<h5>Простые пакеты<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Чтобы преобразовать его в чуть большее, просто создайте новый каталог
приложения <cite>yourapplication</cite> внутри существующего и поместите всё в него.
Переименуйте <cite>yourapplication.py</cite> в <cite>__init__.py</cite>.  (Сначала убедитесь,
что удалили все файлы <cite>.pyc</cite>, иначе скорее всего оно перестанет работать).</p>
<p>У вас должно получиться что-то такое:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">yourapplication</span>
    <span class="o">/</span><span class="n">yourapplication</span>
        <span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="o">/</span><span class="n">static</span>
            <span class="o">/</span><span class="n">style</span><span class="o">.</span><span class="n">css</span>
        <span class="o">/</span><span class="n">templates</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">html</span>
            <span class="n">index</span><span class="o">.</span><span class="n">html</span>
            <span class="n">login</span><span class="o">.</span><span class="n">html</span>
            <span class="o">...</span>
</pre></div>
</div>
<p>Но как теперь запустить приложение?  Простой запуск <code class="docutils literal notranslate"><span class="pre">python</span>
<span class="pre">yourapplication/__init__.py</span></code> не сработает.  Скажем так, Python не хочет
запускать модули в пакете, как программы.  Но это не проблема, просто
добавим во внутренний каталог <cite>yourapplication</cite> новый файл <cite>runserver.py</cite>
со следующим содержимым:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span>
<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Что это нам даст?  Теперь мы можем реструктурировать приложение и поделить
его на несколько модулей.  Единственное, о чём нужно помнить и соблюдать,
это:</p>
<ol class="arabic simple">
<li>Создание приложения Flask должно происходить в файле <cite>__init__.py</cite>.  Так
каждый модуль сможет безопасно импортировать его, а переменная <cite>__name__</cite>
примет значение имени соответствующего пакета.</li>
<li>Все функции представлений, к которым применён декоратор
<a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a>, должны быть импортированы в файл
<cite>__init__.py</cite>.  Не сам объект, но модуль с ними.  Импорт модуля
представлений производится <strong>после создания объекта</strong>.</li>
</ol>
<p>Вот пример <cite>__init__.py</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">yourapplication.views</span>
</pre></div>
</div>
<p>При этом <cite>views.py</cite> должен выглядеть так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>В итоге должно получиться что-то вроде этого:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">yourapplication</span>
    <span class="o">/</span><span class="n">runserver</span><span class="o">.</span><span class="n">py</span>
    <span class="o">/</span><span class="n">yourapplication</span>
        <span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="o">/</span><span class="n">views</span><span class="o">.</span><span class="n">py</span>
        <span class="o">/</span><span class="n">static</span>
            <span class="o">/</span><span class="n">style</span><span class="o">.</span><span class="n">css</span>
        <span class="o">/</span><span class="n">templates</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">html</span>
            <span class="n">index</span><span class="o">.</span><span class="n">html</span>
            <span class="n">login</span><span class="o">.</span><span class="n">html</span>
            <span class="o">...</span>
</pre></div>
</div>
<div class="admonition- admonition">
<p class="first admonition-title">Взаимный импорт</p>
<p>Каждый Python-программист его ненавидит, но мы его добавили: два модуля
зависят друг от друга.  В данном случае <cite>views.py</cite> зависит от
__init__.py.  Мы предостерегаем вас от подобного приёма, но здесь он
оправдан.  Причина заключается в том, что мы на самом деле не используем
представления в <cite>__init__.py</cite>, а просто убеждаемся в том, что модуль
импортирован и делаем это в конце файла.</p>
<p class="last">Однако, у этого подхода всё-же есть проблемы, но если вы хотите
использовать декораторы, без него не обойтись.  Обратитесь к разделу
<span class="xref std std-ref">becomingbig</span> за идеями о том, как с этим справиться.</p>
</div>
</div>
<div class="section" id="blueprint">
<span id="working-with-modules"></span><h5>Работа с Blueprint’ами<a class="headerlink" href="#blueprint" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если у вас большое приложение, рекомендуется поделить его на небольшие
группы - так, чтобы каждая группа была реализована с помощью blueprint’ов.
Для плавного вникания в данную тему обратитесь к разделу <a class="reference internal" href="index.html#blueprints"><span class="std std-ref">Модульные приложения Flask с использованием blueprint’ов</span></a>
данной документации.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/patterns/packages/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-patterns/sqlalchemy"></span><div class="section" id="sqlalchemy-flask">
<span id="sqlalchemy-pattern"></span><h4>SQLAlchemy во Flask<a class="headerlink" href="#sqlalchemy-flask" title="Ссылка на этот заголовок">¶</a></h4>
<p>Многие люди для доступа к базам данных предпочитают использовать
<a class="reference external" href="http://www.sqlalchemy.org/">SQLAlchemy</a>.  В этом случае для написания приложений на Flask больше
подходят не модули, а пакеты, так как в этом случае можно поместить модели
в отдельный модуль (<a class="reference internal" href="index.html#larger-applications"><span class="std std-ref">Большие приложения во Flask</span></a>).  Хоть это и не обязательно,
но всё же имеет смысл.</p>
<p>Есть четыре обычных способа использования SQLAlchemy.  Остановимся на
каждом из них подробнее:</p>
<div class="section" id="flask-sqlalchemy">
<h5>Расширение Flask-SQLAlchemy<a class="headerlink" href="#flask-sqlalchemy" title="Ссылка на этот заголовок">¶</a></h5>
<p>Поскольку SQLAlchemy - это обобщённый слой абстракции над базами данных и
объектно-реляционное отображение, требующее предварительной настройки,
существует расширение Flask, делающее всё необходимое за вас.  Если нужно
быстро начать работу, рекомендуем воспользоваться им.</p>
<p>Расширение <a class="reference external" href="http://packages.python.org/Flask-SQLAlchemy/">Flask-SQLAlchemy</a> можно скачать из <a class="reference external" href="http://pypi.python.org/pypi/Flask-SQLAlchemy">PyPI</a>.</p>
</div>
<div class="section" id="declarative">
<h5>Declarative<a class="headerlink" href="#declarative" title="Ссылка на этот заголовок">¶</a></h5>
<p>Расширение declarative в SQLAlchemy - это один из наиболее частых способов
использования SQLAlchemy.  Оно позволяет вам определять таблицы и модели
одновременно, примерно так, как это делается в Django.  В дополнение к
следующему тексту рекомендуется обратиться к официальной документации по
расширению <a class="reference external" href="http://www.sqlalchemy.org/docs/orm/extensions/declarative.html">declarative</a>.</p>
<p>Вот пример модуля <cite>database.py</cite> для приложения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">scoped_session</span><span class="p">,</span> <span class="n">sessionmaker</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declarative_base</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:////tmp/test.db&#39;</span><span class="p">,</span> <span class="n">convert_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">db_session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">(</span><span class="n">autocommit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">autoflush</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">))</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
<span class="n">Base</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query_property</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">init_db</span><span class="p">():</span>
    <span class="c1"># Здесь нужно импортировать все модули, где могут быть определены модели,</span>
    <span class="c1"># которые необходимым образом могут зарегистрироваться в метаданных.</span>
    <span class="c1"># В противном случае их нужно будет импортировать до вызова init_db()</span>
    <span class="kn">import</span> <span class="nn">yourapplication.models</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
<p>Для определения собственных моделей наследуйте от класса <cite>Base</cite>, который
создан вышеприведённым кодом.  Если вы удивлены, почему в этом примере не
нужно заботиться о потоках (как мы делали в примере для SQLite3 с объектом
<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a> выше), то это потому что SQLAlchemy делает это
самостоятельно при помощи <code class="xref py py-class docutils literal notranslate"><span class="pre">scoped_session</span></code>.</p>
<p>Чтобы использовать SQLAlchemy в приложении декларативным образом,
необходимо поместить в модуль вашего приложения следующий код.  Flask
автоматически удалит сеанс базы данных в конце запроса или при завершении
приложения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">db_session</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span> <span class="nf">shutdown_session</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">db_session</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</pre></div>
</div>
<p>Вот пример модели (поместите его, например, в <cite>models.py</cite>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">Base</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">120</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;User </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>Для создания базы данных можно воспользоваться функцией <cite>init_db</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">init_db</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">init_db</span><span class="p">()</span>
</pre></div>
</div>
<p>Вот так можно добавить новые записи в базу данных:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">db_session</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">yourapplication.models</span> <span class="k">import</span> <span class="n">User</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;admin@localhost&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db_session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
<p>Пример запроса:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;User u&#39;admin&#39;&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="go">&lt;User u&#39;admin&#39;&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Ручное объектно-реляционное отображение<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Ручное объектно-реляционное отображение имеет некоторые преимущества и
недостатки по сравнению с декларативным подходом, рассмотренным выше.
Главное отличие заключается в том, что таблицы и классы определяются
раздельно, а затем создаётся их взаимное отображение.  Этот подход более
гибок, однако и более трудоёмок.  В целом он работает подобно
декларативному подходу, поэтому убедитесь в том, что поделили ваше
приложение на несколько модулей в пакете.</p>
<p>Вот пример модуля <cite>database.py</cite> для вашего приложения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">MetaData</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">scoped_session</span><span class="p">,</span> <span class="n">sessionmaker</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:////tmp/test.db&#39;</span><span class="p">,</span> <span class="n">convert_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">db_session</span> <span class="o">=</span> <span class="n">scoped_session</span><span class="p">(</span><span class="n">sessionmaker</span><span class="p">(</span><span class="n">autocommit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">autoflush</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">init_db</span><span class="p">():</span>
    <span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
<p>Как и при декларативном подходе, вам необходимо закрывать сеанс
после каждого запроса или завершения контекста приложения.  Поместите
следующие строки в модуль вашего приложения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">db_session</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span> <span class="nf">shutdown_session</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">db_session</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</pre></div>
</div>
<p>Вот пример таблицы и модели (поместите их в <cite>models.py</cite>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">mapper</span>
<span class="kn">from</span> <span class="nn">yourapplication.database</span> <span class="k">import</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">db_session</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">db_session</span><span class="o">.</span><span class="n">query_property</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;User </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">120</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">mapper</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
</pre></div>
</div>
<p>Запрос и вставка записей делается точно так же, как в примере выше.</p>
</div>
<div class="section" id="sql">
<h5>Слой абстракции над SQL<a class="headerlink" href="#sql" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если вы хотите использовать только слой абстракции к базам данных (и
SQL), вам потребуется только объект engine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">MetaData</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:////tmp/test.db&#39;</span><span class="p">,</span> <span class="n">convert_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
<p>Теперь можно объявить таблицы в коде, как в примере выше или
автоматически загрузить их:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Table</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Чтобы вставить данные, вы можете воспользоваться методом <cite>insert</cite>.
Прежде чем совершить транзакцию, необходимо сначала получить
подключение:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s1">&#39;admin@localhost&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>SQLAlchemy автоматически подтвердит транзакцию.</p>
<p>Для выполнения запросов можно воспользоваться напрямую объектом engine,
либо использовать подключение:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">users</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="go">(1, u&#39;admin&#39;, u&#39;admin@localhost&#39;)</span>
</pre></div>
</div>
<p>С результатом запроса можно обращаться как со словарём:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="go">u&#39;admin&#39;</span>
</pre></div>
</div>
<p>В метод <code class="xref py py-meth docutils literal notranslate"><span class="pre">execute()</span></code> можно также
передавать строки с выражениями SQL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;select * from users where id = :1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="go">(1, u&#39;admin&#39;, u&#39;admin@localhost&#39;)</span>
</pre></div>
</div>
<p>За более подробной информацией о SQLAlchemy обратитесь к
<a class="reference external" href="http://sqlalchemy.org/">вебсайту</a>.</p>
<p>Примечание переводчика:</p>
<p>В сети можно найти
<a class="reference external" href="https://ru.wikibooks.org/wiki/SQLAlchemy">русскоязычный вики-учебник по использованию SQLAlchemy:</a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/patterns/sqlalchemy/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-patterns/fileuploads"></span><div class="section" id="uploading-files">
<span id="id1"></span><h4>Загрузка файлов<a class="headerlink" href="#uploading-files" title="Ссылка на этот заголовок">¶</a></h4>
<p>Ну да, старая добрая проблема загрузки файлов.  Основная мысль загрузки
файлов на самом деле очень проста.  В общих чертах это работает так:</p>
<ol class="arabic simple">
<li>Тег <code class="docutils literal notranslate"><span class="pre">&lt;form&gt;</span></code> помечается атрибутом <code class="docutils literal notranslate"><span class="pre">enctype=multipart/form-data</span></code>, а в
форму помещается тег <code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">type=file&gt;</span></code>.</li>
<li>Приложение получает доступ к файлу через словарь
<code class="xref py py-attr docutils literal notranslate"><span class="pre">files</span></code> в объекте запроса.</li>
<li>Воспользуйтесь методом <a class="reference external" href="http://werkzeug.pocoo.org/docs/datastructures/#werkzeug.datastructures.FileStorage.save" title="(в Werkzeug v0.14-dev)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a>
для того, чтобы сохранить временный файл в файловой системе для
последующего использования.</li>
</ol>
<div class="section" id="id2">
<h5>Введение<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Начнём с простейшего приложения, которое загружает файл в определённый
каталог и отображает его пользователю. Вот начало  нашего приложения:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>
<span class="kn">from</span> <span class="nn">werkzeug.utils</span> <span class="k">import</span> <span class="n">secure_filename</span>

<span class="n">UPLOAD_FOLDER</span> <span class="o">=</span> <span class="s1">&#39;/path/to/the/uploads&#39;</span>
<span class="n">ALLOWED_EXTENSIONS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="s1">&#39;jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;gif&#39;</span><span class="p">])</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">UPLOAD_FOLDER</span>
</pre></div>
</div>
<p>Сначала нужно выполнить серию импортов.  Большая часть понятна,
<code class="xref py py-func docutils literal notranslate"><span class="pre">werkzeug.secure_filename()</span></code> рассматривается чуть позже.
<cite>UPLOAD_FOLDER</cite> - это путь, куда будут загружаться файлы, а
<cite>ALLOWED_EXTENSIONS</cite> - это набор допустимых расширений.  Теперь вручную
добавим в приложение правило для URL.  Обычно мы так не делаем, но почему
мы делаем это сейчас?  Причина в том, что мы хотим заставить веб-сервер
(или наш сервер приложения) обслуживать эти файлы и поэтому нам нужно
генерировать правила для связывания URL с этими файлами.</p>
<p>Почему мы ограничили список допустимых расширений?  Наверное вам совсем не
хочется, чтобы пользователи могли загружать что угодно, если сервер
напрямую отправляет данные клиенту.  В таком случае вам нужно быть
уверенными в том, что пользователи не загрузят файлы HTML, которые могут
вызвать проблему XSS (см. Cross-Site Scripting (<span class="xref std std-ref">xss</span>) - межсайтовый
скриптинг).  Также убедитесь в том, что запрещены файлы с расширением
<cite>.php</cite>, если сервер их выполняет.  Правда, кому нужен PHP на сервере? :)</p>
<p>Следующая функция проверяет, что расширение файла допустимо, загружает файл
и перенаправляет пользователя на URL с загруженным файлом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">allowed_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">filename</span> <span class="ow">and</span> \
           <span class="n">filename</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ALLOWED_EXTENSIONS</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">allowed_file</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">secure_filename</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span> <span class="n">filename</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;uploaded_file&#39;</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">))</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    &lt;!doctype html&gt;</span>
<span class="s1">    &lt;title&gt;Upload new File&lt;/title&gt;</span>
<span class="s1">    &lt;h1&gt;Upload new File&lt;/h1&gt;</span>
<span class="s1">    &lt;form action=&quot;&quot; method=post enctype=multipart/form-data&gt;</span>
<span class="s1">      &lt;p&gt;&lt;input type=file name=file&gt;</span>
<span class="s1">         &lt;input type=submit value=Upload&gt;</span>
<span class="s1">    &lt;/form&gt;</span>
<span class="s1">    &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Что делает функция <a class="reference external" href="http://werkzeug.pocoo.org/docs/utils/#werkzeug.utils.secure_filename" title="(в Werkzeug v0.14-dev)"><code class="xref py py-func docutils literal notranslate"><span class="pre">secure_filename()</span></code></a>?  Мы исходим из
принципа «никогда не доверяй тому, что ввёл пользователь».  Это справедливо
и для имени загружаемого файла.  Все отправленные из формы данные могут
быть поддельными и имя файла может представлять опасность.  Сейчас главное
запомнить: всегда используйте эту функцию для получения безопасного имени
файла, если собираетесь поместить файл прямо в файловую систему.</p>
<div class="admonition- admonition">
<p class="first admonition-title">Информация для профи</p>
<p>Может быть вам интересно, что делает функция
<a class="reference external" href="http://werkzeug.pocoo.org/docs/utils/#werkzeug.utils.secure_filename" title="(в Werkzeug v0.14-dev)"><code class="xref py py-func docutils literal notranslate"><span class="pre">secure_filename()</span></code></a> и почему нельзя обойтись без её
использования?  Просто представьте, что кто-то хочет отправить следующую
информацию в ваше приложение в качестве имени файла:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;../../../../home/username/.bashrc&quot;</span>
</pre></div>
</div>
<p>Если считать, что <code class="docutils literal notranslate"><span class="pre">../</span></code> - это нормально, то при соединении этого имени
с <cite>UPLOAD_FOLDER</cite>, пользователь может получить возможность изменять на
файловой системе сервера те файлы, который он не должен изменять.  Нужно
немного разбираться в устройстве вашего приложения, но поверьте мне,
хакеры настойчивы :)</p>
<p>Посмотрим, как отработает функция:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">secure_filename</span><span class="p">(</span><span class="s1">&#39;../../../../home/username/.bashrc&#39;</span><span class="p">)</span>
<span class="go">&#39;home_username_.bashrc&#39;</span>
</pre></div>
</div>
</div>
<p>Осталась последняя вещь: обслуживание загруженных файлов.  Начиная с Flask
0.5 для этого можно использовать соответствующую функцию:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">send_from_directory</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/uploads/&lt;filename&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">uploaded_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span>
                               <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>Другая возможность - зарегистрировать <cite>uploaded_file</cite> с помощью правила
<cite>build_only</cite> и воспользоваться <a class="reference external" href="http://werkzeug.pocoo.org/docs/middlewares/#werkzeug.wsgi.SharedDataMiddleware" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedDataMiddleware</span></code></a>.
Такой вариант будет работать и в более старых версиях Flask:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug</span> <span class="k">import</span> <span class="n">SharedDataMiddleware</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/uploads/&lt;filename&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;uploaded_file&#39;</span><span class="p">,</span>
                 <span class="n">build_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">SharedDataMiddleware</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;/uploads&#39;</span><span class="p">:</span>  <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
<p>Теперь, если запустить приложение, всё должно работать как положено.</p>
</div>
<div class="section" id="id3">
<h5>Улучшение загрузки<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.6.</span></p>
</div>
<p>Как на самом деле Flask обрабатывает загрузку?  Если файл достаточно мал,
он сохраняется в памяти веб-сервера.  В противном случае он помещается во
временное место (туда, куда укажет <a class="reference external" href="https://docs.python.org/dev/library/tempfile.html#tempfile.gettempdir" title="(в Python v3.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">tempfile.gettempdir()</span></code></a>).  Но как
указать максимальный размер файла, после которого загрузка файла должна
быть прервана?  По умолчанию Flask не ограничивает размер файла, но вы
можете задать лимит настройкой ключа конфигурации <code class="docutils literal notranslate"><span class="pre">MAX_CONTENT_LENGTH</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">Request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;MAX_CONTENT_LENGTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
</pre></div>
</div>
<p>Код выше ограничит максимальный размер файла 16 мегабайтами.  Если
передаваемый файл окажется больше, Flask сгенерирует исключение
<a class="reference external" href="http://werkzeug.pocoo.org/docs/exceptions/#werkzeug.exceptions.RequestEntityTooLarge" title="(в Werkzeug v0.14-dev)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RequestEntityTooLarge</span></code></a>.</p>
<p>Эта функциональность была добавлена во Flask 0.6, но может быть реализована
и в более ранних версиях при помощи наследовании от класса request.  За
более подробной информацией обратитесь к документации Werkzeug об обработке
файлов.</p>
</div>
<div class="section" id="id4">
<h5>Индикаторы процесса загрузки<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Многие разработчики придумывают считывать файл мелкими частями, сохранять
процент загрузки в базу данных и давать возможность JavaScript считывать
эти данные из клиента.  Короче говоря, клиент спрашивает у сервера каждые
5 секунд, сколько уже было передано.  Почувствовали иронию ситуации?
Клиент спрашивает у сервера о том, что уже и так знает.</p>
<p>Сейчас существуют способы получше, которые работают быстрее и более
надёжны.  В последнее время в вебе многое изменилось и теперь можно
использовать HTML5, Java, Silverlight или Flash, чтобы сделать загрузку
удобнее со стороны клиента.  Посмотрите на следующие библиотеки,
предназначенные именно для этого:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.plupload.com/">Plupload</a> - HTML5, Java, Flash</li>
<li><a class="reference external" href="http://www.swfupload.org/">SWFUpload</a> - Flash</li>
<li><a class="reference external" href="http://jumploader.com/">JumpLoader</a> - Java</li>
</ul>
</div>
<div class="section" id="id5">
<h5>Простейшее решение<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Поскольку общая процедура загрузки файлов остаётся неизменной для всех
приложений, занимающихся загрузкой файлов, для Flask есть расширение под
названием <a class="reference external" href="http://packages.python.org/Flask-Uploads/">Flask-Uploads</a>, которое реализует полностью самостоятельный
механизм загрузки с белым и чёрным списком расширений и т.п.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/patterns/fileuploads/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-patterns/caching"></span><div class="section" id="caching-pattern">
<span id="id1"></span><h4>Кэширование<a class="headerlink" href="#caching-pattern" title="Ссылка на этот заголовок">¶</a></h4>
<p>Когда приложение работает медленно, можно попробовать воспользоваться
кэшированием.  По крайней мере это самый простой способ ускорения
программы.  Как работает кэширование? Допустим, имеется функция, которая
работает довольно долго, но результаты её работы будут пригодны для
использования даже через 5 минут.  Смысл в том, что на самом деле мы на
некоторое время помещаем результаты расчётов в кэш.</p>
<p>Сам по себе Flask не умеет кэшировать, но Werkzeug, одна из библиотек,
на которой он основан, имеет базовую поддержку кэширования.  Библиотека
поддерживает различные средства кэширования, но скорее всего вам
захочется воспользоваться сервером memcached.</p>
<div class="section" id="id2">
<h5>Настройка кэша<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Объект кэша создаётся единожды и продолжает работать примерно так же, как
это происходит с объектами <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a>.  Если речь идёт о сервере
разработки, то можно создать объект
<a class="reference external" href="http://werkzeug.pocoo.org/docs/contrib/cache/#werkzeug.contrib.cache.SimpleCache" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleCache</span></code></a>, который представляет собой
простейший кэш, хранящий элементы в памяти интерпретатора Python:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.contrib.cache</span> <span class="k">import</span> <span class="n">SimpleCache</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">SimpleCache</span><span class="p">()</span>
</pre></div>
</div>
<p>Для использования memcached нужно установить один из поддерживаемых модулей
memcache (его можно взять на <a class="reference external" href="http://pypi.python.org/">PyPI</a>) и запустить
где-нибудь сервер memcached.  Теперь можно подключиться к серверу memcached:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.contrib.cache</span> <span class="k">import</span> <span class="n">MemcachedCache</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">MemcachedCache</span><span class="p">([</span><span class="s1">&#39;127.0.0.1:11211&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Если вы пользуетесь App Engine, можно легко подключиться к серверу memcache
из App Engine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.contrib.cache</span> <span class="k">import</span> <span class="n">GAEMemcachedCache</span>
<span class="n">cache</span> <span class="o">=</span> <span class="n">GAEMemcachedCache</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Использование кэша<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Как теперь воспользоваться этим кэшем?  Имеется две очень важные операции:
<a class="reference external" href="http://werkzeug.pocoo.org/docs/contrib/cache/#werkzeug.contrib.cache.BaseCache.get" title="(в Werkzeug v0.14-dev)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> и
<a class="reference external" href="http://werkzeug.pocoo.org/docs/contrib/cache/#werkzeug.contrib.cache.BaseCache.set" title="(в Werkzeug v0.14-dev)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a>.  Вот как их использовать:</p>
<p>Чтобы получить элемент из кэша, вызовите
<a class="reference external" href="http://werkzeug.pocoo.org/docs/contrib/cache/#werkzeug.contrib.cache.BaseCache.get" title="(в Werkzeug v0.14-dev)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a>, указав ей ключ - имя элемента.
Если что-нибудь есть в кэше, оно будет возвращено.  В противном случае функция
вернёт <cite>None</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rv</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;my-item&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Чтобы добавить элемент в кэш, воспользуйтесь методом
<a class="reference external" href="http://werkzeug.pocoo.org/docs/contrib/cache/#werkzeug.contrib.cache.BaseCache.set" title="(в Werkzeug v0.14-dev)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a>.  Первый аргумент - это ключ, а
второй - его значение.  Также можно указать время кэширования, по истечении
которого элемент будет автоматически удалён.</p>
<p>Вот полный пример того, как это обычно выглядит:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_my_item</span><span class="p">():</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;my-item&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">calculate_value</span><span class="p">()</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;my-item&#39;</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rv</span>
</pre></div>
</div>
<div class="section" id="id4">
<h6>Примечания переводчика<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h6>
<p>Под App Engine подразумевается облачный сервис веб-приложений от Google:
<a class="reference external" href="https://appengine.google.com/start">https://appengine.google.com/start</a>.
Чуть подробнее о нём можно узнать из статьи на Википедии:
<a class="reference external" href="http://ru.wikipedia.org/wiki/Google_App_Engine">Google App Engine</a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/patterns/caching/">Оригинал этой страницы</a></p>
</div>
</div>
</div>
<span id="document-patterns/viewdecorators"></span><div class="section" id="flask">
<h4>Декораторы представлений во Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h4>
<p>В Python имеется любопытная функциональность, которая называется
декораторами функций.  Декораторы позволяют сделать веб-приложения изящнее.
Поскольку каждое представление во Flask является функцией, можно
использовать декораторы для добавления дополнительной функциональности к
одной или более функций.  Декоратор <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> - один из
тех, который вы возможно уже используете.  Но можно реализовать собственные
декораторы.  Например, представьте, что есть представление, которое должно
быть доступно только аутентифицированным пользователям.  Если пользователь
вошёл на сайт, но не аутентифицировался, его нужно перенаправить на
страницу аутентификации.  Это хороший случай, в котором декоратор может
прийтись как нельзя кстати.</p>
<div class="section" id="id1">
<h5>Декоратор «необходима аутентификация»<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Ну что ж, давайте реализуем этот декоратор.  Декоратор - это функция,
возвращающая функцию.  На самом деле очень просто.  Единственное, о чём
нужно помнить при реализации чего-то подобного, это об обновлении
<cite>__name__</cite>, <cite>__module__</cite> и других атрибутов функции.  Часто об этом
забывают, нам не потребуется делать это вручную, потому что есть функция,
которая может сделать это за нас и используется в качестве декоратора
(<a class="reference external" href="https://docs.python.org/dev/library/functools.html#functools.wraps" title="(в Python v3.8)"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.wraps()</span></code></a>).</p>
<p>Пример подразумевает, что страница для ввода учётных данных называется
<code class="docutils literal notranslate"><span class="pre">'login'</span></code>, а текущий пользователь хранится в <cite>g.user</cite>. Если
пользователь не аутентифицирован, то в <cite>g.user</cite> хранится <cite>None</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">g</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>

<span class="k">def</span> <span class="nf">login_required</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated_function</span>
</pre></div>
</div>
<p>Итак, как же теперь воспользоваться этим декоратором?  Применим его в
качестве наиболее глубоко вложенного декоратора.  При дальнейшем применении
декораторов помните, что декоратор <a class="reference internal" href="index.html#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> должен быть
самым внешним:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/secret_page&#39;</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">secret_page</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Кэширующий декоратор<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Представьте, что у вас есть функция представления, которая выполняет
сложные расчёты и поэтому вам хочется, чтобы результаты расчётов в течение
некоторого времени выдавались из кэша.  Для решения этой задачи подойдёт
декоратор.  Подразумевается, что кэш уже настроен, как описано в разделе
<a class="reference internal" href="index.html#caching-pattern"><span class="std std-ref">Кэширование</span></a>.</p>
<p>Вот пример функции кэширования.  Она использует в качестве ключа для кэша
некий префикс (на самом деле это строка формата) и текущий путь запроса.
Отметим, что мы создадим функцию, которая создаст декоратор, с помощью
которого мы задекорируем функцию.  Звучит пугающе?  На самом деле это
впрямь немного сложнее, но код остаётся достаточно прямолинейным для того,
чтобы его ещё можно было прочитать.</p>
<p>Задекорированная функция будет работать следующим образом:</p>
<ol class="arabic simple">
<li>приготовит уникальный ключ кэша для текущего запроса, основываясь на
текущем пути.</li>
<li>получит значение для этого ключа из кэша.  Если кэш вернул что-нибудь,
мы вернём это значение.</li>
<li>в противном случае будет вызвана оригинальная функция, возвращённое
значение будет помещено в кэш с указанным временем кэширования (по
умолчанию - 5 минут).</li>
</ol>
<p>Вот код:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="k">def</span> <span class="nf">cached</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;view/</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">cache_key</span> <span class="o">=</span> <span class="n">key</span> <span class="o">%</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">rv</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">rv</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rv</span>
        <span class="k">return</span> <span class="n">decorated_function</span>
    <span class="k">return</span> <span class="n">decorator</span>
</pre></div>
</div>
<p>Notice that this assumes an instantiated <cite>cache</cite> object is available, see
<a class="reference internal" href="index.html#caching-pattern"><span class="std std-ref">Кэширование</span></a> for more information.
В этом примере подразумевается, что объект <cite>cache</cite> уже инициализирован, как
описано в разделе <a class="reference internal" href="index.html#caching-pattern"><span class="std std-ref">Кэширование</span></a>.</p>
</div>
<div class="section" id="id3">
<h5>Шаблонизирующий декоратор<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>В TurboGears некоторое время назад было распространено использование
шаблонизирующих декораторов.  Смысл этого декоратора заключается в том, что
функция представления возвращает словарь со значениями для шаблона, а
шаблон отрисовывается автоматически.  В этом случае следующие три примера
делают одно и то же:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="nd">@templated</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="nd">@templated</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>Как можно заметить, если имя шаблона не указано, используется конечная
точка карты URL с точками, преобразованными в косые черты и с добавленным
справа текстом <code class="docutils literal notranslate"><span class="pre">'.html'</span></code>.  В противном случае, используется шаблон с
указанным именем.  Когда задекорированная функция завершается,
возвращённый ею словарь передаётся в функцию отрисовки шаблона.  Если
ничего не возвращено, подразумевается пустой словарь, а если возвращён не
словарь, мы возвращаем это значение неизменным.  Таким образом по-прежнему
можно пользоваться функцией redirect или возвращать обычные строки.</p>
<p>Вот код этого декоратора:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">request</span>

<span class="k">def</span> <span class="nf">templated</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">template_name</span> <span class="o">=</span> <span class="n">template</span>
            <span class="k">if</span> <span class="n">template_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">template_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">endpoint</span> \
                    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ctx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ctx</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ctx</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">decorated_function</span>
    <span class="k">return</span> <span class="n">decorator</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Декоратор конечной точки<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если хочется воспользоваться системой маршрутизации Werkzeug для достижения
большей гибкости, нужно отобразить конечную точку в соответствии с правилом
<a class="reference external" href="http://werkzeug.pocoo.org/docs/routing/#werkzeug.routing.Rule" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rule</span></code></a> для функции представления.  Это можно
сделать с помощью декоратора. Например:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">werkzeug.routing</span> <span class="k">import</span> <span class="n">Rule</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Rule</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">endpoint</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;Hello world&quot;</span>
</pre></div>
</div>
<p><a class="reference external" href="http://flask.pocoo.org/docs/patterns/viewdecorators/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-patterns/flashing"></span><div class="section" id="message-flashing-pattern">
<span id="id1"></span><h4>Всплывающие сообщения<a class="headerlink" href="#message-flashing-pattern" title="Ссылка на этот заголовок">¶</a></h4>
<p>Хорошие приложения и интерфейсы пользователя дают обратную связь.  Если
пользователь не получает достаточной обратной связи, вскоре он может начать
ненавидеть приложение.  Flask предоставляет по-настоящему простой способ
дать обратную связь пользователю при помощи системы всплывающих сообщений.
Система всплывающих сообщений обычно делает возможным записать сообщение в
конце запроса и получить к нему доступ во время обработки следующего и
только следующего запроса.  Обычно эти сообщения используются в шаблонах
макетов страниц, которые его и отображают.</p>
<div class="section" id="id2">
<h5>Пример всплывающих сообщений<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Вот полный пример:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> \
     <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">&#39;some_secret&#39;</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span> <span class="ow">or</span> \
                <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;secret&#39;</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;Invalid credentials&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;You were successfully logged in&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;login.html&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>А вот шаблон макета <code class="docutils literal notranslate"><span class="pre">layout.html</span></code>, отображающий сообщение:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My Application<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">with</span> <span class="nv">messages</span> <span class="o">=</span> <span class="nv">get_flashed_messages</span><span class="o">()</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">messages</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">flashes</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span>
      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>А это - шаблон index.html:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Overview<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Do you want to <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;login&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>log in?<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>И, конечно, шаблон страницы входа:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">error</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">error</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Error:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> <span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">post</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Username:
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">text</span> <span class="na">name</span><span class="o">=</span><span class="s">username</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span>
          <span class="nv">request.form.username</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Password:
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">password</span> <span class="na">name</span><span class="o">=</span><span class="s">password</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">submit</span> <span class="na">value</span><span class="o">=</span><span class="s">Login</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h5>Всплывающие сообщения с категориями<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.3.</span></p>
</div>
<p>Всплывающему сообщению можно назначить категорию.  По умолчанию, если
категория не указана, используется категория <code class="docutils literal notranslate"><span class="pre">'message'</span></code> - сообщение.
Для более качественной обратной связи с пользователем можно указывать
другие категории.  Например, сообщения об ошибках должны отображаться
на красном фоне.</p>
<p>Для вывода всплывающего сообщения с другой категорией, просто передайте
её вторым аргументом функции <a class="reference internal" href="index.html#flask.flash" title="flask.flash"><code class="xref py py-func docutils literal notranslate"><span class="pre">flash()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flash</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Invalid password provided&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Внутри шаблона можно сообщить функции <a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_flashed_messages()</span></code></a>,
что нужно вернуть ещё и категорию.  В этом случае цикл выглядит несколько
иначе:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">with</span> <span class="nv">messages</span> <span class="o">=</span> <span class="nv">get_flashed_messages</span><span class="o">(</span><span class="nv">with_categories</span><span class="o">=</span><span class="kp">true</span><span class="o">)</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">messages</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">flashes</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">category</span><span class="o">,</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span>
      <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">category</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Это просто пример того, как можно отображать всплывающие сообщения.  Можно
использовать категорию для добавления к сообщению префикса, например,
<code class="docutils literal notranslate"><span class="pre">&lt;strong&gt;Ошибка:&lt;/strong&gt;</span></code>.</p>
</div>
<div class="section" id="id4">
<h5>Фильтрация всплывающих сообщений<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
<p>При желании можно передать список категорий, который будет использован
функцией <a class="reference internal" href="index.html#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_flashed_messages()</span></code></a> для фильтрации сообщений. Это
полезно в тех случаях, если нужно выводить сообщения каждой категории в
отдельном блоке.</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">with</span> <span class="nv">errors</span> <span class="o">=</span> <span class="nv">get_flashed_messages</span><span class="o">(</span><span class="nv">category_filter</span><span class="o">=[</span><span class="s2">&quot;error&quot;</span><span class="o">])</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">errors</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;alert-message block-message error&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;close&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span><span class="p">&gt;</span>×<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="cp">{%</span>- <span class="k">for</span> <span class="nv">msg</span> <span class="k">in</span> <span class="nv">errors</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">msg</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> -<span class="cp">%}</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="section" id="id5">
<h6>Примечания переводчика<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h6>
<p>В оригинале были «мигающие» или «вспыхивающие» сообщения, но я счёл
дословный перевод не вполне соответствующим истине - эти сообщения не
мигают и не вспыхивают.  Хотя они также и не всплывают, но это слово
показалось мне более удачным.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/patterns/flashing">Оригинал этой страницы</a></p>
</div>
</div>
</div>
<span id="document-patterns/errorpages"></span><div class="section" id="id1">
<h4>Собственные страницы ошибок<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Flask поставляется с удобной функцией <a class="reference internal" href="index.html#flask.abort" title="flask.abort"><code class="xref py py-func docutils literal notranslate"><span class="pre">abort()</span></code></a>, которая
досрочно прерывает запрос с кодом ошибки HTTP.  В комплекте с ней идёт
простая чёрно-белая страница ошибки с небольшим описанием, ничего особого.</p>
<p>В зависимости от кода ошибки, с разной степенью вероятности, пользователь
может увидеть эту страницу.</p>
<div class="section" id="id2">
<h5>Обычные коды ошибок<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>Чаще всего, даже если приложение работает правильно, пользователь может
увидеть следующие коды ошибок:</p>
<p><em>404 Не найдено</em></p>
<blockquote>
<div>Старое доброе сообщение «чувак, ты допустил ошибку при вводе URL».
Встречается настолько часто, что даже новички в интернете знают, что
означает 404: блин, тут нет того, что я искал.  Неплохо поместить на
этой странице что-то более полезное, хотя-бы ссылку на стартовую
страницу.</div></blockquote>
<dl class="docutils">
<dt><em>403 Доступ запрещён</em></dt>
<dd>Если на сайте есть какая-нибудь разновидность ограничения доступа,
может понадобиться отправить код 403 при попытке доступа к ресурсам,
доступ к которым запрещён.  Позволяет не потерять пользователя, который
попытался получить доступ к запрещённому ресурсу.</dd>
<dt><em>410 Удалено</em></dt>
<dd>Вы знаете, что у «404 Не найдено» есть брат по имени «410 Удалено»?
Мало кто делает так, что прежде существовавшие, но ныне удалённые
ресурсы отвечают ошибкой 410 вместо 404.  Если вы не удаляете документы
из базы данных навсегда, а просто помечаете их как удалённые, можно
сделать пользователю одолжение и воспользоваться кодом 410, а не
отображать сообщение о том, что искомое было удалено навечно.</dd>
<dt><em>500 Внутренняя ошибка сервера</em></dt>
<dd>Обычно происходит в случае ошибок в программе или при повышенной
нагрузке на сервер.  Ужасно хорошо было бы иметь на этот случай
приятную страницу, потому что рано или поздно в приложении может
случится сбой (см. также: <a class="reference internal" href="index.html#application-errors"><span class="std std-ref">Журналирование ошибок приложения</span></a>).</dd>
</dl>
</div>
<div class="section" id="id3">
<h5>Обработчики ошибок<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h5>
<p>Обработчик ошибок - это функция, похожая на функцию представления, только
она принимает возникающие ошибки.  Большинство ошибок - это ошибки типа
<a class="reference external" href="http://werkzeug.pocoo.org/docs/exceptions/#werkzeug.exceptions.HTTPException" title="(в Werkzeug v0.14-dev)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPException</span></code></a>, но это могут быть и другие
ошибки, потому что в обработчик внутренних ошибок сервера попадают все
остальные не перехваченные экземпляры исключений.</p>
<p>Обработчик ошибок регистрируется при помощи декоратора
<a class="reference internal" href="index.html#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a> с кодом ошибки.  Помните, что Flask не
устанавливает код ошибки за вас, поэтому удостоверьтесь, что возвращаете
в ответе код статуса HTTP.</p>
<p>Здесь приведён пример обработки исключения «404 Страница не найдена»:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">render_template</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;404.html&#39;</span><span class="p">),</span> <span class="mi">404</span>
</pre></div>
</div>
<p>Шаблон для этого примера может быть таким:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Page Not Found<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Page Not Found<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>What you were looking for is just not there.
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;index&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>go somewhere nice<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h5>Примечания переводчика<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>После прочтения перевода у вас может возникнуть недоумение - что за «чувак»
и «клёво»?  Я не стал бы добавлять в текст эти слова по собственной
инициативе - я просто попытался в меру своих скудных способностей
воспроизвести стиль оригинального текста.  В оригинале этим словам
соответствуют chap и nice.</p>
<p>Более подробный список кодов статуса HTTP можно увидеть здесь:
<a class="reference external" href="http://ru.wikipedia.org/wiki/Список_кодов_состояния_HTTP">Список кодов состояния HTTP</a>.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/patterns/errorpages/">Оригинал этой страницы</a></p>
</div>
</div>
</div>
<p><a class="reference external" href="http://flask.pocoo.org/docs/patterns/">Оригинал этой страницы</a></p>
</div>
<span id="document-deploying/index"></span><div class="section" id="deployment">
<span id="id1"></span><h3>Варианты развёртывания<a class="headerlink" href="#deployment" title="Ссылка на этот заголовок">¶</a></h3>
<p>В зависимости от того, что вы имеете в наличии, есть несколько
вариантов запуска приложений Flask. Во время разработки вы можете
использовать встроенный сервер, но для развёртывания приложений
для промышленного использования необходимо использовать вариант
полноценного развёртывания (не используйте в качестве «боевого»
встроенный сервер для разработки). Несколько вариантов развёртывания
документированы в данном разделе.</p>
<p>Если у вас другой WSGI сервер, чтобы понять, как с ним использовать
WSGI-приложения, читайте его документацию.  Просто не забывайте,
что фактически объект приложения <code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code> и есть
WSGI-приложение.</p>
<p>Для того, чтобы быстро взять и применить приведённые варианты,
читайте <a class="reference internal" href="index.html#quickstart-deployment"><span class="std std-ref">Развёртывание приложения на веб-сервере</span></a> в разделе Быстрый старт.</p>
<div class="toctree-wrapper compound">
<span id="document-deploying/mod_wsgi"></span><div class="section" id="mod-wsgi-apache-flask">
<span id="mod-wsgi-deployment"></span><h4>Настройка mod_wsgi (Apache) для Flask<a class="headerlink" href="#mod-wsgi-apache-flask" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если у вас веб-сервер <a class="reference external" href="http://httpd.apache.org/">Apache</a>, рекомендуется использовать <a class="reference external" href="http://code.google.com/p/modwsgi/">mod_wsgi</a>.</p>
<div class="admonition- admonition">
<p class="first admonition-title">Предварительная проверка</p>
<p class="last">Удостоверьтесь, что все вызовы <code class="docutils literal notranslate"><span class="pre">app.run()</span></code> в файле приложения
находятся внутри блока <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__':</span></code> или вынесены в
отдельный файл.  Просто убедитесь в отсутствии подобных вызовов,
потому что если вы решили воспользоваться mod_wsgi для запуска
приложения, то запускать локальный сервер WSGI не нужно.</p>
</div>
<div class="section" id="mod-wsgi">
<h5>Установка <cite>mod_wsgi</cite><a class="headerlink" href="#mod-wsgi" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если <cite>mod_wsgi</cite> ещё не установлен, его можно установить с помощью менеджера
пакетов или собрать самостоятельно.  В <a class="reference external" href="http://code.google.com/p/modwsgi/wiki/QuickInstallationGuide">инструкции по установке</a> mod_wsgi
описывается установка из исходных текстов в UNIX-системах.</p>
<p>Если вы используете Ubuntu/Debian, можно воспользоваться apt-get:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># apt-get install libapache2-mod-wsgi
</pre></div>
</div>
<p>На FreeBSD <cite>mod_wsgi</cite> можно установить сборкой из порта <cite>www/mod_wsgi</cite> или
при помощи pkg_add:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># pkg_add -r mod_wsgi
</pre></div>
</div>
<p>Если используется pkgsrc, можно установить <cite>mod_wsgi</cite>, собрав из пакета
<cite>www/ap2-wsgi</cite>.</p>
<p>Если случится ошибка сегментации дочернего процесса после первой
перезагрузки apache, можно спокойно проигнорировать её.  Просто
перезапустите сервер.</p>
</div>
<div class="section" id="wsgi">
<h5>Создание файла <cite>.wsgi</cite><a class="headerlink" href="#wsgi" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для запуска приложения нужен файл <cite>yourapplication.wsgi</cite>.  Этот файл
содержит код, выполняемый <cite>mod_wsgi</cite> для получения объекта приложения
Объект с именем <cite>application</cite> в этом файле будет использоваться в качестве
приложения.</p>
<p>Для большинства приложений будет достаточно такого файла:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span> <span class="k">as</span> <span class="n">application</span>
</pre></div>
</div>
<p>Если у вас нет фабричной функции для создания приложений, но есть
экземпляр-одиночка, можно просто импортировать его как <cite>application</cite>.</p>
<p>Сохраните этот файл где-нибудь, где сможете его найти (например, в
<cite>/var/www/yourapplication</cite>) и удостоверьтесь, что <cite>yourapplication</cite> и все
используемые им библиотеки находятся в списке путей загрузки python.  Если
вы не хотите делать его общедоступным для всей системы, воспользуйтесь
<a class="reference external" href="http://pypi.python.org/pypi/virtualenv">виртуальным экземпляром python</a>.  Помните, что при этом вам нужно будет
установить ваше приложение внутрь virtualenv.  Или можно отредактировать
переменную path внутри <cite>.wsgi</cite> перед импортом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;/path/to/the/application&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h5>Настройка Apache<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Наконец, нужно создать файл с настройками Apache для запуска приложения.
В следующем примере мы говорим <cite>mod_wsgi</cite> выполнить приложение от имени
отдельного пользователя в целях безопасности:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;VirtualHost</span> <span class="s">*</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> example.com

    <span class="nb">WSGIDaemonProcess</span> yourapplication <span class="k">user</span>=user1 <span class="k">group</span>=group1 threads=5
    <span class="nb">WSGIScriptAlias</span> / <span class="sx">/var/www/yourapplication/yourapplication.wsgi</span>

    <span class="nt">&lt;Directory</span> <span class="s">/var/www/yourapplication</span><span class="nt">&gt;</span>
        <span class="nb">WSGIProcessGroup</span> yourapplication
        <span class="nb">WSGIApplicationGroup</span> %{GLOBAL}
        <span class="nb">Order</span> deny,allow
        <span class="nb">Allow</span> from <span class="k">all</span>
    <span class="nt">&lt;/Directory&gt;</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>Замечание: WSGIDaemonProcess не реализован в Windows и Apache не запустится
с указанной выше конфигурацией.  В системе Windows эти строки нужно удалить:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;VirtualHost</span> <span class="s">*</span><span class="nt">&gt;</span>
        <span class="nb">ServerName</span> example.com
        <span class="nb">WSGIScriptAlias</span> / C:\yourdir\yourapp.wsgi
        <span class="nt">&lt;Directory</span> <span class="s">C:\yourdir</span><span class="nt">&gt;</span>
                <span class="nb">Order</span> deny,allow
                <span class="nb">Allow</span> from <span class="k">all</span>
        <span class="nt">&lt;/Directory&gt;</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</div>
<p>За более подробной информацией обратитесь к странице <a class="reference external" href="http://code.google.com/p/modwsgi/wiki/">mod_wsgi wiki</a>.</p>
</div>
<div class="section" id="id4">
<h5>Решение проблем<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h5>
<p>Если приложение не запускается, попробуйте следующие решения:</p>
<dl class="docutils">
<dt><strong>Проблема:</strong> приложение не запускается, в журнале ошибок появляется</dt>
<dd>сообщение SystemExit ignored
Произошёл вызов <code class="docutils literal notranslate"><span class="pre">app.run()</span></code> в файле вашего приложения, в котором не
было предохранительного условия <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__':</span></code>.  Либо
удалите из файла этот вызов <a class="reference internal" href="index.html#flask.Flask.run" title="flask.Flask.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a>, либо поместите
его в отдельный файл <cite>run.py</cite>, либо поместите его в подобный блок if.</dd>
<dt><strong>Проблема:</strong> приложение сообщает об ошибках доступа</dt>
<dd>Возможно это вызвано тем, что ваше приложение работает от неправильного
пользователя.  Проверьте, что каталоги, к которым необходим доступ из
приложения, имеют правильные разрешения, а приложение запущено от
правильного пользователя (параметры <code class="docutils literal notranslate"><span class="pre">user</span></code> и <code class="docutils literal notranslate"><span class="pre">group</span></code> в директиве
<cite>WSGIDaemonProcess</cite>).</dd>
<dt><strong>Проблема:</strong> приложение завершается с выводом сообщения об ошибке</dt>
<dd><p class="first">Помните, что mod_wsgi запрещает делать что-либо с <a class="reference external" href="https://docs.python.org/dev/library/sys.html#sys.stdout" title="(в Python v3.8)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stdout</span></code></a> и
<a class="reference external" href="https://docs.python.org/dev/library/sys.html#sys.stderr" title="(в Python v3.8)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stderr</span></code></a>.  Можно выключить эту защиту, прописав в
конфигурации следующую настройку:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">WSGIRestrictStdout</span> <span class="k">Off</span>
</pre></div>
</div>
<p>Или можно заменить стандартный вывод в файле .wsgi на другой поток:</p>
<blockquote class="last">
<div>import sys
sys.stdout = sys.stderr</div></blockquote>
</dd>
<dt><strong>Проблема:</strong> доступ к ресурсам приводит к ошибкам ввода-вывода</dt>
<dd><p class="first">Возможно ваше приложение является символической ссылкой на один из
файлов .py, находящихся в каталоге пакетов сайта.  Такой приём не
работает, поэтому удостоверьтесь, что поместили каталог в пути поиска
python или преобразуйте ваше приложение в пакет.</p>
<p class="last">Причина заключается в том, что имя файла модуля используется для
поиска ресурсов, а в случае символической ссылки будет использоваться
неправильное имя файла.</p>
</dd>
</dl>
</div>
<div class="section" id="id5">
<h5>Поддержка автоматической перезагрузки<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h5>
<p>Чтобы облегчить работу инструментов установки, можно включить поддержку
автоматической перезагрузки.  Когда файл <cite>.wsgi</cite> изменится, <cite>mod_wsgi</cite>
перезагрузит для нас все процессы демона.</p>
<p>Для этого просто добавьте следующие директивы в раздел <cite>Directory</cite>:</p>
<div class="highlight-apache notranslate"><div class="highlight"><pre><span></span><span class="nb">WSGIScriptReloading</span> <span class="k">On</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h5>Работа с виртуальными окружениями<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h5>
<p>Польза от виртуальных окружений заключается в том, что они позволяют не
устанавливать необходимые зависимости на уровне всей системы, что
позволяет достичь большего контроля над используемыми пакетами.  Если вы
решили воспользоваться виртуальным окружением совместно с mod_wsgi, нужно
слегка изменить файл <cite>.wsgi</cite>.</p>
<p>Добавьте следующие строки в начало файла <cite>.wsgi</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">activate_this</span> <span class="o">=</span> <span class="s1">&#39;/path/to/env/bin/activate_this.py&#39;</span>
<span class="n">execfile</span><span class="p">(</span><span class="n">activate_this</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="vm">__file__</span><span class="o">=</span><span class="n">activate_this</span><span class="p">))</span>
</pre></div>
</div>
<p>Эти строки настроят пути загрузки в соответствии с настройками
виртуального окружения.  Помните, что это должен быть абсолютный путь.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/deploying/mod_wsgi/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-deploying/fastcgi"></span><div class="section" id="fastcgi">
<span id="deploying-fastcgi"></span><h4>FastCGI<a class="headerlink" href="#fastcgi" title="Ссылка на этот заголовок">¶</a></h4>
<p>FastCGI - это один из вариантов развёртывания приложения на таких серверах,
как <a class="reference external" href="http://nginx.org/">nginx</a>, <a class="reference external" href="http://www.lighttpd.net/">lighttpd</a> и <a class="reference external" href="http://www.cherokee-project.com/">cherokee</a>; за описанием других опций обратитесь
к разделам <span class="xref std std-ref">deploying-uwsgi</span> и <span class="xref std std-ref">deploying-wsgi-standalone</span>.  Для
использования приложения WSGI с любым из этих серверов необходимо сначала
настроить сервер FastCGI.  Наиболее популярен <a class="reference external" href="http://trac.saddi.com/flup">flup</a>, который будет
использоваться в этом руководстве.  Убедитесь в том, что установили его,
Прежде чем продолжить чтение убедитесь, что он установлен.</p>
<div class="admonition- admonition">
<p class="first admonition-title">Предварительная проверка</p>
<p class="last">Удостоверьтесь, что вызовы <code class="docutils literal notranslate"><span class="pre">app.run()</span></code> в файле приложения находятся
внутри блока <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__':</span></code> или вынесены в отдельный
файл.  Просто убедитесь в отсутствии подобных вызовов, потому что если
вы решили воспользоваться FastCGI для запуска приложения, то запускать
локальный сервер WSGI не нужно.</p>
</div>
<div class="section" id="fcgi">
<h5>Создание файла <cite>.fcgi</cite><a class="headerlink" href="#fcgi" title="Ссылка на этот заголовок">¶</a></h5>
<p>Для начала нужно создать файл сервера FastCGI.  Давайте назовём его
<cite>yourapplication.fcgi</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">from</span> <span class="nn">flup.server.fcgi</span> <span class="k">import</span> <span class="n">WSGIServer</span>
<span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">WSGIServer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Этого достаточно для работы Apache, однако nginx и старые версии lighttpd
требуют явного указания сокетов для связи с сервером FastCGI.  Для этого
нужно передать путь к сокет-файлу в <code class="xref py py-class docutils literal notranslate"><span class="pre">WSGIServer</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WSGIServer</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">bindAddress</span><span class="o">=</span><span class="s1">&#39;/path/to/fcgi.sock&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Этот путь должен быть точно таким же, какой был указан в настройках
сервера.</p>
<p>Сохраните файл <cite>yourapplication.fcgi</cite> где-нибудь, где вы сможете потом
найти его.  Неплохо положить его в <cite>/var/www/yourapplication</cite> или в
какое-то другое подходящее место.</p>
<p>Убедитесь, что у этого файла установлен флаг выполнения, чтобы сервер
мог его выполнить:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># chmod +x /var/www/yourapplication/yourapplication.fcgi
</pre></div>
</div>
</div>
<div class="section" id="apache">
<h5>Настройка Apache<a class="headerlink" href="#apache" title="Ссылка на этот заголовок">¶</a></h5>
<p>Приведённый выше пример достаточно хорош для того, чтобы использовать его
при развёртывании с Apache, однако файл <cite>.fcgi</cite> будет встречаться в URL
приложения, например: example.com/yourapplication.fcgi/news/.  Есть
несколько способов настройки приложения для того, чтобы убрать
yourapplication.fcgi из URL.  Предпочтительный способ - это использование
для маршрутизации запросов серверу FastCGI директив конфигурации
ScriptAlias и SetHandler. Следующий пример использует FastCgiServer
для запуска 5 экземпляров приложения, которые будут обрабатывать все
входящие запросы:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LoadModule</span> <span class="n">fastcgi_module</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">mod_fastcgi</span><span class="o">.</span><span class="n">so</span>

<span class="n">FastCgiServer</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">yourapplication</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">fcgi</span> <span class="o">-</span><span class="n">idle</span><span class="o">-</span><span class="n">timeout</span> <span class="mi">300</span> <span class="o">-</span><span class="n">processes</span> <span class="mi">5</span>

<span class="o">&lt;</span><span class="n">VirtualHost</span> <span class="o">*&gt;</span>
    <span class="n">ServerName</span> <span class="n">webapp1</span><span class="o">.</span><span class="n">mydomain</span><span class="o">.</span><span class="n">com</span>
    <span class="n">DocumentRoot</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">yourapplication</span>

    <span class="n">AddHandler</span> <span class="n">fastcgi</span><span class="o">-</span><span class="n">script</span> <span class="n">fcgi</span>
    <span class="n">ScriptAlias</span> <span class="o">/</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">yourapplication</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">fcgi</span><span class="o">/</span>

    <span class="o">&lt;</span><span class="n">Location</span> <span class="o">/&gt;</span>
        <span class="n">SetHandler</span> <span class="n">fastcgi</span><span class="o">-</span><span class="n">script</span>
    <span class="o">&lt;/</span><span class="n">Location</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">VirtualHost</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Эти процессы будут управляться самим Apache.  Если вы используете
автономный сервер FastCGI, вы можете вместо этого использовать директиву
FastCgiExternalServer.  Заметим, что нижеуказанный путь не является
реальным, он используется просто как идентификатор для других директив,
таких, как as AliasMatch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FastCgiServer</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">yourapplication</span> <span class="o">-</span><span class="n">host</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">3000</span>
</pre></div>
</div>
<p>Если задать ScriptAlias нельзя, например, на веб-узле, настроенном для нескольких
пользователей, то можно воспользоваться промежуточным приложением WSGI для
удаления yourapplication.fcgi из URL. Настройте .htaccess:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;IfModule mod_fcgid.c&gt;
   AddHandler fcgid-script .fcgi
   &lt;Files ~ (\.fcgi)&gt;
       SetHandler fcgid-script
       Options +FollowSymLinks +ExecCGI
   &lt;/Files&gt;
&lt;/IfModule&gt;

&lt;IfModule mod_rewrite.c&gt;
   Options +FollowSymlinks
   RewriteEngine On
   RewriteBase /
   RewriteCond %{REQUEST_FILENAME} !-f
   RewriteRule ^(.*)$ yourapplication.fcgi/$1 [QSA,L]
&lt;/IfModule&gt;
</pre></div>
</div>
<p>Теперь настроим yourapplication.fcgi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1">#: optional path to your local python site-packages folder</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&lt;your_local_path&gt;/lib/python2.6/site-packages&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">flup.server.fcgi</span> <span class="k">import</span> <span class="n">WSGIServer</span>
<span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">app</span>

<span class="k">class</span> <span class="nc">ScriptNameStripper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>

   <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
       <span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SCRIPT_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">ScriptNameStripper</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">WSGIServer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="lighttpd">
<h5>Настройка lighttpd<a class="headerlink" href="#lighttpd" title="Ссылка на этот заголовок">¶</a></h5>
<p>Базовая настройка FastCGI для lighttpd выглядит следующим образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fastcgi</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;/yourapplication.fcgi&quot;</span> <span class="o">=&gt;</span>
    <span class="p">((</span>
        <span class="s2">&quot;socket&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/tmp/yourapplication-fcgi.sock&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bin-path&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/var/www/yourapplication/yourapplication.fcgi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;check-local&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;disable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max-procs&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
    <span class="p">))</span>
<span class="p">)</span>

<span class="n">alias</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;/static/&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/path/to/your/static&quot;</span>
<span class="p">)</span>

<span class="n">url</span><span class="o">.</span><span class="n">rewrite</span><span class="o">-</span><span class="n">once</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;^(/static($|/.*))$&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;$1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;^(/.*)$&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/yourapplication.fcgi$1&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Не забудьте включить модули FastCGI, alias и rewrite.  Эта настройка закрепит
приложение за <cite>/yourapplication</cite>.  Если нужно, чтобы приложение работало в
корне URL, понадобится обойти недоработку lighttpd при помощи промежуточного
приложения <code class="xref py py-class docutils literal notranslate"><span class="pre">LighttpdCGIRootFix</span></code>.</p>
<p>Убедитесь, что применяете его лишь в том случае, если подключили приложение
к корню URL.  А также, обратитесь к документации Lighttpd за более подробной
информацией сюда <a class="reference external" href="http://redmine.lighttpd.net/wiki/lighttpd/Docs:ModFastCGI">FastCGI and Python</a> (отметим, что
явная передача сокет-файла в run() больше не требуется).</p>
</div>
<div class="section" id="nginx">
<h5>Настройка nginx<a class="headerlink" href="#nginx" title="Ссылка на этот заголовок">¶</a></h5>
<p>Установка приложений FastCGI в nginx немного отличается, потому что по
умолчанию программе не передаются параметры FastCGI.</p>
<p>Базовая конфигурация FastCGI nginx для flask выглядит следующим образом:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>location = /yourapplication { rewrite ^ /yourapplication/ last; }
location /yourapplication { try_files $uri @yourapplication; }
location @yourapplication {
    include fastcgi_params;
    fastcgi_split_path_info ^(/yourapplication)(.*)$;
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_param SCRIPT_NAME $fastcgi_script_name;
    fastcgi_pass unix:/tmp/yourapplication-fcgi.sock;
}
</pre></div>
</div>
<p>Эта конфигурация привязывает приложение к <cite>/yourapplication</cite>.  Привязать
приложение к корню URL несколько проще, потому что не нужно думать о том,
какие значения использовать в <cite>PATH_INFO</cite> и <cite>SCRIPT_NAME</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>location / { try_files $uri @yourapplication; }
location @yourapplication {
    include fastcgi_params;
    fastcgi_param PATH_INFO $fastcgi_script_name;
    fastcgi_param SCRIPT_NAME &quot;&quot;;
    fastcgi_pass unix:/tmp/yourapplication-fcgi.sock;
}
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h5>Запуск процессов FastCGI<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h5>
<p>Поскольку Nginx и другие серверы не загружают приложения FastCGI, это нужно
сделать самостоятельно.  <a class="reference external" href="http://supervisord.org/configuration.html#fcgi-program-x-section-settings">Процессами FastCGI может управлять программа
Supervisor</a>.
Можно поискать другие диспетчеры процессов FastCGI или написать сценарий
для запуска файла <cite>.fcgi</cite> во время загрузки, например, с помощью сценария
SysV <code class="docutils literal notranslate"><span class="pre">init.d</span></code>.  В качестве временного решения может подойти запуск
сценария <cite>.fcgi</cite> из программы GNU screen.  Обратитесь к странице
руководства screen за более подробной информацией, однако стоит заметить,
что после перезагрузки системы запуск придётся повторять вручную:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ screen
$ /var/www/yourapplication/yourapplication.fcgi
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Отладка<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h5>
<p>На большинстве веб-серверов становится всё труднее отлаживать приложения
FastCGI.  Довольно часто единственное, о чём сообщают журналы сервера
- это о неожиданном окончании заголовков.  Для отладки приложения
единственное подходящее средство диагностики - это переключиться на
нужного пользователя и запустить приложение вручную.</p>
<p>В следующем примере предполагается, что приложение называется
<cite>application.fcgi</cite>, а веб-сервер работает от имени пользователя
<cite>www-data</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ su www-data
$ cd /var/www/yourapplication
$ python application.fcgi
Traceback (most recent call last):
  File &quot;yourapplication.fcgi&quot;, line 4, in &lt;module&gt;
ImportError: No module named yourapplication
</pre></div>
</div>
<p>In this case the error seems to be «yourapplication» not being on the
python path.  Common problems are:</p>
<ul class="simple">
<li>Relative paths being used.  Don’t rely on the current working directory</li>
<li>The code depending on environment variables that are not set by the
web server.</li>
<li>Different python interpreters being used.</li>
</ul>
<p>В данном случае ошибка вызвана тем, что «yourapplication» не найден в путях
поиска python.  Обычно это происходит по одной из следующих причин:</p>
<ul class="simple">
<li>Указаны относительные пути, которые не работают относительно текущего
каталога.</li>
<li>Выполнение программы зависит от переменных окружения, которые не заданы
для веб-сервера.</li>
<li>Используется интерпретатор python другой версии.</li>
</ul>
<div class="section" id="id5">
<h6>Примечания переводчика<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h6>
<p>В случае настройки Lighttpd не нужно писать никаких сценариев SysV <cite>init.d</cite>,
потому что:</p>
<ol class="arabic simple">
<li>Lighttpd может сам управлять FastCGI-процессами на локальном компьютере,
самостоятельно порождая необходимое их количество (с учётом настроенного
лимита),</li>
<li>в рамках проекта Lighttpd разрабатывается собственный диспетчер
процессов FastCGI - <cite>spawn-fcgi</cite>, который не настолько продвинут, чтобы
регулировать количество необходимых процессов, но по крайней мере
указанное количество процессов запустить и поддерживать сможет.</li>
</ol>
<p>Обычно <cite>spawn-fcgi</cite> применяется в тех случаях, когда приложение FastCGI
работает на отдельном от веб-сервера компьютере или нужно запустить
приложение от имени другого пользователя, например, для изоляции друг от
друга приложений разных пользователей, работающих на одном сервере.
Например, так: <a class="reference external" href="http://vladimir-stupin.blogspot.ru/2011/10/fastcgi-php.html">Настройка FastCGI и PHP с индивидуальными правами
пользователей</a>.</p>
<p>И, наконец, никто не мешает использовать spawn-fcgi совместно с nginx.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/deploying/fastcgi/">Оригинал этой страницы</a></p>
</div>
</div>
</div>
</div>
<p><a class="reference external" href="http://flask.pocoo.org/docs/deploying/">Оригинал этой страницы</a></p>
</div>
</div>
</div>
<div class="section" id="api">
<h2>Справка об API<a class="headerlink" href="#api" title="Ссылка на этот заголовок">¶</a></h2>
<p>Если Вы ищите информацию по конкретным функции, классу или мотоду,
эта часть документации для Вас.</p>
<div class="toctree-wrapper compound">
<span id="document-api"></span><div class="section" id="module-flask">
<span id="id1"></span><span id="api"></span><h3>API (перевод на начальной стадии)<a class="headerlink" href="#module-flask" title="Ссылка на этот заголовок">¶</a></h3>
<p>Эта часть документации содержит описание всех интерфейсов Flask.  В тех
местах, где Flask зависит от внешних библиотек, мы документируем самое
важное прямо здесь, а также снабжаем вас ссылкой на оригинальную
документацию.</p>
<div class="section" id="id2">
<h4>Объект приложения<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="class">
<dt id="flask.Flask">
<em class="property">class </em><code class="descclassname">flask.</code><code class="descname">Flask</code><span class="sig-paren">(</span><em>import_name</em>, <em>static_path=None</em>, <em>static_url_path=None</em>, <em>static_folder='static'</em>, <em>template_folder='templates'</em>, <em>instance_path=None</em>, <em>instance_relative_config=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask" title="Ссылка на это определение">¶</a></dt>
<dd><p>The flask object implements a WSGI application and acts as the central
object.  It is passed the name of the module or package of the
application.  Once it is created it will act as a central registry for
the view functions, the URL rules, template configuration and much more.</p>
<p>The name of the package is used to resolve resources from inside the
package or the folder the module is contained in depending on if the
package parameter resolves to an actual python package (a folder with
an <cite>__init__.py</cite> file inside) or a standard module (just a <cite>.py</cite> file).</p>
<p>For more information about resource loading, see <a class="reference internal" href="#flask.Flask.open_resource" title="flask.Flask.open_resource"><code class="xref py py-func docutils literal notranslate"><span class="pre">open_resource()</span></code></a>.</p>
<p>Usually you create a <a class="reference internal" href="#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> instance in your main module or
in the <cite>__init__.py</cite> file of your package like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-about-the-first-parameter admonition">
<p class="first admonition-title">About the First Parameter</p>
<p>The idea of the first parameter is to give Flask an idea what
belongs to your application.  This name is used to find resources
on the file system, can be used by extensions to improve debugging
information and a lot more.</p>
<p>So it’s important what you provide there.  If you are using a single
module, <cite>__name__</cite> is always the correct value.  If you however are
using a package, it’s usually recommended to hardcode the name of
your package there.</p>
<p>For example if your application is defined in <cite>yourapplication/app.py</cite>
you should create it with one of the two versions below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="s1">&#39;yourapplication&#39;</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p class="last">Why is that?  The application will work even with <cite>__name__</cite>, thanks
to how resources are looked up.  However it will make debugging more
painful.  Certain extensions can make assumptions based on the
import name of your application.  For example the Flask-SQLAlchemy
extension will look for the code in your application that triggered
an SQL query in debug mode.  If the import name is not properly set
up, that debugging information is lost.  (For example it would only
pick up SQL queries in <cite>yourapplication.app</cite> and not
<cite>yourapplication.views.frontend</cite>)</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7: </span>The <cite>static_url_path</cite>, <cite>static_folder</cite>, and <cite>template_folder</cite>
parameters were added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8: </span>The <cite>instance_path</cite> and <cite>instance_relative_config</cite> parameters were
added.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>import_name</strong> – the name of the application package</li>
<li><strong>static_url_path</strong> – can be used to specify a different path for the
static files on the web.  Defaults to the name
of the <cite>static_folder</cite> folder.</li>
<li><strong>static_folder</strong> – the folder with static files that should be served
at <cite>static_url_path</cite>.  Defaults to the <code class="docutils literal notranslate"><span class="pre">'static'</span></code>
folder in the root path of the application.</li>
<li><strong>template_folder</strong> – the folder that contains the templates that should
be used by the application.  Defaults to
<code class="docutils literal notranslate"><span class="pre">'templates'</span></code> folder in the root path of the
application.</li>
<li><strong>instance_path</strong> – An alternative instance path for the application.
By default the folder <code class="docutils literal notranslate"><span class="pre">'instance'</span></code> next to the
package or module is assumed to be the instance
path.</li>
<li><strong>instance_relative_config</strong> – if set to <cite>True</cite> relative filenames
for loading the config are assumed to
be relative to the instance path instead
of the application root.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="flask.Flask.add_template_filter">
<code class="descname">add_template_filter</code><span class="sig-paren">(</span><em>f</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.add_template_filter" title="Ссылка на это определение">¶</a></dt>
<dd><p>Register a custom template filter.  Works exactly like the
<a class="reference internal" href="#flask.Flask.template_filter" title="flask.Flask.template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">template_filter()</span></code></a> decorator.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the filter, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.add_template_global">
<code class="descname">add_template_global</code><span class="sig-paren">(</span><em>f</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.add_template_global" title="Ссылка на это определение">¶</a></dt>
<dd><p>Register a custom template global function. Works exactly like the
<a class="reference internal" href="#flask.Flask.template_global" title="flask.Flask.template_global"><code class="xref py py-meth docutils literal notranslate"><span class="pre">template_global()</span></code></a> decorator.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the global function, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.add_template_test">
<code class="descname">add_template_test</code><span class="sig-paren">(</span><em>f</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.add_template_test" title="Ссылка на это определение">¶</a></dt>
<dd><p>Register a custom template test.  Works exactly like the
<a class="reference internal" href="#flask.Flask.template_test" title="flask.Flask.template_test"><code class="xref py py-meth docutils literal notranslate"><span class="pre">template_test()</span></code></a> decorator.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the test, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.add_url_rule">
<code class="descname">add_url_rule</code><span class="sig-paren">(</span><em>rule</em>, <em>endpoint=None</em>, <em>view_func=None</em>, <em>**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.add_url_rule" title="Ссылка на это определение">¶</a></dt>
<dd><p>Connects a URL rule.  Works exactly like the <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a>
decorator.  If a view_func is provided it will be registered with the
endpoint.</p>
<p>Basically this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Is equivalent to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">pass</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
<p>If the view_func is not provided you will need to connect the endpoint
to a view function like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">view_functions</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
</pre></div>
</div>
<p>Internally <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> invokes <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a> so if you want
to customize the behavior via subclassing you only need to change
this method.</p>
<p>For more information refer to <a class="reference internal" href="#url-route-registrations"><span class="std std-ref">URL Route Registrations</span></a>.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.2: </span><cite>view_func</cite> parameter added.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.6: </span><cite>OPTIONS</cite> is added automatically as method.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>rule</strong> – the URL rule as string</li>
<li><strong>endpoint</strong> – the endpoint for the registered URL rule.  Flask
itself assumes the name of the view function as
endpoint</li>
<li><strong>view_func</strong> – the function to call when serving a request to the
provided endpoint</li>
<li><strong>options</strong> – the options to be forwarded to the underlying
<a class="reference external" href="http://werkzeug.pocoo.org/docs/routing/#werkzeug.routing.Rule" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rule</span></code></a> object.  A change
to Werkzeug is handling of method options.  methods
is a list of methods this rule should be limited
to (<cite>GET</cite>, <cite>POST</cite> etc.).  By default a rule
just listens for <cite>GET</cite> (and implicitly <cite>HEAD</cite>).
Starting with Flask 0.6, <cite>OPTIONS</cite> is implicitly
added and handled by the standard request handling.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.after_request">
<code class="descname">after_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.after_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Register a function to be run after each request.  Your function
must take one parameter, a <a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a> object and return
a new response object or the same (see <a class="reference internal" href="#flask.Flask.process_response" title="flask.Flask.process_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">process_response()</span></code></a>).</p>
<p>As of Flask 0.7 this function might not be executed at the end of the
request in case an unhandled exception occurred.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.after_request_funcs">
<code class="descname">after_request_funcs</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.after_request_funcs" title="Ссылка на это определение">¶</a></dt>
<dd><p>A dictionary with lists of functions that should be called after
each request.  The key of the dictionary is the name of the blueprint
this function is active for, <cite>None</cite> for all requests.  This can for
example be used to open database connections or getting hold of the
currently logged in user.  To register a function here, use the
<a class="reference internal" href="#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a> decorator.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.app_context">
<code class="descname">app_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.app_context" title="Ссылка на это определение">¶</a></dt>
<dd><p>Binds the application only.  For as long as the application is bound
to the current context the <a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.current_app</span></code></a> points to that
application.  An application context is automatically created when a
request context is pushed if necessary.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.app_ctx_globals_class">
<code class="descname">app_ctx_globals_class</code><a class="headerlink" href="#flask.Flask.app_ctx_globals_class" title="Ссылка на это определение">¶</a></dt>
<dd><p>псевдоним класса <code class="xref py py-class docutils literal notranslate"><span class="pre">flask.ctx._AppCtxGlobals</span></code></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.auto_find_instance_path">
<code class="descname">auto_find_instance_path</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.auto_find_instance_path" title="Ссылка на это определение">¶</a></dt>
<dd><p>Tries to locate the instance path if it was not provided to the
constructor of the application class.  It will basically calculate
the path to a folder named <code class="docutils literal notranslate"><span class="pre">instance</span></code> next to your main file or
the package.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.before_first_request">
<code class="descname">before_first_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.before_first_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Registers a function to be run before the first request to this
instance of the application.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.before_first_request_funcs">
<code class="descname">before_first_request_funcs</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.before_first_request_funcs" title="Ссылка на это определение">¶</a></dt>
<dd><p>A lists of functions that should be called at the beginning of the
first request to this instance.  To register a function here, use
the <a class="reference internal" href="#flask.Flask.before_first_request" title="flask.Flask.before_first_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_first_request()</span></code></a> decorator.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.before_request">
<code class="descname">before_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.before_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Registers a function to run before each request.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.before_request_funcs">
<code class="descname">before_request_funcs</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.before_request_funcs" title="Ссылка на это определение">¶</a></dt>
<dd><p>A dictionary with lists of functions that should be called at the
beginning of the request.  The key of the dictionary is the name of
the blueprint this function is active for, <cite>None</cite> for all requests.
This can for example be used to open database connections or
getting hold of the currently logged in user.  To register a
function here, use the <a class="reference internal" href="#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> decorator.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.blueprints">
<code class="descname">blueprints</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.blueprints" title="Ссылка на это определение">¶</a></dt>
<dd><p>all the attached blueprints in a dictionary by name.  Blueprints
can be attached multiple times so this dictionary does not tell
you how often they got attached.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.config">
<code class="descname">config</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.config" title="Ссылка на это определение">¶</a></dt>
<dd><p>The configuration dictionary as <a class="reference internal" href="#flask.Config" title="flask.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">Config</span></code></a>.  This behaves
exactly like a regular dictionary but supports additional methods
to load a config from files.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.context_processor">
<code class="descname">context_processor</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.context_processor" title="Ссылка на это определение">¶</a></dt>
<dd><p>Registers a template context processor function.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.create_global_jinja_loader">
<code class="descname">create_global_jinja_loader</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.create_global_jinja_loader" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates the loader for the Jinja2 environment.  Can be used to
override just the loader and keeping the rest unchanged.  It’s
discouraged to override this function.  Instead one should override
the <a class="reference internal" href="#flask.Flask.jinja_loader" title="flask.Flask.jinja_loader"><code class="xref py py-meth docutils literal notranslate"><span class="pre">jinja_loader()</span></code></a> function instead.</p>
<p>The global loader dispatches between the loaders of the application
and the individual blueprints.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.create_jinja_environment">
<code class="descname">create_jinja_environment</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.create_jinja_environment" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates the Jinja2 environment based on <a class="reference internal" href="#flask.Flask.jinja_options" title="flask.Flask.jinja_options"><code class="xref py py-attr docutils literal notranslate"><span class="pre">jinja_options</span></code></a>
and <a class="reference internal" href="#flask.Flask.select_jinja_autoescape" title="flask.Flask.select_jinja_autoescape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select_jinja_autoescape()</span></code></a>.  Since 0.7 this also adds
the Jinja2 globals and filters after initialization.  Override
this function to customize the behavior.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.create_url_adapter">
<code class="descname">create_url_adapter</code><span class="sig-paren">(</span><em>request</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.create_url_adapter" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates a URL adapter for the given request.  The URL adapter
is created at a point where the request context is not yet set up
so the request is passed explicitly.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.6.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.9: </span>This can now also be called without a request object when the
URL adapter is created for the application context.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.debug">
<code class="descname">debug</code><a class="headerlink" href="#flask.Flask.debug" title="Ссылка на это определение">¶</a></dt>
<dd><p>The debug flag.  Set this to <cite>True</cite> to enable debugging of the
application.  In debug mode the debugger will kick in when an unhandled
exception occurs and the integrated server will automatically reload
the application if changes in the code are detected.</p>
<p>This attribute can also be configured from the config with the <cite>DEBUG</cite>
configuration key.  Defaults to <cite>False</cite>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.debug_log_format">
<code class="descname">debug_log_format</code><em class="property"> = '--------------------------------------------------------------------------------\n%(levelname)s in %(module)s [%(pathname)s:%(lineno)d]:\n%(message)s\n--------------------------------------------------------------------------------'</em><a class="headerlink" href="#flask.Flask.debug_log_format" title="Ссылка на это определение">¶</a></dt>
<dd><p>The logging format used for the debug logger.  This is only used when
the application is in debug mode, otherwise the attached logging
handler does the formatting.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.3.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.default_config">
<code class="descname">default_config</code><em class="property"> = {'APPLICATION_ROOT': None, 'DEBUG': False, 'JSONIFY_PRETTYPRINT_REGULAR': True, 'JSON_AS_ASCII': True, 'JSON_SORT_KEYS': True, 'LOGGER_NAME': None, 'MAX_CONTENT_LENGTH': None, 'PERMANENT_SESSION_LIFETIME': datetime.timedelta(days=31), 'PREFERRED_URL_SCHEME': 'http', 'PRESERVE_CONTEXT_ON_EXCEPTION': None, 'PROPAGATE_EXCEPTIONS': None, 'SECRET_KEY': None, 'SEND_FILE_MAX_AGE_DEFAULT': 43200, 'SERVER_NAME': None, 'SESSION_COOKIE_DOMAIN': None, 'SESSION_COOKIE_HTTPONLY': True, 'SESSION_COOKIE_NAME': 'session', 'SESSION_COOKIE_PATH': None, 'SESSION_COOKIE_SECURE': False, 'TESTING': False, 'TRAP_BAD_REQUEST_ERRORS': False, 'TRAP_HTTP_EXCEPTIONS': False, 'USE_X_SENDFILE': False}</em><a class="headerlink" href="#flask.Flask.default_config" title="Ссылка на это определение">¶</a></dt>
<dd><p>Default configuration parameters.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.dispatch_request">
<code class="descname">dispatch_request</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.dispatch_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Does the request dispatching.  Matches the URL and returns the
return value of the view or error handler.  This does not have to
be a response object.  In order to convert the return value to a
proper response object, call <a class="reference internal" href="#flask.make_response" title="flask.make_response"><code class="xref py py-func docutils literal notranslate"><span class="pre">make_response()</span></code></a>.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.7: </span>This no longer does the exception handling, this code was
moved to the new <a class="reference internal" href="#flask.Flask.full_dispatch_request" title="flask.Flask.full_dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">full_dispatch_request()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.do_teardown_appcontext">
<code class="descname">do_teardown_appcontext</code><span class="sig-paren">(</span><em>exc=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.do_teardown_appcontext" title="Ссылка на это определение">¶</a></dt>
<dd><p>Called when an application context is popped.  This works pretty
much the same as <a class="reference internal" href="#flask.Flask.do_teardown_request" title="flask.Flask.do_teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">do_teardown_request()</span></code></a> but for the application
context.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.do_teardown_request">
<code class="descname">do_teardown_request</code><span class="sig-paren">(</span><em>exc=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.do_teardown_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Called after the actual request dispatching and will
call every as <a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> decorated function.  This is
not actually called by the <a class="reference internal" href="#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> object itself but is always
triggered when the request context is popped.  That way we have a
tighter control over certain resources under testing environments.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.9: </span>Added the <cite>exc</cite> argument.  Previously this was always using the
current exception information.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.enable_modules">
<code class="descname">enable_modules</code><em class="property"> = True</em><a class="headerlink" href="#flask.Flask.enable_modules" title="Ссылка на это определение">¶</a></dt>
<dd><p>Enable the deprecated module support?  This is active by default
in 0.7 but will be changed to False in 0.8.  With Flask 1.0 modules
will be removed in favor of Blueprints</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.endpoint">
<code class="descname">endpoint</code><span class="sig-paren">(</span><em>endpoint</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.endpoint" title="Ссылка на это определение">¶</a></dt>
<dd><p>A decorator to register a function as an endpoint.
Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">endpoint</span><span class="p">(</span><span class="s1">&#39;example.endpoint&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;example&quot;</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>endpoint</strong> – the name of the endpoint</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.error_handler_spec">
<code class="descname">error_handler_spec</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.error_handler_spec" title="Ссылка на это определение">¶</a></dt>
<dd><p>A dictionary of all registered error handlers.  The key is <cite>None</cite>
for error handlers active on the application, otherwise the key is
the name of the blueprint.  Each key points to another dictionary
where they key is the status code of the http exception.  The
special key <cite>None</cite> points to a list of tuples where the first item
is the class for the instance check and the second the error handler
function.</p>
<p>To register a error handler, use the <a class="reference internal" href="#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a>
decorator.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.errorhandler">
<code class="descname">errorhandler</code><span class="sig-paren">(</span><em>code_or_exception</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.errorhandler" title="Ссылка на это определение">¶</a></dt>
<dd><p>A decorator that is used to register a function give a given
error code.  Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;This page does not exist&#39;</span><span class="p">,</span> <span class="mi">404</span>
</pre></div>
</div>
<p>You can also register handlers for arbitrary exceptions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="n">DatabaseError</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">special_exception_handler</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;Database connection failed&#39;</span><span class="p">,</span> <span class="mi">500</span>
</pre></div>
</div>
<p>You can also register a function as error handler without using
the <a class="reference internal" href="#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a> decorator.  The following example is
equivalent to the one above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;This page does not exist&#39;</span><span class="p">,</span> <span class="mi">404</span>
<span class="n">app</span><span class="o">.</span><span class="n">error_handler_spec</span><span class="p">[</span><span class="kc">None</span><span class="p">][</span><span class="mi">404</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_not_found</span>
</pre></div>
</div>
<p>Setting error handlers via assignments to <a class="reference internal" href="#flask.Flask.error_handler_spec" title="flask.Flask.error_handler_spec"><code class="xref py py-attr docutils literal notranslate"><span class="pre">error_handler_spec</span></code></a>
however is discouraged as it requires fiddling with nested dictionaries
and the special case for arbitrary exception types.</p>
<p>The first <cite>None</cite> refers to the active blueprint.  If the error
handler should be application wide <cite>None</cite> shall be used.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7: </span>One can now additionally also register custom exception types
that do not necessarily have to be a subclass of the
<a class="reference external" href="http://werkzeug.pocoo.org/docs/exceptions/#werkzeug.exceptions.HTTPException" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPException</span></code></a> class.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>code</strong> – the code as integer for the handler</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.extensions">
<code class="descname">extensions</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.extensions" title="Ссылка на это определение">¶</a></dt>
<dd><p>a place where extensions can store application specific state.  For
example this is where an extension could store database engines and
similar things.  For backwards compatibility extensions should register
themselves like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s1">&#39;extensions&#39;</span><span class="p">):</span>
    <span class="n">app</span><span class="o">.</span><span class="n">extensions</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">app</span><span class="o">.</span><span class="n">extensions</span><span class="p">[</span><span class="s1">&#39;extensionname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SomeObject</span><span class="p">()</span>
</pre></div>
</div>
<p>The key must match the name of the <cite>flaskext</cite> module.  For example in
case of a «Flask-Foo» extension in <cite>flaskext.foo</cite>, the key would be
<code class="docutils literal notranslate"><span class="pre">'foo'</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.full_dispatch_request">
<code class="descname">full_dispatch_request</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.full_dispatch_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Dispatches the request and on top of that performs request
pre and postprocessing as well as HTTP exception catching and
error handling.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.get_send_file_max_age">
<code class="descname">get_send_file_max_age</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.get_send_file_max_age" title="Ссылка на это определение">¶</a></dt>
<dd><p>Provides default cache_timeout for the <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> functions.</p>
<p>By default, this function returns <code class="docutils literal notranslate"><span class="pre">SEND_FILE_MAX_AGE_DEFAULT</span></code> from
the configuration of <a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a>.</p>
<p>Static file functions such as <a class="reference internal" href="#flask.send_from_directory" title="flask.send_from_directory"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_from_directory()</span></code></a> use this
function, and <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> calls this function on
<a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> when the given cache_timeout is <cite>None</cite>. If a
cache_timeout is given in <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>, that timeout is used;
otherwise, this method is called.</p>
<p>This allows subclasses to change the behavior when sending files based
on the filename.  For example, to set the cache timeout for .js files
to 60 seconds:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyFlask</span><span class="p">(</span><span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_send_file_max_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.js&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">60</span>
        <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="o">.</span><span class="n">get_send_file_max_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.got_first_request">
<code class="descname">got_first_request</code><a class="headerlink" href="#flask.Flask.got_first_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>This attribute is set to <cite>True</cite> if the application started
handling the first request.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.handle_exception">
<code class="descname">handle_exception</code><span class="sig-paren">(</span><em>e</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.handle_exception" title="Ссылка на это определение">¶</a></dt>
<dd><p>Default exception handling that kicks in when an exception
occurs that is not caught.  In debug mode the exception will
be re-raised immediately, otherwise it is logged and the handler
for a 500 internal server error is used.  If no such handler
exists, a default 500 internal server error message is displayed.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.handle_http_exception">
<code class="descname">handle_http_exception</code><span class="sig-paren">(</span><em>e</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.handle_http_exception" title="Ссылка на это определение">¶</a></dt>
<dd><p>Handles an HTTP exception.  By default this will invoke the
registered error handlers and fall back to returning the
exception as response.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.3.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.handle_url_build_error">
<code class="descname">handle_url_build_error</code><span class="sig-paren">(</span><em>error</em>, <em>endpoint</em>, <em>values</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.handle_url_build_error" title="Ссылка на это определение">¶</a></dt>
<dd><p>Handle <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildError</span></code> on <a class="reference internal" href="#flask.url_for" title="flask.url_for"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_for()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.handle_user_exception">
<code class="descname">handle_user_exception</code><span class="sig-paren">(</span><em>e</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.handle_user_exception" title="Ссылка на это определение">¶</a></dt>
<dd><p>This method is called whenever an exception occurs that should be
handled.  A special case are
<code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPException</span></code>s which are forwarded by
this function to the <a class="reference internal" href="#flask.Flask.handle_http_exception" title="flask.Flask.handle_http_exception"><code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_http_exception()</span></code></a> method.  This
function will either return a response value or reraise the
exception with the same traceback.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.has_static_folder">
<code class="descname">has_static_folder</code><a class="headerlink" href="#flask.Flask.has_static_folder" title="Ссылка на это определение">¶</a></dt>
<dd><p>This is <cite>True</cite> if the package bound object’s container has a
folder named <code class="docutils literal notranslate"><span class="pre">'static'</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.init_jinja_globals">
<code class="descname">init_jinja_globals</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.init_jinja_globals" title="Ссылка на это определение">¶</a></dt>
<dd><p>Deprecated.  Used to initialize the Jinja2 globals.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.7: </span>This method is deprecated with 0.7.  Override
<a class="reference internal" href="#flask.Flask.create_jinja_environment" title="flask.Flask.create_jinja_environment"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_jinja_environment()</span></code></a> instead.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.inject_url_defaults">
<code class="descname">inject_url_defaults</code><span class="sig-paren">(</span><em>endpoint</em>, <em>values</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.inject_url_defaults" title="Ссылка на это определение">¶</a></dt>
<dd><p>Injects the URL defaults for the given endpoint directly into
the values dictionary passed.  This is used internally and
automatically called on URL building.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.instance_path">
<code class="descname">instance_path</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.instance_path" title="Ссылка на это определение">¶</a></dt>
<dd><p>Holds the path to the instance folder.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.jinja_env">
<code class="descname">jinja_env</code><a class="headerlink" href="#flask.Flask.jinja_env" title="Ссылка на это определение">¶</a></dt>
<dd><p>The Jinja2 environment used to load templates.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.jinja_loader">
<code class="descname">jinja_loader</code><a class="headerlink" href="#flask.Flask.jinja_loader" title="Ссылка на это определение">¶</a></dt>
<dd><p>The Jinja loader for this package bound object.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.jinja_options">
<code class="descname">jinja_options</code><em class="property"> = {'extensions': ['jinja2.ext.autoescape', 'jinja2.ext.with_']}</em><a class="headerlink" href="#flask.Flask.jinja_options" title="Ссылка на это определение">¶</a></dt>
<dd><p>Options that are passed directly to the Jinja2 environment.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.json_decoder">
<code class="descname">json_decoder</code><a class="headerlink" href="#flask.Flask.json_decoder" title="Ссылка на это определение">¶</a></dt>
<dd><p>псевдоним класса <a class="reference internal" href="#flask.json.JSONDecoder" title="flask.json.JSONDecoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.json.JSONDecoder</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.json_encoder">
<code class="descname">json_encoder</code><a class="headerlink" href="#flask.Flask.json_encoder" title="Ссылка на это определение">¶</a></dt>
<dd><p>псевдоним класса <a class="reference internal" href="#flask.json.JSONEncoder" title="flask.json.JSONEncoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">flask.json.JSONEncoder</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.log_exception">
<code class="descname">log_exception</code><span class="sig-paren">(</span><em>exc_info</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.log_exception" title="Ссылка на это определение">¶</a></dt>
<dd><p>Logs an exception.  This is called by <a class="reference internal" href="#flask.Flask.handle_exception" title="flask.Flask.handle_exception"><code class="xref py py-meth docutils literal notranslate"><span class="pre">handle_exception()</span></code></a>
if debugging is disabled and right before the handler is called.
The default implementation logs the exception as error on the
<a class="reference internal" href="#flask.Flask.logger" title="flask.Flask.logger"><code class="xref py py-attr docutils literal notranslate"><span class="pre">logger</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.logger">
<code class="descname">logger</code><a class="headerlink" href="#flask.Flask.logger" title="Ссылка на это определение">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/dev/library/logging.html#logging.Logger" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">logging.Logger</span></code></a> object for this application.  The
default configuration is to log to stderr if the application is
in debug mode.  This logger can be used to (surprise) log messages.
Here some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;A value for debugging&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;A warning occurred (</span><span class="si">%d</span><span class="s1"> apples)&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;An error occurred&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.3.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.logger_name">
<code class="descname">logger_name</code><a class="headerlink" href="#flask.Flask.logger_name" title="Ссылка на это определение">¶</a></dt>
<dd><p>The name of the logger to use.  By default the logger name is the
package name passed to the constructor.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.4.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.make_config">
<code class="descname">make_config</code><span class="sig-paren">(</span><em>instance_relative=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.make_config" title="Ссылка на это определение">¶</a></dt>
<dd><p>Used to create the config attribute by the Flask constructor.
The <cite>instance_relative</cite> parameter is passed in from the constructor
of Flask (there named <cite>instance_relative_config</cite>) and indicates if
the config should be relative to the instance path or the root path
of the application.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.make_default_options_response">
<code class="descname">make_default_options_response</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.make_default_options_response" title="Ссылка на это определение">¶</a></dt>
<dd><p>This method is called to create the default <cite>OPTIONS</cite> response.
This can be changed through subclassing to change the default
behavior of <cite>OPTIONS</cite> responses.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.make_null_session">
<code class="descname">make_null_session</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.make_null_session" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates a new instance of a missing session.  Instead of overriding
this method we recommend replacing the <a class="reference internal" href="#flask.Flask.session_interface" title="flask.Flask.session_interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">session_interface</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.make_response">
<code class="descname">make_response</code><span class="sig-paren">(</span><em>rv</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.make_response" title="Ссылка на это определение">¶</a></dt>
<dd><p>Converts the return value from a view function to a real
response object that is an instance of <a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a>.</p>
<p>The following types are allowed for <cite>rv</cite>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a></td>
<td>the object is returned unchanged</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://docs.python.org/dev/library/stdtypes.html#str" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></td>
<td>a response object is created with the
string as body</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">unicode</span></code></td>
<td>a response object is created with the
string encoded to utf-8 as body</td>
</tr>
<tr class="row-even"><td>a WSGI function</td>
<td>the function is called as WSGI application
and buffered as response object</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://docs.python.org/dev/library/stdtypes.html#tuple" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a></td>
<td>A tuple in the form <code class="docutils literal notranslate"><span class="pre">(response,</span> <span class="pre">status,</span>
<span class="pre">headers)</span></code> where <cite>response</cite> is any of the
types defined here, <cite>status</cite> is a string
or an integer and <cite>headers</cite> is a list of
a dictionary with header values.</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>rv</strong> – the return value from the view function</td>
</tr>
</tbody>
</table>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.9: </span>Previously a tuple was interpreted as the arguments for the
response object.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.name">
<code class="descname">name</code><a class="headerlink" href="#flask.Flask.name" title="Ссылка на это определение">¶</a></dt>
<dd><p>The name of the application.  This is usually the import name
with the difference that it’s guessed from the run file if the
import name is main.  This name is used as a display name when
Flask needs the name of the application.  It can be set and overridden
to change the value.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.open_instance_resource">
<code class="descname">open_instance_resource</code><span class="sig-paren">(</span><em>resource</em>, <em>mode='rb'</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.open_instance_resource" title="Ссылка на это определение">¶</a></dt>
<dd><p>Opens a resource from the application’s instance folder
(<a class="reference internal" href="#flask.Flask.instance_path" title="flask.Flask.instance_path"><code class="xref py py-attr docutils literal notranslate"><span class="pre">instance_path</span></code></a>).  Otherwise works like
<a class="reference internal" href="#flask.Flask.open_resource" title="flask.Flask.open_resource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_resource()</span></code></a>.  Instance resources can also be opened for
writing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>resource</strong> – the name of the resource.  To access resources within
subfolders use forward slashes as separator.</li>
<li><strong>mode</strong> – resource file opening mode, default is „rb“.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.open_resource">
<code class="descname">open_resource</code><span class="sig-paren">(</span><em>resource</em>, <em>mode='rb'</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.open_resource" title="Ссылка на это определение">¶</a></dt>
<dd><p>Opens a resource from the application’s resource folder.  To see
how this works, consider the following folder structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">myapplication</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">schema</span><span class="o">.</span><span class="n">sql</span>
<span class="o">/</span><span class="n">static</span>
    <span class="o">/</span><span class="n">style</span><span class="o">.</span><span class="n">css</span>
<span class="o">/</span><span class="n">templates</span>
    <span class="o">/</span><span class="n">layout</span><span class="o">.</span><span class="n">html</span>
    <span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>If you want to open the <cite>schema.sql</cite> file you would do the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;schema.sql&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>resource</strong> – the name of the resource.  To access resources within
subfolders use forward slashes as separator.</li>
<li><strong>mode</strong> – resource file opening mode, default is „rb“.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.open_session">
<code class="descname">open_session</code><span class="sig-paren">(</span><em>request</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.open_session" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates or opens a new session.  Default implementation stores all
session data in a signed cookie.  This requires that the
<a class="reference internal" href="#flask.Flask.secret_key" title="flask.Flask.secret_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">secret_key</span></code></a> is set.  Instead of overriding this method
we recommend replacing the <a class="reference internal" href="#flask.Flask.session_interface" title="flask.Flask.session_interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">session_interface</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>request</strong> – an instance of <a class="reference internal" href="#flask.Flask.request_class" title="flask.Flask.request_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request_class</span></code></a>.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.permanent_session_lifetime">
<code class="descname">permanent_session_lifetime</code><a class="headerlink" href="#flask.Flask.permanent_session_lifetime" title="Ссылка на это определение">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/dev/library/datetime.html#datetime.timedelta" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">timedelta</span></code></a> which is used to set the expiration
date of a permanent session.  The default is 31 days which makes a
permanent session survive for roughly one month.</p>
<p>This attribute can also be configured from the config with the
<cite>PERMANENT_SESSION_LIFETIME</cite> configuration key.  Defaults to
<code class="docutils literal notranslate"><span class="pre">timedelta(days=31)</span></code></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.preprocess_request">
<code class="descname">preprocess_request</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.preprocess_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Called before the actual request dispatching and will
call every as <a class="reference internal" href="#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> decorated function.
If any of these function returns a value it’s handled as
if it was the return value from the view and further
request handling is stopped.</p>
<p>This also triggers the <code class="xref py py-meth docutils literal notranslate"><span class="pre">url_value_processor()</span></code> functions before
the actual <a class="reference internal" href="#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">before_request()</span></code></a> functions are called.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.preserve_context_on_exception">
<code class="descname">preserve_context_on_exception</code><a class="headerlink" href="#flask.Flask.preserve_context_on_exception" title="Ссылка на это определение">¶</a></dt>
<dd><p>Returns the value of the <cite>PRESERVE_CONTEXT_ON_EXCEPTION</cite>
configuration value in case it’s set, otherwise a sensible default
is returned.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.process_response">
<code class="descname">process_response</code><span class="sig-paren">(</span><em>response</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.process_response" title="Ссылка на это определение">¶</a></dt>
<dd><p>Can be overridden in order to modify the response object
before it’s sent to the WSGI server.  By default this will
call all the <a class="reference internal" href="#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a> decorated functions.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.5: </span>As of Flask 0.5 the functions registered for after request
execution are called in reverse order of registration.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>response</strong> – a <a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a> object.</td>
</tr>
<tr class="field-even field"><th class="field-name">Результат:</th><td class="field-body">a new response object or the same, has to be an
instance of <a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a>.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.propagate_exceptions">
<code class="descname">propagate_exceptions</code><a class="headerlink" href="#flask.Flask.propagate_exceptions" title="Ссылка на это определение">¶</a></dt>
<dd><p>Returns the value of the <cite>PROPAGATE_EXCEPTIONS</cite> configuration
value in case it’s set, otherwise a sensible default is returned.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.register_blueprint">
<code class="descname">register_blueprint</code><span class="sig-paren">(</span><em>blueprint</em>, <em>**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.register_blueprint" title="Ссылка на это определение">¶</a></dt>
<dd><p>Registers a blueprint on the application.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.register_error_handler">
<code class="descname">register_error_handler</code><span class="sig-paren">(</span><em>code_or_exception</em>, <em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.register_error_handler" title="Ссылка на это определение">¶</a></dt>
<dd><p>Alternative error attach function to the <a class="reference internal" href="#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a>
decorator that is more straightforward to use for non decorator
usage.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.register_module">
<code class="descname">register_module</code><span class="sig-paren">(</span><em>module</em>, <em>**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.register_module" title="Ссылка на это определение">¶</a></dt>
<dd><p>Registers a module with this application.  The keyword argument
of this function are the same as the ones for the constructor of the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code> class and will override the values of the module if
provided.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.7: </span>The module system was deprecated in favor for the blueprint
system.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.request_class">
<code class="descname">request_class</code><a class="headerlink" href="#flask.Flask.request_class" title="Ссылка на это определение">¶</a></dt>
<dd><p>псевдоним класса <code class="xref py py-class docutils literal notranslate"><span class="pre">flask.wrappers.Request</span></code></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.request_context">
<code class="descname">request_context</code><span class="sig-paren">(</span><em>environ</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.request_context" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates a <a class="reference internal" href="#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> from the given
environment and binds it to the current context.  This must be used in
combination with the <cite>with</cite> statement because the request is only bound
to the current context for the duration of the <cite>with</cite> block.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">environ</span><span class="p">):</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
<p>The object returned can also be used without the <cite>with</cite> statement
which is useful for working in the shell.  The example above is
doing exactly the same as this code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">request_context</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.3: </span>Added support for non-with statement usage and <cite>with</cite> statement
is now passed the ctx object.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>environ</strong> – a WSGI environment</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.response_class">
<code class="descname">response_class</code><a class="headerlink" href="#flask.Flask.response_class" title="Ссылка на это определение">¶</a></dt>
<dd><p>псевдоним класса <code class="xref py py-class docutils literal notranslate"><span class="pre">flask.wrappers.Response</span></code></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.route">
<code class="descname">route</code><span class="sig-paren">(</span><em>rule</em>, <em>**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.route" title="Ссылка на это определение">¶</a></dt>
<dd><p>A decorator that is used to register a view function for a
given URL rule.  This does the same thing as <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a>
but is intended for decorator usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World&#39;</span>
</pre></div>
</div>
<p>For more information refer to <a class="reference internal" href="#url-route-registrations"><span class="std std-ref">URL Route Registrations</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>rule</strong> – the URL rule as string</li>
<li><strong>endpoint</strong> – the endpoint for the registered URL rule.  Flask
itself assumes the name of the view function as
endpoint</li>
<li><strong>options</strong> – the options to be forwarded to the underlying
<a class="reference external" href="http://werkzeug.pocoo.org/docs/routing/#werkzeug.routing.Rule" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rule</span></code></a> object.  A change
to Werkzeug is handling of method options.  methods
is a list of methods this rule should be limited
to (<cite>GET</cite>, <cite>POST</cite> etc.).  By default a rule
just listens for <cite>GET</cite> (and implicitly <cite>HEAD</cite>).
Starting with Flask 0.6, <cite>OPTIONS</cite> is implicitly
added and handled by the standard request handling.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>host=None</em>, <em>port=None</em>, <em>debug=None</em>, <em>**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.run" title="Ссылка на это определение">¶</a></dt>
<dd><p>Runs the application on a local development server.  If the
<a class="reference internal" href="#flask.Flask.debug" title="flask.Flask.debug"><code class="xref py py-attr docutils literal notranslate"><span class="pre">debug</span></code></a> flag is set the server will automatically reload
for code changes and show a debugger in case an exception happened.</p>
<p>If you want to run the application in debug mode, but disable the
code execution on the interactive debugger, you can pass
<code class="docutils literal notranslate"><span class="pre">use_evalex=False</span></code> as parameter.  This will keep the debugger’s
traceback screen active, but disable code execution.</p>
<div class="admonition-keep-in-mind admonition">
<p class="first admonition-title">Keep in Mind</p>
<p class="last">Flask will suppress any server error with a generic error page
unless it is in debug mode.  As such to enable just the
interactive debugger without the code reloading, you have to
invoke <a class="reference internal" href="#flask.Flask.run" title="flask.Flask.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a> with <code class="docutils literal notranslate"><span class="pre">debug=True</span></code> and <code class="docutils literal notranslate"><span class="pre">use_reloader=False</span></code>.
Setting <code class="docutils literal notranslate"><span class="pre">use_debugger</span></code> to <cite>True</cite> without being in debug mode
won’t catch any exceptions because there won’t be any to
catch.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.10: </span>The default port is now picked from the <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> variable.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>host</strong> – the hostname to listen on. Set this to <code class="docutils literal notranslate"><span class="pre">'0.0.0.0'</span></code> to
have the server available externally as well. Defaults to
<code class="docutils literal notranslate"><span class="pre">'127.0.0.1'</span></code>.</li>
<li><strong>port</strong> – the port of the webserver. Defaults to <code class="docutils literal notranslate"><span class="pre">5000</span></code> or the
port defined in the <code class="docutils literal notranslate"><span class="pre">SERVER_NAME</span></code> config variable if
present.</li>
<li><strong>debug</strong> – if given, enable or disable debug mode.
See <a class="reference internal" href="#flask.Flask.debug" title="flask.Flask.debug"><code class="xref py py-attr docutils literal notranslate"><span class="pre">debug</span></code></a>.</li>
<li><strong>options</strong> – the options to be forwarded to the underlying
Werkzeug server.  See
<a class="reference external" href="http://werkzeug.pocoo.org/docs/serving/#werkzeug.serving.run_simple" title="(в Werkzeug v0.14-dev)"><code class="xref py py-func docutils literal notranslate"><span class="pre">werkzeug.serving.run_simple()</span></code></a> for more
information.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.save_session">
<code class="descname">save_session</code><span class="sig-paren">(</span><em>session</em>, <em>response</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.save_session" title="Ссылка на это определение">¶</a></dt>
<dd><p>Saves the session if it needs updates.  For the default
implementation, check <a class="reference internal" href="#flask.Flask.open_session" title="flask.Flask.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a>.  Instead of overriding this
method we recommend replacing the <a class="reference internal" href="#flask.Flask.session_interface" title="flask.Flask.session_interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">session_interface</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>session</strong> – the session to be saved (a
<a class="reference external" href="http://werkzeug.pocoo.org/docs/contrib/securecookie/#werkzeug.contrib.securecookie.SecureCookie" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecureCookie</span></code></a>
object)</li>
<li><strong>response</strong> – an instance of <a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.secret_key">
<code class="descname">secret_key</code><a class="headerlink" href="#flask.Flask.secret_key" title="Ссылка на это определение">¶</a></dt>
<dd><p>If a secret key is set, cryptographic components can use this to
sign cookies and other things.  Set this to a complex random value
when you want to use the secure cookie for instance.</p>
<p>This attribute can also be configured from the config with the
<cite>SECRET_KEY</cite> configuration key.  Defaults to <cite>None</cite>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.select_jinja_autoescape">
<code class="descname">select_jinja_autoescape</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.select_jinja_autoescape" title="Ссылка на это определение">¶</a></dt>
<dd><p>Returns <cite>True</cite> if autoescaping should be active for the given
template name.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.send_static_file">
<code class="descname">send_static_file</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.send_static_file" title="Ссылка на это определение">¶</a></dt>
<dd><p>Function used internally to send static files from the static
folder to the browser.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.session_cookie_name">
<code class="descname">session_cookie_name</code><a class="headerlink" href="#flask.Flask.session_cookie_name" title="Ссылка на это определение">¶</a></dt>
<dd><p>The secure cookie uses this for the name of the session cookie.</p>
<p>This attribute can also be configured from the config with the
<cite>SESSION_COOKIE_NAME</cite> configuration key.  Defaults to <code class="docutils literal notranslate"><span class="pre">'session'</span></code></p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.session_interface">
<code class="descname">session_interface</code><em class="property"> = &lt;flask.sessions.SecureCookieSessionInterface object&gt;</em><a class="headerlink" href="#flask.Flask.session_interface" title="Ссылка на это определение">¶</a></dt>
<dd><p>the session interface to use.  By default an instance of
<a class="reference internal" href="#flask.sessions.SecureCookieSessionInterface" title="flask.sessions.SecureCookieSessionInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecureCookieSessionInterface</span></code></a> is used here.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.should_ignore_error">
<code class="descname">should_ignore_error</code><span class="sig-paren">(</span><em>error</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.should_ignore_error" title="Ссылка на это определение">¶</a></dt>
<dd><p>This is called to figure out if an error should be ignored
or not as far as the teardown system is concerned.  If this
function returns <cite>True</cite> then the teardown handlers will not be
passed the error.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.teardown_appcontext">
<code class="descname">teardown_appcontext</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.teardown_appcontext" title="Ссылка на это определение">¶</a></dt>
<dd><p>Registers a function to be called when the application context
ends.  These functions are typically also called when the request
context is popped.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">()</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<span class="o">...</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">ctx.pop()</span></code> is executed in the above example, the teardown
functions are called just before the app context moves from the
stack of active contexts.  This becomes relevant if you are using
such constructs in tests.</p>
<p>Since a request context typically also manages an application
context it would also be called when you pop a request context.</p>
<p>When a teardown function was called because of an exception it will
be passed an error object.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.teardown_appcontext_funcs">
<code class="descname">teardown_appcontext_funcs</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.teardown_appcontext_funcs" title="Ссылка на это определение">¶</a></dt>
<dd><p>A list of functions that are called when the application context
is destroyed.  Since the application context is also torn down
if the request ends this is the place to store code that disconnects
from databases.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.teardown_request">
<code class="descname">teardown_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.teardown_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Register a function to be run at the end of each request,
regardless of whether there was an exception or not.  These functions
are executed when the request context is popped, even if not an
actual request was performed.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctx</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">()</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<span class="o">...</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">ctx.pop()</span></code> is executed in the above example, the teardown
functions are called just before the request context moves from the
stack of active contexts.  This becomes relevant if you are using
such constructs in tests.</p>
<p>Generally teardown functions must take every necessary step to avoid
that they will fail.  If they do execute code that might fail they
will have to surround the execution of these code by try/except
statements and log occurring errors.</p>
<p>When a teardown function was called because of a exception it will
be passed an error object.</p>
<div class="admonition-debug-note admonition">
<p class="first admonition-title">Debug Note</p>
<p class="last">In debug mode Flask will not tear down a request on an exception
immediately.  Instead if will keep it alive so that the interactive
debugger can still access it.  This behavior can be controlled
by the <code class="docutils literal notranslate"><span class="pre">PRESERVE_CONTEXT_ON_EXCEPTION</span></code> configuration variable.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.teardown_request_funcs">
<code class="descname">teardown_request_funcs</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.teardown_request_funcs" title="Ссылка на это определение">¶</a></dt>
<dd><p>A dictionary with lists of functions that are called after
each request, even if an exception has occurred. The key of the
dictionary is the name of the blueprint this function is active for,
<cite>None</cite> for all requests. These functions are not allowed to modify
the request, and their return values are ignored. If an exception
occurred while processing the request, it gets passed to each
teardown_request function. To register a function here, use the
<a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> decorator.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.template_context_processors">
<code class="descname">template_context_processors</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.template_context_processors" title="Ссылка на это определение">¶</a></dt>
<dd><p>A dictionary with list of functions that are called without argument
to populate the template context.  The key of the dictionary is the
name of the blueprint this function is active for, <cite>None</cite> for all
requests.  Each returns a dictionary that the template context is
updated with.  To register a function here, use the
<a class="reference internal" href="#flask.Flask.context_processor" title="flask.Flask.context_processor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">context_processor()</span></code></a> decorator.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.template_filter">
<code class="descname">template_filter</code><span class="sig-paren">(</span><em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.template_filter" title="Ссылка на это определение">¶</a></dt>
<dd><p>A decorator that is used to register custom template filter.
You can specify a name for the filter, otherwise the function
name will be used. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">template_filter</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the filter, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.template_global">
<code class="descname">template_global</code><span class="sig-paren">(</span><em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.template_global" title="Ссылка на это определение">¶</a></dt>
<dd><p>A decorator that is used to register a custom template global function.
You can specify a name for the global function, otherwise the function
name will be used. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">template_global</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the global function, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.template_test">
<code class="descname">template_test</code><span class="sig-paren">(</span><em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.template_test" title="Ссылка на это определение">¶</a></dt>
<dd><p>A decorator that is used to register custom template test.
You can specify a name for the test, otherwise the function
name will be used. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">template_test</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">is_prime</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the test, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.test_client">
<code class="descname">test_client</code><span class="sig-paren">(</span><em>use_cookies=True</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.test_client" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates a test client for this application.  For information
about unit testing head over to <a class="reference internal" href="index.html#testing"><span class="std std-ref">Тестирование приложений Flask</span></a>.</p>
<p>Note that if you are testing for assertions or exceptions in your
application code, you must set <code class="docutils literal notranslate"><span class="pre">app.testing</span> <span class="pre">=</span> <span class="pre">True</span></code> in order for the
exceptions to propagate to the test client.  Otherwise, the exception
will be handled by the application (not visible to the test client) and
the only indication of an AssertionError or other exception will be a
500 status code response to the test client.  See the <a class="reference internal" href="#flask.Flask.testing" title="flask.Flask.testing"><code class="xref py py-attr docutils literal notranslate"><span class="pre">testing</span></code></a>
attribute.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">testing</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
</pre></div>
</div>
<p>The test client can be used in a <cite>with</cite> block to defer the closing down
of the context until the end of the <cite>with</cite> block.  This is useful if
you want to access the context locals for testing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/?vodka=42&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;vodka&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;42&#39;</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#flask.testing.FlaskClient" title="flask.testing.FlaskClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlaskClient</span></code></a> for more information.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.4: </span>added support for <cite>with</cite> block usage for the client.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7: </span>The <cite>use_cookies</cite> parameter was added as well as the ability
to override the client to be used by setting the
<a class="reference internal" href="#flask.Flask.test_client_class" title="flask.Flask.test_client_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">test_client_class</span></code></a> attribute.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.test_client_class">
<code class="descname">test_client_class</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.test_client_class" title="Ссылка на это определение">¶</a></dt>
<dd><p>the test client that is used with when <cite>test_client</cite> is used.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.test_request_context">
<code class="descname">test_request_context</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.test_request_context" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates a WSGI environment from the given values (see
<code class="xref py py-func docutils literal notranslate"><span class="pre">werkzeug.test.EnvironBuilder()</span></code> for more information, this
function accepts the same arguments).</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.testing">
<code class="descname">testing</code><a class="headerlink" href="#flask.Flask.testing" title="Ссылка на это определение">¶</a></dt>
<dd><p>The testing flag.  Set this to <cite>True</cite> to enable the test mode of
Flask extensions (and in the future probably also Flask itself).
For example this might activate unittest helpers that have an
additional runtime cost which should not be enabled by default.</p>
<p>If this is enabled and PROPAGATE_EXCEPTIONS is not changed from the
default it’s implicitly enabled.</p>
<p>This attribute can also be configured from the config with the
<cite>TESTING</cite> configuration key.  Defaults to <cite>False</cite>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.trap_http_exception">
<code class="descname">trap_http_exception</code><span class="sig-paren">(</span><em>e</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.trap_http_exception" title="Ссылка на это определение">¶</a></dt>
<dd><p>Checks if an HTTP exception should be trapped or not.  By default
this will return <cite>False</cite> for all exceptions except for a bad request
key error if <code class="docutils literal notranslate"><span class="pre">TRAP_BAD_REQUEST_ERRORS</span></code> is set to <cite>True</cite>.  It
also returns <cite>True</cite> if <code class="docutils literal notranslate"><span class="pre">TRAP_HTTP_EXCEPTIONS</span></code> is set to <cite>True</cite>.</p>
<p>This is called for all HTTP exceptions raised by a view function.
If it returns <cite>True</cite> for any exception the error handler for this
exception is not called and it shows up as regular exception in the
traceback.  This is helpful for debugging implicitly raised HTTP
exceptions.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.update_template_context">
<code class="descname">update_template_context</code><span class="sig-paren">(</span><em>context</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.update_template_context" title="Ссылка на это определение">¶</a></dt>
<dd><p>Update the template context with some commonly used variables.
This injects request, session, config and g into the template
context as well as everything template context processors want
to inject.  Note that the as of Flask 0.6, the original values
in the context will not be overridden if a context processor
decides to return a value with the same key.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>context</strong> – the context as a dictionary that is updated in place
to add extra variables.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.url_build_error_handlers">
<code class="descname">url_build_error_handlers</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.url_build_error_handlers" title="Ссылка на это определение">¶</a></dt>
<dd><p>A list of functions that are called when <a class="reference internal" href="#flask.url_for" title="flask.url_for"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_for()</span></code></a> raises a
<code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildError</span></code>.  Each function registered here
is called with <cite>error</cite>, <cite>endpoint</cite> and <cite>values</cite>.  If a function
returns <cite>None</cite> or raises a <cite>BuildError</cite> the next function is
tried.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.url_default_functions">
<code class="descname">url_default_functions</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.url_default_functions" title="Ссылка на это определение">¶</a></dt>
<dd><p>A dictionary with lists of functions that can be used as URL value
preprocessors.  The key <cite>None</cite> here is used for application wide
callbacks, otherwise the key is the name of the blueprint.
Each of these functions has the chance to modify the dictionary
of URL values before they are used as the keyword arguments of the
view function.  For each function registered this one should also
provide a <a class="reference internal" href="#flask.Flask.url_defaults" title="flask.Flask.url_defaults"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_defaults()</span></code></a> function that adds the parameters
automatically again that were removed that way.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.url_defaults">
<code class="descname">url_defaults</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.url_defaults" title="Ссылка на это определение">¶</a></dt>
<dd><p>Callback function for URL defaults for all view functions of the
application.  It’s called with the endpoint and values and should
update the values passed in place.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.url_map">
<code class="descname">url_map</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.url_map" title="Ссылка на это определение">¶</a></dt>
<dd><p>The <a class="reference external" href="http://werkzeug.pocoo.org/docs/routing/#werkzeug.routing.Map" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Map</span></code></a> for this instance.  You can use
this to change the routing converters after the class was created
but before any routes are connected.  Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">werkzeug.routing</span> <span class="k">import</span> <span class="n">BaseConverter</span>

<span class="k">class</span> <span class="nc">ListConverter</span><span class="p">(</span><span class="n">BaseConverter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BaseConverter</span><span class="o">.</span><span class="n">to_url</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">url_map</span><span class="o">.</span><span class="n">converters</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ListConverter</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.url_rule_class">
<code class="descname">url_rule_class</code><a class="headerlink" href="#flask.Flask.url_rule_class" title="Ссылка на это определение">¶</a></dt>
<dd><p>псевдоним класса <a class="reference external" href="http://werkzeug.pocoo.org/docs/routing/#werkzeug.routing.Rule" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">werkzeug.routing.Rule</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.url_value_preprocessor">
<code class="descname">url_value_preprocessor</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.url_value_preprocessor" title="Ссылка на это определение">¶</a></dt>
<dd><p>Registers a function as URL value preprocessor for all view
functions of the application.  It’s called before the view functions
are called and can modify the url values provided.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.url_value_preprocessors">
<code class="descname">url_value_preprocessors</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.url_value_preprocessors" title="Ссылка на это определение">¶</a></dt>
<dd><p>A dictionary with lists of functions that can be used as URL
value processor functions.  Whenever a URL is built these functions
are called to modify the dictionary of values in place.  The key
<cite>None</cite> here is used for application wide
callbacks, otherwise the key is the name of the blueprint.
Each of these functions has the chance to modify the dictionary</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.use_x_sendfile">
<code class="descname">use_x_sendfile</code><a class="headerlink" href="#flask.Flask.use_x_sendfile" title="Ссылка на это определение">¶</a></dt>
<dd><p>Enable this if you want to use the X-Sendfile feature.  Keep in
mind that the server has to support this.  This only affects files
sent with the <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> method.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.2.</span></p>
</div>
<p>This attribute can also be configured from the config with the
<cite>USE_X_SENDFILE</cite> configuration key.  Defaults to <cite>False</cite>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Flask.view_functions">
<code class="descname">view_functions</code><em class="property"> = None</em><a class="headerlink" href="#flask.Flask.view_functions" title="Ссылка на это определение">¶</a></dt>
<dd><p>A dictionary of all view functions registered.  The keys will
be function names which are also used to generate URLs and
the values are the function objects themselves.
To register a view function, use the <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> decorator.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Flask.wsgi_app">
<code class="descname">wsgi_app</code><span class="sig-paren">(</span><em>environ</em>, <em>start_response</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Flask.wsgi_app" title="Ссылка на это определение">¶</a></dt>
<dd><p>The actual WSGI application.  This is not implemented in
<cite>__call__</cite> so that middlewares can be applied without losing a
reference to the class.  So instead of doing this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">MyMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>
</div>
<p>It’s a better idea to do this instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">MyMiddleware</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">)</span>
</pre></div>
</div>
<p>Then you still have the original application object around and
can continue to call methods on it.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.7: </span>The behavior of the before and after request callbacks was changed
under error conditions and a new callback was added that will
always execute at the end of the request, independent on if an
error occurred or not.  See <a class="reference internal" href="index.html#callbacks-and-errors"><span class="std std-ref">Функции обратного вызова и ошибки</span></a>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>environ</strong> – a WSGI environment</li>
<li><strong>start_response</strong> – a callable accepting a status code,
a list of headers and an optional
exception context to start the response</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="blueprint">
<h4>Объекты blueprint<a class="headerlink" href="#blueprint" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="class">
<dt id="flask.Blueprint">
<em class="property">class </em><code class="descclassname">flask.</code><code class="descname">Blueprint</code><span class="sig-paren">(</span><em>name</em>, <em>import_name</em>, <em>static_folder=None</em>, <em>static_url_path=None</em>, <em>template_folder=None</em>, <em>url_prefix=None</em>, <em>subdomain=None</em>, <em>url_defaults=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint" title="Ссылка на это определение">¶</a></dt>
<dd><p>Represents a blueprint.  A blueprint is an object that records
functions that will be called with the
<code class="xref py py-class docutils literal notranslate"><span class="pre">BlueprintSetupState</span></code> later to register functions
or other things on the main application.  See <a class="reference internal" href="index.html#blueprints"><span class="std std-ref">Модульные приложения Flask с использованием blueprint’ов</span></a> for more
information.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
<dl class="method">
<dt id="flask.Blueprint.add_app_template_filter">
<code class="descname">add_app_template_filter</code><span class="sig-paren">(</span><em>f</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.add_app_template_filter" title="Ссылка на это определение">¶</a></dt>
<dd><p>Register a custom template filter, available application wide.  Like
<a class="reference internal" href="#flask.Flask.add_template_filter" title="flask.Flask.add_template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.add_template_filter()</span></code></a> but for a blueprint.  Works exactly
like the <a class="reference internal" href="#flask.Blueprint.app_template_filter" title="flask.Blueprint.app_template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app_template_filter()</span></code></a> decorator.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the filter, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.add_app_template_global">
<code class="descname">add_app_template_global</code><span class="sig-paren">(</span><em>f</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.add_app_template_global" title="Ссылка на это определение">¶</a></dt>
<dd><p>Register a custom template global, available application wide.  Like
<a class="reference internal" href="#flask.Flask.add_template_global" title="flask.Flask.add_template_global"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.add_template_global()</span></code></a> but for a blueprint.  Works exactly
like the <a class="reference internal" href="#flask.Blueprint.app_template_global" title="flask.Blueprint.app_template_global"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app_template_global()</span></code></a> decorator.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the global, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.add_app_template_test">
<code class="descname">add_app_template_test</code><span class="sig-paren">(</span><em>f</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.add_app_template_test" title="Ссылка на это определение">¶</a></dt>
<dd><p>Register a custom template test, available application wide.  Like
<a class="reference internal" href="#flask.Flask.add_template_test" title="flask.Flask.add_template_test"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.add_template_test()</span></code></a> but for a blueprint.  Works exactly
like the <a class="reference internal" href="#flask.Blueprint.app_template_test" title="flask.Blueprint.app_template_test"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app_template_test()</span></code></a> decorator.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the test, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.add_url_rule">
<code class="descname">add_url_rule</code><span class="sig-paren">(</span><em>rule</em>, <em>endpoint=None</em>, <em>view_func=None</em>, <em>**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.add_url_rule" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.add_url_rule()</span></code></a> but for a blueprint.  The endpoint for
the <a class="reference internal" href="#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a> function is prefixed with the name of the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.after_app_request">
<code class="descname">after_app_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.after_app_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.after_request()</span></code></a> but for a blueprint.  Such a function
is executed after each request, even if outside of the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.after_request">
<code class="descname">after_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.after_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.after_request()</span></code></a> but for a blueprint.  This function
is only executed after each request that is handled by a function of
that blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_context_processor">
<code class="descname">app_context_processor</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_context_processor" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.context_processor" title="flask.Flask.context_processor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.context_processor()</span></code></a> but for a blueprint.  Such a
function is executed each request, even if outside of the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_errorhandler">
<code class="descname">app_errorhandler</code><span class="sig-paren">(</span><em>code</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_errorhandler" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.errorhandler()</span></code></a> but for a blueprint.  This
handler is used for all requests, even if outside of the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_template_filter">
<code class="descname">app_template_filter</code><span class="sig-paren">(</span><em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_template_filter" title="Ссылка на это определение">¶</a></dt>
<dd><p>Register a custom template filter, available application wide.  Like
<a class="reference internal" href="#flask.Flask.template_filter" title="flask.Flask.template_filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.template_filter()</span></code></a> but for a blueprint.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the filter, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_template_global">
<code class="descname">app_template_global</code><span class="sig-paren">(</span><em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_template_global" title="Ссылка на это определение">¶</a></dt>
<dd><p>Register a custom template global, available application wide.  Like
<a class="reference internal" href="#flask.Flask.template_global" title="flask.Flask.template_global"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.template_global()</span></code></a> but for a blueprint.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the global, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_template_test">
<code class="descname">app_template_test</code><span class="sig-paren">(</span><em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_template_test" title="Ссылка на это определение">¶</a></dt>
<dd><p>Register a custom template test, available application wide.  Like
<a class="reference internal" href="#flask.Flask.template_test" title="flask.Flask.template_test"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.template_test()</span></code></a> but for a blueprint.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>name</strong> – the optional name of the test, otherwise the
function name will be used.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_url_defaults">
<code class="descname">app_url_defaults</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_url_defaults" title="Ссылка на это определение">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#flask.Blueprint.url_defaults" title="flask.Blueprint.url_defaults"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_defaults()</span></code></a> but application wide.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.app_url_value_preprocessor">
<code class="descname">app_url_value_preprocessor</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.app_url_value_preprocessor" title="Ссылка на это определение">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#flask.Blueprint.url_value_preprocessor" title="flask.Blueprint.url_value_preprocessor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">url_value_preprocessor()</span></code></a> but application wide.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.before_app_first_request">
<code class="descname">before_app_first_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.before_app_first_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.before_first_request" title="flask.Flask.before_first_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.before_first_request()</span></code></a>.  Such a function is
executed before the first request to the application.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.before_app_request">
<code class="descname">before_app_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.before_app_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.before_request()</span></code></a>.  Such a function is executed
before each request, even if outside of a blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.before_request">
<code class="descname">before_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.before_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.before_request" title="flask.Flask.before_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.before_request()</span></code></a> but for a blueprint.  This function
is only executed before each request that is handled by a function of
that blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.context_processor">
<code class="descname">context_processor</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.context_processor" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.context_processor" title="flask.Flask.context_processor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.context_processor()</span></code></a> but for a blueprint.  This
function is only executed for requests handled by a blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.endpoint">
<code class="descname">endpoint</code><span class="sig-paren">(</span><em>endpoint</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.endpoint" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.endpoint" title="flask.Flask.endpoint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.endpoint()</span></code></a> but for a blueprint.  This does not
prefix the endpoint with the blueprint name, this has to be done
explicitly by the user of this method.  If the endpoint is prefixed
with a <cite>.</cite> it will be registered to the current blueprint, otherwise
it’s an application independent endpoint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.errorhandler">
<code class="descname">errorhandler</code><span class="sig-paren">(</span><em>code_or_exception</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.errorhandler" title="Ссылка на это определение">¶</a></dt>
<dd><p>Registers an error handler that becomes active for this blueprint
only.  Please be aware that routing does not happen local to a
blueprint so an error handler for 404 usually is not handled by
a blueprint unless it is caused inside a view function.  Another
special case is the 500 internal server error which is always looked
up from the application.</p>
<p>Otherwise works as the <a class="reference internal" href="#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a> decorator
of the <a class="reference internal" href="#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> object.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.get_send_file_max_age">
<code class="descname">get_send_file_max_age</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.get_send_file_max_age" title="Ссылка на это определение">¶</a></dt>
<dd><p>Provides default cache_timeout for the <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> functions.</p>
<p>By default, this function returns <code class="docutils literal notranslate"><span class="pre">SEND_FILE_MAX_AGE_DEFAULT</span></code> from
the configuration of <a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a>.</p>
<p>Static file functions such as <a class="reference internal" href="#flask.send_from_directory" title="flask.send_from_directory"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_from_directory()</span></code></a> use this
function, and <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> calls this function on
<a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> when the given cache_timeout is <cite>None</cite>. If a
cache_timeout is given in <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>, that timeout is used;
otherwise, this method is called.</p>
<p>This allows subclasses to change the behavior when sending files based
on the filename.  For example, to set the cache timeout for .js files
to 60 seconds:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyFlask</span><span class="p">(</span><span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_send_file_max_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.js&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">60</span>
        <span class="k">return</span> <span class="n">flask</span><span class="o">.</span><span class="n">Flask</span><span class="o">.</span><span class="n">get_send_file_max_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Blueprint.has_static_folder">
<code class="descname">has_static_folder</code><a class="headerlink" href="#flask.Blueprint.has_static_folder" title="Ссылка на это определение">¶</a></dt>
<dd><p>This is <cite>True</cite> if the package bound object’s container has a
folder named <code class="docutils literal notranslate"><span class="pre">'static'</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Blueprint.jinja_loader">
<code class="descname">jinja_loader</code><a class="headerlink" href="#flask.Blueprint.jinja_loader" title="Ссылка на это определение">¶</a></dt>
<dd><p>The Jinja loader for this package bound object.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.make_setup_state">
<code class="descname">make_setup_state</code><span class="sig-paren">(</span><em>app</em>, <em>options</em>, <em>first_registration=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.make_setup_state" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates an instance of <a class="reference internal" href="#flask.blueprints.BlueprintSetupState" title="flask.blueprints.BlueprintSetupState"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BlueprintSetupState()</span></code></a>
object that is later passed to the register callback functions.
Subclasses can override this to return a subclass of the setup state.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.open_resource">
<code class="descname">open_resource</code><span class="sig-paren">(</span><em>resource</em>, <em>mode='rb'</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.open_resource" title="Ссылка на это определение">¶</a></dt>
<dd><p>Opens a resource from the application’s resource folder.  To see
how this works, consider the following folder structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">myapplication</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">schema</span><span class="o">.</span><span class="n">sql</span>
<span class="o">/</span><span class="n">static</span>
    <span class="o">/</span><span class="n">style</span><span class="o">.</span><span class="n">css</span>
<span class="o">/</span><span class="n">templates</span>
    <span class="o">/</span><span class="n">layout</span><span class="o">.</span><span class="n">html</span>
    <span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>If you want to open the <cite>schema.sql</cite> file you would do the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;schema.sql&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>resource</strong> – the name of the resource.  To access resources within
subfolders use forward slashes as separator.</li>
<li><strong>mode</strong> – resource file opening mode, default is „rb“.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.record">
<code class="descname">record</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.record" title="Ссылка на это определение">¶</a></dt>
<dd><p>Registers a function that is called when the blueprint is
registered on the application.  This function is called with the
state as argument as returned by the <a class="reference internal" href="#flask.Blueprint.make_setup_state" title="flask.Blueprint.make_setup_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_setup_state()</span></code></a>
method.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.record_once">
<code class="descname">record_once</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.record_once" title="Ссылка на это определение">¶</a></dt>
<dd><p>Works like <a class="reference internal" href="#flask.Blueprint.record" title="flask.Blueprint.record"><code class="xref py py-meth docutils literal notranslate"><span class="pre">record()</span></code></a> but wraps the function in another
function that will ensure the function is only called once.  If the
blueprint is registered a second time on the application, the
function passed is not called.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.register">
<code class="descname">register</code><span class="sig-paren">(</span><em>app</em>, <em>options</em>, <em>first_registration=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.register" title="Ссылка на это определение">¶</a></dt>
<dd><p>Called by <a class="reference internal" href="#flask.Flask.register_blueprint" title="flask.Flask.register_blueprint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.register_blueprint()</span></code></a> to register a blueprint
on the application.  This can be overridden to customize the register
behavior.  Keyword arguments from
<a class="reference internal" href="#flask.Flask.register_blueprint" title="flask.Flask.register_blueprint"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_blueprint()</span></code></a> are directly forwarded to this
method in the <cite>options</cite> dictionary.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.route">
<code class="descname">route</code><span class="sig-paren">(</span><em>rule</em>, <em>**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.route" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.route()</span></code></a> but for a blueprint.  The endpoint for the
<a class="reference internal" href="#flask.url_for" title="flask.url_for"><code class="xref py py-func docutils literal notranslate"><span class="pre">url_for()</span></code></a> function is prefixed with the name of the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.send_static_file">
<code class="descname">send_static_file</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.send_static_file" title="Ссылка на это определение">¶</a></dt>
<dd><p>Function used internally to send static files from the static
folder to the browser.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.teardown_app_request">
<code class="descname">teardown_app_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.teardown_app_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.teardown_request()</span></code></a> but for a blueprint.  Such a
function is executed when tearing down each request, even if outside of
the blueprint.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.teardown_request">
<code class="descname">teardown_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.teardown_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.teardown_request()</span></code></a> but for a blueprint.  This
function is only executed when tearing down requests handled by a
function of that blueprint.  Teardown request functions are executed
when the request context is popped, even when no actual request was
performed.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.url_defaults">
<code class="descname">url_defaults</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.url_defaults" title="Ссылка на это определение">¶</a></dt>
<dd><p>Callback function for URL defaults for this blueprint.  It’s called
with the endpoint and values and should update the values passed
in place.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Blueprint.url_value_preprocessor">
<code class="descname">url_value_preprocessor</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Blueprint.url_value_preprocessor" title="Ссылка на это определение">¶</a></dt>
<dd><p>Registers a function as URL value preprocessor for this
blueprint.  It’s called before the view functions are called and
can modify the url values provided.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id3">
<h4>Данные входящих запросов<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="class">
<dt id="flask.Request">
<em class="property">class </em><code class="descclassname">flask.</code><code class="descname">Request</code><span class="sig-paren">(</span><em>environ</em>, <em>populate_request=True</em>, <em>shallow=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Request" title="Ссылка на это определение">¶</a></dt>
<dd><p>The request object used by default in Flask.  Remembers the
matched endpoint and view arguments.</p>
<p>It is what ends up as <a class="reference internal" href="#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>.  If you want to replace
the request object used you can subclass this and set
<a class="reference internal" href="#flask.Flask.request_class" title="flask.Flask.request_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request_class</span></code></a> to your subclass.</p>
<p>The request object is a <a class="reference external" href="http://werkzeug.pocoo.org/docs/wrappers/#werkzeug.wrappers.Request" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a> subclass and
provides all of the attributes Werkzeug defines plus a few Flask
specific ones.</p>
<dl class="attribute">
<dt id="flask.Request.form">
<code class="descname">form</code><a class="headerlink" href="#flask.Request.form" title="Ссылка на это определение">¶</a></dt>
<dd><p><a class="reference external" href="http://werkzeug.pocoo.org/docs/datastructures/#werkzeug.datastructures.MultiDict" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDict</span></code></a> с данными разбора от запросов
<cite>POST</cite> или <cite>PUT</cite>.  Помните, пожалуйста, что загрузки файлов на этом не
ограничиваются, есть ещё атрибут <a class="reference internal" href="#flask.Request.files" title="flask.Request.files"><code class="xref py py-attr docutils literal notranslate"><span class="pre">files</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.args">
<code class="descname">args</code><a class="headerlink" href="#flask.Request.args" title="Ссылка на это определение">¶</a></dt>
<dd><p><a class="reference external" href="http://werkzeug.pocoo.org/docs/datastructures/#werkzeug.datastructures.MultiDict" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDict</span></code></a> с разобранным содержимым
строки запроса.  (Это та часть URL, которая следует после знака вопроса).</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.values">
<code class="descname">values</code><a class="headerlink" href="#flask.Request.values" title="Ссылка на это определение">¶</a></dt>
<dd><p><a class="reference external" href="http://werkzeug.pocoo.org/docs/datastructures/#werkzeug.datastructures.CombinedMultiDict" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CombinedMultiDict</span></code></a> с содержимым
<a class="reference internal" href="#flask.Request.form" title="flask.Request.form"><code class="xref py py-attr docutils literal notranslate"><span class="pre">form</span></code></a> и <a class="reference internal" href="#flask.Request.args" title="flask.Request.args"><code class="xref py py-attr docutils literal notranslate"><span class="pre">args</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.cookies">
<code class="descname">cookies</code><a class="headerlink" href="#flask.Request.cookies" title="Ссылка на это определение">¶</a></dt>
<dd><p><a class="reference external" href="https://docs.python.org/dev/library/stdtypes.html#dict" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> с содержимым всех переменных браузера, переданных с
запросом.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.stream">
<code class="descname">stream</code><a class="headerlink" href="#flask.Request.stream" title="Ссылка на это определение">¶</a></dt>
<dd><p>Если поступающие данные формы не закодированы одним из известных
типов mimetype, потребляемые данные сохраняются в этом потоке в
неизменном виде.  В большинстве случаев лучше использовать
<a class="reference internal" href="#flask.Request.data" title="flask.Request.data"><code class="xref py py-attr docutils literal notranslate"><span class="pre">data</span></code></a>, который предоставит вам эти данные в виде строки.
Поток возвращает данные лишь единожды.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.headers">
<code class="descname">headers</code><a class="headerlink" href="#flask.Request.headers" title="Ссылка на это определение">¶</a></dt>
<dd><p>Заголовки поступившего запроса в виде словаря, как объекта.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.data">
<code class="descname">data</code><a class="headerlink" href="#flask.Request.data" title="Ссылка на это определение">¶</a></dt>
<dd><p>Содержит данные поступившего запроса в виде строки в том случае, когда
Flask не может обработать такой mimetype.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.files">
<code class="descname">files</code><a class="headerlink" href="#flask.Request.files" title="Ссылка на это определение">¶</a></dt>
<dd><p><a class="reference external" href="http://werkzeug.pocoo.org/docs/datastructures/#werkzeug.datastructures.MultiDict" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDict</span></code></a> с файлами, загружаемыми как часть
запроса <cite>POST</cite> или <cite>PUT</cite>.  Каждый файл сохраняется в виде объекта
<a class="reference external" href="http://werkzeug.pocoo.org/docs/datastructures/#werkzeug.datastructures.FileStorage" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileStorage</span></code></a>.  Он, говоря простым языком,
ведёт себя как известный вам по Python объект файла, с той разницей, что
в нём есть функция <a class="reference external" href="http://werkzeug.pocoo.org/docs/datastructures/#werkzeug.datastructures.FileStorage.save" title="(в Werkzeug v0.14-dev)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a>, которая
может сохранить файл в файловую систему..</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.environ">
<code class="descname">environ</code><a class="headerlink" href="#flask.Request.environ" title="Ссылка на это определение">¶</a></dt>
<dd><p>Нижележащее WSGI-окружение.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.method">
<code class="descname">method</code><a class="headerlink" href="#flask.Request.method" title="Ссылка на это определение">¶</a></dt>
<dd><p>Текущий метод запроса (<code class="docutils literal notranslate"><span class="pre">POST</span></code>, <code class="docutils literal notranslate"><span class="pre">GET</span></code> и т. д.)</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.path">
<code class="descname">path</code><a class="headerlink" href="#flask.Request.path" title="Ссылка на это определение">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="flask.Request.script_root">
<code class="descname">script_root</code><a class="headerlink" href="#flask.Request.script_root" title="Ссылка на это определение">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="flask.Request.url">
<code class="descname">url</code><a class="headerlink" href="#flask.Request.url" title="Ссылка на это определение">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="flask.Request.base_url">
<code class="descname">base_url</code><a class="headerlink" href="#flask.Request.base_url" title="Ссылка на это определение">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="flask.Request.url_root">
<code class="descname">url_root</code><a class="headerlink" href="#flask.Request.url_root" title="Ссылка на это определение">¶</a></dt>
<dd><p>Предоставляет различные способы представления текущего URL.  Представим, что
ваше приложение соответствует следующему URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">myapplication</span>
</pre></div>
</div>
<p>А запросы пользователя поступают на такой URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://www.example.com/myapplication/page.html?x=y
</pre></div>
</div>
<p>В таком случае значения вышеупомянутых атрибутов станут вот такими:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><cite>path</cite></td>
<td><code class="docutils literal notranslate"><span class="pre">/page.html</span></code></td>
</tr>
<tr class="row-even"><td><cite>script_root</cite></td>
<td><code class="docutils literal notranslate"><span class="pre">/myapplication</span></code></td>
</tr>
<tr class="row-odd"><td><cite>base_url</cite></td>
<td><code class="docutils literal notranslate"><span class="pre">http://www.example.com/myapplication/page.html</span></code></td>
</tr>
<tr class="row-even"><td><cite>url</cite></td>
<td><code class="docutils literal notranslate"><span class="pre">http://www.example.com/myapplication/page.html?x=y</span></code></td>
</tr>
<tr class="row-odd"><td><cite>url_root</cite></td>
<td><code class="docutils literal notranslate"><span class="pre">http://www.example.com/myapplication/</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.is_xhr">
<code class="descname">is_xhr</code><a class="headerlink" href="#flask.Request.is_xhr" title="Ссылка на это определение">¶</a></dt>
<dd><p><cite>True</cite> если запрос обработан через JavaScript <cite>XMLHttpRequest</cite>.
Это работает лишь с теми библиотеками, которые поддерживают
заголовок <code class="docutils literal notranslate"><span class="pre">X-Requested-With</span></code> и устанавливают его в значение
<cite>XMLHttpRequest</cite>.  Подобными библиотеками являются prototype,
jQuery и Mochikit, возможно какие-то ещё.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.blueprint">
<code class="descname">blueprint</code><a class="headerlink" href="#flask.Request.blueprint" title="Ссылка на это определение">¶</a></dt>
<dd><p>The name of the current blueprint</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.endpoint">
<code class="descname">endpoint</code><a class="headerlink" href="#flask.Request.endpoint" title="Ссылка на это определение">¶</a></dt>
<dd><p>The endpoint that matched the request.  This in combination with
<a class="reference internal" href="#flask.Request.view_args" title="flask.Request.view_args"><code class="xref py py-attr docutils literal notranslate"><span class="pre">view_args</span></code></a> can be used to reconstruct the same or a
modified URL.  If an exception happened when matching, this will
be <cite>None</cite>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Request.get_json">
<code class="descname">get_json</code><span class="sig-paren">(</span><em>force=False</em>, <em>silent=False</em>, <em>cache=True</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Request.get_json" title="Ссылка на это определение">¶</a></dt>
<dd><p>Parses the incoming JSON request data and returns it.  If
parsing fails the <a class="reference internal" href="#flask.Request.on_json_loading_failed" title="flask.Request.on_json_loading_failed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">on_json_loading_failed()</span></code></a> method on the
request object will be invoked.  By default this function will
only load the json data if the mimetype is <code class="docutils literal notranslate"><span class="pre">application/json</span></code>
but this can be overriden by the <cite>force</cite> parameter.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>force</strong> – if set to <cite>True</cite> the mimetype is ignored.</li>
<li><strong>silent</strong> – if set to <cite>False</cite> this method will fail silently
and return <cite>False</cite>.</li>
<li><strong>cache</strong> – if set to <cite>True</cite> the parsed JSON data is remembered
on the request.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.json">
<code class="descname">json</code><a class="headerlink" href="#flask.Request.json" title="Ссылка на это определение">¶</a></dt>
<dd><p>If the mimetype is <cite>application/json</cite> this will contain the
parsed JSON data.  Otherwise this will be <cite>None</cite>.</p>
<p>The <a class="reference internal" href="#flask.Request.get_json" title="flask.Request.get_json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_json()</span></code></a> method should be used instead.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.max_content_length">
<code class="descname">max_content_length</code><a class="headerlink" href="#flask.Request.max_content_length" title="Ссылка на это определение">¶</a></dt>
<dd><p>Read-only view of the <cite>MAX_CONTENT_LENGTH</cite> config key.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.module">
<code class="descname">module</code><a class="headerlink" href="#flask.Request.module" title="Ссылка на это определение">¶</a></dt>
<dd><p>The name of the current module if the request was dispatched
to an actual module.  This is deprecated functionality, use blueprints
instead.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Request.on_json_loading_failed">
<code class="descname">on_json_loading_failed</code><span class="sig-paren">(</span><em>e</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Request.on_json_loading_failed" title="Ссылка на это определение">¶</a></dt>
<dd><p>Called if decoding of the JSON data failed.  The return value of
this method is used by <a class="reference internal" href="#flask.Request.get_json" title="flask.Request.get_json"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_json()</span></code></a> when an error occurred.  The
default implementation just raises a <code class="xref py py-class docutils literal notranslate"><span class="pre">BadRequest</span></code> exception.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.10: </span>Removed buggy previous behavior of generating a random JSON
response.  If you want that behavior back you can trivially
add it by subclassing.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.routing_exception">
<code class="descname">routing_exception</code><em class="property"> = None</em><a class="headerlink" href="#flask.Request.routing_exception" title="Ссылка на это определение">¶</a></dt>
<dd><p>if matching the URL failed, this is the exception that will be
raised / was raised as part of the request handling.  This is
usually a <a class="reference external" href="http://werkzeug.pocoo.org/docs/exceptions/#werkzeug.exceptions.NotFound" title="(в Werkzeug v0.14-dev)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NotFound</span></code></a> exception or
something similar.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.url_rule">
<code class="descname">url_rule</code><em class="property"> = None</em><a class="headerlink" href="#flask.Request.url_rule" title="Ссылка на это определение">¶</a></dt>
<dd><p>the internal URL rule that matched the request.  This can be
useful to inspect which methods are allowed for the URL from
a before/after handler (<code class="docutils literal notranslate"><span class="pre">request.url_rule.methods</span></code>) etc.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.6.</span></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.Request.view_args">
<code class="descname">view_args</code><em class="property"> = None</em><a class="headerlink" href="#flask.Request.view_args" title="Ссылка на это определение">¶</a></dt>
<dd><p>a dict of view arguments that matched the request.  If an exception
happened when matching, this will be <cite>None</cite>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.request">
<em class="property">class </em><code class="descclassname">flask.</code><code class="descname">request</code><a class="headerlink" href="#flask.request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Чтобы получить доступ к данным поступившего запроса, вы можете
использовать глобальный объект <cite>request</cite>.  Flask занимается для вас
разбором данных поступившего запроса и предоставляет вам к ним доступ
через глобальный объект.  Внутри себя Flask хочет убедиться, что
в случае многопоточного окружения, вы всегда получите корректные
данные, адресованные активному потоку.</p>
<p>Это прокси.  За дополнительными сведениями обращайтесь к
<a class="reference internal" href="index.html#notes-on-proxies"><span class="std std-ref">Замечания о посредниках</span></a>.</p>
<p>Объект запроса это экземпляр подкласса
<a class="reference external" href="http://werkzeug.pocoo.org/docs/wrappers/#werkzeug.wrappers.Request" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a>, сопровождаемый всеми атрибутами,
которые определены в Werkzeug.  Здесь дан лишь краткий обзор
наиболее важных из них.</p>
</dd></dl>

</div>
<div class="section" id="id4">
<h4>Объекты ответа<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="class">
<dt id="flask.Response">
<em class="property">class </em><code class="descclassname">flask.</code><code class="descname">Response</code><span class="sig-paren">(</span><em>response=None</em>, <em>status=None</em>, <em>headers=None</em>, <em>mimetype=None</em>, <em>content_type=None</em>, <em>direct_passthrough=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Response" title="Ссылка на это определение">¶</a></dt>
<dd><p>The response object that is used by default in Flask.  Works like the
response object from Werkzeug but is set to have an HTML mimetype by
default.  Quite often you don’t have to create this object yourself because
<a class="reference internal" href="#flask.Flask.make_response" title="flask.Flask.make_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_response()</span></code></a> will take care of that for you.</p>
<p>If you want to replace the response object used you can subclass this and
set <a class="reference internal" href="#flask.Flask.response_class" title="flask.Flask.response_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_class</span></code></a> to your subclass.</p>
<dl class="attribute">
<dt id="flask.Response.headers">
<code class="descname">headers</code><a class="headerlink" href="#flask.Response.headers" title="Ссылка на это определение">¶</a></dt>
<dd><p>Объект <code class="xref py py-class docutils literal notranslate"><span class="pre">Headers</span></code>, представляющий заголовки ответа.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Response.status">
<code class="descname">status</code><a class="headerlink" href="#flask.Response.status" title="Ссылка на это определение">¶</a></dt>
<dd><p>Строка со статусом ответа.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Response.status_code">
<code class="descname">status_code</code><a class="headerlink" href="#flask.Response.status_code" title="Ссылка на это определение">¶</a></dt>
<dd><p>Статус ответа в виде целого числа.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Response.data">
<code class="descname">data</code><a class="headerlink" href="#flask.Response.data" title="Ссылка на это определение">¶</a></dt>
<dd><p>A descriptor that calls <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_data()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">set_data()</span></code>.  This
should not be used and will eventually get deprecated.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.Response.mimetype">
<code class="descname">mimetype</code><a class="headerlink" href="#flask.Response.mimetype" title="Ссылка на это определение">¶</a></dt>
<dd><p>The mimetype (content type without charset etc.)</p>
</dd></dl>

<dl class="method">
<dt id="flask.Response.set_cookie">
<code class="descname">set_cookie</code><span class="sig-paren">(</span><em>key</em>, <em>value=''</em>, <em>max_age=None</em>, <em>expires=None</em>, <em>path='/'</em>, <em>domain=None</em>, <em>secure=False</em>, <em>httponly=False</em>, <em>samesite=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Response.set_cookie" title="Ссылка на это определение">¶</a></dt>
<dd><p>Sets a cookie. The parameters are the same as in the cookie <cite>Morsel</cite>
object in the Python standard library but it accepts unicode data, too.</p>
<p>A warning is raised if the size of the cookie header exceeds
<code class="xref py py-attr docutils literal notranslate"><span class="pre">max_cookie_size</span></code>, but the header will still be set.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> – the key (name) of the cookie to be set.</li>
<li><strong>value</strong> – the value of the cookie.</li>
<li><strong>max_age</strong> – should be a number of seconds, or <cite>None</cite> (default) if
the cookie should last only as long as the client’s
browser session.</li>
<li><strong>expires</strong> – should be a <cite>datetime</cite> object or UNIX timestamp.</li>
<li><strong>path</strong> – limits the cookie to a given path, per default it will
span the whole domain.</li>
<li><strong>domain</strong> – if you want to set a cross-domain cookie.  For example,
<code class="docutils literal notranslate"><span class="pre">domain=&quot;.example.com&quot;</span></code> will set a cookie that is
readable by the domain <code class="docutils literal notranslate"><span class="pre">www.example.com</span></code>,
<code class="docutils literal notranslate"><span class="pre">foo.example.com</span></code> etc.  Otherwise, a cookie will only
be readable by the domain that set it.</li>
<li><strong>secure</strong> – If <cite>True</cite>, the cookie will only be available via HTTPS</li>
<li><strong>httponly</strong> – disallow JavaScript to access the cookie.  This is an
extension to the cookie standard and probably not
supported by all browsers.</li>
<li><strong>samesite</strong> – Limits the scope of the cookie such that it will only
be attached to requests if those requests are
«same-site».</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id5">
<h4>Сессии<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<p>Если вы установили <a class="reference internal" href="#flask.Flask.secret_key" title="flask.Flask.secret_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.secret_key</span></code></a> вы можете использовать сессии во
Flask приложении. Сессия в основном используется для того, что бы запоминать
информацию между запросами. Во Flask это реализовано при помощи подписанных
cookies. Таким образом, пользователь может посмотреть на содержимое сессии, но
не может изменить его пока он не знает секретный ключ, поэтому убедитесь, что
ключ сложный и неопределяемый.</p>
<p>Для доступа к текущей сессии вы можете использовать объект <a class="reference internal" href="#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a>:</p>
<dl class="class">
<dt id="flask.session">
<em class="property">class </em><code class="descclassname">flask.</code><code class="descname">session</code><a class="headerlink" href="#flask.session" title="Ссылка на это определение">¶</a></dt>
<dd><p>Объект сессии работает почти как обычный словарь, с той разницей, что он
следит за изменениями.</p>
<p>Это прокси.  За дополнительными сведениями обращайтесь к
<a class="reference internal" href="index.html#notes-on-proxies"><span class="std std-ref">Замечания о посредниках</span></a>.</p>
<p>Следующие атрибуты интресны:</p>
<dl class="attribute">
<dt id="flask.session.new">
<code class="descname">new</code><a class="headerlink" href="#flask.session.new" title="Ссылка на это определение">¶</a></dt>
<dd><p><cite>True</cite> если сессия новая, в ином случае - <cite>False</cite>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.session.modified">
<code class="descname">modified</code><a class="headerlink" href="#flask.session.modified" title="Ссылка на это определение">¶</a></dt>
<dd><p><cite>True</cite> если объект сессии был изменен. Имейте ввиду, что изменения
изменяемых структур данных не отмечаются автоматически, в этой ситуации
вы должны явно установить значение атрибута в <cite>True</cite> самостоятельно.
Вот пример:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># это изменение не будет отмечено из-за изменения изменяемого объекта</span>
<span class="c1"># (это тип `list` - список).</span>
<span class="n">session</span><span class="p">[</span><span class="s1">&#39;objects&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="c1"># так что укажем это самостоятельно</span>
<span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="flask.session.permanent">
<code class="descname">permanent</code><a class="headerlink" href="#flask.session.permanent" title="Ссылка на это определение">¶</a></dt>
<dd><p>Если установлен в <cite>True</cite> то сессия будет жить
<a class="reference internal" href="#flask.Flask.permanent_session_lifetime" title="flask.Flask.permanent_session_lifetime"><code class="xref py py-attr docutils literal notranslate"><span class="pre">permanent_session_lifetime</span></code></a> секунд. По умолчанию 31
день. Если установлен в <cite>False</cite> (по умолчанию), сессия будет удалена как
только пользователь закроет окно браузера.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id6">
<h4>Интерфейс сессий<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
<p>Итерфейс сессий предоставляет простой способ замены имплементации сессий Flask.</p>
<dl class="class">
<dt id="flask.sessions.SessionInterface">
<em class="property">class </em><code class="descclassname">flask.sessions.</code><code class="descname">SessionInterface</code><a class="headerlink" href="#flask.sessions.SessionInterface" title="Ссылка на это определение">¶</a></dt>
<dd><p>The basic interface you have to implement in order to replace the
default session interface which uses werkzeug’s securecookie
implementation.  The only methods you have to implement are
<a class="reference internal" href="#flask.sessions.SessionInterface.open_session" title="flask.sessions.SessionInterface.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a> and <a class="reference internal" href="#flask.sessions.SessionInterface.save_session" title="flask.sessions.SessionInterface.save_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_session()</span></code></a>, the others have
useful defaults which you don’t need to change.</p>
<p>The session object returned by the <a class="reference internal" href="#flask.sessions.SessionInterface.open_session" title="flask.sessions.SessionInterface.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a> method has to
provide a dictionary like interface plus the properties and methods
from the <a class="reference internal" href="#flask.sessions.SessionMixin" title="flask.sessions.SessionMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionMixin</span></code></a>.  We recommend just subclassing a dict
and adding that mixin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">SessionMixin</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>If <a class="reference internal" href="#flask.sessions.SessionInterface.open_session" title="flask.sessions.SessionInterface.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a> returns <cite>None</cite> Flask will call into
<a class="reference internal" href="#flask.sessions.SessionInterface.make_null_session" title="flask.sessions.SessionInterface.make_null_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_null_session()</span></code></a> to create a session that acts as replacement
if the session support cannot work because some requirement is not
fulfilled.  The default <a class="reference internal" href="#flask.sessions.NullSession" title="flask.sessions.NullSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullSession</span></code></a> class that is created
will complain that the secret key was not set.</p>
<p>To replace the session interface on an application all you have to do
is to assign <a class="reference internal" href="#flask.Flask.session_interface" title="flask.Flask.session_interface"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.Flask.session_interface</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">session_interface</span> <span class="o">=</span> <span class="n">MySessionInterface</span><span class="p">()</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
<dl class="method">
<dt id="flask.sessions.SessionInterface.get_cookie_domain">
<code class="descname">get_cookie_domain</code><span class="sig-paren">(</span><em>app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.get_cookie_domain" title="Ссылка на это определение">¶</a></dt>
<dd><p>Helpful helper method that returns the cookie domain that should
be used for the session cookie if session cookies are used.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.get_cookie_httponly">
<code class="descname">get_cookie_httponly</code><span class="sig-paren">(</span><em>app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.get_cookie_httponly" title="Ссылка на это определение">¶</a></dt>
<dd><p>Returns True if the session cookie should be httponly.  This
currently just returns the value of the <code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_HTTPONLY</span></code>
config var.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.get_cookie_path">
<code class="descname">get_cookie_path</code><span class="sig-paren">(</span><em>app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.get_cookie_path" title="Ссылка на это определение">¶</a></dt>
<dd><p>Returns the path for which the cookie should be valid.  The
default implementation uses the value from the SESSION_COOKIE_PATH``
config var if it’s set, and falls back to <code class="docutils literal notranslate"><span class="pre">APPLICATION_ROOT</span></code> or
uses <code class="docutils literal notranslate"><span class="pre">/</span></code> if it’s <cite>None</cite>.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.get_cookie_secure">
<code class="descname">get_cookie_secure</code><span class="sig-paren">(</span><em>app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.get_cookie_secure" title="Ссылка на это определение">¶</a></dt>
<dd><p>Returns True if the cookie should be secure.  This currently
just returns the value of the <code class="docutils literal notranslate"><span class="pre">SESSION_COOKIE_SECURE</span></code> setting.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.get_expiration_time">
<code class="descname">get_expiration_time</code><span class="sig-paren">(</span><em>app</em>, <em>session</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.get_expiration_time" title="Ссылка на это определение">¶</a></dt>
<dd><p>A helper method that returns an expiration date for the session
or <cite>None</cite> if the session is linked to the browser session.  The
default implementation returns now + the permanent session
lifetime configured on the application.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.is_null_session">
<code class="descname">is_null_session</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.is_null_session" title="Ссылка на это определение">¶</a></dt>
<dd><p>Checks if a given object is a null session.  Null sessions are
not asked to be saved.</p>
<p>This checks if the object is an instance of <a class="reference internal" href="#flask.sessions.SessionInterface.null_session_class" title="flask.sessions.SessionInterface.null_session_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">null_session_class</span></code></a>
by default.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.make_null_session">
<code class="descname">make_null_session</code><span class="sig-paren">(</span><em>app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.make_null_session" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates a null session which acts as a replacement object if the
real session support could not be loaded due to a configuration
error.  This mainly aids the user experience because the job of the
null session is to still support lookup without complaining but
modifications are answered with a helpful error message of what
failed.</p>
<p>This creates an instance of <a class="reference internal" href="#flask.sessions.SessionInterface.null_session_class" title="flask.sessions.SessionInterface.null_session_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">null_session_class</span></code></a> by default.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SessionInterface.null_session_class">
<code class="descname">null_session_class</code><a class="headerlink" href="#flask.sessions.SessionInterface.null_session_class" title="Ссылка на это определение">¶</a></dt>
<dd><p><a class="reference internal" href="#flask.sessions.SessionInterface.make_null_session" title="flask.sessions.SessionInterface.make_null_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_null_session()</span></code></a> will look here for the class that should
be created when a null session is requested.  Likewise the
<a class="reference internal" href="#flask.sessions.SessionInterface.is_null_session" title="flask.sessions.SessionInterface.is_null_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_null_session()</span></code></a> method will perform a typecheck against
this type.</p>
<p>псевдоним класса <a class="reference internal" href="#flask.sessions.NullSession" title="flask.sessions.NullSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullSession</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.open_session">
<code class="descname">open_session</code><span class="sig-paren">(</span><em>app</em>, <em>request</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.open_session" title="Ссылка на это определение">¶</a></dt>
<dd><p>This method has to be implemented and must either return <cite>None</cite>
in case the loading failed because of a configuration error or an
instance of a session object which implements a dictionary like
interface + the methods and attributes on <a class="reference internal" href="#flask.sessions.SessionMixin" title="flask.sessions.SessionMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionMixin</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SessionInterface.pickle_based">
<code class="descname">pickle_based</code><em class="property"> = False</em><a class="headerlink" href="#flask.sessions.SessionInterface.pickle_based" title="Ссылка на это определение">¶</a></dt>
<dd><p>A flag that indicates if the session interface is pickle based.
This can be used by flask extensions to make a decision in regards
to how to deal with the session object.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SessionInterface.save_session">
<code class="descname">save_session</code><span class="sig-paren">(</span><em>app</em>, <em>session</em>, <em>response</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SessionInterface.save_session" title="Ссылка на это определение">¶</a></dt>
<dd><p>This is called for actual sessions returned by <a class="reference internal" href="#flask.sessions.SessionInterface.open_session" title="flask.sessions.SessionInterface.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a>
at the end of the request.  This is still called during a request
context so if you absolutely need access to the request you can do
that.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.sessions.SecureCookieSessionInterface">
<em class="property">class </em><code class="descclassname">flask.sessions.</code><code class="descname">SecureCookieSessionInterface</code><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface" title="Ссылка на это определение">¶</a></dt>
<dd><p>The default session interface that stores sessions in signed cookies
through the <code class="xref py py-mod docutils literal notranslate"><span class="pre">itsdangerous</span></code> module.</p>
<dl class="staticmethod">
<dt id="flask.sessions.SecureCookieSessionInterface.digest_method">
<em class="property">static </em><code class="descname">digest_method</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.digest_method" title="Ссылка на это определение">¶</a></dt>
<dd><p>the hash function to use for the signature.  The default is sha1</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SecureCookieSessionInterface.key_derivation">
<code class="descname">key_derivation</code><em class="property"> = 'hmac'</em><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.key_derivation" title="Ссылка на это определение">¶</a></dt>
<dd><p>the name of the itsdangerous supported key derivation.  The default
is hmac.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SecureCookieSessionInterface.open_session">
<code class="descname">open_session</code><span class="sig-paren">(</span><em>app</em>, <em>request</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.open_session" title="Ссылка на это определение">¶</a></dt>
<dd><p>This method has to be implemented and must either return <cite>None</cite>
in case the loading failed because of a configuration error or an
instance of a session object which implements a dictionary like
interface + the methods and attributes on <a class="reference internal" href="#flask.sessions.SessionMixin" title="flask.sessions.SessionMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">SessionMixin</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SecureCookieSessionInterface.salt">
<code class="descname">salt</code><em class="property"> = 'cookie-session'</em><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.salt" title="Ссылка на это определение">¶</a></dt>
<dd><p>the salt that should be applied on top of the secret key for the
signing of cookie based sessions.</p>
</dd></dl>

<dl class="method">
<dt id="flask.sessions.SecureCookieSessionInterface.save_session">
<code class="descname">save_session</code><span class="sig-paren">(</span><em>app</em>, <em>session</em>, <em>response</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.save_session" title="Ссылка на это определение">¶</a></dt>
<dd><p>This is called for actual sessions returned by <a class="reference internal" href="#flask.sessions.SecureCookieSessionInterface.open_session" title="flask.sessions.SecureCookieSessionInterface.open_session"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_session()</span></code></a>
at the end of the request.  This is still called during a request
context so if you absolutely need access to the request you can do
that.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SecureCookieSessionInterface.serializer">
<code class="descname">serializer</code><em class="property"> = &lt;flask.sessions.TaggedJSONSerializer object&gt;</em><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.serializer" title="Ссылка на это определение">¶</a></dt>
<dd><p>A python serializer for the payload.  The default is a compact
JSON derived serializer with support for some extra Python types
such as datetime objects or tuples.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SecureCookieSessionInterface.session_class">
<code class="descname">session_class</code><a class="headerlink" href="#flask.sessions.SecureCookieSessionInterface.session_class" title="Ссылка на это определение">¶</a></dt>
<dd><p>псевдоним класса <a class="reference internal" href="#flask.sessions.SecureCookieSession" title="flask.sessions.SecureCookieSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecureCookieSession</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.sessions.SecureCookieSession">
<em class="property">class </em><code class="descclassname">flask.sessions.</code><code class="descname">SecureCookieSession</code><span class="sig-paren">(</span><em>initial=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.SecureCookieSession" title="Ссылка на это определение">¶</a></dt>
<dd><p>Baseclass for sessions based on signed cookies.</p>
</dd></dl>

<dl class="class">
<dt id="flask.sessions.NullSession">
<em class="property">class </em><code class="descclassname">flask.sessions.</code><code class="descname">NullSession</code><span class="sig-paren">(</span><em>initial=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.sessions.NullSession" title="Ссылка на это определение">¶</a></dt>
<dd><p>Class used to generate nicer error messages if sessions are not
available.  Will still allow read-only access to the empty session
but fail on setting.</p>
</dd></dl>

<dl class="class">
<dt id="flask.sessions.SessionMixin">
<em class="property">class </em><code class="descclassname">flask.sessions.</code><code class="descname">SessionMixin</code><a class="headerlink" href="#flask.sessions.SessionMixin" title="Ссылка на это определение">¶</a></dt>
<dd><p>Expands a basic dictionary with an accessors that are expected
by Flask extensions and users for the session.</p>
<dl class="attribute">
<dt id="flask.sessions.SessionMixin.modified">
<code class="descname">modified</code><em class="property"> = True</em><a class="headerlink" href="#flask.sessions.SessionMixin.modified" title="Ссылка на это определение">¶</a></dt>
<dd><p>for some backends this will always be <cite>True</cite>, but some backends will
default this to false and detect changes in the dictionary for as
long as changes do not happen on mutable structures in the session.
The default mixin implementation just hardcodes <cite>True</cite> in.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SessionMixin.new">
<code class="descname">new</code><em class="property"> = False</em><a class="headerlink" href="#flask.sessions.SessionMixin.new" title="Ссылка на это определение">¶</a></dt>
<dd><p>some session backends can tell you if a session is new, but that is
not necessarily guaranteed.  Use with caution.  The default mixin
implementation just hardcodes <cite>False</cite> in.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.sessions.SessionMixin.permanent">
<code class="descname">permanent</code><a class="headerlink" href="#flask.sessions.SessionMixin.permanent" title="Ссылка на это определение">¶</a></dt>
<dd><p>this reflects the <code class="docutils literal notranslate"><span class="pre">'_permanent'</span></code> key in the dict.</p>
</dd></dl>

</dd></dl>

<dl class="data">
<dt id="flask.sessions.session_json_serializer">
<code class="descclassname">flask.sessions.</code><code class="descname">session_json_serializer</code><em class="property"> = &lt;flask.sessions.TaggedJSONSerializer object&gt;</em><a class="headerlink" href="#flask.sessions.session_json_serializer" title="Ссылка на это определение">¶</a></dt>
<dd><p>A customized JSON serializer that supports a few extra types that
we take for granted when serializing (tuples, markup objects, datetime).</p>
<p>Этот объект предоставляет методы сериализации и десериализации похожие на
simplejson, но так же конвертирует некоторые встроенные объекты Python,
которые обычно появляются в сессиях. На данный момент следующие расширенные
значения поддерживаются в JSON при дампе:</p>
<ul class="simple">
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code> объекты</li>
<li><a class="reference external" href="https://docs.python.org/dev/library/uuid.html#uuid.UUID" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUID</span></code></a> объекты</li>
<li><a class="reference external" href="https://docs.python.org/dev/library/datetime.html#datetime.datetime" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> объекты</li>
<li><a class="reference external" href="https://docs.python.org/dev/library/stdtypes.html#tuple" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>ы</li>
</ul>
</dd></dl>

<div class="admonition- admonition">
<p class="first admonition-title">Замечание</p>
<p class="last">Ключ конфигурации <code class="docutils literal notranslate"><span class="pre">PERMANENT_SESSION_LIFETIME</span></code> может так же быть числом
начиная с версии Flask 0.8. Вы можете использовать атрибут
<a class="reference internal" href="#flask.Flask.permanent_session_lifetime" title="flask.Flask.permanent_session_lifetime"><code class="xref py py-attr docutils literal notranslate"><span class="pre">permanent_session_lifetime</span></code></a> в приложении с автоматической
конвертацией результата в число.</p>
</div>
</div>
<div class="section" id="id7">
<h4>Тестовый клиент<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="class">
<dt id="flask.testing.FlaskClient">
<em class="property">class </em><code class="descclassname">flask.testing.</code><code class="descname">FlaskClient</code><span class="sig-paren">(</span><em>application</em>, <em>response_wrapper=None</em>, <em>use_cookies=True</em>, <em>allow_subdomain_redirects=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.testing.FlaskClient" title="Ссылка на это определение">¶</a></dt>
<dd><p>Works like a regular Werkzeug test client but has some knowledge about
how Flask works to defer the cleanup of the request context stack to the
end of a with body when used in a with statement.  For general information
about how to use this class refer to <a class="reference external" href="http://werkzeug.pocoo.org/docs/test/#werkzeug.test.Client" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">werkzeug.test.Client</span></code></a>.</p>
<p>Basic usage is outlined in the <a class="reference internal" href="index.html#testing"><span class="std std-ref">Тестирование приложений Flask</span></a> chapter.</p>
<dl class="method">
<dt id="flask.testing.FlaskClient.open">
<code class="descname">open</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.testing.FlaskClient.open" title="Ссылка на это определение">¶</a></dt>
<dd><p>Takes the same arguments as the <code class="xref py py-class docutils literal notranslate"><span class="pre">EnvironBuilder</span></code> class with
some additions:  You can provide a <code class="xref py py-class docutils literal notranslate"><span class="pre">EnvironBuilder</span></code> or a WSGI
environment as only argument instead of the <code class="xref py py-class docutils literal notranslate"><span class="pre">EnvironBuilder</span></code>
arguments and two optional keyword arguments (<cite>as_tuple</cite>, <cite>buffered</cite>)
that change the type of the return value or the way the application is
executed.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.5: </span>If a dict is provided as file in the dict for the <cite>data</cite> parameter
the content type has to be called <cite>content_type</cite> now instead of
<cite>mimetype</cite>.  This change was made for consistency with
<code class="xref py py-class docutils literal notranslate"><span class="pre">werkzeug.FileWrapper</span></code>.</p>
<blockquote>
<div>The <cite>follow_redirects</cite> parameter was added to <a class="reference internal" href="#flask.testing.FlaskClient.open" title="flask.testing.FlaskClient.open"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a>.</div></blockquote>
</div>
<p>Additional parameters:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>as_tuple</strong> – Returns a tuple in the form <code class="docutils literal notranslate"><span class="pre">(environ,</span> <span class="pre">result)</span></code></li>
<li><strong>buffered</strong> – Set this to True to buffer the application run.
This will automatically close the application for
you as well.</li>
<li><strong>follow_redirects</strong> – Set this to True if the <cite>Client</cite> should
follow HTTP redirects.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.testing.FlaskClient.session_transaction">
<code class="descname">session_transaction</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.testing.FlaskClient.session_transaction" title="Ссылка на это определение">¶</a></dt>
<dd><p>When used in combination with a with statement this opens a
session transaction.  This can be used to modify the session that
the test client uses.  Once the with block is left the session is
stored back.</p>
<blockquote>
<div><dl class="docutils">
<dt>with client.session_transaction() as session:</dt>
<dd>session[„value“] = 42</dd>
</dl>
</div></blockquote>
<p>Internally this is implemented by going through a temporary test
request context and since session handling could depend on
request variables this function accepts the same arguments as
<a class="reference internal" href="#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_request_context()</span></code></a> which are directly
passed through.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id8">
<h4>Глобальные переменные<a class="headerlink" href="#id8" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для совместного использования данных, которые действительны в течение одного
запроса и только от одной функции к другой, глобальная переменная не достаточно
хороша, потому что она нарушила бы работу приложения в многопоточных средах.
Flask предоставляет специальный объект, который гарантирует что для разных
запросов будут возвращены разные значения. В двух словах: это работает примерно
так же как и <a class="reference internal" href="#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a> и <a class="reference internal" href="#flask.session" title="flask.session"><code class="xref py py-class docutils literal notranslate"><span class="pre">session</span></code></a>.</p>
<dl class="data">
<dt id="flask.g">
<code class="descclassname">flask.</code><code class="descname">g</code><a class="headerlink" href="#flask.g" title="Ссылка на это определение">¶</a></dt>
<dd><p>Просто храните здесь все что хотите. Например соединение с базой данных или
пользователя, который сейчас авторизирован.</p>
<p>Начиная с Flask 0.10 это хранится в контексте приложения и не зависит от
контекста запроса, что делает их доступными уже в момент создани контекста
приложения, но еще до создания запроса. Это особенно полезно когда
используется подход <a class="reference internal" href="index.html#faking-resources"><span class="std std-ref">Подделка ресурсов и контекста</span></a> для тестирования.</p>
<p>Дополнительно с версии 0.10 вы можете использовать метод <code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code> для
получения значения атрибута или <cite>None</cite> (или второго аргумента метода
<code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code>) если значение отсутствует. Эти две строки эквивалентны:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">flask</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">flask</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Так же допускается использование оператора <code class="docutils literal notranslate"><span class="pre">in</span></code> на этом объекте для
проверки на существование ключа в объекте.</p>
<p>Это прокси.  За дополнительными сведениями обращайтесь к
<a class="reference internal" href="index.html#notes-on-proxies"><span class="std std-ref">Замечания о посредниках</span></a>.</p>
</dd></dl>

</div>
<div class="section" id="id9">
<h4>Полезные функции и классы<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="data">
<dt id="flask.current_app">
<code class="descclassname">flask.</code><code class="descname">current_app</code><a class="headerlink" href="#flask.current_app" title="Ссылка на это определение">¶</a></dt>
<dd><p>Приложение в текущем запросе. Это используется для расширений,
которые хотят поддерживать несколько приложений работающих бок о бок.
Это работает на основе контекста приложения а не на контексте запроса, так
что вы можете изменить значение этого прокси используя метод
<a class="reference internal" href="#flask.Flask.app_context" title="flask.Flask.app_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">app_context()</span></code></a>.</p>
<p>Это прокси.  За дополнительными сведениями обращайтесь к
<a class="reference internal" href="index.html#notes-on-proxies"><span class="std std-ref">Замечания о посредниках</span></a>.</p>
</dd></dl>

<dl class="function">
<dt id="flask.has_request_context">
<code class="descclassname">flask.</code><code class="descname">has_request_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.has_request_context" title="Ссылка на это определение">¶</a></dt>
<dd><p>If you have code that wants to test if a request context is there or
not this function can be used.  For instance, you may want to take advantage
of request information if the request object is available, but fail
silently if it is unavailable.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">remote_addr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="k">if</span> <span class="n">remote_addr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">has_request_context</span><span class="p">():</span>
            <span class="n">remote_addr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote_addr</span> <span class="o">=</span> <span class="n">remote_addr</span>
</pre></div>
</div>
<p>Alternatively you can also just test any of the context bound objects
(such as <a class="reference internal" href="#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a> or <a class="reference internal" href="#flask.g" title="flask.g"><code class="xref py py-class docutils literal notranslate"><span class="pre">g</span></code></a> for truthness):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">remote_addr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="k">if</span> <span class="n">remote_addr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">request</span><span class="p">:</span>
            <span class="n">remote_addr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote_addr</span> <span class="o">=</span> <span class="n">remote_addr</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="flask.copy_current_request_context">
<code class="descclassname">flask.</code><code class="descname">copy_current_request_context</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.copy_current_request_context" title="Ссылка на это определение">¶</a></dt>
<dd><p>A helper function that decorates a function to retain the current
request context.  This is useful when working with greenlets.  The moment
the function is decorated a copy of the request context is created and
then pushed when the function is called.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gevent</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">copy_current_request_context</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="nd">@copy_current_request_context</span>
    <span class="k">def</span> <span class="nf">do_some_work</span><span class="p">():</span>
        <span class="c1"># do some work here, it can access flask.request like you</span>
        <span class="c1"># would otherwise in the view function.</span>
        <span class="o">...</span>
    <span class="n">gevent</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">do_some_work</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;Regular response&#39;</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="flask.has_app_context">
<code class="descclassname">flask.</code><code class="descname">has_app_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.has_app_context" title="Ссылка на это определение">¶</a></dt>
<dd><p>Works like <a class="reference internal" href="#flask.has_request_context" title="flask.has_request_context"><code class="xref py py-func docutils literal notranslate"><span class="pre">has_request_context()</span></code></a> but for the application
context.  You can also just do a boolean check on the
<a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> object instead.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="flask.url_for">
<code class="descclassname">flask.</code><code class="descname">url_for</code><span class="sig-paren">(</span><em>endpoint</em>, <em>**values</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.url_for" title="Ссылка на это определение">¶</a></dt>
<dd><p>Generates a URL to the given endpoint with the method provided.</p>
<p>Variable arguments that are unknown to the target endpoint are appended
to the generated URL as query arguments.  If the value of a query argument
is <cite>None</cite>, the whole pair is skipped.  In case blueprints are active
you can shortcut references to the same blueprint by prefixing the
local endpoint with a dot (<code class="docutils literal notranslate"><span class="pre">.</span></code>).</p>
<p>This will reference the index function local to the current blueprint:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;.index&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information, head over to the <a class="reference internal" href="index.html#url-building"><span class="std std-ref">Quickstart</span></a>.</p>
<p>To integrate applications, <a class="reference internal" href="#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a> has a hook to intercept URL build
errors through <code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.build_error_handler</span></code>.  The <cite>url_for</cite> function
results in a <code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildError</span></code> when the current app does
not have a URL for the given endpoint and values.  When it does, the
<a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a> calls its <code class="xref py py-attr docutils literal notranslate"><span class="pre">build_error_handler</span></code> if
it is not <cite>None</cite>, which can return a string to use as the result of
<cite>url_for</cite> (instead of <cite>url_for</cite>’s default to raise the
<code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildError</span></code> exception) or re-raise the exception.
An example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">external_url_handler</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">):</span>
    <span class="s2">&quot;Looks up an external URL when `url_for` cannot build a URL.&quot;</span>
    <span class="c1"># This is an example of hooking the build_error_handler.</span>
    <span class="c1"># Here, lookup_url is some utility function you&#39;ve built</span>
    <span class="c1"># which looks up the endpoint in some external URL registry.</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">lookup_url</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># External lookup did not have a URL.</span>
        <span class="c1"># Re-raise the BuildError, in context of original traceback.</span>
        <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">tb</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">error</span>
    <span class="c1"># url_for will use this result, instead of raising BuildError.</span>
    <span class="k">return</span> <span class="n">url</span>

<span class="n">app</span><span class="o">.</span><span class="n">build_error_handler</span> <span class="o">=</span> <span class="n">external_url_handler</span>
</pre></div>
</div>
<p>Here, <cite>error</cite> is the instance of <code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildError</span></code>, and
<cite>endpoint</cite> and <cite>**values</cite> are the arguments passed into <cite>url_for</cite>.  Note
that this is for building URLs outside the current application, and not for
handling 404 NotFound errors.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10: </span>The <cite>_scheme</cite> parameter was added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9: </span>The <cite>_anchor</cite> and <cite>_method</cite> parameters were added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9: </span>Calls <code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.handle_build_error()</span></code> on
<code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildError</span></code>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>endpoint</strong> – the endpoint of the URL (name of the function)</li>
<li><strong>values</strong> – the variable arguments of the URL rule</li>
<li><strong>_external</strong> – if set to <cite>True</cite>, an absolute URL is generated. Server
address can be changed via <cite>SERVER_NAME</cite> configuration variable which
defaults to <cite>localhost</cite>.</li>
<li><strong>_scheme</strong> – a string specifying the desired URL scheme. The <cite>_external</cite>
parameter must be set to <cite>True</cite> or a <cite>ValueError</cite> is raised.</li>
<li><strong>_anchor</strong> – if provided this is added as anchor to the URL.</li>
<li><strong>_method</strong> – if provided this explicitly specifies an HTTP method.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.abort">
<code class="descclassname">flask.</code><code class="descname">abort</code><span class="sig-paren">(</span><em>code</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.abort" title="Ссылка на это определение">¶</a></dt>
<dd><p>Вызывает исключение <a class="reference external" href="http://werkzeug.pocoo.org/docs/exceptions/#werkzeug.exceptions.HTTPException" title="(в Werkzeug v0.14-dev)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">HTTPException</span></code></a> для переданного
кода ответа. Например для отмены запроса и ответа со статусом 404 - страница
не найдена, вы можете вызвать <code class="docutils literal notranslate"><span class="pre">abort(404)</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>code</strong> – код ответа HTTP.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.redirect">
<code class="descclassname">flask.</code><code class="descname">redirect</code><span class="sig-paren">(</span><em>location</em>, <em>code=302</em>, <em>Response=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.redirect" title="Ссылка на это определение">¶</a></dt>
<dd><p>Returns a response object (a WSGI application) that, if called,
redirects the client to the target location.  Supported codes are 301,
302, 303, 305, and 307.  300 is not supported because it’s not a real
redirect and 304 because it’s the answer for a request with a request
with defined If-Modified-Since headers.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.6: </span>The location can now be a unicode string that is encoded using
the <code class="xref py py-func docutils literal notranslate"><span class="pre">iri_to_uri()</span></code> function.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10: </span>The class used for the Response object can now be passed in.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>location</strong> – the location the response should redirect to.</li>
<li><strong>code</strong> – the redirect status code. defaults to 302.</li>
<li><strong>Response</strong> (<em>class</em>) – a Response class to use when instantiating a
response. The default is <a class="reference external" href="http://werkzeug.pocoo.org/docs/wrappers/#werkzeug.wrappers.Response" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">werkzeug.wrappers.Response</span></code></a> if
unspecified.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.make_response">
<code class="descclassname">flask.</code><code class="descname">make_response</code><span class="sig-paren">(</span><em>*args</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.make_response" title="Ссылка на это определение">¶</a></dt>
<dd><p>Sometimes it is necessary to set additional headers in a view.  Because
views do not have to return response objects but can return a value that
is converted into a response object by Flask itself, it becomes tricky to
add headers to it.  This function can be called instead of using a return
and you will get a response object which you can use to attach headers.</p>
<p>If view looked like this and you want to add a new header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>You can now do something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Parachutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;parachutes are cool&#39;</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p>This function accepts the very same arguments you can return from a
view function.  This for example creates a response with a 404 error
code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;not_found.html&#39;</span><span class="p">),</span> <span class="mi">404</span><span class="p">)</span>
</pre></div>
</div>
<p>The other use case of this function is to force the return value of a
view function into a response which is helpful with view
decorators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">view_function</span><span class="p">())</span>
<span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Parachutes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;parachutes are cool&#39;</span>
</pre></div>
</div>
<p>Internally this function does the following things:</p>
<ul class="simple">
<li>if no arguments are passed, it creates a new response argument</li>
<li>if one argument is passed, <a class="reference internal" href="#flask.Flask.make_response" title="flask.Flask.make_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.make_response()</span></code></a>
is invoked with it.</li>
<li>if more than one argument is passed, the arguments are passed
to the <a class="reference internal" href="#flask.Flask.make_response" title="flask.Flask.make_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.make_response()</span></code></a> function as tuple.</li>
</ul>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.6.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="flask.after_this_request">
<code class="descclassname">flask.</code><code class="descname">after_this_request</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.after_this_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Executes a function after this request.  This is useful to modify
response objects.  The function is passed the response object and has
to return the same or a new one.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="nd">@after_this_request</span>
    <span class="k">def</span> <span class="nf">add_header</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-Foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Parachute&#39;</span>
        <span class="k">return</span> <span class="n">response</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>This is more useful if a function other than the view function wants to
modify a response.  For instance think of a decorator that wants to add
some headers without converting the return value into a response object.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="flask.send_file">
<code class="descclassname">flask.</code><code class="descname">send_file</code><span class="sig-paren">(</span><em>filename_or_fp</em>, <em>mimetype=None</em>, <em>as_attachment=False</em>, <em>attachment_filename=None</em>, <em>add_etags=True</em>, <em>cache_timeout=None</em>, <em>conditional=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.send_file" title="Ссылка на это определение">¶</a></dt>
<dd><p>Sends the contents of a file to the client.  This will use the
most efficient method available and configured.  By default it will
try to use the WSGI server’s file_wrapper support.  Alternatively
you can set the application’s <a class="reference internal" href="#flask.Flask.use_x_sendfile" title="flask.Flask.use_x_sendfile"><code class="xref py py-attr docutils literal notranslate"><span class="pre">use_x_sendfile</span></code></a> attribute
to <code class="docutils literal notranslate"><span class="pre">True</span></code> to directly emit an <cite>X-Sendfile</cite> header.  This however
requires support of the underlying webserver for <cite>X-Sendfile</cite>.</p>
<p>By default it will try to guess the mimetype for you, but you can
also explicitly provide one.  For extra security you probably want
to send certain files as attachment (HTML for instance).  The mimetype
guessing requires a <cite>filename</cite> or an <cite>attachment_filename</cite> to be
provided.</p>
<p>Please never pass filenames to this function from user sources without
checking them first.  Something like this is usually sufficient to
avoid security problems:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s1">&#39;..&#39;</span> <span class="ow">in</span> <span class="n">filename</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
    <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.2.</span></p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5: </span>The <cite>add_etags</cite>, <cite>cache_timeout</cite> and <cite>conditional</cite> parameters were
added.  The default behavior is now to attach etags.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.7: </span>mimetype guessing and etag support for file objects was
deprecated because it was unreliable.  Pass a filename if you are
able to, otherwise attach an etag yourself.  This functionality
will be removed in Flask 1.0</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.9: </span>cache_timeout pulls its default from application config, when None.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>filename_or_fp</strong> – the filename of the file to send.  This is
relative to the <code class="xref py py-attr docutils literal notranslate"><span class="pre">root_path</span></code> if a
relative path is specified.
Alternatively a file object might be provided
in which case <cite>X-Sendfile</cite> might not work and
fall back to the traditional method.  Make sure
that the file pointer is positioned at the start
of data to send before calling <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>.</li>
<li><strong>mimetype</strong> – the mimetype of the file if provided, otherwise
auto detection happens.</li>
<li><strong>as_attachment</strong> – set to <cite>True</cite> if you want to send this file with
a <code class="docutils literal notranslate"><span class="pre">Content-Disposition:</span> <span class="pre">attachment</span></code> header.</li>
<li><strong>attachment_filename</strong> – the filename for the attachment if it
differs from the file’s filename.</li>
<li><strong>add_etags</strong> – set to <cite>False</cite> to disable attaching of etags.</li>
<li><strong>conditional</strong> – set to <cite>True</cite> to enable conditional responses.</li>
<li><strong>cache_timeout</strong> – the timeout in seconds for the headers. When <cite>None</cite>
(default), this value is set by
<a class="reference internal" href="#flask.Flask.get_send_file_max_age" title="flask.Flask.get_send_file_max_age"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_send_file_max_age()</span></code></a> of
<a class="reference internal" href="#flask.current_app" title="flask.current_app"><code class="xref py py-data docutils literal notranslate"><span class="pre">current_app</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.send_from_directory">
<code class="descclassname">flask.</code><code class="descname">send_from_directory</code><span class="sig-paren">(</span><em>directory</em>, <em>filename</em>, <em>**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.send_from_directory" title="Ссылка на это определение">¶</a></dt>
<dd><p>Send a file from a given directory with <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>.  This
is a secure way to quickly expose static files from an upload folder
or something similar.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/uploads/&lt;path:filename&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">],</span>
                               <span class="n">filename</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-sending-files-and-performance admonition">
<p class="first admonition-title">Sending files and Performance</p>
<p class="last">It is strongly recommended to activate either <cite>X-Sendfile</cite> support in
your webserver or (if no authentication happens) to tell the webserver
to serve files for the given path on its own without calling into the
web application for improved performance.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.5.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>directory</strong> – the directory where all the files are stored.</li>
<li><strong>filename</strong> – the filename relative to that directory to
download.</li>
<li><strong>options</strong> – optional keyword arguments that are directly
forwarded to <a class="reference internal" href="#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.safe_join">
<code class="descclassname">flask.</code><code class="descname">safe_join</code><span class="sig-paren">(</span><em>directory</em>, <em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.safe_join" title="Ссылка на это определение">¶</a></dt>
<dd><p>Safely join <cite>directory</cite> and <cite>filename</cite>.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/wiki/&lt;path:filename&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">wiki_page</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">safe_join</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;WIKI_FOLDER&#39;</span><span class="p">],</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c1"># Read and process the file content...</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first simple">
<li><strong>directory</strong> – the base directory.</li>
<li><strong>filename</strong> – the untrusted filename relative to that directory.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><a class="reference external" href="http://werkzeug.pocoo.org/docs/exceptions/#werkzeug.exceptions.NotFound" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NotFound</span></code></a> if the resulting path
would fall out of <cite>directory</cite>.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.escape">
<code class="descclassname">flask.</code><code class="descname">escape</code><span class="sig-paren">(</span><em>s</em><span class="sig-paren">)</span> &#x2192; markup<a class="headerlink" href="#flask.escape" title="Ссылка на это определение">¶</a></dt>
<dd><p>Convert the characters &amp;, &lt;, &gt;, „, and » in string s to HTML-safe
sequences.  Use this if you need to display text that might contain
such characters in HTML.  Marks return value as markup string.</p>
</dd></dl>

<dl class="class">
<dt id="flask.Markup">
<em class="property">class </em><code class="descclassname">flask.</code><code class="descname">Markup</code><a class="headerlink" href="#flask.Markup" title="Ссылка на это определение">¶</a></dt>
<dd><p>A string that is ready to be safely inserted into an HTML or XML
document, either because it was escaped or because it was marked
safe.</p>
<p>Passing an object to the constructor converts it to text and wraps
it to mark it safe without escaping. To escape the text, use the
<a class="reference internal" href="#flask.escape" title="flask.escape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">escape()</span></code></a> class method instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;Hello, &lt;em&gt;World&lt;/em&gt;!&#39;</span><span class="p">)</span>
<span class="go">Markup(&#39;Hello, &lt;em&gt;World&lt;/em&gt;!&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="go">Markup(&#39;42&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s1">&#39;Hello, &lt;em&gt;World&lt;/em&gt;!&#39;</span><span class="p">)</span>
<span class="go">Markup(&#39;Hello &amp;lt;em&amp;gt;World&amp;lt;/em&amp;gt;!&#39;)</span>
</pre></div>
</div>
<p>This implements the <code class="docutils literal notranslate"><span class="pre">__html__()</span></code> interface that some frameworks
use. Passing an object that implements <code class="docutils literal notranslate"><span class="pre">__html__()</span></code> will wrap the
output of that method, marking it safe.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__html__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s1">&#39;&lt;a href=&quot;/foo&quot;&gt;foo&lt;/a&gt;&#39;</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="n">Foo</span><span class="p">())</span>
<span class="go">Markup(&#39;&lt;a href=&quot;/foo&quot;&gt;foo&lt;/a&gt;&#39;)</span>
</pre></div>
</div>
<p>This is a subclass of the text type (<code class="docutils literal notranslate"><span class="pre">str</span></code> in Python 3,
<code class="docutils literal notranslate"><span class="pre">unicode</span></code> in Python 2). It has the same methods as that type, but
all methods escape their arguments and return a <code class="docutils literal notranslate"><span class="pre">Markup</span></code> instance.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;&lt;em&gt;</span><span class="si">%s</span><span class="s1">&lt;/em&gt;&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="s1">&#39;foo &amp; bar&#39;</span>
<span class="go">Markup(&#39;&lt;em&gt;foo &amp;amp; bar&lt;/em&gt;&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;&lt;em&gt;Hello&lt;/em&gt; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;foo&gt;&#39;</span>
<span class="go">Markup(&#39;&lt;em&gt;Hello&lt;/em&gt; &amp;lt;foo&amp;gt;&#39;)</span>
</pre></div>
</div>
<dl class="classmethod">
<dt id="flask.Markup.escape">
<em class="property">classmethod </em><code class="descname">escape</code><span class="sig-paren">(</span><em>s</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Markup.escape" title="Ссылка на это определение">¶</a></dt>
<dd><p>Escape a string. Calls <a class="reference internal" href="#flask.escape" title="flask.escape"><code class="xref py py-func docutils literal notranslate"><span class="pre">escape()</span></code></a> and ensures that for
subclasses the correct type is returned.</p>
</dd></dl>

<dl class="method">
<dt id="flask.Markup.striptags">
<code class="descname">striptags</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Markup.striptags" title="Ссылка на это определение">¶</a></dt>
<dd><p><a class="reference internal" href="#flask.Markup.unescape" title="flask.Markup.unescape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unescape()</span></code></a> the markup, remove tags, and normalize
whitespace to single spaces.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;Main &amp;raquo;        &lt;em&gt;About&lt;/em&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">striptags</span><span class="p">()</span>
<span class="go">&#39;Main » About&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.Markup.unescape">
<code class="descname">unescape</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.Markup.unescape" title="Ссылка на это определение">¶</a></dt>
<dd><p>Convert escaped markup back into a text string. This replaces
HTML entities with the characters they represent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;Main &amp;raquo; &lt;em&gt;About&lt;/em&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unescape</span><span class="p">()</span>
<span class="go">&#39;Main » &lt;em&gt;About&lt;/em&gt;&#39;</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id10">
<h4>Передача сообщений<a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="function">
<dt id="flask.flash">
<code class="descclassname">flask.</code><code class="descname">flash</code><span class="sig-paren">(</span><em>message</em>, <em>category='message'</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.flash" title="Ссылка на это определение">¶</a></dt>
<dd><p>Flashes a message to the next request.  In order to remove the
flashed message from the session and to display it to the user,
the template has to call <a class="reference internal" href="#flask.get_flashed_messages" title="flask.get_flashed_messages"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_flashed_messages()</span></code></a>.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.3: </span><cite>category</cite> parameter added.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>message</strong> – the message to be flashed.</li>
<li><strong>category</strong> – the category for the message.  The following values
are recommended: <code class="docutils literal notranslate"><span class="pre">'message'</span></code> for any kind of message,
<code class="docutils literal notranslate"><span class="pre">'error'</span></code> for errors, <code class="docutils literal notranslate"><span class="pre">'info'</span></code> for information
messages and <code class="docutils literal notranslate"><span class="pre">'warning'</span></code> for warnings.  However any
kind of string can be used as category.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.get_flashed_messages">
<code class="descclassname">flask.</code><code class="descname">get_flashed_messages</code><span class="sig-paren">(</span><em>with_categories=False</em>, <em>category_filter=[]</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.get_flashed_messages" title="Ссылка на это определение">¶</a></dt>
<dd><p>Pulls all flashed messages from the session and returns them.
Further calls in the same request to the function will return
the same messages.  By default just the messages are returned,
but when <cite>with_categories</cite> is set to <cite>True</cite>, the return value will
be a list of tuples in the form <code class="docutils literal notranslate"><span class="pre">(category,</span> <span class="pre">message)</span></code> instead.</p>
<p>Filter the flashed messages to one or more categories by providing those
categories in <cite>category_filter</cite>.  This allows rendering categories in
separate html blocks.  The <cite>with_categories</cite> and <cite>category_filter</cite>
arguments are distinct:</p>
<ul class="simple">
<li><cite>with_categories</cite> controls whether categories are returned with message
text (<cite>True</cite> gives a tuple, where <cite>False</cite> gives just the message text).</li>
<li><cite>category_filter</cite> filters the messages down to only those matching the
provided categories.</li>
</ul>
<p>See <a class="reference internal" href="index.html#message-flashing-pattern"><span class="std std-ref">Всплывающие сообщения</span></a> for examples.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.3: </span><cite>with_categories</cite> parameter added.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.9: </span><cite>category_filter</cite> parameter added.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>with_categories</strong> – set to <cite>True</cite> to also receive categories.</li>
<li><strong>category_filter</strong> – whitelist of categories to limit return values</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-flask.json">
<span id="json"></span><h4>Поддержка JSON<a class="headerlink" href="#module-flask.json" title="Ссылка на этот заголовок">¶</a></h4>
<p>Flask использует <code class="docutils literal notranslate"><span class="pre">simplejson</span></code> в качестве JSON имплементации. Flask будет
пытаться использовать библиотеку simplejson, и в случае если ее нет - будет
использовать стандартный JSON модуль. Поверх этого предоставляется доступ к JSON
сериализаторам и десериализаторам текущего приложения для облегчения расширения.</p>
<p>Для начала попробуем следующее:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">simplejson</span> <span class="k">as</span> <span class="nn">json</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>
</pre></div>
</div>
<p>Вместо этого можно просто сделать так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">json</span>
</pre></div>
</div>
<p>В качестве примера использования прочитайте документацию к <a class="reference external" href="https://docs.python.org/dev/library/json.html#module-json" title="(в Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code></a> в
стандартной библиотеке. Следующие расширения по умолчанию добавлены в
стандартный JSON модуль:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">datetime</span></code> объекты, которые могут быть сериализированы в строки
<span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc822.html"><strong>RFC 822</strong></a>.</li>
<li>Любые объекты, имеющие метод <code class="docutils literal notranslate"><span class="pre">__html__</span></code> (такие как <a class="reference internal" href="#flask.Markup" title="flask.Markup"><code class="xref py py-class docutils literal notranslate"><span class="pre">Markup</span></code></a>
). Будет вызван метод <code class="docutils literal notranslate"><span class="pre">__html__</span></code> и возвращаемое значение будет
представлено как строка.</li>
</ol>
<p>Функция <code class="xref py py-func docutils literal notranslate"><span class="pre">htmlsafe_dumps()</span></code> этого json модуля также доступна через вызов
фильтра <code class="docutils literal notranslate"><span class="pre">|tojson</span></code> в Jinja2. Заметьте, что внутри <cite>script</cite> тегов данные
экранируются, так что убедитесь, что вы отключили экранирование с <code class="docutils literal notranslate"><span class="pre">|safe</span></code> если
вы хотите исопльзовать внутри <cite>script</cite> теги:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">text/javascript</span><span class="p">&gt;</span>
    <span class="nx">doSomethingWith</span><span class="p">(</span><span class="cp">{{</span> <span class="nv">user.username</span><span class="o">|</span><span class="nf">tojson</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="admonition-json admonition">
<p class="first admonition-title">Автосортировка ключей JSON</p>
<p>Переменная конфигурации <code class="docutils literal notranslate"><span class="pre">JSON_SORT_KEYS</span></code> (<a class="reference internal" href="index.html#config"><span class="std std-ref">Обработка конфигурации Flask</span></a>) может быть
установлена в false для предотвращения автосортировки ключей в Flask. По
умолчанию сортировка включена и вне контекста приложения сортировка так же
включена.</p>
<p class="last">Заметьте, что отключение сортировки ключей может вызвать проблемы при
кэшировании результата.</p>
</div>
<dl class="function">
<dt id="flask.json.jsonify">
<code class="descclassname">flask.json.</code><code class="descname">jsonify</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.jsonify" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates a <a class="reference internal" href="#flask.Response" title="flask.Response"><code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code></a> with the JSON representation of
the given arguments with an <cite>application/json</cite> mimetype.  The arguments
to this function are the same as to the <a class="reference external" href="https://docs.python.org/dev/library/stdtypes.html#dict" title="(в Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> constructor.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">jsonify</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/_get_current_user&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_current_user</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                   <span class="n">email</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                   <span class="nb">id</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
<p>This will send a JSON response like this to the browser:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;admin@localhost&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">42</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For security reasons only objects are supported toplevel.  For more
information about this, have a look at <span class="xref std std-ref">json-security</span>.</p>
<p>This function’s response will be pretty printed if it was not requested
with <code class="docutils literal notranslate"><span class="pre">X-Requested-With:</span> <span class="pre">XMLHttpRequest</span></code> to simplify debugging unless
the <code class="docutils literal notranslate"><span class="pre">JSONIFY_PRETTYPRINT_REGULAR</span></code> config parameter is set to false.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.2.</span></p>
</div>
</dd></dl>

<dl class="function">
<dt id="flask.json.dumps">
<code class="descclassname">flask.json.</code><code class="descname">dumps</code><span class="sig-paren">(</span><em>obj</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.dumps" title="Ссылка на это определение">¶</a></dt>
<dd><p>Serialize <code class="docutils literal notranslate"><span class="pre">obj</span></code> to a JSON formatted <code class="docutils literal notranslate"><span class="pre">str</span></code> by using the application’s
configured encoder (<a class="reference internal" href="#flask.Flask.json_encoder" title="flask.Flask.json_encoder"><code class="xref py py-attr docutils literal notranslate"><span class="pre">json_encoder</span></code></a>) if there is an
application on the stack.</p>
<p>This function can return <code class="docutils literal notranslate"><span class="pre">unicode</span></code> strings or ascii-only bytestrings by
default which coerce into unicode strings automatically.  That behavior by
default is controlled by the <code class="docutils literal notranslate"><span class="pre">JSON_AS_ASCII</span></code> configuration variable
and can be overriden by the simplejson <code class="docutils literal notranslate"><span class="pre">ensure_ascii</span></code> parameter.</p>
</dd></dl>

<dl class="function">
<dt id="flask.json.dump">
<code class="descclassname">flask.json.</code><code class="descname">dump</code><span class="sig-paren">(</span><em>obj</em>, <em>fp</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.dump" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.json.dumps" title="flask.json.dumps"><code class="xref py py-func docutils literal notranslate"><span class="pre">dumps()</span></code></a> but writes into a file object.</p>
</dd></dl>

<dl class="function">
<dt id="flask.json.loads">
<code class="descclassname">flask.json.</code><code class="descname">loads</code><span class="sig-paren">(</span><em>s</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.loads" title="Ссылка на это определение">¶</a></dt>
<dd><p>Unserialize a JSON object from a string <code class="docutils literal notranslate"><span class="pre">s</span></code> by using the application’s
configured decoder (<a class="reference internal" href="#flask.Flask.json_decoder" title="flask.Flask.json_decoder"><code class="xref py py-attr docutils literal notranslate"><span class="pre">json_decoder</span></code></a>) if there is an
application on the stack.</p>
</dd></dl>

<dl class="function">
<dt id="flask.json.load">
<code class="descclassname">flask.json.</code><code class="descname">load</code><span class="sig-paren">(</span><em>fp</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.load" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like <a class="reference internal" href="#flask.json.loads" title="flask.json.loads"><code class="xref py py-func docutils literal notranslate"><span class="pre">loads()</span></code></a> but reads from a file object.</p>
</dd></dl>

<dl class="class">
<dt id="flask.json.JSONEncoder">
<em class="property">class </em><code class="descclassname">flask.json.</code><code class="descname">JSONEncoder</code><span class="sig-paren">(</span><em>*</em>, <em>skipkeys=False</em>, <em>ensure_ascii=True</em>, <em>check_circular=True</em>, <em>allow_nan=True</em>, <em>sort_keys=False</em>, <em>indent=None</em>, <em>separators=None</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.JSONEncoder" title="Ссылка на это определение">¶</a></dt>
<dd><p>The default Flask JSON encoder.  This one extends the default simplejson
encoder by also supporting <code class="docutils literal notranslate"><span class="pre">datetime</span></code> objects, <code class="docutils literal notranslate"><span class="pre">UUID</span></code> as well as
<code class="docutils literal notranslate"><span class="pre">Markup</span></code> objects which are serialized as RFC 822 datetime strings (same
as the HTTP date format).  In order to support more data types override the
<a class="reference internal" href="#flask.json.JSONEncoder.default" title="flask.json.JSONEncoder.default"><code class="xref py py-meth docutils literal notranslate"><span class="pre">default()</span></code></a> method.</p>
<dl class="method">
<dt id="flask.json.JSONEncoder.default">
<code class="descname">default</code><span class="sig-paren">(</span><em>o</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.JSONEncoder.default" title="Ссылка на это определение">¶</a></dt>
<dd><p>Implement this method in a subclass such that it returns a
serializable object for <code class="docutils literal notranslate"><span class="pre">o</span></code>, or calls the base implementation (to
raise a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>).</p>
<p>For example, to support arbitrary iterators, you could implement
default like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">iterable</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.json.JSONDecoder">
<em class="property">class </em><code class="descclassname">flask.json.</code><code class="descname">JSONDecoder</code><span class="sig-paren">(</span><em>*</em>, <em>object_hook=None</em>, <em>parse_float=None</em>, <em>parse_int=None</em>, <em>parse_constant=None</em>, <em>strict=True</em>, <em>object_pairs_hook=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.json.JSONDecoder" title="Ссылка на это определение">¶</a></dt>
<dd><p>The default JSON decoder.  This one does not change the behavior from
the default simplejson encoder.  Consult the <a class="reference external" href="https://docs.python.org/dev/library/json.html#module-json" title="(в Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code></a> documentation
for more information.  This decoder is not only used for the load
functions of this module but also <a class="reference internal" href="#flask.Request" title="flask.Request"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Request</span></code></a>.</p>
</dd></dl>

</div>
<div class="section" id="id11">
<h4>Отрисовка шаблонов<a class="headerlink" href="#id11" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="function">
<dt id="flask.render_template">
<code class="descclassname">flask.</code><code class="descname">render_template</code><span class="sig-paren">(</span><em>template_name_or_list</em>, <em>**context</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.render_template" title="Ссылка на это определение">¶</a></dt>
<dd><p>Renders a template from the template folder with the given
context.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>template_name_or_list</strong> – the name of the template to be
rendered, or an iterable with template names
the first one existing will be rendered</li>
<li><strong>context</strong> – the variables that should be available in the
context of the template.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.render_template_string">
<code class="descclassname">flask.</code><code class="descname">render_template_string</code><span class="sig-paren">(</span><em>source</em>, <em>**context</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.render_template_string" title="Ссылка на это определение">¶</a></dt>
<dd><p>Renders a template from the given template source string
with the given context.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>source</strong> – the sourcecode of the template to be
rendered</li>
<li><strong>context</strong> – the variables that should be available in the
context of the template.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="flask.get_template_attribute">
<code class="descclassname">flask.</code><code class="descname">get_template_attribute</code><span class="sig-paren">(</span><em>template_name</em>, <em>attribute</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.get_template_attribute" title="Ссылка на это определение">¶</a></dt>
<dd><p>Loads a macro (or variable) a template exports.  This can be used to
invoke a macro from within Python code.  If you for example have a
template named <cite>_cider.html</cite> with the following contents:</p>
<div class="highlight-html+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">macro</span> <span class="nv">hello</span><span class="o">(</span><span class="nv">name</span><span class="o">)</span> <span class="cp">%}</span>Hello <span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span>!<span class="cp">{%</span> <span class="k">endmacro</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>You can access this from Python code like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hello</span> <span class="o">=</span> <span class="n">get_template_attribute</span><span class="p">(</span><span class="s1">&#39;_cider.html&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="k">return</span> <span class="n">hello</span><span class="p">(</span><span class="s1">&#39;World&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.2.</span></p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>template_name</strong> – the name of the template</li>
<li><strong>attribute</strong> – the name of the variable of macro to access</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="id12">
<h4>Конфигурация<a class="headerlink" href="#id12" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="class">
<dt id="flask.Config">
<em class="property">class </em><code class="descclassname">flask.</code><code class="descname">Config</code><span class="sig-paren">(</span><em>root_path</em>, <em>defaults=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Config" title="Ссылка на это определение">¶</a></dt>
<dd><p>Works exactly like a dict but provides ways to fill it from files
or special dictionaries.  There are two common patterns to populate the
config.</p>
<p>Either you can fill the config from a config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="s1">&#39;yourconfig.cfg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or alternatively you can define the configuration options in the
module that calls <a class="reference internal" href="#flask.Config.from_object" title="flask.Config.from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_object()</span></code></a> or provide an import path to
a module that should be loaded.  It is also possible to tell it to
use the same module and with that provide the configuration values
just before the call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s1">&#39;development key&#39;</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>
</div>
<p>In both cases (loading from any Python file or loading from modules),
only uppercase keys are added to the config.  This makes it possible to use
lowercase values in the config file for temporary values that are not added
to the config or to define the config keys in the same file that implements
the application.</p>
<p>Probably the most interesting way to load configurations is from an
environment variable pointing to a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_envvar</span><span class="p">(</span><span class="s1">&#39;YOURAPPLICATION_SETTINGS&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case before launching the application you have to set this
environment variable to the file you want to use.  On Linux and OS X
use the export statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">YOURAPPLICATION_SETTINGS</span><span class="o">=</span><span class="s1">&#39;/path/to/config/file&#39;</span>
</pre></div>
</div>
<p>On windows use <cite>set</cite> instead.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>root_path</strong> – path to which files are read relative from.  When the
config object is created by the application, this is
the application’s <code class="xref py py-attr docutils literal notranslate"><span class="pre">root_path</span></code>.</li>
<li><strong>defaults</strong> – an optional dictionary of default values</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="flask.Config.from_envvar">
<code class="descname">from_envvar</code><span class="sig-paren">(</span><em>variable_name</em>, <em>silent=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Config.from_envvar" title="Ссылка на это определение">¶</a></dt>
<dd><p>Loads a configuration from an environment variable pointing to
a configuration file.  This is basically just a shortcut with nicer
error messages for this line of code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_pyfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;YOURAPPLICATION_SETTINGS&#39;</span><span class="p">])</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first simple">
<li><strong>variable_name</strong> – name of the environment variable</li>
<li><strong>silent</strong> – set to <cite>True</cite> if you want silent failure for missing
files.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Результат:</th><td class="field-body"><p class="first last">bool. <cite>True</cite> if able to load config, <cite>False</cite> otherwise.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Config.from_object">
<code class="descname">from_object</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Config.from_object" title="Ссылка на это определение">¶</a></dt>
<dd><p>Updates the values from the given object.  An object can be of one
of the following two types:</p>
<ul class="simple">
<li>a string: in this case the object with that name will be imported</li>
<li>an actual object reference: that object is used directly</li>
</ul>
<p>Objects are usually either modules or classes.</p>
<p>Just the uppercase variables in that object are stored in the config.
Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s1">&#39;yourapplication.default_config&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">yourapplication</span> <span class="k">import</span> <span class="n">default_config</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">default_config</span><span class="p">)</span>
</pre></div>
</div>
<p>You should not use this function to load the actual configuration but
rather configuration defaults.  The actual config should be loaded
with <a class="reference internal" href="#flask.Config.from_pyfile" title="flask.Config.from_pyfile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_pyfile()</span></code></a> and ideally from a location not within the
package because the package might be installed system wide.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><strong>obj</strong> – an import name or object</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="flask.Config.from_pyfile">
<code class="descname">from_pyfile</code><span class="sig-paren">(</span><em>filename</em>, <em>silent=False</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.Config.from_pyfile" title="Ссылка на это определение">¶</a></dt>
<dd><p>Updates the values in the config from a Python file.  This function
behaves as if the file was imported as module with the
<a class="reference internal" href="#flask.Config.from_object" title="flask.Config.from_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_object()</span></code></a> function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Параметры:</th><td class="field-body"><ul class="first last simple">
<li><strong>filename</strong> – the filename of the config.  This can either be an
absolute filename or a filename relative to the
root path.</li>
<li><strong>silent</strong> – set to <cite>True</cite> if you want silent failure for missing
files.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7: </span><cite>silent</cite> parameter.</p>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id13">
<h4>Расширения<a class="headerlink" href="#id13" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="data">
<dt id="flask.flask.ext">
<code class="descclassname">flask.</code><code class="descname">ext</code><a class="headerlink" href="#flask.flask.ext" title="Ссылка на это определение">¶</a></dt>
<dd><p>Этот модуль отвечает за перенаправление импорта к расширениям Flask. Он был
добавлен в версии 0.8 как канонический путь для импорта расширений Flask и
дает нам возможность создавать расширяемые и распространяемые дополнения.</p>
<p>Если вы хотите использовать расширение с именем “Flask-Foo” вы должны
импортировать его из <a class="reference internal" href="#flask.flask.ext" title="flask.flask.ext"><code class="xref py py-data docutils literal notranslate"><span class="pre">ext</span></code></a> как указано:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask.ext</span> <span class="k">import</span> <span class="n">foo</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="id14">
<h4>Потоки<a class="headerlink" href="#id14" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="function">
<dt id="flask.stream_with_context">
<code class="descclassname">flask.</code><code class="descname">stream_with_context</code><span class="sig-paren">(</span><em>generator_or_function</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.stream_with_context" title="Ссылка на это определение">¶</a></dt>
<dd><p>Request contexts disappear when the response is started on the server.
This is done for efficiency reasons and to make it less likely to encounter
memory leaks with badly written WSGI middlewares.  The downside is that if
you are using streamed responses, the generator cannot access request bound
information any more.</p>
<p>This function however can help you keep the context around for longer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">stream_with_context</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/stream&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">streamed_response</span><span class="p">():</span>
    <span class="nd">@stream_with_context</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">():</span>
        <span class="k">yield</span> <span class="s1">&#39;Hello &#39;</span>
        <span class="k">yield</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">yield</span> <span class="s1">&#39;!&#39;</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">generate</span><span class="p">())</span>
</pre></div>
</div>
<p>Alternatively it can also be used around a specific generator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">stream_with_context</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/stream&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">streamed_response</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">():</span>
        <span class="k">yield</span> <span class="s1">&#39;Hello &#39;</span>
        <span class="k">yield</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">yield</span> <span class="s1">&#39;!&#39;</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">stream_with_context</span><span class="p">(</span><span class="n">generate</span><span class="p">()))</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
</dd></dl>

</div>
<div class="section" id="id15">
<h4>Внутренние дополнения<a class="headerlink" href="#id15" title="Ссылка на этот заголовок">¶</a></h4>
<dl class="class">
<dt id="flask.ctx.RequestContext">
<em class="property">class </em><code class="descclassname">flask.ctx.</code><code class="descname">RequestContext</code><span class="sig-paren">(</span><em>app</em>, <em>environ</em>, <em>request=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.RequestContext" title="Ссылка на это определение">¶</a></dt>
<dd><p>The request context contains all request relevant information.  It is
created at the beginning of the request and pushed to the
<cite>_request_ctx_stack</cite> and removed at the end of it.  It will create the
URL adapter and request object for the WSGI environment provided.</p>
<p>Do not attempt to use this class directly, instead use
<a class="reference internal" href="#flask.Flask.test_request_context" title="flask.Flask.test_request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_request_context()</span></code></a> and
<a class="reference internal" href="#flask.Flask.request_context" title="flask.Flask.request_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request_context()</span></code></a> to create this object.</p>
<p>When the request context is popped, it will evaluate all the
functions registered on the application for teardown execution
(<a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a>).</p>
<p>The request context is automatically popped at the end of the request
for you.  In debug mode the request context is kept around if
exceptions happen so that interactive debuggers have a chance to
introspect the data.  With 0.4 this can also be forced for requests
that did not fail and outside of <cite>DEBUG</cite> mode.  By setting
<code class="docutils literal notranslate"><span class="pre">'flask._preserve_context'</span></code> to <cite>True</cite> on the WSGI environment the
context will not pop itself at the end of the request.  This is used by
the <a class="reference internal" href="#flask.Flask.test_client" title="flask.Flask.test_client"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_client()</span></code></a> for example to implement the
deferred cleanup functionality.</p>
<p>You might find this helpful for unittests where you need the
information from the context local around for a little longer.  Make
sure to properly <code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code> the stack yourself in
that situation, otherwise your unittests will leak memory.</p>
<dl class="method">
<dt id="flask.ctx.RequestContext.copy">
<code class="descname">copy</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.RequestContext.copy" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates a copy of this request context with the same request object.
This can be used to move a request context to a different greenlet.
Because the actual request object is the same this cannot be used to
move a request context to a different thread unless access to the
request object is locked.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.ctx.RequestContext.match_request">
<code class="descname">match_request</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.RequestContext.match_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Can be overridden by a subclass to hook into the matching
of the request.</p>
</dd></dl>

<dl class="method">
<dt id="flask.ctx.RequestContext.pop">
<code class="descname">pop</code><span class="sig-paren">(</span><em>exc=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.RequestContext.pop" title="Ссылка на это определение">¶</a></dt>
<dd><p>Pops the request context and unbinds it by doing that.  This will
also trigger the execution of functions registered by the
<a class="reference internal" href="#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> decorator.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.9: </span>Added the <cite>exc</cite> argument.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.ctx.RequestContext.push">
<code class="descname">push</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.RequestContext.push" title="Ссылка на это определение">¶</a></dt>
<dd><p>Binds the request context to the current context.</p>
</dd></dl>

</dd></dl>

<dl class="data">
<dt id="flask._request_ctx_stack">
<code class="descclassname">flask.</code><code class="descname">_request_ctx_stack</code><a class="headerlink" href="#flask._request_ctx_stack" title="Ссылка на это определение">¶</a></dt>
<dd><p>Внутренний класс <a class="reference external" href="http://werkzeug.pocoo.org/docs/local/#werkzeug.local.LocalStack" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocalStack</span></code></a> используется для
имплементации всех локальных контекстных объектов используемых в Flask. Это
документированный инстанс и может быть использован в коде расширений или
приложений но использовать его не рекомендуется.</p>
<p>Следующие атрибуты всегда доступны на каждом слое стэка:</p>
<dl class="docutils">
<dt><cite>app</cite></dt>
<dd>активное приложение Flask.</dd>
<dt><cite>url_adapter</cite></dt>
<dd>URL адптер который использвется для поиска соответствий запроса.</dd>
<dt><cite>request</cite></dt>
<dd>текущий объект запроса.</dd>
<dt><cite>session</cite></dt>
<dd>активный объект сессии.</dd>
<dt><cite>g</cite></dt>
<dd>объект со всеми атрибутами объекта <a class="reference internal" href="#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.g</span></code></a>.</dd>
<dt><cite>flashes</cite></dt>
<dd>внутренний кэш для флеш сообщений.</dd>
</dl>
<p>Пример использования:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">_request_ctx_stack</span>

<span class="k">def</span> <span class="nf">get_session</span><span class="p">():</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">_request_ctx_stack</span><span class="o">.</span><span class="n">top</span>
    <span class="k">if</span> <span class="n">ctx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">session</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="flask.ctx.AppContext">
<em class="property">class </em><code class="descclassname">flask.ctx.</code><code class="descname">AppContext</code><span class="sig-paren">(</span><em>app</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.AppContext" title="Ссылка на это определение">¶</a></dt>
<dd><p>The application context binds an application object implicitly
to the current thread or greenlet, similar to how the
<a class="reference internal" href="#flask.ctx.RequestContext" title="flask.ctx.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> binds request information.  The application
context is also implicitly created if a request context is created
but the application is not on top of the individual application
context.</p>
<dl class="method">
<dt id="flask.ctx.AppContext.pop">
<code class="descname">pop</code><span class="sig-paren">(</span><em>exc=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.AppContext.pop" title="Ссылка на это определение">¶</a></dt>
<dd><p>Pops the app context.</p>
</dd></dl>

<dl class="method">
<dt id="flask.ctx.AppContext.push">
<code class="descname">push</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.ctx.AppContext.push" title="Ссылка на это определение">¶</a></dt>
<dd><p>Binds the app context to the current context.</p>
</dd></dl>

</dd></dl>

<dl class="data">
<dt id="flask._app_ctx_stack">
<code class="descclassname">flask.</code><code class="descname">_app_ctx_stack</code><a class="headerlink" href="#flask._app_ctx_stack" title="Ссылка на это определение">¶</a></dt>
<dd><p>Работает аналогично контексту запроса только привязан к приложению.
Используется в основном расширениями для хранения данных.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.9.</span></p>
</div>
</dd></dl>

<dl class="class">
<dt id="flask.blueprints.BlueprintSetupState">
<em class="property">class </em><code class="descclassname">flask.blueprints.</code><code class="descname">BlueprintSetupState</code><span class="sig-paren">(</span><em>blueprint</em>, <em>app</em>, <em>options</em>, <em>first_registration</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.blueprints.BlueprintSetupState" title="Ссылка на это определение">¶</a></dt>
<dd><p>Temporary holder object for registering a blueprint with the
application.  An instance of this class is created by the
<a class="reference internal" href="#flask.Blueprint.make_setup_state" title="flask.Blueprint.make_setup_state"><code class="xref py py-meth docutils literal notranslate"><span class="pre">make_setup_state()</span></code></a> method and later passed
to all register callback functions.</p>
<dl class="method">
<dt id="flask.blueprints.BlueprintSetupState.add_url_rule">
<code class="descname">add_url_rule</code><span class="sig-paren">(</span><em>rule</em>, <em>endpoint=None</em>, <em>view_func=None</em>, <em>**options</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.add_url_rule" title="Ссылка на это определение">¶</a></dt>
<dd><p>A helper method to register a rule (and optionally a view function)
to the application.  The endpoint is automatically prefixed with the
blueprint’s name.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.app">
<code class="descname">app</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.app" title="Ссылка на это определение">¶</a></dt>
<dd><p>a reference to the current application</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.blueprint">
<code class="descname">blueprint</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.blueprint" title="Ссылка на это определение">¶</a></dt>
<dd><p>a reference to the blueprint that created this setup state.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.first_registration">
<code class="descname">first_registration</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.first_registration" title="Ссылка на это определение">¶</a></dt>
<dd><p>as blueprints can be registered multiple times with the
application and not everything wants to be registered
multiple times on it, this attribute can be used to figure
out if the blueprint was registered in the past already.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.options">
<code class="descname">options</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.options" title="Ссылка на это определение">¶</a></dt>
<dd><p>a dictionary with all options that were passed to the
<a class="reference internal" href="#flask.Flask.register_blueprint" title="flask.Flask.register_blueprint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register_blueprint()</span></code></a> method.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.subdomain">
<code class="descname">subdomain</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.subdomain" title="Ссылка на это определение">¶</a></dt>
<dd><p>The subdomain that the blueprint should be active for, <cite>None</cite>
otherwise.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.url_defaults">
<code class="descname">url_defaults</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.url_defaults" title="Ссылка на это определение">¶</a></dt>
<dd><p>A dictionary with URL defaults that is added to each and every
URL that was defined with the blueprint.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.blueprints.BlueprintSetupState.url_prefix">
<code class="descname">url_prefix</code><em class="property"> = None</em><a class="headerlink" href="#flask.blueprints.BlueprintSetupState.url_prefix" title="Ссылка на это определение">¶</a></dt>
<dd><p>The prefix that should be used for all URLs defined on the
blueprint.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id16">
<h4>Сигналы<a class="headerlink" href="#id16" title="Ссылка на этот заголовок">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.6.</span></p>
</div>
<dl class="data">
<dt id="flask.signals_available">
<code class="descclassname">flask.</code><code class="descname">signals_available</code><a class="headerlink" href="#flask.signals_available" title="Ссылка на это определение">¶</a></dt>
<dd><p><cite>True</cite> if the signaling system is available.  This is the case
when <a class="reference external" href="http://pypi.python.org/pypi/blinker">blinker</a> is installed.</p>
</dd></dl>

<dl class="data">
<dt id="flask.template_rendered">
<code class="descclassname">flask.</code><code class="descname">template_rendered</code><a class="headerlink" href="#flask.template_rendered" title="Ссылка на это определение">¶</a></dt>
<dd><p>This signal is sent when a template was successfully rendered.  The
signal is invoked with the instance of the template as <cite>template</cite>
and the context as dictionary (named <cite>context</cite>).</p>
</dd></dl>

<dl class="data">
<dt id="flask.request_started">
<code class="descclassname">flask.</code><code class="descname">request_started</code><a class="headerlink" href="#flask.request_started" title="Ссылка на это определение">¶</a></dt>
<dd><p>This signal is sent before any request processing started but when the
request context was set up.  Because the request context is already
bound, the subscriber can access the request with the standard global
proxies such as <a class="reference internal" href="#flask.request" title="flask.request"><code class="xref py py-class docutils literal notranslate"><span class="pre">request</span></code></a>.</p>
</dd></dl>

<dl class="data">
<dt id="flask.request_finished">
<code class="descclassname">flask.</code><code class="descname">request_finished</code><a class="headerlink" href="#flask.request_finished" title="Ссылка на это определение">¶</a></dt>
<dd><p>This signal is sent right before the response is sent to the client.
It is passed the response to be sent named <cite>response</cite>.</p>
</dd></dl>

<dl class="data">
<dt id="flask.got_request_exception">
<code class="descclassname">flask.</code><code class="descname">got_request_exception</code><a class="headerlink" href="#flask.got_request_exception" title="Ссылка на это определение">¶</a></dt>
<dd><p>This signal is sent when an exception happens during request processing.
It is sent <em>before</em> the standard exception handling kicks in and even
in debug mode, where no exception handling happens.  The exception
itself is passed to the subscriber as <cite>exception</cite>.</p>
</dd></dl>

<dl class="data">
<dt id="flask.request_tearing_down">
<code class="descclassname">flask.</code><code class="descname">request_tearing_down</code><a class="headerlink" href="#flask.request_tearing_down" title="Ссылка на это определение">¶</a></dt>
<dd><p>This signal is sent when the application is tearing down the request.
This is always called, even if an error happened.  An <cite>exc</cite> keyword
argument is passed with the exception that caused the teardown.</p>
<div class="versionchanged">
<p><span class="versionmodified">Изменено в версии 0.9: </span>The <cite>exc</cite> parameter was added.</p>
</div>
</dd></dl>

<dl class="data">
<dt id="flask.appcontext_tearing_down">
<code class="descclassname">flask.</code><code class="descname">appcontext_tearing_down</code><a class="headerlink" href="#flask.appcontext_tearing_down" title="Ссылка на это определение">¶</a></dt>
<dd><p>This signal is sent when the application is tearing down the
application context.  This is always called, even if an error happened.
An <cite>exc</cite> keyword argument is passed with the exception that caused the
teardown.  The sender is the application.</p>
</dd></dl>

<dl class="data">
<dt id="flask.appcontext_pushed">
<code class="descclassname">flask.</code><code class="descname">appcontext_pushed</code><a class="headerlink" href="#flask.appcontext_pushed" title="Ссылка на это определение">¶</a></dt>
<dd><p>This signal is sent when an application context is pushed.  The sender
is the application.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
</dd></dl>

<dl class="data">
<dt id="flask.appcontext_popped">
<code class="descclassname">flask.</code><code class="descname">appcontext_popped</code><a class="headerlink" href="#flask.appcontext_popped" title="Ссылка на это определение">¶</a></dt>
<dd><p>This signal is sent when an application context is popped.  The sender
is the application.  This usually falls in line with the
<a class="reference internal" href="#flask.appcontext_tearing_down" title="flask.appcontext_tearing_down"><code class="xref py py-data docutils literal notranslate"><span class="pre">appcontext_tearing_down</span></code></a> signal.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
</dd></dl>

<dl class="data">
<dt id="flask.message_flashed">
<code class="descclassname">flask.</code><code class="descname">message_flashed</code><a class="headerlink" href="#flask.message_flashed" title="Ссылка на это определение">¶</a></dt>
<dd><p>This signal is sent when the application is flashing a message.  The
messages is sent as <cite>message</cite> keyword argument and the category as
<cite>category</cite>.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.10.</span></p>
</div>
</dd></dl>

<dl class="class">
<dt id="flask.signals.Namespace">
<em class="property">class </em><code class="descclassname">flask.signals.</code><code class="descname">Namespace</code><a class="headerlink" href="#flask.signals.Namespace" title="Ссылка на это определение">¶</a></dt>
<dd><p>An alias for <a class="reference external" href="https://pythonhosted.org/blinker/index.html#blinker.base.Namespace" title="(в Blinker v1.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">blinker.base.Namespace</span></code></a> if blinker is available,
otherwise a dummy class that creates fake signals.  This class is
available for Flask extensions that want to provide the same fallback
system as Flask itself.</p>
<dl class="method">
<dt id="flask.signals.Namespace.signal">
<code class="descname">signal</code><span class="sig-paren">(</span><em>name</em>, <em>doc=None</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.signals.Namespace.signal" title="Ссылка на это определение">¶</a></dt>
<dd><p>Creates a new signal for this namespace if blinker is available,
otherwise returns a fake signal that has a send method that will
do nothing but will fail with a <a class="reference external" href="https://docs.python.org/dev/library/exceptions.html#RuntimeError" title="(в Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> for all other
operations, including connecting.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="class-based-views">
<h4>Class-Based Views<a class="headerlink" href="#class-based-views" title="Ссылка на этот заголовок">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.7.</span></p>
</div>
<dl class="class">
<dt id="flask.views.View">
<em class="property">class </em><code class="descclassname">flask.views.</code><code class="descname">View</code><a class="headerlink" href="#flask.views.View" title="Ссылка на это определение">¶</a></dt>
<dd><p>Alternative way to use view functions.  A subclass has to implement
<a class="reference internal" href="#flask.views.View.dispatch_request" title="flask.views.View.dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch_request()</span></code></a> which is called with the view arguments from
the URL routing system.  If <a class="reference internal" href="#flask.views.View.methods" title="flask.views.View.methods"><code class="xref py py-attr docutils literal notranslate"><span class="pre">methods</span></code></a> is provided the methods
do not have to be passed to the <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a>
method explicitly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Hello </span><span class="si">%s</span><span class="s1">!&#39;</span> <span class="o">%</span> <span class="n">name</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/hello/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">MyView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;myview&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>When you want to decorate a pluggable view you will have to either do that
when the view function is created (by wrapping the return value of
<a class="reference internal" href="#flask.views.View.as_view" title="flask.views.View.as_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_view()</span></code></a>) or you can use the <a class="reference internal" href="#flask.views.View.decorators" title="flask.views.View.decorators"><code class="xref py py-attr docutils literal notranslate"><span class="pre">decorators</span></code></a> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SecretView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]</span>
    <span class="n">decorators</span> <span class="o">=</span> <span class="p">[</span><span class="n">superuser_required</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">dispatch_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>The decorators stored in the decorators list are applied one after another
when the view function is created.  Note that you can <em>not</em> use the class
based decorators since those would decorate the view class and not the
generated view function!</p>
<dl class="classmethod">
<dt id="flask.views.View.as_view">
<em class="property">classmethod </em><code class="descname">as_view</code><span class="sig-paren">(</span><em>name</em>, <em>*class_args</em>, <em>**class_kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.views.View.as_view" title="Ссылка на это определение">¶</a></dt>
<dd><p>Converts the class into an actual view function that can be used
with the routing system.  Internally this generates a function on the
fly which will instantiate the <a class="reference internal" href="#flask.views.View" title="flask.views.View"><code class="xref py py-class docutils literal notranslate"><span class="pre">View</span></code></a> on each request and call
the <a class="reference internal" href="#flask.views.View.dispatch_request" title="flask.views.View.dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch_request()</span></code></a> method on it.</p>
<p>The arguments passed to <a class="reference internal" href="#flask.views.View.as_view" title="flask.views.View.as_view"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_view()</span></code></a> are forwarded to the
constructor of the class.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.views.View.decorators">
<code class="descname">decorators</code><em class="property"> = []</em><a class="headerlink" href="#flask.views.View.decorators" title="Ссылка на это определение">¶</a></dt>
<dd><p>The canonical way to decorate class-based views is to decorate the
return value of as_view().  However since this moves parts of the
logic from the class declaration to the place where it’s hooked
into the routing system.</p>
<p>You can place one or more decorators in this list and whenever the
view function is created the result is automatically decorated.</p>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8.</span></p>
</div>
</dd></dl>

<dl class="method">
<dt id="flask.views.View.dispatch_request">
<code class="descname">dispatch_request</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#flask.views.View.dispatch_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Subclasses have to override this method to implement the
actual view function code.  This method is called with all
the arguments from the URL rule.</p>
</dd></dl>

<dl class="attribute">
<dt id="flask.views.View.methods">
<code class="descname">methods</code><em class="property"> = None</em><a class="headerlink" href="#flask.views.View.methods" title="Ссылка на это определение">¶</a></dt>
<dd><p>A for which methods this pluggable view can handle.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="flask.views.MethodView">
<em class="property">class </em><code class="descclassname">flask.views.</code><code class="descname">MethodView</code><a class="headerlink" href="#flask.views.MethodView" title="Ссылка на это определение">¶</a></dt>
<dd><p>Like a regular class-based view but that dispatches requests to
particular methods.  For instance if you implement a method called
<code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code> it means you will response to <code class="docutils literal notranslate"><span class="pre">'GET'</span></code> requests and
the <a class="reference internal" href="#flask.views.MethodView.dispatch_request" title="flask.views.MethodView.dispatch_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch_request()</span></code></a> implementation will automatically
forward your request to that.  Also <code class="xref py py-attr docutils literal notranslate"><span class="pre">options</span></code> is set for you
automatically:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CounterAPI</span><span class="p">(</span><span class="n">MethodView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;counter&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;counter&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="s1">&#39;OK&#39;</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/counter&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">CounterAPI</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s1">&#39;counter&#39;</span><span class="p">))</span>
</pre></div>
</div>
<dl class="method">
<dt id="flask.views.MethodView.dispatch_request">
<code class="descname">dispatch_request</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#flask.views.MethodView.dispatch_request" title="Ссылка на это определение">¶</a></dt>
<dd><p>Subclasses have to override this method to implement the
actual view function code.  This method is called with all
the arguments from the URL rule.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="url-route-registrations">
<span id="id17"></span><h4>URL Route Registrations<a class="headerlink" href="#url-route-registrations" title="Ссылка на этот заголовок">¶</a></h4>
<p>Generally there are three ways to define rules for the routing system:</p>
<ol class="arabic simple">
<li>You can use the <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.route()</span></code></a> decorator.</li>
<li>You can use the <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flask.Flask.add_url_rule()</span></code></a> function.</li>
<li>You can directly access the underlying Werkzeug routing system
which is exposed as <a class="reference internal" href="#flask.Flask.url_map" title="flask.Flask.url_map"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.Flask.url_map</span></code></a>.</li>
</ol>
<p>Variable parts in the route can be specified with angular brackets
(<code class="docutils literal notranslate"><span class="pre">/user/&lt;username&gt;</span></code>).  By default a variable part in the URL accepts any
string without a slash however a different converter can be specified as
well by using <code class="docutils literal notranslate"><span class="pre">&lt;converter:name&gt;</span></code>.</p>
<p>Variable parts are passed to the view function as keyword arguments.</p>
<p>The following converters are available:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><cite>string</cite></td>
<td>accepts any text without a slash (the default)</td>
</tr>
<tr class="row-even"><td><cite>int</cite></td>
<td>accepts integers</td>
</tr>
<tr class="row-odd"><td><cite>float</cite></td>
<td>like <cite>int</cite> but for floating point values</td>
</tr>
<tr class="row-even"><td><cite>path</cite></td>
<td>like the default but also accepts slashes</td>
</tr>
</tbody>
</table>
<p>Here are some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;username&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_user</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/post/&lt;int:post_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_post</span><span class="p">(</span><span class="n">post_id</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>An important detail to keep in mind is how Flask deals with trailing
slashes.  The idea is to keep each URL unique so the following rules
apply:</p>
<ol class="arabic simple">
<li>If a rule ends with a slash and is requested without a slash by the
user, the user is automatically redirected to the same page with a
trailing slash attached.</li>
<li>If a rule does not end with a trailing slash and the user requests the
page with a trailing slash, a 404 not found is raised.</li>
</ol>
<p>This is consistent with how web servers deal with static files.  This
also makes it possible to use relative link targets safely.</p>
<p>You can also define multiple rules for the same function.  They have to be
unique however.  Defaults can also be specified.  Here for example is a
definition for a URL that accepts an optional page:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users/&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/users/page/&lt;int:page&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_users</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This specifies that <code class="docutils literal notranslate"><span class="pre">/users/</span></code> will be the URL for page one and
<code class="docutils literal notranslate"><span class="pre">/users/page/N</span></code> will be the URL for page <cite>N</cite>.</p>
<p>Here are the parameters that <a class="reference internal" href="#flask.Flask.route" title="flask.Flask.route"><code class="xref py py-meth docutils literal notranslate"><span class="pre">route()</span></code></a> and
<a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a> accept.  The only difference is that
with the route parameter the view function is defined with the decorator
instead of the <cite>view_func</cite> parameter.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><cite>rule</cite></td>
<td>the URL rule as string</td>
</tr>
<tr class="row-even"><td><cite>endpoint</cite></td>
<td>the endpoint for the registered URL rule.  Flask itself
assumes that the name of the view function is the name
of the endpoint if not explicitly stated.</td>
</tr>
<tr class="row-odd"><td><cite>view_func</cite></td>
<td>the function to call when serving a request to the
provided endpoint.  If this is not provided one can
specify the function later by storing it in the
<a class="reference internal" href="#flask.Flask.view_functions" title="flask.Flask.view_functions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">view_functions</span></code></a> dictionary with the
endpoint as key.</td>
</tr>
<tr class="row-even"><td><cite>defaults</cite></td>
<td>A dictionary with defaults for this rule.  See the
example above for how defaults work.</td>
</tr>
<tr class="row-odd"><td><cite>subdomain</cite></td>
<td>specifies the rule for the subdomain in case subdomain
matching is in use.  If not specified the default
subdomain is assumed.</td>
</tr>
<tr class="row-even"><td><cite>**options</cite></td>
<td>the options to be forwarded to the underlying
<a class="reference external" href="http://werkzeug.pocoo.org/docs/routing/#werkzeug.routing.Rule" title="(в Werkzeug v0.14-dev)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rule</span></code></a> object.  A change to
Werkzeug is handling of method options.  methods is a list
of methods this rule should be limited to (<cite>GET</cite>, <cite>POST</cite>
etc.).  By default a rule just listens for <cite>GET</cite> (and
implicitly <cite>HEAD</cite>).  Starting with Flask 0.6, <cite>OPTIONS</cite> is
implicitly added and handled by the standard request
handling.  They have to be specified as keyword arguments.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="view-function-options">
<span id="view-func-options"></span><h4>View Function Options<a class="headerlink" href="#view-function-options" title="Ссылка на этот заголовок">¶</a></h4>
<p>For internal usage the view functions can have some attributes attached to
customize behavior the view function would normally not have control over.
The following attributes can be provided optionally to either override
some defaults to <a class="reference internal" href="#flask.Flask.add_url_rule" title="flask.Flask.add_url_rule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_url_rule()</span></code></a> or general behavior:</p>
<ul class="simple">
<li><cite>__name__</cite>: The name of a function is by default used as endpoint.  If
endpoint is provided explicitly this value is used.  Additionally this
will be prefixed with the name of the blueprint by default which
cannot be customized from the function itself.</li>
<li><cite>methods</cite>: If methods are not provided when the URL rule is added,
Flask will look on the view function object itself is an <cite>methods</cite>
attribute exists.  If it does, it will pull the information for the
methods from there.</li>
<li><cite>provide_automatic_options</cite>: if this attribute is set Flask will
either force enable or disable the automatic implementation of the
HTTP <cite>OPTIONS</cite> response.  This can be useful when working with
decorators that want to customize the <cite>OPTIONS</cite> response on a per-view
basis.</li>
<li><cite>required_methods</cite>: if this attribute is set, Flask will always add
these methods when registering a URL rule even if the methods were
explicitly overridden in the <code class="docutils literal notranslate"><span class="pre">route()</span></code> call.</li>
</ul>
<p>Full example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span>
        <span class="c1"># custom options handling here</span>
        <span class="o">...</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
<span class="n">index</span><span class="o">.</span><span class="n">provide_automatic_options</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">index</span><span class="o">.</span><span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">]</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Добавлено в версии 0.8: </span>The <cite>provide_automatic_options</cite> functionality was added.</p>
</div>
<p><a class="reference external" href="http://flask.pocoo.org/docs/api/">Оригинал этой страницы</a></p>
</div>
</div>
</div>
</div>
<div class="section" id="id6">
<h2>Дополнительные заметки<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h2>
<p>Здесь заметки для заинтересованных - о дизайне, правовая информация и лог изменений.</p>
<div class="toctree-wrapper compound">
<span id="document-design"></span><div class="section" id="flask">
<span id="design"></span><h3>Проектные решения во Flask<a class="headerlink" href="#flask" title="Ссылка на этот заголовок">¶</a></h3>
<p>Если вам кажется странным, почему Flask делает некоторые вещи именно так,
а не как-нибудь иначе, этот раздел для вас. После его прочтения у вас
должно появиться понимание, почему некоторые проектные решения, на первый
взгляд кажутся случайными и неожиданными, особенно по сравнению с другими
фреймворками.</p>
<div class="section" id="id1">
<h4>Явный объект приложения<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h4>
<p>Веб-приложения на Python, основанные на WSGI, должны обладать центральным
вызываемым объектом, реализующим приложение.  Во Flask это экземпляр
класса <a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a>.  Каждое приложение Flask должно само
создать экземпляр этого класса и передать ему имя модуля, но почему Flask
не может сделать это сам?</p>
<p>Если бы не было явного объекта приложения, то следующий код:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>Выглядел бы так:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hypothetical_flask</span> <span class="k">import</span> <span class="n">route</span>

<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>Для этого есть три основных причины.  Наиболее важная заключается в том,
что неявный объект приложения может существовать одновременно только в
одном экземпляре.  Есть способы сымитировать множество приложений в одном
объекте приложения, например, поддерживая пачку приложений, но это вызовет
некоторые проблемы, в детали которых мы не станем вдаваться.  Следующий
вопрос: в каких случаях микрофреймворку может понадобиться создавать больше
одного приложения одновременно? Хорошим примером является модульное
тестирование.  Когда вам нужно протестировать что-нибудь, может оказаться
полезным создать минимальное приложение для тестирования определённого
поведения.  Когда объект приложения удалятся, занятые им ресурсы снова
становятся свободными.</p>
<p>Другой возможной причиной, почему могут пригодиться явные объекты приложений,
может быть необходимость обернуть объект в дополнительный код, что можно
сделать создав подкласс базового класса (<a class="reference internal" href="index.html#flask.Flask" title="flask.Flask"><code class="xref py py-class docutils literal notranslate"><span class="pre">Flask</span></code></a>) для изменения
части его поведения.  Это невозможно сделать без костылей, если объект был
создан до этого, на основе класса, который вам не доступен.</p>
<p>Но существует и ещё одна очень важная причина, почему Flask зависит от явных
экземпляров классов: имя пакета.  Когда бы вы ни создавали экземпляр Flask,
обычно вы передаёте ему <cite>__name__</cite> в качестве имени пакета.  Flask использует
эту информацию для правильной загрузки ресурсов относящихся к модулю.  При
помощи выдающихся возможностей Python к рефлексии, вы можете получить доступ
к пакету, чтобы узнать, где хранятся шаблоны и статические файлы (см.
<a class="reference internal" href="index.html#flask.Flask.open_resource" title="flask.Flask.open_resource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open_resource()</span></code></a>).  Очевидно, что фреймворкам не требуется
какая-либо настройка и они по-прежнему смогут загружать шаблоны относительно
модуля вашего приложения.  Но они используют для этого текущий рабочий
каталог, поэтому нет возможности надёжно узнать, где именно находится
приложение.  Текущий рабочий каталог одинаков в рамках процесса, поэтому если
запустить несколько приложений в рамках одного процесса (а это может
происходить в веб-сервере, даже если вы об этом не догадываетесь), путь
может измениться.  Даже хуже: многие веб-серверы устанавливают рабочим
каталогом не каталог приложения, а корневой каталог документов, который
обычно является другим каталогом.</p>
<p>Третья причина заключается в том, что «явное лучше неявного». Этот объект -
ваше приложение WSGI, вам больше не нужно помнить о чём-то ещё.  Если вам
нужно воспользоваться промежуточным модулем WSGI, просто оберните его этим
модулем и всё (хотя есть способы лучше, чтобы сделать это, если вы не хотите
потерять ссылки на объект приложения <a class="reference internal" href="index.html#flask.Flask.wsgi_app" title="flask.Flask.wsgi_app"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wsgi_app()</span></code></a>).</p>
<p>Кроме того, такой дизайн делает возможным использование фабричных методов
для создания приложения, которое может оказаться полезным для модульного
тестирования и других подобных вещей (<span class="xref std std-ref">app-factories</span>).</p>
</div>
<div class="section" id="id2">
<h4>Система маршрутизации<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h4>
<p>Flask использует систему маршрутизации Werkzeug, которая была спроектирована
для того, чтобы автоматически упорядочивать маршруты в зависимости от их
сложности.  Это означает, что вы можете объявлять маршруты в произвольном
порядке и они всё равно будут работать ожидаемым образом.  Это необходимо,
если вы хотите, чтобы маршруты, основанные на декораторах, работали
правильно, потому что декораторы могут активироваться в неопределённом
порядке, если приложение разделено на несколько модулей.</p>
<p>Другое проектное решение системы маршрутизации Werkzeug заключается в том,
что Werkzeug старается, чтобы URL’ы были уникальными.  Werkzeug настолько
последователен в этом, что автоматически выполнит переадресацию на
канонический URL, если маршрут окажется неоднозначным.</p>
</div>
<div class="section" id="id3">
<h4>Одна система шаблонизации<a class="headerlink" href="#id3" title="Ссылка на этот заголовок">¶</a></h4>
<p>Flask остановился на одной системе шаблонизации: Jinja2.  Почему Flask не
имеет интерфейса для подключения систем шаблонизации?  Очевидно, что вы
можете использовать любые системы шаблонизации, но Flask всё равно
настроит Jinja2.  Хотя <em>всегда</em> настроенная Jinja2, возможно и не
потребуется, скорее всего нет причин, чтобы не принять решение
воспользоваться единой системой шаблонизации.</p>
<p>Системы шаблонизации похожи на языки программирования и каждая из них
обладает собственным мировоззрением. Внешне они все работают одинаково:
вы просите систему шаблонизации заполнить шаблон набором переменных и
получаете его в виде строки.</p>
<p>Но на этом сходство заканчивается.  Jinja2, например, обдает системой
расширяемых фильтров, возможностью наследования шаблонов, поддержкой
повторного использования блоков (макросов), которые можно использовать
внутри шаблонов и из кода на Python для всех операций, использует Unicode,
поддерживает поэтапную отрисовку шаблонов, настраиваемый синтаксис и
многое другое.  С другой стороны, системы шаблонизации вроде Genshi
основываются на потоковом заполнении XML, наследовании шаблонов с
помощью XPath и т.п.  Mako интерпретирует шаблоны аналогично модулям
Python.</p>
<p>Когда нужно соединить систему шаблонизации с приложением или фреймворком,
требуется больше чем просто отрисовка шаблонов. Например, Flask широко
использует поддержку экранирования из Jinja2.  А ещё он позволяет получить
доступ к макросам из шаблонов Jinja2.</p>
<p>Слой абстракции над системами шаблонизации, учитывающий уникальные
особенности каждой из них - это почти наука, слишком сложная для поддержки
в микрофреймворке вроде Flask.</p>
<p>Кроме того, расширения из-за этого могут оказаться слишком зависимыми от
имеющейся системы шаблонизации.  Вы можете воспользоваться собственным
языком шаблонов, но расширения по-прежнему будут зависеть от Jinja.</p>
</div>
<div class="section" id="id4">
<h4>Микро, но с зависимостями<a class="headerlink" href="#id4" title="Ссылка на этот заголовок">¶</a></h4>
<p>Почему Flask называет себя микрофреймворком, если он зависит от двух
библиотек (а именно - от Werkzeug и Jinja2)? Если посмотреть на Ruby со
стороны веб-разработки, то и там имеется протокол очень похожий на WSGI.
Только там он называется Rack, но всё же он больше похож на реализацию
WSGI для Ruby. Но практически ни одно приложение для Ruby не работает
с Rack напрямую, используя для этого одноимённую библиотеку.  У
библиотеки Rack в Python имеется два аналога: WebOb (прежде известная
под именем Paste) и Werkzeug.  Paste всё ещё существует, но насколько я
понимаю, он уступил своё место в пользу WebOb.  Разработчики WebOb
и Werkzeug развивались параллельно, имея схожие цели: сделать хорошую
реализацию WSGI для использования в других приложениях.</p>
<p>Фреймворк Flask использует преимущества, уже реализованные в Werkzeug
для правильного взаимодействия с WSGI (что иногда может оказаться сложной
задачей).  Благодаря недавним разработкам в инфраструктуре пакетов Python,
пакеты с зависимостями больше не являются проблемой и осталось мало
причин, чтобы воздерживаться от использования библиотек, зависящих от
других библиотек.</p>
</div>
<div class="section" id="id5">
<h4>Локальные объекты потоков<a class="headerlink" href="#id5" title="Ссылка на этот заголовок">¶</a></h4>
<p>Flask использует объекты, локальные внутри потока (фактически - объекты
локального контекста, по сути они поддерживают контексты гринлетов) для
запроса, сеанса и для дополнительного объекта, в который можно положить
собственные объекты (<a class="reference internal" href="index.html#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">g</span></code></a>).  Почему сделано так и почему это
не так уж плохо?</p>
<p>Да, обычно это не лучшая мысль, использовать локальные объекты потоков.
Они могут вызвать проблемы с серверами, которые не основаны на понятии
потоков и приводят к сложностям в сопровождении больших приложений.
Однако, Flask просто не предназначен для больших приложений или
асинхронных серверов.  Flask стремится упростить и ускорить разработку
традиционных веб-приложений.</p>
<p>Также обратитесь к разделу документации <span class="xref std std-ref">becomingbig</span> за мыслями
о том, как стоит писать большие приложения на основе Flask.</p>
</div>
<div class="section" id="id6">
<h4>Что есть Flask и чем он не является<a class="headerlink" href="#id6" title="Ссылка на этот заголовок">¶</a></h4>
<p>Во Flask никогда не будет слоя для работы с базами данных.  В нём нет
библиотеки форм или чего-то подобного.  Flask сам по себе является мостом
к Werkzeug для реализации хорошего приложения WSGI и к Jinja2 для
обработки шаблонов.  Он также связан с несколькими стандартными
библиотеками, например, с библиотекой журналирования logging.  Всё
остальное отдаётся на откуп расширениям.</p>
<p>Почему так?  Потому что люди обладают разными предпочтениями и
требованиями и Flask не сможет удовлетворить их, если всё это будет частью
ядра.  Большинству веб-приложений нужна какая-нибудь система шаблонизации.
Однако не каждому приложению необходима база данных SQL.</p>
<p>Идея Flask заключается в создании хорошей основы для других приложений.
Всё остальное должны сделать вы сами или расширения.</p>
<p><a class="reference external" href="http://flask.pocoo.org/docs/design/">Оригинал этой страницы</a></p>
</div>
</div>
<span id="document-htmlfaq"></span><div class="section" id="faq-html-xhtml">
<h3>FAQ по HTML/XHTML<a class="headerlink" href="#faq-html-xhtml" title="Ссылка на этот заголовок">¶</a></h3>
<p>Документация на Flask и примеры приложений используют HTML5.  Вы могли
заметить, что во многих ситуациях, когда закрывающие теги необязательны,
они не используются, и HTML-код получается более чистым и быстрым при
его загрузке.  Так как среди разработчиков встречается много недопониманий
о HTML и XHTML, этот документ пытается ответить на некоторые самые
главные вопросы.</p>
<div class="section" id="xhtml">
<h4>История XHTML<a class="headerlink" href="#xhtml" title="Ссылка на этот заголовок">¶</a></h4>
<p>Какое-то время назад казалось, что XHTML сменил HTML.  Однико, наврядли
все сайты в Internet являются в точности XHTML (т. е. HTML, подчиняющимся
правилам XML).  На это есть несколько серьёзных причин.  Одна из них в том,
что Internet Explorer не поддерживает XHTML надлежащим образом.  По
спецификации XHTML, он должен снабжаться MIME типом <cite>application/xhtml+xml</cite>,
однако Internet Explorer отвергает при попытках чтения такие файлы.
Хотя сконфигурировать веб-серверы для надлежащей обработки XHTML относительно
просто, мало кто это делает.  Возможно, потому, что правильное использование
XHTML не всегда безболезненно.</p>
<p>Одной из важнейших причин, вызывающих болезненную реакцию, является
драконовская - строгая и беспощадная - обработка ошибок со стороны XML.
Если при парсинге XML браузер встречает ошибку, он он должен показать
пользователю безобразное сообщение об ошибке, вместо попытки восстановить
свою работу с отображением того, что возможно.  Большинство генераторов
(X)HTML в Интернет  построены на не-XML шаблонизаторах (например, на Jinja,
которым пользуется Flask), которые не защищают вас от случайного создания
недопустимого XHTML.  Конечно, существуют и заточенные под XML шаблонизаторы,
такие, как Kid и популярный Genshi, однако, так как им приходится
подчиняться правилам XML, часто они работают с повышенными накладными
вычислительными расходами и не слишком просты в использовании.</p>
<p>Однако, большинство пользователей считают, что они используют XHTML
надлежащим образом.  Они указывают в начале документа doctype как XHTML,
и самостоятельно закрывают все необходимые тэги (<code class="docutils literal notranslate"><span class="pre">&lt;br&gt;</span></code> становится
<code class="docutils literal notranslate"><span class="pre">&lt;br/&gt;</span></code> или <code class="docutils literal notranslate"><span class="pre">&lt;br&gt;&lt;/br&gt;</span></code> в XHTML).  Однаког, даже если документ
проходит все проверки на соответствие правилам XHTML, то, как происходит
реальная обработка браузером, определяется MIME-типом, который, как
упомяналось ранее, часто указан не так, как надо.  В итоге вполне годный
XHTML обрабатывается, как неправильный HTML.</p>
<p>Также, XHTML сменил способ работы с JavaScript.  Для надлежащей работы с
XHTML, для запроса элементов HTML, программисты должны использовать интерфейс
DOM с пространствами имён, в данном случае - с пространством имён XHTML.</p>
</div>
<div class="section" id="html5">
<h4>История HTML5<a class="headerlink" href="#html5" title="Ссылка на этот заголовок">¶</a></h4>
<p>Разработка спецификации HTML5 стартовала в 2004 году под названием
«Web Applications 1.0».  Работа велась группой «Web Hypertext Application
Technology Working Group» (сокращённо WHATWG), которую сформировали
основные поставщики браузеров - Apple, Mozilla и Opera.  Была поставлена
задача закрепить новую улучшенную спецификацию HTML, с учётом исторически
сложившегося поведения браузеров, без революционного отрыва от реальности
и с учётом необходимости сохранения обратной совместимости.</p>
<p>К примеру, в HTML4 <code class="docutils literal notranslate"><span class="pre">&lt;title/Hello/</span></code> теоретически, парсится в точности,
как и <code class="docutils literal notranslate"><span class="pre">&lt;title&gt;Hello&lt;/title&gt;</span></code>.  Однако, поскольку люди используют
тэги в стиле XHTML, типа <code class="docutils literal notranslate"><span class="pre">&lt;link</span> <span class="pre">/&gt;</span></code>, производители браузеров внедрили
синтаксис XHTML поверх определённого спецификацией синтаксиса.</p>
<p>В 2007 году, под эгидой W3C, спецификация была принята в качестве основы
для новой спецификации HTML, известной как HTML5.  В настоящее время
заметна такая тенденция, что XHTML сдаёт позиции, группа по XHTML2
расформирована, а HTML5 внедряется всеми основными разработчиками
браузеров.</p>
</div>
<div class="section" id="html-xhtml">
<h4>HTML в сравнении с XHTML<a class="headerlink" href="#html-xhtml" title="Ссылка на этот заголовок">¶</a></h4>
<p>Следующая таблица даст вам краткий обзор возможностей, доступных в
HTML 4.01, XHTML 1.1 и HTML5. (XHTML 1.0 не включён, так как его сменил
XHTML 1.1, а также не слишком часто используемый XHTML5.)</p>
<table border="1" class="docutils">
<colgroup>
<col width="55%" />
<col width="15%" />
<col width="16%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">HTML4.01</th>
<th class="head">XHTML1.1</th>
<th class="head">HTML5</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">&lt;tag/value/</span></code> == <code class="docutils literal notranslate"><span class="pre">&lt;tag&gt;value&lt;/tag&gt;</span></code></td>
<td><a href="#id13"><span class="problematic" id="id14">|Да|</span></a> <a class="footnote-reference" href="#id6" id="id1">[1]</a></td>
<td><a href="#id15"><span class="problematic" id="id16">|Нет|</span></a></td>
<td><a href="#id17"><span class="problematic" id="id18">|Нет|</span></a></td>
</tr>
<tr class="row-odd"><td>поддержка <code class="docutils literal notranslate"><span class="pre">&lt;br/&gt;</span></code></td>
<td><a href="#id2"><span class="problematic" id="id3">|</span></a>Нет</td>
<td><a href="#id19"><span class="problematic" id="id20">|Да|</span></a></td>
<td><a href="#id21"><span class="problematic" id="id22">|Да|</span></a> <a class="footnote-reference" href="#id7" id="id4">[2]</a></td>
</tr>
<tr class="row-even"><td>поддержка <code class="docutils literal notranslate"><span class="pre">&lt;script/&gt;</span></code></td>
<td><a href="#id23"><span class="problematic" id="id24">|Нет|</span></a></td>
<td><a href="#id25"><span class="problematic" id="id26">|Да|</span></a></td>
<td><a href="#id27"><span class="problematic" id="id28">|Нет|</span></a></td>
</tr>
<tr class="row-odd"><td>должен предоставляться, как <cite>text/html</cite></td>
<td><a href="#id29"><span class="problematic" id="id30">|Да|</span></a></td>
<td><a href="#id31"><span class="problematic" id="id32">|Нет|</span></a> <a class="footnote-reference" href="#id8" id="id5">[3]</a></td>
<td><a href="#id33"><span class="problematic" id="id34">|Да|</span></a></td>
</tr>
<tr class="row-even"><td>должен предоставляться, как
<cite>application/xhtml+xml</cite></td>
<td><a href="#id35"><span class="problematic" id="id36">|Нет|</span></a></td>
<td><a href="#id37"><span class="problematic" id="id38">|Да|</span></a></td>
<td><a href="#id39"><span class="problematic" id="id40">|Нет|</span></a></td>
</tr>
<tr class="row-odd"><td>строгая обработка ошибок</td>
<td><a href="#id41"><span class="problematic" id="id42">|Нет|</span></a></td>
<td><a href="#id43"><span class="problematic" id="id44">|Да|</span></a></td>
<td><a href="#id45"><span class="problematic" id="id46">|Нет|</span></a></td>
</tr>
<tr class="row-even"><td>встроенная поддержка SVG</td>
<td><a href="#id47"><span class="problematic" id="id48">|Нет|</span></a></td>
<td><a href="#id49"><span class="problematic" id="id50">|Да|</span></a></td>
<td><a href="#id51"><span class="problematic" id="id52">|Да|</span></a></td>
</tr>
<tr class="row-odd"><td>встроенная поддержка MathML</td>
<td><a href="#id53"><span class="problematic" id="id54">|Нет|</span></a></td>
<td><a href="#id55"><span class="problematic" id="id56">|Да|</span></a></td>
<td><a href="#id57"><span class="problematic" id="id58">|Да|</span></a></td>
</tr>
<tr class="row-even"><td>тэг <code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code></td>
<td><a href="#id59"><span class="problematic" id="id60">|Нет|</span></a></td>
<td><a href="#id61"><span class="problematic" id="id62">|Нет|</span></a></td>
<td><a href="#id63"><span class="problematic" id="id64">|Да|</span></a></td>
</tr>
<tr class="row-odd"><td>тэг <code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code></td>
<td><a href="#id65"><span class="problematic" id="id66">|Нет|</span></a></td>
<td><a href="#id67"><span class="problematic" id="id68">|Нет|</span></a></td>
<td><a href="#id69"><span class="problematic" id="id70">|Да|</span></a></td>
</tr>
<tr class="row-even"><td>Новые семантические тэги, такие, как
<code class="docutils literal notranslate"><span class="pre">&lt;article&gt;</span></code></td>
<td><a href="#id71"><span class="problematic" id="id72">|Нет|</span></a></td>
<td><a href="#id73"><span class="problematic" id="id74">|Нет|</span></a></td>
<td><a href="#id75"><span class="problematic" id="id76">|Да|</span></a></td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Эта непонятная особенность унаследована из SGML. Она не поддерживается
браузерами по причинам, более подробно изложенным выше.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td>Сохранено для совместимости с кодом сервера, который генерирует тэги типа
<code class="docutils literal notranslate"><span class="pre">&lt;br&gt;</span></code>.  Не должно использоваться в новом коде.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td>XHTML 1.0 - последний стандарт XHTML, который может быть обслужен как
<cite>text/html</cite>, исходя из цели обеспечения обратной совместимости.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="id9">
<h4>Что означает «строгий»?<a class="headerlink" href="#id9" title="Ссылка на этот заголовок">¶</a></h4>
<p>Для HTML5 есть строго определённые правила парсинга, кроме того, он
описывает, каким образом, в точности, должен реагировать браузер на ошибки
парсинга - в отличие от XHTML, в котором сформулировано просто прерывание
парсинга.  Некоторых людей смущает, что очевидно недопустимый синтаксис всё
ещё генерирует ожидаемые результаты (например, при отсутствии закрывающих
тэгов или при незаключённых в кавычки атрибутах).</p>
<p>Некоторые из этих ошибок работают, так как у большинство браузеров, когда
они сталкиваются с ошибками разметки, то используют их мягкую обработку,
другие указаны фактически.  По стандарту, следующие конструкции  HTML5 не
являются обязательными, но должны поддерживаться браузерами:</p>
<ul class="simple">
<li>Оборачивание документа в тэг <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code></li>
<li>Оборачивание элементов заголовка в <code class="docutils literal notranslate"><span class="pre">&lt;head&gt;</span></code> или элементов тела в
<code class="docutils literal notranslate"><span class="pre">&lt;body&gt;</span></code></li>
<li>Закрытие тэгов <code class="docutils literal notranslate"><span class="pre">&lt;p&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;li&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;dt&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;dd&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;tr&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;td&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;th&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;tbody&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;thead&gt;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&lt;tfoot&gt;</span></code>.</li>
<li>Атрибуты цитирования, пока они не содержат пробелов или
специальных символов (таких, как <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">'</span></code>, или <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>).</li>
<li>Требование, чтобы логические атрибуты имели значение.</li>
</ul>
<p>Это значит, что следующая HTML5-страница является абсолютно допустимой:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Привет, HTML5<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">header</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Привет, HTML5<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">tagline</span><span class="p">&gt;</span>HTML5 прекрасен
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">nav</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">/index</span><span class="p">&gt;</span>Начало<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">/downloads</span><span class="p">&gt;</span>Загрузки<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">/about</span><span class="p">&gt;</span>О сайте<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Возможно, HTML5 - это будущее<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    Может быть, бывает и нечто иное, но с точки зрения поддержки
    разработчиками браузеров, HTML5 сложно превзойти.
  <span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Ключ 1
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>Значение 1
    <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span>Ключ 2
    <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>Значение 2
  <span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h4>Новые технологии в HTML5<a class="headerlink" href="#id10" title="Ссылка на этот заголовок">¶</a></h4>
<p>HTML5 добавил много новых особенностей, которые делают веб-приложения
более лёгкими в написании и использовании.</p>
<ul class="simple">
<li>Тэги <code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code> и <code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code> дают способ встроить аудио и видео без
лишних сложностей с дополнениями типа QuickTime или Flash.</li>
<li>Семантические элементы типа <code class="docutils literal notranslate"><span class="pre">&lt;article&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;header&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;nav&gt;</span></code> и
<code class="docutils literal notranslate"><span class="pre">&lt;time&gt;</span></code>, делающие содержимое более простым для понимания.</li>
<li>Тэг <code class="docutils literal notranslate"><span class="pre">&lt;canvas&gt;</span></code>, который поддерживает мощный API для рисования, снижает
потребность в изображениях, генерируемых сервером для представления
данных в графическом виде.</li>
<li>Новые типа контроля над формами, такие, как <code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">type=&quot;date&quot;&gt;</span></code>,
которые позволяют агентам пользователя упросить ввод и проверку
значенийthat.</li>
<li>Расширенные API для JavaScript APIs типа Web Storage, Web Workers, Web Sockets,
geolocation, и оффлайновые приложения.</li>
</ul>
<p>Также, было добавлено много других особенностей.  Хорошее руководство по новым
особенностям HTML5 это книга Марка Пилигрима (Mark Pilgrim), которая вот-вот выйдет
в свет, под названием <a class="reference external" href="https://www.ozon.ru/context/detail/id/28302257/?partner=flask-russian-docs">Погружение в HTML5</a> (Dive Into HTML5).</p>
</div>
<div class="section" id="id12">
<h4>Что следует использовать?<a class="headerlink" href="#id12" title="Ссылка на этот заголовок">¶</a></h4>
<p>В настоящий ответ, ответ: HTML5.  Учитывая последние разработки в области
веб-браузеров, есть очень мало причин к использованию XHTML.  Подытожим причины,
перечисленные выше:</p>
<ul class="simple">
<li>Internet Explorer (который, к несчастью, занимает наибольшую долю рынка)
имеет слабую поддержку XHTML.</li>
<li>Многие библиотеки JavaScript также не поддерживают XHTML, из-за более
сложного пространства имён API, который он требует.</li>
<li>HTML5 добавляет несколько новых особенностей, включая семантические тэги и
долгожданные тэги <code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code>.</li>
<li>Имеет за собой поддержку большинства фирм-разработчиков браузеров.</li>
<li>На нём проще писать, и результат получается более кратким.</li>
</ul>
<p>Для большинства приложений, несомненно, лучше использовать HTML5, а не XHTML.</p>
</div>
</div>
</div>
</div>
<div class="section" id="id7">
<h2>Статус перевода на 01.09.2014<a class="headerlink" href="#id7" title="Ссылка на этот заголовок">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-summary"></span><div class="section" id="id1">
<h3>Статус перевода на 01.09.2014<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h3>
<p>(Этот раздел на стадии формирования)</p>
<table border="1" class="docutils">
<colgroup>
<col width="63%" />
<col width="22%" />
<col width="9%" />
<col width="7%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Раздел
(оригинальное название)</th>
<th class="head">Раздел
(русский перевод)</th>
<th class="head">Объём
в процентах</th>
<th class="head">Сотояние
перевода</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td colspan="4"><strong>Руководство пользователя</strong></td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://flask.pocoo.org/docs/foreword/">Foreword</a></td>
<td><a class="reference internal" href="index.html#foreword"><span class="std std-ref">Предисловие</span></a></td>
<td>0.6%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://flask.pocoo.org/docs/advanced_foreword/">Foreword for Experienced Programmers</a></td>
<td><a class="reference internal" href="index.html#advanced-foreword"><span class="std std-ref">Предисловие для опытных программистов</span></a></td>
<td>0.7%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://flask.pocoo.org/docs/installation/">Installation</a></td>
<td><a class="reference internal" href="index.html#installation"><span class="std std-ref">Инсталляция</span></a></td>
<td>1.7</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://flask.pocoo.org/docs/quickstart/">Quickstart</a></td>
<td><a class="reference internal" href="index.html#quickstart"><span class="std std-ref">Быстрый старт</span></a></td>
<td>8.5</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/">**Tutorial**</a></td>
<td><a class="reference internal" href="index.html#tutorial"><span class="std std-ref">Учебник</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/introduction">Introducing Flaskr</a></li>
</ul>
</td>
<td><ul class="first last simple">
<li><a class="reference internal" href="index.html#tutorial-introduction"><span class="std std-ref">Введение в Flaskr</span></a></li>
</ul>
</td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><ul class="first last simple">
<li><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/folders">Step 0: Creating The Folders</a></li>
</ul>
</td>
<td><ul class="first last simple">
<li><a class="reference internal" href="index.html#tutorial-folders"><span class="std std-ref">Шаг 0: Создание папок</span></a></li>
</ul>
</td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/schema">Step 1: Database Schema</a></li>
</ul>
</td>
<td><ul class="first last simple">
<li><a class="reference internal" href="index.html#tutorial-schema"><span class="std std-ref">Шаг 1: Схема базы данных</span></a></li>
</ul>
</td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><ul class="first last simple">
<li><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/setup">Step 2: Application Setup Code</a></li>
</ul>
</td>
<td><ul class="first last simple">
<li><a class="reference internal" href="index.html#tutorial-setup"><span class="std std-ref">Шаг 2: Код для настройки приложения</span></a></li>
</ul>
</td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/dbinit">Step 3: Creating The Database</a></li>
</ul>
</td>
<td><ul class="first last simple">
<li><a class="reference internal" href="index.html#tutorial-dbinit"><span class="std std-ref">Шаг 4: Создание базы данных</span></a></li>
</ul>
</td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><ul class="first last simple">
<li><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/dbcon">Step 4: Request Database Connections</a></li>
</ul>
</td>
<td><ul class="first last simple">
<li><a class="reference internal" href="index.html#tutorial-dbcon"><span class="std std-ref">Шаг 3: Соединения с базой данных</span></a></li>
</ul>
</td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/views">Step 5: The View Functions</a></li>
</ul>
</td>
<td><ul class="first last simple">
<li><a class="reference internal" href="index.html#tutorial-views"><span class="std std-ref">Шаг 5: Функции представления</span></a></li>
</ul>
</td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><ul class="first last simple">
<li><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/templates">Step 6: The Templates</a></li>
</ul>
</td>
<td><ul class="first last simple">
<li><a class="reference internal" href="index.html#tutorial-templates"><span class="std std-ref">Шаг 6: Шаблоны</span></a></li>
</ul>
</td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><ul class="first last simple">
<li><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/css">Step 7: Adding Style</a></li>
</ul>
</td>
<td><ul class="first last simple">
<li><a class="reference internal" href="index.html#tutorial-css"><span class="std std-ref">Шаг 7: Добавление стиля</span></a></li>
</ul>
</td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><ul class="first last simple">
<li><a class="reference external" href="http://flask.pocoo.org/docs/tutorial/testing">Bonus: Testing The Application</a></li>
</ul>
</td>
<td><ul class="first last simple">
<li><a class="reference internal" href="index.html#tutorial-testing"><span class="std std-ref">Бонус: Тестирование приложения</span></a></li>
</ul>
</td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://flask.pocoo.org/docs/templating/">Templates</a></td>
<td><a class="reference internal" href="index.html#templating"><span class="std std-ref">Шаблоны</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://flask.pocoo.org/docs/testing/">Testing Flask Applications</a></td>
<td><a class="reference internal" href="index.html#testing"><span class="std std-ref">Тестирование приложений Flask</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://flask.pocoo.org/docs/errorhandling/">Logging Application Errors</a></td>
<td><a class="reference internal" href="index.html#application-errors"><span class="std std-ref">Журналирование ошибок приложения</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://flask.pocoo.org/docs/config/">Configuration Handling</a></td>
<td><a class="reference internal" href="index.html#config"><span class="std std-ref">Обработка конфигурации Flask</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://flask.pocoo.org/docs/signals/">Signals</a></td>
<td><a class="reference internal" href="index.html#signals"><span class="std std-ref">Сигналы</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://flask.pocoo.org/docs/views/">Pluggable Views</a></td>
<td><a class="reference internal" href="index.html#views"><span class="std std-ref">Сменные представления (Pluggable Views)</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://flask.pocoo.org/docs/appcontext/">The Application Context</a></td>
<td><a class="reference internal" href="index.html#app-context"><span class="std std-ref">Контекст приложения Flask</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://flask.pocoo.org/docs/reqcontext/">The Request Context</a></td>
<td><a class="reference internal" href="index.html#request-context"><span class="std std-ref">Контекст запроса Flask</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://flask.pocoo.org/docs/blueprints/">Modular Applications with Blueprints</a></td>
<td><a class="reference internal" href="index.html#blueprints"><span class="std std-ref">Модульные приложения Flask с использованием blueprint’ов</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://flask.pocoo.org/docs/extensions/">Flask Extensions</a></td>
<td><a class="reference internal" href="index.html#extensions"><span class="std std-ref">Расширения Flask</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://flask.pocoo.org/docs/shell/">Working with the Shell</a></td>
<td><a class="reference internal" href="index.html#shell"><span class="std std-ref">Работа с командной оболочкой</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://flask.pocoo.org/docs/patterns/">Patterns for Flask</a></td>
<td><a class="reference internal" href="index.html#patterns"><span class="std std-ref">Заготовки для Flask</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://flask.pocoo.org/docs/deploying/">Deployment Options</a></td>
<td><a class="reference internal" href="index.html#deployment"><span class="std std-ref">Варианты развёртывания</span></a></td>
<td>1.%</td>
<td>+(beta)</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://flask.pocoo.org/docs/becomingbig/">Becoming Big</a></td>
<td><span class="xref std std-ref">becomingbig</span></td>
<td>1.%</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><a class="reference external" href="http://flask.pocoo.org/docs/0.10/">Оригинал этой страницы</a></p>
<p>© 2012-2018 Перевод ferm32</p>
<p>© 2013 Перевод разделов design, … <a class="reference external" href="http://vladimir-stupin.blogspot.ru/">http://vladimir-stupin.blogspot.ru/</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<!--<p class="logo"><a href="index.html#document-index"><img src="_static/flask-small.png" />
</a></p>-->
<table cellspacing="0">
<tr>
<td><a href="https://media.readthedocs.org/pdf/flask-russian-docs/latest/flask-russian-docs.pdf">PDF
</a></p></td>
<td><a href="https://media.readthedocs.org/htmlzip/flask-russian-docs/latest/flask-russian-docs.zip">HTML
</a></p></td>
<td><a href="https://media.readthedocs.org/epub/flask-russian-docs/latest/flask-russian-docs.epub">Epub
</a></p></td>
</tr>
<tr>
<p><a href="https://www.ozon.ru/context/detail/id/135559040/?partner=flask-russian-docs"><img src="_static/grinberg-flask.jpg" 
  alt="flask russian book"></a>
</p>
</tr>
</table>

  <h3><a href="index.html#document-index">Оглавление</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-foreword">Предисловие</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Что означает «микро»?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Конфигурация и Соглашения</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#flask">Расти вместе с Flask</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-advanced_foreword">Предисловие для опытных программистов</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#thread-locals-flask">Внутрипоточные объекты (Thread-Locals) во Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Разработка для Веб с осторожностью</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#python-3">Статус Python 3</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installation">Инсталляция</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#virtualenv">virtualenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Установка непосредственно в систему</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Жизнь на переднем краю</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#pip-setuptools-ms-windows"><cite>pip</cite> и <cite>setuptools</cite> в MS Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-quickstart">Быстрый старт</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Минимальное приложение</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#debug-mode">Режим отладки</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Маршрутизация</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id6">Статические файлы</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id7">Визуализация шаблонов</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id11">Доступ к данным запроса</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id15">Ошибки и перенаправления</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#about-responses">Об ответах</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sessions">Сессии</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#message-flashing">Message Flashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id18">Ведение журналов</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#hooking-wsgi">Как зацепиться (hooking) к промежуточному слою WSGI</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#quickstart-deployment">Развёртывание приложения на веб-сервере</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-tutorial/index">Учебник</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/introduction">Введение в Flaskr</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/folders">Шаг 0: Создание папок</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/schema">Шаг 1: Схема базы данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/setup">Шаг 2: Код для настройки приложения</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/dbcon">Шаг 3: Соединения с базой данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/dbinit">Шаг 4: Создание базы данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/views">Шаг 5: Функции представления</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/templates">Шаг 6: Шаблоны</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/css">Шаг 7: Добавление стиля</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-tutorial/testing">Бонус: Тестирование приложения</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-templating">Шаблоны</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#jinja">Установка Jinja</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Стандартный контекст</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Стандартные фильтры</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Управление автоэкранированием</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registering-filters">Регистрация фильтров</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id6">Процессоры контекста</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-testing">Тестирование приложений Flask</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Приложение</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Скелет для тестирования</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Первый тест</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">Вход и выход</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id6">Тестирование добавления сообщений</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id7">Другие трюки с тестами</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#faking-resources">Подделка ресурсов и контекста</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id9">Сохранение окружения контекста</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id10">Доступ к сессиям и их изменение</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-errorhandling">Журналирование ошибок приложения</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Письма об ошибках</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Журналирование в файл</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Управление форматом журнала</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id9">Другие библиотеки</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#id10">Отладка ошибок приложения</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id11">В случае сомнений запускайте вручную</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-debuggers">Работа с отладчиками</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-config">Обработка конфигурации Flask</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Основы конфигурации</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Встроенные параметры конфигурации</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Задание конфигурации с помощью файлов</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Лучшие способы задания конфигурации</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">Режим разработки и режим эксплуатации</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#instance-folders">Каталоги экземпляров</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id7">Примечания переводчика</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-signals">Сигналы</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Подписка на сигналы</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Создание сигналов</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#signals-sending">Отправка сигналов</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#flask">Сигналы и контекст запроса Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">Подписки на сигналы с использованием декоратора</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id6">Сигналы ядра</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-views">Сменные представления (Pluggable Views)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Основной принцип</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Подсказки метода</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Диспетчеризация на базе метода</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Декорирующие представления</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#api">Представления метода для различных API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-appcontext">Контекст приложения Flask</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Назначение контекста приложения</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Создание контекста приложения</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Локальность контекста</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Использование контекста</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-reqcontext">Контекст запроса Flask</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Подробнее о локальных объектах контекста</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Как работает контекст</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#callbacks-and-errors">Функции обратного вызова и ошибки</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#teardown-request">Функции обратного вызова teardown_request</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#notes-on-proxies">Замечания о посредниках</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">Защита контекста при ошибках</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-blueprints">Модульные приложения Flask с использованием blueprint’ов</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#blueprint">Для чего нужны blueprint’ы?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Концепция blueprint’ов</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Мой первый blueprint</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Регистрация blueprint’ов</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Ресурсы blueprint’а</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#url">Генерирование URL’ов</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id8">Обработчики ошибок</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-extensions">Расширения Flask</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Поиск расширений</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Использование расширений</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#flask-0-8">Flask до версии 0.8</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-shell">Работа с командной оболочкой</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Создание контекста запроса</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Формирование запроса до/после</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Дальнейшее развитие опыта работы с командной оболочкой</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-patterns/index">Заготовки для Flask</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/packages">Большие приложения во Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/sqlalchemy">SQLAlchemy во Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/fileuploads">Загрузка файлов</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/caching">Кэширование</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/viewdecorators">Декораторы представлений во Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/flashing">Всплывающие сообщения</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-patterns/errorpages">Собственные страницы ошибок</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-deploying/index">Варианты развёртывания</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-deploying/mod_wsgi">Настройка mod_wsgi (Apache) для Flask</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-deploying/fastcgi">FastCGI</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api">API (перевод на начальной стадии)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Объект приложения</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#blueprint">Объекты blueprint</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Данные входящих запросов</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Объекты ответа</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">Сессии</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id6">Интерфейс сессий</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id7">Тестовый клиент</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id8">Глобальные переменные</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id9">Полезные функции и классы</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id10">Передача сообщений</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#module-flask.json">Поддержка JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id11">Отрисовка шаблонов</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id12">Конфигурация</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id13">Расширения</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id14">Потоки</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id15">Внутренние дополнения</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id16">Сигналы</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#class-based-views">Class-Based Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#url-route-registrations">URL Route Registrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#view-function-options">View Function Options</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-design">Проектные решения во Flask</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Явный объект приложения</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">Система маршрутизации</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id3">Одна система шаблонизации</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id4">Микро, но с зависимостями</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">Локальные объекты потоков</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id6">Что есть Flask и чем он не является</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-htmlfaq">FAQ по HTML/XHTML</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#xhtml">История XHTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#html5">История HTML5</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#html-xhtml">HTML в сравнении с XHTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id9">Что означает «строгий»?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id10">Новые технологии в HTML5</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id12">Что следует использовать?</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-summary">Статус перевода на 01.09.2014</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Быстрый поиск</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Искать" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Навигация</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html#document-index">Документация Flask (русский перевод) 0.10.1</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2013, Armin Ronacher.
    </div>

<!-- Yandex.Metrika informer -->
<a href="https://metrika.yandex.ru/stat/?id=25069343&amp;from=informer"
target="_blank" rel="nofollow"><img src="//bs.yandex.ru/informer/25069343/3_1_FFFFFFFF_EFEFEFFF_0_pageviews"
style="width:88px; height:31px; border:0;" alt="Яндекс.Метрика" title="Яндекс.Метрика: данные за сегодня (просмотры, визиты и уникальные посетители)" onclick="try{Ya.Metrika.informer({i:this,id:25069343,lang:'ru'});return false}catch(e){}"/></a>
<!-- /Yandex.Metrika informer -->

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
(function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
                    try {
                                    w.yaCounter25069343 = new Ya.Metrika({id:25069343,
                                                        clickmap:true,
                                                                            trackLinks:true,
                                                                                                accurateTrackBounce:true});
                                            } catch(e) { }
                                                });

            var n = d.getElementsByTagName("script")[0],
                    s = d.createElement("script"),
                            f = function () { n.parentNode.insertBefore(s, n); };
                                s.type = "text/javascript";
                                    s.async = true;
                                        s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

                                            if (w.opera == "[object Opera]") {
                                                        d.addEventListener("DOMContentLoaded", f, false);
                                                            } else { f(); }
})(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="//mc.yandex.ru/watch/25069343" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
<hr />
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'ferm32'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    


  </body>
</html>